=== PROJECT CONTEXT EXPORT ===

PROJECT STRUCTURE:
tool_crawl_quang_cao/
    b77da63d-af55-43c2-ab7f-364250b20e30.json
    comments.json
    readme.md
    response_debug.txt
    users.json
    backend/
        .gitignore
        main.py
        requirements.txt
        response_debug.txt
        app/
            api.py
            __init__.py
        config/
            cloneM.txt
            groups.json
            payload.txt
            settings.json
        core/
            browser.py
            control.py
            join_groups.py
            nst.py
            runner.py
            scraper.py
            search_worker.py
            settings.py
            utils.py
        data/
            runtime_control.json
            post_ids/
                b77da63d-af55-43c2-ab7f-364250b20e30.json
            results/
                all_results_20251222_220621.json
                all_results_20251222_221333.json
                all_results_20251222_221814.json
        worker/
            check_cookies.py
            get_all_info.py
            get_id.py
            get_payload.py
            get_post_from_page.py
            single_get_comment.py
            single_get_reactions.py
    data/
    frontend/
        data.json
        index.html
        script.js
        style.css
        icon/
            Icon_of_Zalo.svg.webp
            logo-messenger-inkythuatso-2-01-30-15-47-51.jpg
            zalo-icon.png

==================================================

--- START FILE: b77da63d-af55-43c2-ab7f-364250b20e30.json ---
[

  {
    "id": "122152945058694563",
    "flag": "xanh",
    "text": "üéâ üå∏ ‚ÄúT·∫øt ƒë·∫øn xu√¢n v·ªÅ ‚Äì t√¨m vi·ªác ƒë√¢u xa, Vingroup ch√†o ƒë√≥n ‚Äì m·ªü l·ªëi thƒÉng hoa!‚Äù üå∏ üéâ üè¢ VINGROUP ‚Äì TUY·ªÇN D·ª§NG KH·ªêI VƒÇN PH√íNG TO√ÄN QU·ªêC üáªüá≥ üáªüá≥ B·∫°n ƒëang t√¨m ki·∫øm m·ªôt m√¥i tr∆∞·ªùng ·ªïn ƒë·ªãnh ‚Äì chuy√™n nghi·ªáp ‚Äì c√≥ l·ªô tr√¨nh thƒÉng ti·∫øn r√µ r√†ng? üáªüá≥ Vingroup ‚Äì T·∫≠p ƒëo√†n kinh t·∫ø t∆∞ nh√¢n h√†ng ƒë·∫ßu Vi·ªát Nam ‚Äì ƒëang m·ªü r·ªông ƒë·ªôi ng≈© vƒÉn ph√≤ng tr√™n to√†n qu·ªëc, s·∫µn s√†ng ƒë·ªìng h√†nh c√πng b·∫°n b∆∞·ªõc v√†o nƒÉm m·ªõi v·ªõi nhi·ªÅu c∆° h·ªôi ph√°t tri·ªÉn ƒë·ªôt ph√°. üí¢ V·ªä TR√ç ƒêANG TUY·ªÇN üîñ Nh√¢n Vi√™n K·∫ø To√°n üîñ Chuy√™n Vi√™n Qu·∫£n L√Ω Kinh Doanh üîñ Nh√¢n Vi√™n T∆∞ V·∫•n ChƒÉm S√≥c Kh√°ch H√†ng üîñ Tr∆∞·ªüng Ph√≤ng Xu·∫•t Nh·∫≠p Kh·∫©u üîñ Tr∆∞·ªüng Ph√≤ng Ti·∫øp Th·ªã Th∆∞∆°ng M·∫°i üîñ Tr∆∞·ªüng Ph√≤ng H√†nh Ch√≠nh Nh√¢n S·ª± üìç L√†m vi·ªác t·∫°i c√°c vƒÉn ph√≤ng ƒë·∫°i di·ªán tr√™n to√†n qu·ªëc üéØ T·∫†I SAO B·∫†N N√äN ·ª®NG TUY·ªÇN NGAY? ‚ñ™Ô∏è Thu nh·∫≠p h·∫•p d·∫´n, th∆∞·ªüng T·∫øt r√µ r√†ng ‚ñ™Ô∏è B·∫£o hi·ªÉm ƒë·∫ßy ƒë·ªß, ph√∫c l·ª£i ·ªïn ƒë·ªãnh ‚ñ™Ô∏è C∆° h·ªôi ph√°t tri·ªÉn s·ª± nghi·ªáp, ƒë∆∞·ª£c ƒë√†o t·∫°o chuy√™n s√¢u ‚ñ™Ô∏è M√¥i tr∆∞·ªùng l√†m vi·ªác minh b·∫°ch, hi·ªán ƒë·∫°i, chuy√™n nghi·ªáp üì® N·ªôp h·ªì s∆° tr·ª±c tuy·∫øn t·∫°i: https://qrco.de/tuyendungVinGroup üëâ Tag ng∆∞·ªùi ph√π h·ª£p ho·∫∑c chia s·∫ª ngay c∆° h·ªôi tuy·ªát v·ªùi n√†y! üåü VINGROUP ‚Äì N∆°i t√†i nƒÉng ƒë∆∞·ª£c ph√°t huy v√† th√†nh c√¥ng ƒë∆∞·ª£c ghi nh·∫≠n. C√πng kh·ªüi ƒë·ªông nƒÉm m·ªõi v·ªõi b∆∞·ªõc ti·∫øn v·ªØng v√†ng trong s·ª± nghi·ªáp! #Vingroup #TuyenDungTet2025 #CoHoiNgheNghiep #ViecLamVanPhong #DonXuanVingroup",
    "owning_profile": {
      "__typename": "User",
      "name": "Tuy·ªÉn D·ª•ng VinGroup",
      "id": "61570836905496"
    }
  },
  {
    "id": "4432161690347913",
    "flag": "v√†ng",
    "text": "[H√† ƒê√¥ng, HN] TUY·ªÇN V·∫¨N H√ÄNH S√ÄN TMƒêT L∆Ø∆†NG 6M - 12M !! KH√îNG YC KINH NGHI·ªÜM",
    "owning_profile": {
      "__typename": "User",
      "name": "Nguy·ªÖn H√† Thu",
      "id": "100007869585114"
    }
  },
  {
    "id": "122171583440394422",
    "flag": "xanh",
    "text": "‚ú® NHA KHOA META TUY·ªÇN D·ª§NG ‚ú® V·ªã tr√≠: B√°c sƒ© RƒÉng S·ª© Th·∫©m M·ªπ Ch√∫ng t√¥i t√¨m ki·∫øm b√°c sƒ© c√≥ ƒë·ªãnh h∆∞·ªõng ph√°t tri·ªÉn l√¢u d√†i trong lƒ©nh v·ª±c rƒÉng s·ª© th·∫©m m·ªπ, mong mu·ªën l√†m vi·ªác trong m√¥i tr∆∞·ªùng chu·∫©n ch·ªânh, t√¥n tr·ªçng chuy√™n m√¥n v√† gi√° tr·ªã c√° nh√¢n. üí∞ Thu nh·∫≠p: Th·ªèa thu·∫≠n theo nƒÉng l·ª±c (L∆∞∆°ng c·ª©ng + KPI + Th∆∞·ªüng + Ph·ª• c·∫•p) üîπ H·ªá th·ªëng m√°y m√≥c hi·ªán ƒë·∫°i üîπ Ngu·ªìn kh√°ch ·ªïn ƒë·ªãnh üîπ Ekip h·ªó tr·ª£ chuy√™n m√¥n üîπ Quy tr√¨nh r√µ r√†ng ‚Äì minh b·∫°ch üìç ƒê·ªãa ch·ªâ: 391 Tr∆∞·ªùng Chinh, Thanh Xu√¢n, H√† N·ªôi üì≤ Li√™n h·ªá ·ª©ng tuy·ªÉn: 036.903.6666",
    "owning_profile": {
      "__typename": "User",
      "name": "Tuy·ªÉn D·ª•ng Nh√¢n S·ª± Nha Khoa H√† N·ªôi",
      "id": "61561832674763"
    }
  },
  {
    "id": "24955032474094131",
    "flag": "v√†ng",
    "text": "[BSV] Tuy·ªÉn d·ª•ng NV cho T·∫≠p ƒêo√†n VIETTEL: - NV VƒÇN PH√íNG l√†m gi·ªù h√†nh ch√≠nh üí∞ Thu nh·∫≠p 8-15tr. Ch∆∞a t√≠nh l∆∞∆°ng th∆∞·ªüng - L√†m t·∫°i tr·ª• s·ªü VIETTEL HCM - ƒê·ªãa ch·ªâ l√†m vi·ªác: 158/2A Ho√†ng Hoa Th√°m, ph∆∞·ªùng 12, Q.T√¢n B√¨nh üëâ kh√¥ng y√™u c·∫ßu kinh nghi·ªám üëâ Ch·∫ø ƒë·ªô ph√∫c l·ª£i t·ªët ‚úÖ Ch·∫•m ƒë·ªÉ nh·∫≠n JD Th√¥ng tin contact: ‚ú´ Li√™n h·ªá b·ªô ph·∫≠n tuy·ªÉn d·ª•ng : 0922312726 Mr Nhi·ªám ‚ú´ Email: truonghuunhiem@bs24vietnam.vn",
    "owning_profile": {
      "__typename": "User",
      "name": "Gia Minh",
      "id": "61568481862081"
    }
  },
  {
    "id": "2198533247305479",
    "flag": "v√†ng",
    "text": "V·ªã tr√≠ tuy·ªÉn d·ª•ng: L√†m vi·ªác 8 ti·∫øng ü•∞ ‚Ä¢Nh√¢n vi√™n than Full : 8.500.000vnd ( Tuy·ªÉn nh√¢n vi√™n l√†m vi·ªác l√¢u d√†i ) ‚Ä¢Nh√¢n vi√™n L·ªÖ t√¢n Full ca g√£y ho·∫∑c chuy√™n ca 12h~20h30 . L∆∞∆°ng tho·∫£ thu·∫≠n ‚Ä¢Nh√¢n vi√™n ph·ª•c v·ª•: Nh√¢n vi√™n fulltime Nh√† h√†ng H√†n Qu·ªëc Ca g√£y 10h-14h/17h-22h ho·∫∑c 9h-14h/17h-21h ( ngh·ªâ tr∆∞a 3 ti·∫øng ) ho·∫∑c Ca part xoay ca linh ƒë·ªông 10h-14h v√† 18h - 22h. Ho·∫∑c part 12h-16h30 v√† 13h - 17h30. - Ch·∫ø ƒë·ªô, quy·ªÅn l·ª£i: L∆∞∆°ng c∆° b·∫£n + ƒÉn ca 2 b·ªØa + h·ªó tr·ª£ ti·ªÅn ƒëi l·∫°i + 100% TI·ªÄN TIP. L√†m 26ng√†y/th√°ng - ƒê·ªëi v·ªõi nh√¢n vi√™n full sau 6 th√°ng h∆∞·ªüng ph√©p nƒÉm, v√† ƒë·ªëi v·ªõi t·∫•t c·∫£ nh√¢n vi√™n ng√†y L·ªÖ T·∫øt x 400% l∆∞∆°ng + th∆∞·ªüng . Thu nh·∫≠p t·ª´ 6-10tr ‚Ä¢M√¥i tr∆∞·ªùng tr·∫ª trung, th√¢n thi·ªán, ƒë·ªìng nghi·ªáp d·ªÖ th∆∞∆°ng ‚Ä¢C∆° h·ªôi h·ªçc h·ªèi k·ªπ nƒÉng giao ti·∫øp, ph·ª•c v·ª• chuy√™n nghi·ªáp Y√™u c·∫ßu: ‚Ä¢Kh√¥ng y√™u c·∫ßu kinh nghi·ªám (s·∫Ω ƒë∆∞·ª£c ƒë√†o t·∫°o) ‚Ä¢Nhanh nh·∫πn, chƒÉm ch·ªâ, c√≥ tinh th·∫ßn tr√°ch nhi·ªám ‚Ä¢Th√°i ƒë·ªô vui v·∫ª, l·ªãch s·ª± v·ªõi kh√°ch h√†ng üìç ƒê·ªãa ch·ªâ: Nh√† h√†ng GOJUMONG CASUAL t·∫ßng 6 Lotte Li·ªÖu Giai üìû Li√™n h·ªá tr·ª±c ti·∫øp ho·∫∑c zalo: Qu·∫£n l√Ω Mrs Trang: 0987.469.405",
    "owning_profile": {
      "__typename": "User",
      "name": "Trang L√™",
      "id": "100006577548369"
    }
  }
 
]
--- END FILE: b77da63d-af55-43c2-ab7f-364250b20e30.json ---

--- START FILE: comments.json ---
[
    {
        "id": "100076814636713",
        "name": "Nguy·ªÖn Huy",
        "text": "Nguy·ªÖn Duy H√≤a h√≤a ph·∫£i kh√¥ng h√≤a",
        "created_time_vn": "2025-12-17 20:42:01"
    },
    {
        "id": "100064510548300",
        "name": "Nguy·ªÖn Duy H√≤a",
        "text": "ƒê·ª´ng g·∫Øp l·ª≠a b·ªè v√†o tay t√¥i",
        "created_time_vn": "2025-12-17 20:48:48"
    }
]
--- END FILE: comments.json ---

--- START FILE: users.json ---
[]
--- END FILE: users.json ---

--- START FILE: backend\main.py ---
from core.runner import AppRunner

if __name__ == "__main__":
    AppRunner().run()

--- END FILE: backend\main.py ---

--- START FILE: backend\app\api.py ---
from multiprocessing import Process
import time
from typing import Optional, Any, Dict
from pathlib import Path
import json
import os
import tempfile
import threading
import re
from urllib.parse import quote_plus
from concurrent.futures import ThreadPoolExecutor, as_completed

from fastapi import Body, FastAPI, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel
from fastapi.concurrency import run_in_threadpool

from core.settings import SETTINGS_PATH
from core.nst import connect_profile, stop_profile, stop_all_browsers
from core.browser import FBController
from core import control as control_state
from core.scraper import SimpleBot
from core.settings import get_settings
from worker.get_all_info import get_all_info_from_post_ids_dir, get_info_for_profile_ids

app = FastAPI(title="NST Tool API", version="1.0.0")
class InfoRunRequest(BaseModel):
    mode: str = "all"  # "all" ho·∫∑c "selected"
    profiles: list[str] | None = None


# Cho ph√©p frontend (file tƒ©nh) g·ªçi API qua localhost
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Bot processes (m·ªói profile 1 process ƒë·ªôc l·∫≠p RUN/REST)
_bot_lock = threading.Lock()
_bot_processes: Dict[str, Process] = {}
_settings_lock = threading.Lock()
_join_groups_lock = threading.Lock()
_join_groups_processes: Dict[str, Process] = {}
_feed_lock = threading.Lock()
_feed_processes: Dict[str, Process] = {}


def _hard_stop_everything(reason: str = "") -> dict:
    """
    STOP ki·ªÉu "fresh start":
    - Signal STOP ngay (set_global_emergency_stop=True) ƒë·ªÉ c√°c loop tho√°t n·∫øu c√≤n s·ªëng
    - ƒê√≥ng to√†n b·ªô NST browser
    - Terminate runner/join/feed processes (ƒë√≥ng h·∫≥n, kh√¥ng gi·ªØ sleep)
    - Reset runtime_control.json v·ªÅ m·∫∑c ƒë·ªãnh (S·∫¥N S√ÄNG)
    """
    global _bot_processes

    print("=" * 60)
    print(f"üõë [HARD_STOP] {reason}".strip())
    print("=" * 60)

    # 1) Signal STOP
    try:
        control_state.set_global_emergency_stop(True)
    except Exception:
        pass

    # 2) Close all NST browsers
    nst_ok = False
    nst_err = None
    try:
        nst_ok = bool(stop_all_browsers())
    except Exception as e:
        nst_err = str(e)
        print(f"‚ö†Ô∏è stop_all_browsers l·ªói: {e}")

    # 3) Kill bot processes
    bot_killed: list[str] = []
    try:
        with _bot_lock:
            for pid, proc in list(_bot_processes.items()):
                try:
                    if proc and proc.is_alive():
                        proc.terminate()
                        proc.join(timeout=3)
                        bot_killed.append(pid)
                except Exception:
                    pass
                _bot_processes.pop(pid, None)
    except Exception:
        pass

    # 4) Kill join groups processes
    join_killed: list[str] = []
    try:
        with _join_groups_lock:
            _prune_join_group_processes()
            for pid, proc in list(_join_groups_processes.items()):
                try:
                    if proc and proc.is_alive():
                        proc.terminate()
                        proc.join(timeout=3)
                        join_killed.append(pid)
                except Exception:
                    pass
                _join_groups_processes.pop(pid, None)
    except Exception:
        pass

    # 5) Kill feed processes
    feed_killed: list[str] = []
    try:
        with _feed_lock:
            _prune_feed_processes()
            for pid, proc in list(_feed_processes.items()):
                try:
                    if proc and proc.is_alive():
                        proc.terminate()
                        proc.join(timeout=3)
                        feed_killed.append(pid)
                except Exception:
                    pass
                _feed_processes.pop(pid, None)
    except Exception:
        pass

    # 6) Reset runtime state v·ªÅ m·∫∑c ƒë·ªãnh (ƒë·ªÉ l·∫ßn sau b·∫•m ch·∫°y l√† "m·ªõi ho√†n to√†n")
    try:
        control_state.reset_all_state()
    except Exception:
        # fallback: √≠t nh·∫•t clear emergency stop ƒë·ªÉ UI kh√¥ng b·ªã k·∫πt
        try:
            control_state.reset_emergency_stop(clear_stopped_profiles=True)
        except Exception:
            pass

    return {
        "status": "ok",
        "nst_stop_all_ok": nst_ok,
        "nst_error": nst_err,
        "bot_killed": bot_killed,
        "join_killed": join_killed,
        "feed_killed": feed_killed,
    }


def _prune_bot_processes() -> None:
    dead = []
    for pid, proc in list(_bot_processes.items()):
        try:
            if not proc.is_alive():
                dead.append(pid)
        except Exception:
            dead.append(pid)
    for pid in dead:
        _bot_processes.pop(pid, None)


def _run_bot_profile_loop(
    profile_id: str,
    run_minutes: int,
    rest_minutes: int,
    text: str,
    mode: str,
) -> None:
    """
    Worker ƒë·ªôc l·∫≠p cho 1 profile:
    - ch·∫°y RUN_MINUTES (active time, pause freeze)
    - ng·ªß REST_MINUTES (pause freeze)
    - l·∫∑p l·∫°i cho t·ªõi khi STOP (global ho·∫∑c stop theo profile)
    """
    pid = str(profile_id or "").strip()
    if not pid:
        return

    cfg = get_settings()
    target_url = cfg.target_url
    m = str(mode or "feed").strip().lower()
    if m not in ("feed", "search"):
        m = "feed"
    t = str(text or "").strip()
    if m == "search" and t:
        q = quote_plus(t)
        target_url = f"https://www.facebook.com/search/posts/?q={q}"

    run_m = int(run_minutes or 0)
    rest_m = int(rest_minutes or 0)
    if run_m <= 0:
        run_m = int(getattr(cfg, "run_minutes", 30) or 30)
    if rest_m <= 0:
        rest_m = int(getattr(cfg, "rest_minutes", 120) or 120)

    duration_seconds = max(1, run_m * 60)
    rest_seconds = max(1, rest_m * 60)

    while True:
        # STOP/PAUSE tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu phi√™n
        stop, paused, reason = control_state.check_flags(pid)
        if stop:
            print(f"üõë [{pid}] STOP tr∆∞·ªõc khi start loop ({reason})")
            try:
                control_state.set_profile_state(pid, "STOPPED")
            except Exception:
                pass
            return
        if paused:
            print(f"‚è∏Ô∏è [{pid}] PAUSED tr∆∞·ªõc khi start loop ({reason})")
            control_state.wait_if_paused(pid, sleep_seconds=0.5)

        fb: Optional[FBController] = None
        try:
            control_state.set_profile_state(pid, "RUNNING")
        except Exception:
            pass

        try:
            ws = connect_profile(pid)
            fb = FBController(ws)
            fb.profile_id = pid
            # tuy·ªát ƒë·ªëi ƒë·ªôc l·∫≠p: ch·ªâ x·ª≠ l√Ω trong profile n√†y
            try:
                fb.all_profile_ids = [pid]
            except Exception:
                pass
            # filter text n·∫øu c√≥
            try:
                if t:
                    parts = []
                    for chunk in t.replace("\n", ",").split(","):
                        s = " ".join(str(chunk).strip().split())
                        if s:
                            parts.append(s)
                    seen = set()
                    user_keywords = []
                    for x in parts:
                        k = x.lower()
                        if k in seen:
                            continue
                        seen.add(k)
                        user_keywords.append(x)
                    fb.user_keywords = user_keywords
            except Exception:
                pass
            fb.connect()
            bot = SimpleBot(fb)
            bot.run(target_url, duration=duration_seconds)
        except RuntimeError as e:
            # STOP/BROWSER_CLOSED => tho√°t phi√™n
            if "EMERGENCY_STOP" in str(e) or "BROWSER_CLOSED" in str(e):
                print(f"üõë [{pid}] D·ª´ng bot ({e})")
            else:
                raise
        except Exception as e:
            print(f"‚ùå L·ªói ·ªü profile {pid}: {e}")
            try:
                control_state.set_profile_state(pid, "ERROR")
            except Exception:
                pass
        finally:
            # ƒë√≥ng playwright + NST profile best-effort
            try:
                if fb and getattr(fb, "page", None):
                    try:
                        fb.page.close()
                    except Exception:
                        pass
            except Exception:
                pass
            try:
                if fb and getattr(fb, "browser", None) and getattr(fb.browser, "contexts", None):
                    for ctx in list(fb.browser.contexts):
                        try:
                            ctx.close()
                        except Exception:
                            pass
            except Exception:
                pass
            try:
                if fb and getattr(fb, "browser", None):
                    try:
                        fb.browser.close()
                    except Exception:
                        pass
            except Exception:
                pass
            try:
                if fb and getattr(fb, "play", None):
                    try:
                        fb.play.stop()
                    except Exception:
                        pass
            except Exception:
                pass
            try:
                stop_profile(pid)
            except Exception:
                pass

        # Check stop sau khi k·∫øt th√∫c phi√™n
        stop, paused, reason = control_state.check_flags(pid)
        if stop:
            print(f"üõë [{pid}] STOP sau phi√™n ({reason}) -> tho√°t loop")
            try:
                control_state.set_profile_state(pid, "STOPPED")
            except Exception:
                pass
            return

        # REST (ƒë·ªôc l·∫≠p theo profile) - pause freeze
        slept = 0
        while slept < rest_seconds:
            stop, paused, reason = control_state.check_flags(pid)
            if stop:
                print(f"üõë [{pid}] STOP trong REST ({reason}) -> tho√°t")
                try:
                    control_state.set_profile_state(pid, "STOPPED")
                except Exception:
                    pass
                return
            if paused:
                control_state.wait_if_paused(pid, sleep_seconds=0.5)
                continue
            time.sleep(1)
            slept += 1


def _run_join_groups_worker(profile_id: str, groups: list[str]) -> None:
    """Worker ch·∫°y join groups cho 1 profile (ƒë·ªÉ ch·∫°y song song nhi·ªÅu profile)."""
    try:
        from core.join_groups import run_batch_join_from_list
        run_batch_join_from_list(profile_id, groups)
    except Exception as exc:
        print(f"‚ùå Join groups worker l·ªói ({profile_id}): {exc}")


def _run_feed_worker(
    profile_id: str,
    mode: str,
    text: str,
    run_minutes: int,
    rest_minutes: int,
    all_profile_ids: Optional[list[str]] = None,
) -> None:
    """
    Worker ch·∫°y nu√¥i acc (feed/search & like) cho 1 profile theo v√≤ng l·∫∑p:
    ch·∫°y run_minutes -> t·∫Øt -> ngh·ªâ rest_minutes -> l·∫∑p l·∫°i.
    N·∫øu rest_minutes <= 0 th√¨ ch·ªâ ch·∫°y 1 l·∫ßn.
    """
    try:
        from core.search_worker import feed_and_like, search_and_like
        m = str(mode or "feed").strip().lower()
        run_m = int(run_minutes or 0)
        rest_m = int(rest_minutes or 0)
        if run_m <= 0:
            run_m = 30

        while True:
            # STOP/PAUSE checkpoint
            stop, paused, reason = control_state.check_flags(profile_id)
            if stop:
                print(f"üõë [FEED] {profile_id} EMERGENCY_STOP ({reason}) -> d·ª´ng worker")
                break
            if paused:
                print(f"‚è∏Ô∏è [FEED] {profile_id} PAUSED ({reason}) -> sleep")
                control_state.wait_if_paused(profile_id, sleep_seconds=0.5)

            if m == "search":
                search_and_like(profile_id, text or "", duration_minutes=run_m, all_profile_ids=all_profile_ids)
            else:
                feed_and_like(profile_id, text or "", duration_minutes=run_m, all_profile_ids=all_profile_ids)

            if rest_m <= 0:
                break

            # ngh·ªâ r·ªìi ch·∫°y l·∫°i (process c√≥ th·ªÉ b·ªã terminate b·ªüi stop-all)
            import time as _t
            # sleep theo chunk ƒë·ªÉ v·∫´n d·ª´ng ƒë∆∞·ª£c ngay
            slept = 0
            while slept < rest_m * 60:
                stop, paused, reason = control_state.check_flags(profile_id)
                if stop:
                    print(f"üõë [FEED] {profile_id} EMERGENCY_STOP trong sleep ({reason}) -> d·ª´ng")
                    return
                if paused:
                    _t.sleep(1)
                    continue
                _t.sleep(1)
                slept += 1
    except Exception as exc:
        print(f"‚ùå Feed worker l·ªói ({profile_id}): {exc}")


def _close_fb_controller_best_effort(fb: Optional[FBController], profile_id: str) -> None:
    """
    ƒê√≥ng s·∫°ch tab/context playwright + y√™u c·∫ßu NST stop (gi·ªëng logic trong cookie fetch).
    """
    try:
        if fb and getattr(fb, "page", None):
            try:
                fb.page.close()
            except Exception:
                pass
    except Exception:
        pass
    try:
        if fb and getattr(fb, "browser", None) and getattr(fb.browser, "contexts", None):
            for ctx in list(fb.browser.contexts):
                try:
                    ctx.close()
                except Exception:
                    pass
    except Exception:
        pass
    try:
        if fb and getattr(fb, "browser", None):
            try:
                fb.browser.close()
            except Exception:
                pass
    except Exception:
        pass
    try:
        if fb and getattr(fb, "play", None):
            try:
                fb.play.stop()
            except Exception:
                pass
    except Exception:
        pass

    # Best-effort: y√™u c·∫ßu NST stop/close browser instance c·ªßa profile
    try:
        stop_profile(profile_id)
    except Exception:
        pass


def _force_close_nst_tabs_for_profile(profile_id: str) -> dict:
    """
    Force ƒë√≥ng tab NST theo ƒë√∫ng ki·ªÉu cookie:
    connect -> attach CDP -> close page/context/browser/play -> stop_profile
    """
    pid = _norm_profile_id(profile_id)
    if not pid:
        return {"profile_id": profile_id, "ok": False, "reason": "empty_profile_id"}

    fb: Optional[FBController] = None
    connected = False
    try:
        ws = connect_profile(pid)
        fb = FBController(ws)
        fb.profile_id = pid
        fb.connect()
        connected = True
        return {"profile_id": pid, "ok": True, "connected": True}
    except Exception as exc:
        # N·∫øu connect fail v·∫´n c·ªë stop_profile ·ªü finally
        return {"profile_id": pid, "ok": False, "connected": connected, "reason": str(exc)}
    finally:
        _close_fb_controller_best_effort(fb, pid)


def _norm_profile_id(value: str) -> str:
    """Chu·∫©n ho√° profile_id: b·ªè to√†n b·ªô whitespace (tr√°nh l·ªói d√≠nh space khi copy/paste)."""
    return re.sub(r"\s+", "", str(value or "")).strip()


class RunRequest(BaseModel):
    run_minutes: Optional[int] = None
    rest_minutes: Optional[int] = None
    profile_ids: Optional[list[str]] = None
    # text filter cho scan b√†i vi·∫øt (d√πng trong core/browser.py)
    text: Optional[str] = None
    # mode cho scan b√†i vi·∫øt: "feed" | "search"
    mode: Optional[str] = None


## NOTE: AppRunner mode ƒë√£ ƒë∆∞·ª£c thay b·∫±ng bot per-profile ƒë·ªôc l·∫≠p (xem _run_bot_profile_loop)


@app.get("/health")
def health_check() -> dict:
    return {"status": "ok"}


@app.post("/run")
def run_bot(payload: Optional[RunRequest] = Body(None)) -> dict:
    """
    Start bot per-profile ƒë·ªôc l·∫≠p (m·ªói profile 1 process loop RUN/REST).
    """
    # start per-profile bot processes (ƒë·ªôc l·∫≠p)

    run_minutes = payload.run_minutes if payload else None
    rest_minutes = payload.rest_minutes if payload else None
    profile_ids = payload.profile_ids if payload else None
    text = payload.text if payload else None
    mode = payload.mode if payload else None

    # Validate profile_ids (b·∫Øt bu·ªôc ch·ªçn profile nh∆∞ UI)
    if not profile_ids:
        raise HTTPException(status_code=400, detail="profile_ids r·ªóng")
    pids = [_norm_profile_id(x) for x in (profile_ids or [])]
    pids = [p for p in pids if p]
    if not pids:
        raise HTTPException(status_code=400, detail="profile_ids kh√¥ng h·ª£p l·ªá")

    # N·∫øu user b·∫•m CH·∫†Y m√† tr∆∞·ªõc ƒë√≥ ƒë√£ STOP, auto reset STOP ƒë·ªÉ job ch·∫°y ƒë∆∞·ª£c.
    # Ch·ªâ resume/clear STOPPED cho ƒë√∫ng c√°c profile ƒë∆∞·ª£c y√™u c·∫ßu ch·∫°y.
    try:
        stop, _paused, reason = control_state.check_flags(None)
        if stop:
            print(f"üü° [/run] GLOBAL_EMERGENCY_STOP ƒëang b·∫≠t ({reason}) -> auto reset ƒë·ªÉ ch·∫°y")
            control_state.reset_emergency_stop(clear_stopped_profiles=False)
        # N·∫øu profile ƒëang b·ªã stop ri√™ng l·∫ª th√¨ clear ƒë·ªÉ ch·∫°y ƒë∆∞·ª£c
        control_state.resume_profiles(pids)
    except Exception as _e:
        pass

    # D·ªçn state c≈© trong runtime_control: ch·ªâ gi·ªØ profile_states c·ªßa ƒë√∫ng pids ƒëang ch·∫°y
    try:
        def _keep_only_selected(st: dict) -> None:
            ps = st.get("profile_states")
            if not isinstance(ps, dict):
                ps = {}
            keep = {pid: ps.get(pid) or "RUNNING" for pid in pids}
            st["profile_states"] = keep
            # remove paused/stopped ngo√†i danh s√°ch ƒë∆∞·ª£c ch·∫°y (tr√°nh hi·ªán profile l·∫°)
            st["paused_profiles"] = [x for x in (st.get("paused_profiles") or []) if str(x) in set(pids)]
            st["stopped_profiles"] = [x for x in (st.get("stopped_profiles") or []) if str(x) in set(pids)]
        control_state._update(_keep_only_selected)  # type: ignore[attr-defined]
    except Exception:
        pass

    # ‚úÖ Ch·∫∑n ch·∫°y n·∫øu b·∫•t k·ª≥ profile n√†o thi·∫øu cookie/access_token
    _validate_profiles_requirements(pids, require_cookie=True, require_access_token=True)

    m = str(mode or "feed").strip().lower()
    if m not in ("feed", "search"):
        m = "feed"
    # Search b·∫Øt bu·ªôc c√≥ text ƒë·ªÉ search
    if m == "search" and not str(text or "").strip():
        raise HTTPException(status_code=400, detail="Search c·∫ßn text")

    started: list[str] = []
    skipped: list[dict] = []
    run_m = int(run_minutes or 0) if payload else 0
    rest_m = int(rest_minutes or 0) if payload else 0
    txt = str(text or "")
    md = str(m or "feed")

    with _bot_lock:
        _prune_bot_processes()
        for pid in pids:
            existing = _bot_processes.get(pid)
            if existing and existing.is_alive():
                skipped.append({"profile_id": pid, "reason": "already_running"})
                continue
            proc = Process(
                target=_run_bot_profile_loop,
                args=(pid, run_m, rest_m, txt, md),
                daemon=True,
            )
            proc.start()
            _bot_processes[pid] = proc
            started.append(pid)

    return {"status": "ok", "started": started, "skipped": skipped, "running": list(_bot_processes.keys())}


@app.post("/stop")
def stop_bot() -> dict:
    """
    STOP (fresh start):
    - ƒê√≥ng h·∫≥n m·ªçi th·ª© (NST + kill runner/jobs)
    - Reset runtime_control.json v·ªÅ m·∫∑c ƒë·ªãnh
    - L·∫ßn sau b·∫•m ch·∫°y s·∫Ω t√≠nh l·∫°i RUN/REST t·ª´ ƒë·∫ßu (PAUSE m·ªõi l√† c√°i gi·ªØ timer)
    """
    return _hard_stop_everything(reason="/stop")


@app.get("/status")
def status() -> dict:
    with _bot_lock:
        _prune_bot_processes()
        running = [pid for pid, proc in _bot_processes.items() if proc and proc.is_alive()]
    return {"running": len(running) > 0, "bot_profile_ids": running}


@app.get("/settings")
def get_settings_json() -> dict:
    """
    Tr·∫£ n·ªôi dung file backend/config/settings.json ƒë·ªÉ frontend hi·ªÉn th·ªã.
    """
    path: Path = SETTINGS_PATH
    if not path.exists():
        raise HTTPException(status_code=404, detail=f"Kh√¥ng t√¨m th·∫•y settings.json: {path}")

    try:
        with path.open(encoding="utf-8") as f:
            raw = json.load(f)
    except json.JSONDecodeError as exc:
        raise HTTPException(status_code=400, detail=f"settings.json kh√¥ng h·ª£p l·ªá: {exc}") from exc
    except Exception as exc:
        raise HTTPException(status_code=500, detail=f"Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c settings.json: {exc}") from exc

    return raw


def _read_settings_raw() -> Dict[str, Any]:
    path: Path = SETTINGS_PATH
    if not path.exists():
        raise HTTPException(status_code=404, detail=f"Kh√¥ng t√¨m th·∫•y settings.json: {path}")
    try:
        with path.open(encoding="utf-8") as f:
            raw = json.load(f)
    except json.JSONDecodeError as exc:
        raise HTTPException(status_code=400, detail=f"settings.json kh√¥ng h·ª£p l·ªá: {exc}") from exc
    except Exception as exc:
        raise HTTPException(status_code=500, detail=f"Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c settings.json: {exc}") from exc

    if not isinstance(raw, dict):
        raise HTTPException(status_code=400, detail="settings.json ph·∫£i l√† object")
    return raw


def _validate_profiles_requirements(
    profile_ids: list[str],
    *,
    require_cookie: bool = True,
    require_access_token: bool = True,
) -> None:
    """
    N·∫øu c√≥ profile thi·∫øu cookie/access_token (theo require_*), s·∫Ω raise 400 v√† KH√îNG cho start job.
    """
    raw = _read_settings_raw()
    profiles = raw.get("PROFILE_IDS") or {}
    if not isinstance(profiles, dict):
        profiles = {}

    missing_list: list[dict] = []
    for pid in profile_ids:
        cfg = profiles.get(pid)
        missing: list[str] = []
        if not isinstance(cfg, dict):
            # profile ch∆∞a t·ªìn t·∫°i trong settings.json
            if require_cookie:
                missing.append("cookie")
            if require_access_token:
                missing.append("access_token")
        else:
            if require_cookie and not str(cfg.get("cookie") or "").strip():
                missing.append("cookie")
            if require_access_token and not str(cfg.get("access_token") or cfg.get("accessToken") or "").strip():
                missing.append("access_token")

        if missing:
            missing_list.append({"profile_id": pid, "missing": missing})

    if missing_list:
        raise HTTPException(
            status_code=400,
            detail={
                "message": "Thi·∫øu c·∫•u h√¨nh profile (cookie/access_token). H√£y c·∫≠p nh·∫≠t tr∆∞·ªõc khi ch·∫°y.",
                "missing": missing_list,
            },
        )


def _atomic_write_json(path: Path, data: Dict[str, Any]) -> None:
    """
    Ghi JSON an to√†n: write temp file c√πng th∆∞ m·ª•c r·ªìi replace.
    """
    directory = str(path.parent)
    os.makedirs(directory, exist_ok=True)

    fd, tmp_path = tempfile.mkstemp(prefix="settings_", suffix=".json", dir=directory)
    try:
        with os.fdopen(fd, "w", encoding="utf-8") as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
            f.write("\n")
        os.replace(tmp_path, str(path))
    except Exception:
        try:
            os.remove(tmp_path)
        except Exception:
            pass
        raise


def _merge_group_ids(existing: Any, new_items: list[str]) -> list[str]:
    """Merge + de-dupe group ids, gi·ªØ th·ª© t·ª± (existing tr∆∞·ªõc)."""
    base: list[str] = []
    if isinstance(existing, list):
        base = [str(x).strip() for x in existing if str(x).strip()]
    elif isinstance(existing, str):
        base = [s.strip() for s in existing.split(",") if s.strip()]

    seen: set[str] = set()
    merged: list[str] = []
    for gid in base + new_items:
        gid2 = str(gid or "").strip()
        if not gid2 or gid2 in seen:
            continue
        seen.add(gid2)
        merged.append(gid2)
    return merged


def _write_settings_raw(raw: Dict[str, Any]) -> None:
    try:
        _atomic_write_json(SETTINGS_PATH, raw)
    except Exception as exc:
        raise HTTPException(status_code=500, detail=f"Kh√¥ng ghi ƒë∆∞·ª£c settings.json: {exc}") from exc


class ApiKeyPayload(BaseModel):
    api_key: str


class ProfileCreatePayload(BaseModel):
    profile_id: str


class ProfileUpdatePayload(BaseModel):
    cookie: Optional[str] = None
    access_token: Optional[str] = None


class ProfileGroupsPayload(BaseModel):
    # C√≥ th·ªÉ truy·ªÅn 1 group ho·∫∑c nhi·ªÅu group (append).
    group_id: Optional[str] = None
    group_ids: Optional[list[str]] = None


class ProfileGroupsReplacePayload(BaseModel):
    # Replace ho√†n to√†n groups c·ªßa profile. Cho ph√©p r·ªóng ƒë·ªÉ xo√° h·∫øt.
    groups: Optional[list[str]] = None


class JoinGroupsRequest(BaseModel):
    profile_ids: list[str]


class JoinGroupsStopRequest(BaseModel):
    # n·∫øu kh√¥ng truy·ªÅn -> stop t·∫•t c·∫£
    profile_ids: Optional[list[str]] = None


class FeedStartRequest(BaseModel):
    profile_ids: list[str]
    mode: str = "feed"  # "feed" | "search"
    text: str = ""      # input text (ƒë·ªãa ƒëi·ªÉm, ho·∫∑c query search)
    # backward-compat: gi·ªØ field c≈© n·∫øu frontend c≈© c√≤n g·ªçi
    filter_text: str = ""
    run_minutes: int = 30
    rest_minutes: int = 0


class FeedStopRequest(BaseModel):
    profile_ids: Optional[list[str]] = None


@app.put("/settings/api-key")
def update_api_key(payload: ApiKeyPayload) -> dict:
    with _settings_lock:
        raw = _read_settings_raw()
        raw["API_KEY"] = str(payload.api_key or "").strip()
        _write_settings_raw(raw)
        return {"status": "ok"}


@app.post("/settings/profiles")
def add_profile(payload: ProfileCreatePayload) -> dict:
    pid = _norm_profile_id(payload.profile_id)
    if not pid:
        raise HTTPException(status_code=400, detail="profile_id r·ªóng")

    with _settings_lock:
        raw = _read_settings_raw()
        profiles = raw.get("PROFILE_IDS")
        if profiles is None or isinstance(profiles, list) or isinstance(profiles, str):
            # N·∫øu ƒëang format c≈©, convert sang dict
            profiles = {}
        if not isinstance(profiles, dict):
            raise HTTPException(status_code=400, detail="PROFILE_IDS ph·∫£i l√† object")

        # T·∫°o profile m·ªõi: lu√¥n c√≥ cookie/access_token/groups (groups tr·ªëng)
        cur = profiles.get(pid)
        if cur is None or not isinstance(cur, dict):
            cur = {}
            profiles[pid] = cur
        cur.setdefault("cookie", "")
        cur.setdefault("access_token", "")
        cur.setdefault("groups", [])
        raw["PROFILE_IDS"] = profiles
        _write_settings_raw(raw)
        return {"status": "ok"}


@app.put("/settings/profiles/{profile_id}")
def update_profile(profile_id: str, payload: ProfileUpdatePayload) -> dict:
    pid = _norm_profile_id(profile_id)
    if not pid:
        raise HTTPException(status_code=400, detail="profile_id r·ªóng")

    with _settings_lock:
        raw = _read_settings_raw()
        profiles = raw.get("PROFILE_IDS") or {}
        if isinstance(profiles, list) or isinstance(profiles, str):
            profiles = {}
        if not isinstance(profiles, dict):
            raise HTTPException(status_code=400, detail="PROFILE_IDS ph·∫£i l√† object")

        cur = profiles.get(pid)
        if cur is None:
            profiles[pid] = {}
            cur = profiles[pid]
        if not isinstance(cur, dict):
            cur = {}
            profiles[pid] = cur

        if payload.cookie is not None:
            cur["cookie"] = str(payload.cookie)
        if payload.access_token is not None:
            cur["access_token"] = str(payload.access_token)

        raw["PROFILE_IDS"] = profiles
        _write_settings_raw(raw)
        return {"status": "ok"}


@app.post("/settings/profiles/{profile_id}/groups")
def add_or_sync_profile_groups(profile_id: str, payload: ProfileGroupsPayload) -> dict:
    """
    C·∫≠p nh·∫≠t groups cho 1 profile:
    - ho·∫∑c truy·ªÅn group_id / group_ids ƒë·ªÉ append v√†o PROFILE_IDS[pid].groups
    """
    pid = _norm_profile_id(profile_id)
    if not pid:
        raise HTTPException(status_code=400, detail="profile_id r·ªóng")

    new_groups: list[str] = []
    if payload.group_ids:
        new_groups.extend([str(x or "").strip() for x in payload.group_ids])
    if payload.group_id:
        new_groups.append(str(payload.group_id or "").strip())
    new_groups = [g for g in new_groups if g]

    if not new_groups:
        raise HTTPException(status_code=400, detail="Thi·∫øu group_id/group_ids")

    with _settings_lock:
        raw = _read_settings_raw()
        profiles = raw.get("PROFILE_IDS") or {}
        if isinstance(profiles, list) or isinstance(profiles, str):
            profiles = {}
        if not isinstance(profiles, dict):
            raise HTTPException(status_code=400, detail="PROFILE_IDS ph·∫£i l√† object")

        cur = profiles.get(pid)
        if cur is None or not isinstance(cur, dict):
            cur = {}
            profiles[pid] = cur

        merged = _merge_group_ids(cur.get("groups"), new_groups)

        cur["groups"] = merged
        raw["PROFILE_IDS"] = profiles
        _write_settings_raw(raw)

        return {"status": "ok", "profile_id": pid, "groups": merged}


@app.put("/settings/profiles/{profile_id}/groups")
def replace_profile_groups(profile_id: str, payload: ProfileGroupsReplacePayload) -> dict:
    """
    Ghi ƒë√® to√†n b·ªô groups c·ªßa 1 profile (ƒë√∫ng y√™u c·∫ßu: trong textarea c√≥ g√¨ th√¨ ƒë√® l√™n c√°i c≈©).
    """
    pid = _norm_profile_id(profile_id)
    if not pid:
        raise HTTPException(status_code=400, detail="profile_id r·ªóng")

    raw_groups = payload.groups if payload and payload.groups is not None else []
    if not isinstance(raw_groups, list):
        raise HTTPException(status_code=400, detail="groups ph·∫£i l√† list")

    cleaned: list[str] = []
    seen: set[str] = set()
    for item in raw_groups:
        s = str(item or "").strip()
        if not s:
            continue
        # de-dupe ƒë·ªÉ tr√°nh spam
        if s in seen:
            continue
        seen.add(s)
        cleaned.append(s)

    with _settings_lock:
        raw = _read_settings_raw()
        profiles = raw.get("PROFILE_IDS") or {}
        if isinstance(profiles, list) or isinstance(profiles, str):
            profiles = {}
        if not isinstance(profiles, dict):
            raise HTTPException(status_code=400, detail="PROFILE_IDS ph·∫£i l√† object")

        cur = profiles.get(pid)
        if cur is None or not isinstance(cur, dict):
            cur = {}
            profiles[pid] = cur

        cur["groups"] = cleaned
        raw["PROFILE_IDS"] = profiles
        _write_settings_raw(raw)
        return {"status": "ok", "profile_id": pid, "groups": cleaned}


def _prune_join_group_processes() -> None:
    """D·ªçn c√°c process ƒë√£ ch·∫°y xong kh·ªèi map."""
    dead = []
    for pid, proc in list(_join_groups_processes.items()):
        try:
            if not proc.is_alive():
                dead.append(pid)
        except Exception:
            dead.append(pid)
    for pid in dead:
        _join_groups_processes.pop(pid, None)


def _prune_feed_processes() -> None:
    dead = []
    for pid, proc in list(_feed_processes.items()):
        try:
            if not proc.is_alive():
                dead.append(pid)
        except Exception:
            dead.append(pid)
    for pid in dead:
        _feed_processes.pop(pid, None)


@app.post("/groups/join")
def auto_join_groups(payload: JoinGroupsRequest) -> dict:
    """
    Ch·∫°y auto join group cho c√°c profile ƒë√£ ch·ªçn (m·ªói profile 1 process ‚Üí ch·∫°y song song).
    Groups l·∫•y t·ª´ settings.json: PROFILE_IDS[pid].groups
    """
    # N·∫øu user b·∫•m join m√† tr∆∞·ªõc ƒë√≥ ƒë√£ STOP, auto reset STOP ƒë·ªÉ job ch·∫°y ƒë∆∞·ª£c.
    try:
        stop, _paused, reason = control_state.check_flags(None)
        if stop:
            print(f"üü° [/groups/join] GLOBAL_EMERGENCY_STOP ƒëang b·∫≠t ({reason}) -> auto reset ƒë·ªÉ join")
            control_state.reset_emergency_stop(clear_stopped_profiles=False)
    except Exception:
        pass

    if not payload.profile_ids:
        raise HTTPException(status_code=400, detail="profile_ids r·ªóng")

    pids = [_norm_profile_id(x) for x in payload.profile_ids]
    pids = [p for p in pids if p]
    if not pids:
        raise HTTPException(status_code=400, detail="profile_ids kh√¥ng h·ª£p l·ªá")

    # Clear STOPPED cho ƒë√∫ng c√°c profile ƒë∆∞·ª£c y√™u c·∫ßu join
    try:
        control_state.resume_profiles(pids)
    except Exception:
        pass

    # ‚úÖ Join group ch·ªâ c·∫ßn cookie (kh√¥ng b·∫Øt access_token)
    _validate_profiles_requirements(pids, require_cookie=True, require_access_token=False)

    started: list[str] = []
    skipped: list[dict] = []

    with _join_groups_lock:
        _prune_join_group_processes()

        raw = _read_settings_raw()
        profiles = raw.get("PROFILE_IDS") or {}
        if not isinstance(profiles, dict):
            profiles = {}

        for pid in pids:
            # skip n·∫øu ƒëang ch·∫°y
            existing = _join_groups_processes.get(pid)
            if existing and existing.is_alive():
                skipped.append({"profile_id": pid, "reason": "already_running"})
                continue

            cfg = profiles.get(pid)
            if not isinstance(cfg, dict):
                skipped.append({"profile_id": pid, "reason": "profile_not_found"})
                continue

            groups = cfg.get("groups")
            if not isinstance(groups, list):
                groups = []
            groups = [str(g or "").strip() for g in groups if str(g or "").strip()]

            if len(groups) == 0:
                skipped.append({"profile_id": pid, "reason": "no_groups"})
                continue

            proc = Process(
                target=_run_join_groups_worker,
                args=(pid, groups),
                daemon=True,
            )
            proc.start()
            _join_groups_processes[pid] = proc
            started.append(pid)

    return {
        "status": "ok",
        "started": started,
        "skipped": skipped,
        "running": list(_join_groups_processes.keys()),
    }


@app.post("/groups/join/stop")
def stop_auto_join_groups(payload: Optional[JoinGroupsStopRequest] = Body(None)) -> dict:
    """
    D·ª´ng auto join group:
    - Kh√¥ng truy·ªÅn payload -> d·ª´ng t·∫•t c·∫£
    - C√≥ profile_ids -> d·ª´ng theo danh s√°ch
    """
    target: Optional[list[str]] = None
    if payload and payload.profile_ids is not None:
        target = [_norm_profile_id(x) for x in (payload.profile_ids or [])]
        target = [p for p in target if p]

    stopped: list[str] = []
    not_running: list[str] = []

    with _join_groups_lock:
        _prune_join_group_processes()
        keys = list(_join_groups_processes.keys())
        to_stop = keys if target is None else [p for p in target if p in _join_groups_processes]

        # terminate processes
        for pid in to_stop:
            proc = _join_groups_processes.get(pid)
            if not proc:
                continue
            try:
                if proc.is_alive():
                    proc.terminate()
                    proc.join(timeout=5)
            except Exception:
                pass
            _join_groups_processes.pop(pid, None)
            stopped.append(pid)

        if target is not None:
            for pid in target:
                if pid not in stopped:
                    not_running.append(pid)

    # Best-effort: y√™u c·∫ßu NST stop/close browser instance c·ªßa profile (gi·ªëng lu·ªìng l·∫•y cookie)
    for pid in stopped:
        try:
            stop_profile(pid)
        except Exception:
            pass

    return {"status": "ok", "stopped": stopped, "not_running": not_running}


@app.get("/groups/join/status")
def join_groups_status() -> dict:
    """Tr·∫°ng th√°i join-groups ƒëang ch·∫°y."""
    with _join_groups_lock:
        _prune_join_group_processes()
        running = []
        for pid, proc in _join_groups_processes.items():
            try:
                if proc.is_alive():
                    running.append(pid)
            except Exception:
                pass
    return {"running": running}


@app.get("/feed/status")
def feed_status() -> dict:
    """Tr·∫°ng th√°i nu√¥i acc (feed) ƒëang ch·∫°y."""
    with _feed_lock:
        _prune_feed_processes()
        running: list[str] = []
        for pid, proc in _feed_processes.items():
            try:
                if proc.is_alive():
                    running.append(pid)
            except Exception:
                pass
    return {"running": running}


@app.post("/feed/start")
def feed_start(payload: FeedStartRequest) -> dict:
    """Ch·∫°y nu√¥i acc (feed & like) cho c√°c profile ƒë√£ ch·ªçn (m·ªói profile 1 process)."""
    if not payload.profile_ids:
        raise HTTPException(status_code=400, detail="profile_ids r·ªóng")

    pids = [_norm_profile_id(x) for x in payload.profile_ids]
    pids = [p for p in pids if p]
    if not pids:
        raise HTTPException(status_code=400, detail="profile_ids kh√¥ng h·ª£p l·ªá")

    # N·∫øu user b·∫•m NU√îI ACC m√† tr∆∞·ªõc ƒë√≥ ƒë√£ STOP, auto reset STOP ƒë·ªÉ job ch·∫°y ƒë∆∞·ª£c.
    try:
        stop, _paused, reason = control_state.check_flags(None)
        if stop:
            print(f"üü° [/feed/start] GLOBAL_EMERGENCY_STOP ƒëang b·∫≠t ({reason}) -> auto reset ƒë·ªÉ ch·∫°y")
            control_state.reset_emergency_stop(clear_stopped_profiles=False)
        control_state.resume_profiles(pids)
    except Exception:
        pass

    # ‚úÖ Ch·∫∑n ch·∫°y n·∫øu b·∫•t k·ª≥ profile n√†o thi·∫øu cookie/access_token
    _validate_profiles_requirements(pids, require_cookie=True, require_access_token=True)

    run_minutes = int(payload.run_minutes or 0)
    if run_minutes <= 0:
        raise HTTPException(status_code=400, detail="run_minutes ph·∫£i > 0")
    rest_minutes = int(payload.rest_minutes or 0)
    if rest_minutes < 0:
        raise HTTPException(status_code=400, detail="rest_minutes ph·∫£i >= 0")

    started: list[str] = []
    skipped: list[dict] = []
    mode = str(payload.mode or "feed").strip().lower()
    text = str(payload.text or "").strip()
    # backward-compat
    if not text and getattr(payload, "filter_text", None):
        text = str(payload.filter_text or "").strip()
    # Cho ph√©p text r·ªóng n·∫øu mode=feed (s·∫Ω ch·ªâ filter theo keyword m·∫∑c ƒë·ªãnh)
    if not text and mode == "search":
        raise HTTPException(status_code=400, detail="text r·ªóng (search c·∫ßn text)")

    with _feed_lock:
        _prune_feed_processes()
        for pid in pids:
            existing = _feed_processes.get(pid)
            if existing and existing.is_alive():
                skipped.append({"profile_id": pid, "reason": "already_running"})
                continue

            proc = Process(
                target=_run_feed_worker,
                args=(pid, mode, text, run_minutes, rest_minutes, pids),
                daemon=True,
            )
            proc.start()
            _feed_processes[pid] = proc
            started.append(pid)

    return {"status": "ok", "started": started, "skipped": skipped, "running": list(_feed_processes.keys())}


@app.post("/feed/stop")
def feed_stop(payload: Optional[FeedStopRequest] = Body(None)) -> dict:
    """D·ª´ng nu√¥i acc (feed) theo list profile_ids ho·∫∑c d·ª´ng t·∫•t c·∫£ n·∫øu kh√¥ng truy·ªÅn."""
    target: Optional[list[str]] = None
    if payload and payload.profile_ids is not None:
        target = [_norm_profile_id(x) for x in (payload.profile_ids or [])]
        target = [p for p in target if p]

    stopped: list[str] = []
    with _feed_lock:
        _prune_feed_processes()
        keys = list(_feed_processes.keys())
        to_stop = keys if target is None else [p for p in target if p in _feed_processes]
        for pid in to_stop:
            proc = _feed_processes.get(pid)
            try:
                if proc and proc.is_alive():
                    proc.terminate()
                    proc.join(timeout=5)
            except Exception:
                pass
            _feed_processes.pop(pid, None)
            stopped.append(pid)

    for pid in stopped:
        try:
            stop_profile(pid)
        except Exception:
            pass

    return {"status": "ok", "stopped": stopped}


@app.get("/jobs/status")
def jobs_status() -> dict:
    """Tr·∫°ng th√°i chung (ƒë·ªÉ UI hi·ªÉn th·ªã/diagnose)."""
    with _bot_lock:
        _prune_bot_processes()
        bot_running_pids = []
        for pid, proc in _bot_processes.items():
            try:
                if proc.is_alive():
                    bot_running_pids.append(pid)
            except Exception:
                pass
    is_bot_running = len(bot_running_pids) > 0
    with _join_groups_lock:
        _prune_join_group_processes()
        join_running = []
        for pid, proc in _join_groups_processes.items():
            try:
                if proc.is_alive():
                    join_running.append(pid)
            except Exception:
                pass
    with _feed_lock:
        _prune_feed_processes()
        feed_running = []
        for pid, proc in _feed_processes.items():
            try:
                if proc.is_alive():
                    feed_running.append(pid)
            except Exception:
                pass
    return {
        "bot_running": is_bot_running,
        "bot_pid": None,
        "bot_profile_ids": bot_running_pids,
        "join_groups_running": join_running,
        "feed_running": feed_running,
    }


@app.post("/jobs/stop-all")
def stop_all_jobs() -> dict:
    """
    D·ª´ng t·∫•t c·∫£ t√°c v·ª• n·ªÅn (d√πng chung cho auto join group + sau n√†y nu√¥i acc).
    """
    # Legacy endpoint: v·∫´n map v·ªÅ hard stop (fresh start) cho ƒë√∫ng spec m·ªõi
    return _hard_stop_everything(reason="/jobs/stop-all")


# ==============================================================================
# INFO COLLECTOR (get_all_info_from_post_ids_dir)
# ==============================================================================

@app.post("/info/run")
async def run_info_collector(payload: InfoRunRequest = Body(...)) -> dict:
    """
    Trigger l·∫•y th√¥ng tin reactions/comments:
      - mode="all": ch·∫°y to√†n b·ªô post_ids dir (gi·ªëng CLI hi·ªán t·∫°i)
      - mode="selected": ch·ªâ ch·∫°y c√°c profile_id truy·ªÅn trong payload.profiles
    """
    mode = (payload.mode or "all").lower()
    try:
        if mode == "selected":
            profiles = payload.profiles or []
            if not profiles:
                raise HTTPException(status_code=400, detail="profiles is required when mode=selected")
            summary = await run_in_threadpool(get_info_for_profile_ids, profiles)
        else:
            summary = await run_in_threadpool(get_all_info_from_post_ids_dir)
        return {"status": "ok", "mode": mode, "summary": summary}
    except ValueError as e:
        # N·∫øu kh√¥ng c√≥ d·ªØ li·ªáu b√†i vi·∫øt th√¨ tr·∫£ v·ªÅ message r√µ r√†ng
        error_msg = str(e)
        if "kh√¥ng c√≥ d·ªØ li·ªáu b√†i vi·∫øt" in error_msg.lower():
            raise HTTPException(status_code=400, detail="Kh√¥ng c√≥ d·ªØ li·ªáu b√†i vi·∫øt ƒë·ªÉ x·ª≠ l√Ω")
        raise HTTPException(status_code=400, detail=error_msg)
    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))


@app.get("/info/scan-stats")
def get_scan_stats() -> dict:
    """
    L·∫•y s·ªë b√†i ƒë√£ qu√©t ƒë∆∞·ª£c cho t·ª´ng profile_id t·ª´ c√°c file JSON trong data/post_ids/
    """
    from pathlib import Path
    import json
    import os
    
    BASE_DIR = Path(__file__).resolve().parents[1]
    POST_IDS_DIR = BASE_DIR / "data" / "post_ids"
    
    stats = {}
    
    if not POST_IDS_DIR.exists():
        return {"stats": stats}
    
    json_files = list(POST_IDS_DIR.glob("*.json"))
    for file_path in json_files:
        profile_id = file_path.stem  # L·∫•y t√™n file kh√¥ng c√≥ extension
        try:
            with open(file_path, "r", encoding="utf-8") as f:
                data = json.load(f)
                if isinstance(data, list):
                    count = len(data)
                else:
                    count = 0
                stats[profile_id] = count
        except Exception:
            stats[profile_id] = 0
    
    return {"stats": stats}


@app.get("/info/progress")
def get_info_progress() -> dict:
    """
    L·∫•y ti·∫øn tr√¨nh khi ƒëang l·∫•y th√¥ng tin (s·ªë b√†i ƒë√£ x·ª≠ l√Ω / t·ªïng s·ªë b√†i)
    """
    from backend.worker.get_all_info import INFO_PROGRESS
    
    return {
        "is_running": INFO_PROGRESS.get("is_running", False),
        "current": INFO_PROGRESS.get("current", 0),
        "total": INFO_PROGRESS.get("total", 0),
        "current_file": INFO_PROGRESS.get("current_file", ""),
    }


# ==============================================================================
# CONTROL API (STOP / PAUSE / RESUME) - theo spec Boss
# ==============================================================================

class ProfileControlPayload(BaseModel):
    profile_id: str


class ProfilesControlPayload(BaseModel):
    profile_ids: list[str]


class ResetStopPayload(BaseModel):
    clear_stopped_profiles: bool = False


@app.get("/control/state")
def control_get_state() -> dict:
    return control_state.get_state()


@app.post("/control/stop-all")
def control_stop_all() -> dict:
    """
    STOP ALL = d·ª´ng kh·∫©n c·∫•p.
    - set GLOBAL_EMERGENCY_STOP=true (∆∞u ti√™n cao nh·∫•t)
    - best-effort: ƒë√≥ng to√†n b·ªô NST browser
    - KH√îNG h·ªèi confirm, KH√îNG delay
    """
    return _hard_stop_everything(reason="/control/stop-all")


@app.post("/control/pause-all")
def control_pause_all() -> dict:
    print("[UI] PAUSE ALL triggered")
    st = control_state.set_global_pause(True)
    return {"status": "ok", "state": st}


@app.post("/control/resume-all")
def control_resume_all() -> dict:
    print("[UI] RESUME ALL triggered")
    st = control_state.set_global_pause(False)
    return {"status": "ok", "state": st}


@app.post("/control/pause-profile")
def control_pause_profile(payload: ProfileControlPayload) -> dict:
    pid = _norm_profile_id(payload.profile_id)
    print(f"[UI] PAUSE profile_id={pid}")
    st = control_state.pause_profile(pid)
    return {"status": "ok", "state": st, "profile_id": pid}


@app.post("/control/resume-profile")
def control_resume_profile(payload: ProfileControlPayload) -> dict:
    pid = _norm_profile_id(payload.profile_id)
    print(f"[UI] RESUME profile_id={pid}")
    st = control_state.resume_profile(pid)
    return {"status": "ok", "state": st, "profile_id": pid}


@app.post("/control/stop-profiles")
def control_stop_profiles(payload: ProfilesControlPayload) -> dict:
    """
    STOP theo danh s√°ch profile (d√πng cho UI: tick profile -> b·∫•m d·ª´ng).
    - Set stopped_profiles cho t·ª´ng pid
    - Best-effort: ƒë√≥ng NST browser cho ƒë√∫ng c√°c pid ƒë√≥
    """
    global _bot_processes
    pids = [_norm_profile_id(x) for x in (payload.profile_ids or [])]
    pids = [p for p in pids if p]
    print(f"[UI] STOP profiles={pids}")

    st = control_state.stop_profiles(pids)

    # Terminate bot process ƒë√∫ng profile (ƒë·ªôc l·∫≠p), kh√¥ng ·∫£nh h∆∞·ªüng profile kh√°c
    try:
        with _bot_lock:
            _prune_bot_processes()
            for pid in pids:
                proc = _bot_processes.get(pid)
                try:
                    if proc and proc.is_alive():
                        proc.terminate()
                        proc.join(timeout=3)
                except Exception:
                    pass
                _bot_processes.pop(pid, None)
    except Exception:
        pass

    nst_ok: list[str] = []
    nst_fail: list[dict] = []
    for pid in pids:
        try:
            ok = bool(stop_profile(pid))
            if ok:
                nst_ok.append(pid)
            else:
                nst_fail.append({"profile_id": pid, "reason": "stop_profile_returned_false"})
        except Exception as e:
            nst_fail.append({"profile_id": pid, "reason": str(e)})

    return {"status": "ok", "state": st, "stopped_profiles": pids, "nst_ok": nst_ok, "nst_fail": nst_fail}


@app.post("/control/pause-profiles")
def control_pause_profiles(payload: ProfilesControlPayload) -> dict:
    pids = [_norm_profile_id(x) for x in (payload.profile_ids or [])]
    pids = [p for p in pids if p]
    print(f"[UI] PAUSE profiles={pids}")
    st = control_state.pause_profiles(pids)
    return {"status": "ok", "state": st, "paused_profiles": pids}


@app.post("/control/resume-profiles")
def control_resume_profiles(payload: ProfilesControlPayload) -> dict:
    pids = [_norm_profile_id(x) for x in (payload.profile_ids or [])]
    pids = [p for p in pids if p]
    print(f"[UI] RESUME profiles={pids}")
    st = control_state.resume_profiles(pids)
    return {"status": "ok", "state": st, "resumed_profiles": pids}


@app.post("/control/reset-stop")
def control_reset_stop(payload: Optional[ResetStopPayload] = Body(None)) -> dict:
    """
    Reset emergency stop ƒë·ªÉ h·ªá th·ªëng ch·∫°y l·∫°i ƒë∆∞·ª£c.
    - clear_stopped_profiles=true: xo√° lu√¥n stopped_profiles (ƒë·ªÉ profile kh√¥ng b·ªã gi·ªØ STOPPED)
    """
    clear_stopped = bool(payload.clear_stopped_profiles) if payload else False
    print(f"[UI] RESET STOP (clear_stopped_profiles={clear_stopped})")
    st = control_state.reset_emergency_stop(clear_stopped_profiles=clear_stopped)
    return {"status": "ok", "state": st}

@app.delete("/settings/profiles/{profile_id}")
def delete_profile(profile_id: str) -> dict:
    pid = _norm_profile_id(profile_id)
    if not pid:
        raise HTTPException(status_code=400, detail="profile_id r·ªóng")

    with _settings_lock:
        raw = _read_settings_raw()
        profiles = raw.get("PROFILE_IDS") or {}
        if isinstance(profiles, list) or isinstance(profiles, str):
            profiles = {}
        if not isinstance(profiles, dict):
            raise HTTPException(status_code=400, detail="PROFILE_IDS ph·∫£i l√† object")

        if pid in profiles:
            del profiles[pid]
        raw["PROFILE_IDS"] = profiles
        _write_settings_raw(raw)
        return {"status": "ok"}


@app.post("/settings/profiles/{profile_id}/cookie/fetch")
def fetch_and_save_cookie(profile_id: str) -> dict:
    """
    K·∫øt n·ªëi NST profile -> l·∫•y cookie t·ª´ browser context -> l∆∞u v√†o settings.json.
    """
    pid = _norm_profile_id(profile_id)
    if not pid:
        raise HTTPException(status_code=400, detail="profile_id r·ªóng")

    try:
        ws = connect_profile(pid)
    except Exception as exc:
        # NST ch∆∞a ch·∫°y / API key sai / profile_id sai
        raise HTTPException(status_code=502, detail=str(exc)) from exc
    fb = FBController(ws)
    fb.profile_id = pid
    fb.connect()
    try:
        # ƒë·∫£m b·∫£o context ƒë√£ c√≥ session/cookie
        try:
            fb.goto("https://www.facebook.com/")
            fb.page.wait_for_timeout(1200)
        except Exception:
            pass

        cookie_string = fb.save_cookies()
        if not cookie_string:
            raise HTTPException(status_code=400, detail="Kh√¥ng l·∫•y ƒë∆∞·ª£c cookie (c√≥ th·ªÉ ch∆∞a ƒëƒÉng nh·∫≠p)")
        return {"status": "ok", "profile_id": pid, "cookie": cookie_string}
    finally:
        # ƒê√≥ng s·∫°ch tab/context playwright
        try:
            if fb.page:
                try:
                    fb.page.close()
                except Exception:
                    pass
        except Exception:
            pass
        try:
            if fb.browser and getattr(fb.browser, "contexts", None):
                for ctx in list(fb.browser.contexts):
                    try:
                        ctx.close()
                    except Exception:
                        pass
        except Exception:
            pass
        try:
            if fb.browser:
                fb.browser.close()
        except Exception:
            pass
        try:
            if fb.play:
                fb.play.stop()
        except Exception:
            pass

        # Best-effort: y√™u c·∫ßu NST stop/close browser instance c·ªßa profile
        try:
            stop_profile(pid)
        except Exception:
            pass

--- END FILE: backend\app\api.py ---

--- START FILE: backend\app\__init__.py ---
"""
App package cho FastAPI endpoints.
"""

--- END FILE: backend\app\__init__.py ---

--- START FILE: backend\config\groups.json ---
{
  "b77da63d-af55-43c2-ab7f-364250b20e30": [
    {
      "page_id": "988098777982558",
      "url_page": "https://www.facebook.com/groups/tuyendungkisuIT"
    }
  ]
}




--- END FILE: backend\config\groups.json ---

--- START FILE: backend\config\settings.json ---
{
  "API_KEY": "7a43ee33-9f15-434d-a1b6-6d1b5809f935",
  "HEADLESS": false,
  "TARGET_URL": "https://facebook.com",
  "PROFILE_IDS": {
    "b77da63d-af55-43c2-ab7f-364250b20e30": {
      "access_token": "EAAGNO4a7r2wBQbl2ozjrGQSIzSGOVgZAcoj86vjZCqZC1FCurCX5PaGbzqHdRMUFgJ6CGBhlGusZAOXm4gGxpm5q80y89Y1MNzNYOttxin0b3DhBZCCuZBLqsxjaeltCjsDBPTEP29ZAzz7oKp5Lk6yVVFZAlhBiP4p3JFcEE125EyZAPHaAEdH0JjZA3LkhtbpLWA0AZDZD",
      "cookie": "sb=acBIaQQgqAGBTmbz93PPTcnU; ps_l=1; ps_n=1; datr=acBIabhUTCuJxOkmdTYz8XW-; c_user=100044138143352; fr=1VMWQQuenYceehdsZ.AWfGfB9qmBtvmuDdeO81J0dTos4jVxL0x5pHYhV1thuLhAjmW7E.BpSUdY..AAA.0.0.BpSUeS.AWfu06UAzWOUNEhJL1ZIELO2A04; xs=44%3Aaj597WlM7O7beg%3A2%3A1766410069%3A-1%3A-1%3A%3AAcx_3Kz36a3z318o8wuDUtGUsdWuBNAFeGxishIR9g; wd=929x883;",
      "fb_dtsg": "NAfu29YJvi_1RzbzZWrSlZ3JOPAtlb2YrVQWjwmitp5kE0FtpiCo0gg:44:1766410069",
      "lsd": "JxUArcF13Kgs6kRC1Z8iwU",
      "spin_r": "1031381813",
      "spin_t": "1766339451",
      "groups": [
        "https://www.facebook.com/groups/tuyendungkisuIT"
      ]
    }
  },
  "RUN_MINUTES": 30,
  "REST_MINUTES": 120
}
--- END FILE: backend\config\settings.json ---

--- START FILE: backend\core\browser.py ---
import time
import random
from playwright.sync_api import sync_playwright
import json
import re
from urllib.parse import urlparse, parse_qs, unquote
import os
import sys
from core.settings import get_settings, SETTINGS_PATH
from core import control as control_state
# ==============================================================================
# JS TOOLS & HELPER FUNCTIONS
# ==============================================================================
current_dir = os.path.dirname(os.path.abspath(__file__))
parent_dir = os.path.dirname(current_dir)
worker_path = os.path.join(parent_dir, 'worker')

if worker_path not in sys.path:
    sys.path.append(worker_path)

# Import h√†m l·∫•y th√¥ng tin an to√†n
try:
    from get_id import get_id_from_url
except ImportError:
    try:
        from worker.get_id import get_id_from_url
    except:
        print("‚ö†Ô∏è C·∫£nh b√°o: Kh√¥ng import ƒë∆∞·ª£c worker/get_id.py")
        get_id_from_url = None


JS_EXPAND_SCRIPT = """
(node) => {
    if (!node) return 0;

    const keywords = ["Xem th√™m", "See more"];
    let clickedCount = 0;

    // üîí Ch·ªâ t√¨m trong n·ªôi dung b√†i vi·∫øt
    const scopes = [
        '[data-ad-preview="message"]',
        '[data-ad-rendering-role="story_message"]',
        '.userContent'
    ];

    let target = null;
    for (const sel of scopes) {
        const found = node.querySelector(sel);
        if (found) {
            target = found;
            break;
        }
    }

    if (!target) return 0;

    const buttons = Array.from(
        target.querySelectorAll('[role="button"]')
    );

    for (const btn of buttons) {
        const text = btn.innerText ? btn.innerText.trim() : "";
        if (!keywords.includes(text)) continue;

        const rect = btn.getBoundingClientRect();

        // ‚ùó Ch·ªâ click n·∫øu n√∫t ƒëang n·∫±m trong viewport
        if (rect.top < 0 || rect.bottom > window.innerHeight) continue;

        if (btn.offsetWidth > 0 && btn.offsetHeight > 0) {
            btn.click();
            btn.style.border = "2px solid red";
            clickedCount++;
        }
    }

    return clickedCount;
}
"""

JS_CHECK_AND_HIGHLIGHT_SCOPED = """
([node, keywords]) => { 
    if (!node || !keywords || keywords.length === 0) return false;
    
    // [C·ª∞C K·ª≤ QUAN TR·ªåNG] 
    // Ch·ªâ ƒë·ªãnh ch√≠nh x√°c c√°c selector bao b·ªçc n·ªôi dung b√†i vi·∫øt m√† S·∫øp ƒë√£ cung c·∫•p.
    // Bot s·∫Ω ch·ªâ ho·∫°t ƒë·ªông b√™n trong c√°c th·∫ª n√†y.
    const strictSelectors = [
        '[data-ad-preview="message"]',              // ∆Øu ti√™n 1: Chu·∫©n Ads
        '[data-ad-rendering-role="story_message"]', // ∆Øu ti√™n 2: Wrapper c·ªßa message
        '.userContent'                              // ∆Øu ti√™n 3: C√°c d·∫°ng b√†i c≈©
    ];

    let targetScope = null;

    // 1. T√¨m ƒë√∫ng c√°i h·ªôp n·ªôi dung
    for (const selector of strictSelectors) {
        const found = node.querySelector(selector);
        if (found) {
            targetScope = found;
            break;
        }
    }

    // [CH·ªêT CH·∫∂N]
    // N·∫øu kh√¥ng t√¨m th·∫•y c√°i h·ªôp n·ªôi dung n√†y -> Coi nh∆∞ kh√¥ng ph·∫£i b√†i vi·∫øt h·ª£p l·ªá -> RETURN FALSE NGAY.
    // ƒêi·ªÅu n√†y ƒë·∫£m b·∫£o kh√¥ng bao gi·ªù qu√©t nh·∫ßm t√™n Page hay Header b√™n ngo√†i.
    if (!targetScope) return false;

    // 2. Logic qu√©t v√† highlight (Ch·ªâ ch·∫°y trong targetScope)
    const sortedKeywords = keywords.sort((a, b) => b.length - a.length);
    const pattern = new RegExp(`(${sortedKeywords.join('|')})`, 'gi');
    let foundCount = 0;

    function highlightTextNode(textNode) {
        const text = textNode.nodeValue;
        if (!pattern.test(text)) return;
        
        const fragment = document.createDocumentFragment();
        const parts = text.split(pattern);
        parts.forEach(part => {
            if (pattern.test(part)) {
                const span = document.createElement('span');
                // Style cho d·ªÖ nh√¨n khi debug
                Object.assign(span.style, {
                    backgroundColor: 'yellow', color: 'red', fontWeight: 'bold',
                    border: '2px solid red', padding: '2px', zIndex: '9999'
                });
                span.innerText = part;
                fragment.appendChild(span);
                foundCount++;
            } else {
                fragment.appendChild(document.createTextNode(part));
            }
            pattern.lastIndex = 0; 
        });
        textNode.parentNode.replaceChild(fragment, textNode);
    }

    const walker = document.createTreeWalker(targetScope, NodeFilter.SHOW_TEXT, {
        acceptNode: n => {
            // V·∫´n gi·ªØ b·ªô l·ªçc th·∫ª r√°c ƒë·ªÉ s·∫°ch s·∫Ω nh·∫•t c√≥ th·ªÉ
            if (['SCRIPT', 'STYLE', 'NOSCRIPT', 'BUTTON', 'INPUT'].includes(n.parentNode.nodeName)) {
                return NodeFilter.FILTER_REJECT;
            }
            if (n.parentNode.isContentEditable) return NodeFilter.FILTER_REJECT;
            return NodeFilter.FILTER_ACCEPT;
        }
    });

    const textNodes = [];
    while (walker.nextNode()) textNodes.push(walker.currentNode);
    textNodes.forEach(highlightTextNode);
    
    return foundCount > 0;
}
"""

def extract_facebook_post_id(url: str):
    if not url: return None
    try: url = unquote(url)
    except: pass
    
    patterns = [
        r"(pfbid[A-Za-z0-9]+)", 
        r"/posts/(\d+)", 
        r"/videos/(\d+)", 
        r"/reel/(\d+)",
        r"story_fbid=(\d+)", 
        r"fbid=(\d+)",
        r"id=(\d+)"
    ]
    for p in patterns:
        m = re.search(p, url)
        if m: return m.group(1)
        
    qs = parse_qs(urlparse(url).query)
    for k in ["story_fbid", "fbid", "id"]:
        if k in qs: return qs[k][0]
    return None

def parse_graphql_payload(post_data):
    """Ph√¢n t√≠ch data g·ª≠i ƒëi ƒë·ªÉ t√¨m bi·∫øn 'url'."""
    if not post_data: return None
    variables_str = None
    
    try:
        if isinstance(post_data, str):
            json_body = json.loads(post_data)
        else:
            json_body = post_data
        variables_str = json.dumps(json_body.get("variables", {}))
    except:
        try:
            qs = parse_qs(post_data)
            if "variables" in qs:
                variables_str = qs["variables"][0]
        except: pass

    if variables_str and '"url":' in variables_str:
        match = re.search(r'"url"\s*:\s*"([^"]+)"', variables_str)
        if match:
            raw_url = match.group(1)
            return raw_url.replace(r"\/", "/")
            
    return None


class FBController:
    def __init__(self, ws_url):
        self.ws_url = ws_url
        self.browser = None
        self.page = None
        self.play = None
        self.profile_id = "unknown"
        # keyword filter th√™m t·ª´ UI (Setting profile -> Qu√©t b√†i vi·∫øt)
        # n·∫øu r·ªóng => ch·ªâ l·ªçc theo job_keywords m·∫∑c ƒë·ªãnh
        self.user_keywords = []
        cfg = get_settings()
        self.all_profile_ids = cfg.profile_ids
        # Ch·ªâ b·∫Øt URL payload t·ª´ request
        self.captured_payload_url = None
        
        self.job_keywords = [
            "tuy·ªÉn d·ª•ng", "tuy·ªÉn nh√¢n vi√™n", "tuy·ªÉn g·∫•p", "vi·ªác l√†m", "tuy·ªÉn",
            "l∆∞∆°ng", "ph·ªèng v·∫•n", "h·ªì s∆°",
            "full-time", "part-time", "th·ª±c t·∫≠p", "k·∫ø to√°n", "may m·∫∑c", "kcn" ,"·ª®ng vi√™n " , "·ª®ng tuy·ªÉn"
        ]
        # cache nh·∫π ƒë·ªÉ tr√°nh spam IO khi check control li√™n t·ª•c
        self._last_control_check_ts = 0.0
        self._last_control_snapshot = (False, False, "")

    def control_checkpoint(self, where: str = "") -> None:
        """
        ∆Øu ti√™n flag theo spec:
          1) GLOBAL_EMERGENCY_STOP -> STOP NGAY
          2) GLOBAL_PAUSE -> SLEEP
          3) PAUSED_PROFILES[pid] -> SLEEP
        """
        now = time.time()
        if now - float(getattr(self, "_last_control_check_ts", 0.0)) > 0.35:
            self._last_control_check_ts = now
            self._last_control_snapshot = control_state.check_flags(getattr(self, "profile_id", None))

        stop, paused, reason = self._last_control_snapshot

        if stop:
            try:
                control_state.set_profile_state(self.profile_id, "STOPPED")
            except Exception:
                pass
            print(f"üõë [STOP] {self.profile_id} @ {where} ({reason})")
            raise RuntimeError("EMERGENCY_STOP")

        if paused:
            try:
                control_state.set_profile_state(self.profile_id, "PAUSED")
            except Exception:
                pass
            if where:
                print(f"‚è∏Ô∏è [PAUSE] {self.profile_id} @ {where} ({reason})")
            # ch·ªù ƒë·∫øn khi h·∫øt pause ho·∫∑c emergency stop
            control_state.wait_if_paused(self.profile_id, sleep_seconds=0.5)
            try:
                control_state.set_profile_state(self.profile_id, "RUNNING")
            except Exception:
                pass

    def connect(self):
        self.play = sync_playwright().start()
        self.browser = self.play.chromium.connect_over_cdp(self.ws_url)
        context = self.browser.contexts[0]
        self.page = context.pages[0]
        
        self.start_network_sniffer()
        
        try:
            viewport = self.page.viewport_size
            self.page.mouse.click(viewport['width']/2, viewport['height']/2)
        except: pass

    def goto(self, url):
        self.page.goto(url, timeout=0)

    # ===================== [CORE] NETWORK SNIFFER =====================
    def start_network_sniffer(self):
        print("üõ∞  ƒê√£ k√≠ch ho·∫°t Sniffer: Ch·∫ø ƒë·ªô b·∫Øt Payload URL...")

        # B·∫ÆT URL T·ª™ REQUEST (ch·ªâ b·∫Øt URL c√≥ ch·ª©a "share")
        def on_request(request):
            if "facebook.com/api/graphql" in request.url and request.method == "POST":
                try:
                    raw_url = parse_graphql_payload(request.post_data)
                    if raw_url:
                        # Ch·ªâ l∆∞u n·∫øu URL c√≥ ch·ª©a "share" (v√≠ d·ª•: https://www.facebook.com/share/p/1HYNUE6FzL/)
                        if "/share/" in raw_url:
                            self.captured_payload_url = raw_url
                            print(f"üîó [DEBUG] B·∫Øt ƒë∆∞·ª£c Share URL: {raw_url}")
                except: pass

        self.page.on("request", on_request)

    # ===================== SHARE & CH·ªú ID (LOGIC M·ªöI) =====================
    def share_center_ad(self, post_handle, post_type):
            
        try:
            self.control_checkpoint("before_share")
            viewport = self.page.viewport_size
            height = viewport['height'] if viewport else 800
            escape_step = height * 0.35  # üëà THO√ÅT MODULE R√ÅC
            print("üöÄ Share ‚Üí b·∫Øt Payload URL ‚Üí g·ªçi get_id_from_url")

            self.captured_payload_url = None

            share_btn = post_handle.query_selector(
                'xpath=.//div[@data-ad-rendering-role="share_button"]/ancestor::div[@role="button"]'
            )
            if not share_btn:
                print("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y n√∫t Share")
                self.scroll_past_post(post_handle)
                time.sleep(random.uniform(0.12, 0.13))
                return False

            self.bring_element_into_view_smooth(share_btn)
            self.page.wait_for_timeout(300)
            share_btn.click()

            # ƒê·ª£i b·∫Øt ƒë∆∞·ª£c payload URL
            for _ in range(50):
                self.control_checkpoint("after_share_click_wait_payload")
                if self.captured_payload_url:
                    # G·ªçi get_id_from_url tr·ª±c ti·∫øp t·ª´ URL payload
                    if get_id_from_url:
                        try:
                            self.control_checkpoint("before_get_id_from_url")
                            print(f"üì• ƒêang g·ªçi get_id_from_url v·ªõi URL: {self.captured_payload_url}")
                            details = get_id_from_url(self.captured_payload_url, self.profile_id)
                            if details and details.get("post_id"):
                                self.save_post_id_from_details(details, post_type)
                                self.page.keyboard.press("Escape")
                                return True
                            else:
                                print("‚ö†Ô∏è Kh√¥ng l·∫•y ƒë∆∞·ª£c post_id t·ª´ get_id_from_url")
                        except Exception as e:
                            # Kh√¥ng ƒë∆∞·ª£c nu·ªët STOP/PAUSE
                            if isinstance(e, RuntimeError) and ("EMERGENCY_STOP" in str(e) or "BROWSER_CLOSED" in str(e)):
                                raise
                            print(f"‚ùå L·ªói khi g·ªçi get_id_from_url: {e}")
                    break
                self.page.wait_for_timeout(150)

            print("‚ö†Ô∏è Kh√¥ng l·∫•y ƒë∆∞·ª£c Payload URL")
            self.page.keyboard.press("Escape")
            return False

        except Exception as e:
            # Kh√¥ng ƒë∆∞·ª£c nu·ªët STOP/PAUSE
            if isinstance(e, RuntimeError) and ("EMERGENCY_STOP" in str(e) or "BROWSER_CLOSED" in str(e)):
                raise
            print(f"‚ùå share_center_ad l·ªói: {e}")
            self.page.keyboard.press("Escape")
            return False

    # ===================== C√ÅC H√ÄM KH√ÅC GI·ªÆ NGUY√äN =====================
    def save_post_id_from_details(self, details, post_type):
        """
        L∆∞u post t·ª´ dict details tr·∫£ v·ªÅ t·ª´ get_id_from_url
        details ch·ª©a: post_id, owning_profile, post_text
        """
        try:
            post_id = details.get("post_id")
            if not post_id:
                print("‚ö†Ô∏è Kh√¥ng c√≥ post_id trong details")
                return False
                
            folder = "data/post_ids"
            os.makedirs(folder, exist_ok=True)
            filepath = f"{folder}/{self.profile_id}.json"

            data = []
            if os.path.exists(filepath):
                try:
                    with open(filepath, "r", encoding="utf8") as f:
                        data = json.load(f)
                except:
                    data = []

            # 1. Tr√°nh tr√πng ID (Check c·∫£ format c≈© post_id v√† m·ªõi id)
            for item in data:
                existing_id = item.get("id") or item.get("post_id")
                if existing_id == post_id:
                    print(f"üîÅ ID {post_id} ƒë√£ t·ªìn t·∫°i -> b·ªè qua.")
                    return False

            # 2. Format d·ªØ li·ªáu JSON theo y√™u c·∫ßu
            # Map flag: green -> xanh, yellow -> v√†ng
            flag_vn = "xanh" if post_type == "green" else "v√†ng" if post_type == "yellow" else post_type
            
            # L·∫•y th√¥ng tin t·ª´ k·∫øt qu·∫£ worker tr·∫£ v·ªÅ
            post_text = details.get("post_text", "")
            owning_profile = details.get("owning_profile", {})

            record = {
                "id": post_id,
                "flag": flag_vn,
                "text": post_text,
                "owning_profile": owning_profile
            }

            data.append(record)

            with open(filepath, "w", encoding="utf8") as f:
                json.dump(data, f, indent=2, ensure_ascii=False)

            print(f"üíæ ƒê√£ l∆∞u Post {post_id} | Ch·ªß b√†i: {owning_profile.get('name', 'N/A')}")
            
            return True
        except Exception as e:
            print(f"‚ùå L·ªói save_post_id_from_details: {e}")
            return False


    def scan_while_scrolling(self):
        try:
            viewport = self.page.viewport_size
            height = viewport['height'] if viewport else 800

            normal_step = height * 0.12
            escape_step = height * 0.35  # üëà THO√ÅT MODULE R√ÅC

            print("‚¨áÔ∏è Scan theo center-post (LOCK khi th·∫•y xanh)")

            while True:
                self.control_checkpoint("before_scroll_loop")
                post = self.get_center_post()

                # =========================
                # ‚ùå KH√îNG PH·∫¢I POST ‚Üí THO√ÅT NGAY
                # =========================
                if not post:
                    # ƒëang ƒë·ª©ng tr√™n ref / k·∫øt b·∫°n / module r√°c
                    self.control_checkpoint("before_escape_wheel")
                    self.page.mouse.wheel(0, escape_step)
                    time.sleep(random.uniform(0.12, 0.13))
                    continue

                # =========================
                # POST ƒê√É X·ª¨ L√ù ‚Üí ƒê·∫®Y RA KH·ªéI VIEW
                # =========================
                if self.check_post_is_processed(post):
                    try:
                        self.control_checkpoint("before_normal_wheel")
                        self.page.mouse.wheel(0, normal_step)
                    except Exception as e:
                        error_msg = str(e).lower()
                        if any(keyword in error_msg for keyword in ["closed", "disconnected", "target page", "context or browser"]):
                            raise RuntimeError("BROWSER_CLOSED") from e
                        raise
                    time.sleep(random.uniform(0.08, 0.15))
                    continue

                # =========================
                # LOCK POST H·ª¢P L·ªÜ
                # =========================
                is_ad = self.check_current_post_is_ad(post)

                if is_ad:
                    print("üü• ADS detected (center-post)")
                    return post, "green"
                else:
                    print("üü® B√†i th∆∞·ªùng detected (center-post)")
                    return post, "yellow"

        except Exception as e:
            error_msg = str(e).lower()
            # N·∫øu browser/page ƒë√£ b·ªã ƒë√≥ng th√¨ raise exception ƒë·∫∑c bi·ªát ƒë·ªÉ bot d·ª´ng
            if any(keyword in error_msg for keyword in ["closed", "disconnected", "target page", "context or browser"]):
                print(f"üõë Browser ƒë√£ b·ªã ƒë√≥ng trong scan_while_scrolling -> Raise exception")
                raise RuntimeError("BROWSER_CLOSED") from e
            print(f"‚ö†Ô∏è L·ªói scan: {e}")
            return None, None

    def like_current_post(self, post_handle):
        print("‚ù§Ô∏è ƒêang th·ª±c hi·ªán Like b√†i vi·∫øt n√†y...")
        try:
            self.control_checkpoint("before_like")
            element = post_handle.as_element()
            if not element: return False
            already_liked = element.query_selector('div[role="button"][aria-label="G·ª° Th√≠ch"], div[role="button"][aria-label="Remove Like"]')
            if already_liked:
                print("‚ö†Ô∏è B√†i n√†y ƒë√£ Like r·ªìi -> B·ªè qua.")
                return False
            
            # Like theo x√°c su·∫•t gi·ªëng ng∆∞·ªùi d√πng (gi·ªëng search_worker.py):
            # - V·ªõi m·ªói b√†i "ƒë√∫ng", random 1 t·ªâ l·ªá trong kho·∫£ng 40%..60%
            # - Sau ƒë√≥ roll ƒë·ªÉ quy·∫øt ƒë·ªãnh c√≥ Like hay kh√¥ng
            p = random.uniform(0.40, 0.60)
            roll = random.random()
            should_like = roll < p
            print(f"üé≤ [LikeProb] p={p:.2f} roll={roll:.2f} -> {'LIKE' if should_like else 'SKIP'}")
            
            if not should_like:
                print("‚è≠Ô∏è Skip Like theo x√°c su·∫•t random")
                return False
            
            selector = 'div[role="button"][aria-label="Th√≠ch"], div[role="button"][aria-label="Like"]'
            like_btn = element.query_selector(selector)
            if like_btn:
                self.bring_element_into_view_smooth(like_btn)
                time.sleep(0.5)
                self.control_checkpoint("before_like_click")
                like_btn.click()
                self.control_checkpoint("after_like_click")
                print("‚úÖ ƒê√£ B·∫•m Like th√†nh c√¥ng!")
                return True
            else:
                print("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y n√∫t Like ph√π h·ª£p.")
                return False
        except Exception as e:
            if isinstance(e, RuntimeError) and ("EMERGENCY_STOP" in str(e) or "BROWSER_CLOSED" in str(e)):
                raise
            print(f"‚ùå L·ªói Like: {e}")
            return False

    


    def get_center_post(self):
        try:
            return self.page.evaluate_handle("""
                () => {
                    const x = window.innerWidth / 2;
                    const y = window.innerHeight * 0.45;
                    const el = document.elementFromPoint(x, y);
                    if (!el) return null;

                    // =========================
                    // 1. CHECK CONTEXT: SEARCH PAGE?
                    // =========================
                    const isSearchPage = !!document.querySelector(
                        'h1, span'
                    ) && [...document.querySelectorAll('h1, span')]
                        .some(e => e.innerText?.trim() === 'K·∫øt qu·∫£ t√¨m ki·∫øm');

                    // =========================
                    // 2. CH·ªåN CONTAINER PH√ô H·ª¢P
                    // =========================
                    const POST_SELECTOR = isSearchPage
                        ? 'div.x78zum5.xdt5ytf'   // search page
                        : 'div.x1lliihq';         // home / feed

                    let cur = el.closest(POST_SELECTOR);

                    while (cur) {
                        // ‚úÖ PH·∫¢I C√ì LIKE BUTTON ‚Üí m·ªõi l√† post th·∫≠t
                        const hasLike = cur.querySelector(
                            'div[aria-label="Th√≠ch"], div[aria-label="Like"],' +
                            'div[aria-label="G·ª° Th√≠ch"], div[aria-label="Remove Like"]'
                        );

                        if (hasLike) {
                            cur.style.outline = "4px solid #00ff00";
                            cur.setAttribute('data-center-post', 'true'); // üîí MARK
                            return cur;
                        }

                        cur = cur.parentElement?.closest(POST_SELECTOR);
                    }

                    return null;
                }
            """)
        except:
            return None

    def check_current_post_is_ad(self, post_handle):
        if not post_handle or not post_handle.as_element(): return False
        return post_handle.evaluate("""
            (post) => {
                if (post.getAttribute('data-bot-processed') === 'true') return false;
                const checkAnchors = (element) => {
                    if (!element) return false;
                    const anchors = Array.from(element.querySelectorAll('a[href*="__cft__"]'));
                    for (const a of anchors) {
                        const href = a.getAttribute('href');
                        if (!href) continue;
                        if (href.includes('__tn__')) continue;
                        let m = href.match(/__cft__\\[0\\]=([^&#]+)/) || href.match(/__cft__%5B0%5D=([^&#]+)/);
                        if (m && m[1]) return true; 
                    }
                    return false;
                };
                if (checkAnchors(post)) { post.style.outline = "5px solid red"; return true; }
                if (post.parentElement && checkAnchors(post.parentElement)) { post.style.outline = "5px solid red"; return true; }
                if (post.parentElement && post.parentElement.parentElement && checkAnchors(post.parentElement.parentElement)) { post.style.outline = "5px solid red"; return true; }
                return false;
            }
        """)

    def mark_post_as_processed(self, post_handle):
        try:
            post_handle.evaluate("""(post) => {
                post.setAttribute('data-bot-processed', 'true');
                post.style.outline = "5px solid gray"; 
                post.style.opacity = "0.7";
            }""")
            print("üèÅ ƒê√£ ƒë√°nh d·∫•u b√†i vi·∫øt: DONE.")
        except: pass
        
    def save_cookies(self):
        """
        L·∫•y cookie t·ª´ browser context v√† l∆∞u th·∫≥ng v√†o:
        backend/config/settings.json -> PROFILE_IDS[profile_id]["cookie"]
        Tr·∫£ v·ªÅ cookie_string.
        """
        try:
            print("üç™ ƒêang tr√≠ch xu·∫•t Cookie (Key=ID, Value=String)...")
            
            # 1. L·∫•y to√†n b·ªô cookies
            all_cookies = self.page.context.cookies()
            if not all_cookies:
                print("‚ö†Ô∏è Ch∆∞a ƒëƒÉng nh·∫≠p.")
                return None

            # 2. Danh s√°ch c√°c tr∆∞·ªùng c·∫ßn l·∫•y (ƒê√∫ng th·ª© t·ª± S·∫øp g·ª≠i)
            target_keys = [
                "sb", "ps_l", "ps_n", "datr", "c_user", 
                "ar_debug", "fr", "xs", "wd"
            ]
            
            # T·∫°o map ƒë·ªÉ tra c·ª©u
            cookie_map = {c['name']: c['value'] for c in all_cookies}
            
            # 3. Gh√©p chu·ªói string
            cookie_parts = []
            for key in target_keys:
                if key in cookie_map:
                    cookie_parts.append(f"{key}={cookie_map[key]}")
            
            # T·∫°o chu·ªói k·∫øt qu·∫£ (n·∫øu c√≥ d·ªØ li·ªáu)
            if cookie_parts:
                cookie_string = "; ".join(cookie_parts) + ";"
            else:
                cookie_string = ""

            # 4. L∆∞u v√†o settings.json theo ƒë√∫ng profile_id
            try:
                if not SETTINGS_PATH.exists():
                    print(f"‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y settings.json: {SETTINGS_PATH}")
                    return cookie_string

                with SETTINGS_PATH.open("r", encoding="utf-8") as f:
                    raw = json.load(f)

                if not isinstance(raw, dict):
                    raw = {}

                profiles = raw.get("PROFILE_IDS")
                if profiles is None or isinstance(profiles, (list, str)):
                    profiles = {}
                if not isinstance(profiles, dict):
                    profiles = {}

                pid = str(self.profile_id or "").strip()
                if not pid:
                    print("‚ö†Ô∏è profile_id r·ªóng, kh√¥ng ghi v√†o settings.json")
                    return cookie_string

                cfg = profiles.get(pid)
                if not isinstance(cfg, dict):
                    cfg = {}
                cfg["cookie"] = cookie_string
                profiles[pid] = cfg
                raw["PROFILE_IDS"] = profiles

                # ghi file
                with SETTINGS_PATH.open("w", encoding="utf-8") as f:
                    json.dump(raw, f, indent=2, ensure_ascii=False)
                    f.write("\n")

                print(f"‚úÖ ƒê√£ c·∫≠p nh·∫≠t cookie v√†o settings.json cho profile_id={pid}")
            except Exception as e:
                print(f"‚ö†Ô∏è Kh√¥ng ghi ƒë∆∞·ª£c cookie v√†o settings.json: {e}")

            return cookie_string
            
        except Exception as e:
            print(f"‚ùå L·ªói l∆∞u cookies: {e}")
            return None
        
    def process_post(self, post_handle, post_type):
        """
        post_type: 'green' (ads) | 'yellow' (normal)
        """
        viewport = self.page.viewport_size
        if viewport: height = viewport['height']
        else: height = 800 
        try:
            self.control_checkpoint("before_process_post")
            print(f"üß† X·ª≠ l√Ω b√†i vi·∫øt type={post_type}")

            # 1. Expand n·ªôi dung
            expanded = self.page.evaluate(JS_EXPAND_SCRIPT, post_handle)
            if expanded > 0:
                print(f"üìñ ƒê√£ m·ªü {expanded} 'Xem th√™m'")
                time.sleep(1.2)

            # 2. Check keyword (chung cho c·∫£ ads & th∆∞·ªùng)
            has_keyword = self.page.evaluate(
                JS_CHECK_AND_HIGHLIGHT_SCOPED,
                [post_handle, self.job_keywords]
            )

            if not has_keyword:
                print("‚ùå Kh√¥ng c√≥ keyword -> skip b√†i")

                # 1. ƒê√°nh d·∫•u ƒë√£ x·ª≠ l√Ω
                self.mark_post_as_processed(post_handle)

                # 2. üö® ƒê·∫®Y POST RA KH·ªéI VIEWPORT (QUAN TR·ªåNG)
                try:
                    viewport = self.page.viewport_size
                    height = viewport['height'] if viewport else 800
                    self.page.mouse.wheel(0, height * 0.4)
                except Exception as e:
                    error_msg = str(e).lower()
                    if any(keyword in error_msg for keyword in ["closed", "disconnected", "target page", "context or browser"]):
                        raise RuntimeError("BROWSER_CLOSED") from e
                    pass

                return False

            print("‚úÖ C√≥ keyword")

            # 2b. N·∫øu user nh·∫≠p text (Setting profile -> Qu√©t b√†i vi·∫øt) th√¨ b·∫Øt bu·ªôc
            # b√†i ph·∫£i c√≥ √≠t nh·∫•t 1 trong c√°c t·ª´/c·ª•m t·ª´ ƒë√≥ (l·ªçc gi·ªëng Nu√¥i acc).
            if getattr(self, "user_keywords", None):
                try:
                    has_user_text = self.page.evaluate(
                        JS_CHECK_AND_HIGHLIGHT_SCOPED,
                        [post_handle, self.user_keywords]
                    )
                except Exception:
                    has_user_text = False
                if not has_user_text:
                    print("‚ùå Kh√¥ng ƒë·∫°t text nh·∫≠p -> skip b√†i")

                    # ƒê√°nh d·∫•u ƒë√£ x·ª≠ l√Ω + ƒë·∫©y ra kh·ªèi view
                    self.mark_post_as_processed(post_handle)
                    try:
                        viewport = self.page.viewport_size
                        height = viewport['height'] if viewport else 800
                        self.page.mouse.wheel(0, height * 0.4)
                    except Exception as e:
                        error_msg = str(e).lower()
                        if any(keyword in error_msg for keyword in ["closed", "disconnected", "target page", "context or browser"]):
                            raise RuntimeError("BROWSER_CLOSED") from e
                        pass
                    return False

            # 3. Like
            self.like_current_post(post_handle)
            self.control_checkpoint("after_like")

            # 4. Share ƒë·ªÉ b·∫Øt ID
            ok = self.share_center_ad(post_handle, post_type)
            self.control_checkpoint("after_share")
            if not ok:
                self.mark_post_as_processed(post_handle)
                print("‚ö†Ô∏è Kh√¥ng b·∫Øt ƒë∆∞·ª£c ID -> skip")
                return False
            # 5. L∆∞u ID + flag

            # 6. Mark processed
            self.mark_post_as_processed(post_handle)
            

            return True

        except Exception as e:
            if isinstance(e, RuntimeError) and ("EMERGENCY_STOP" in str(e) or "BROWSER_CLOSED" in str(e)):
                raise
            print(f"‚ùå L·ªói process_post: {e}")
            return False

    def check_post_is_processed(self, post_handle):
        """Ki·ªÉm tra attribute data-bot-processed ƒë·ªÉ tr√°nh qu√©t l·∫°i"""
        try:
            return post_handle.evaluate("(post) => post.getAttribute('data-bot-processed') === 'true'")
        except:
            return False
    
    def bring_element_into_view_smooth(self, element):
        """
        Ki·ªÉm tra element (n√∫t Share) c√≥ trong m√†n h√¨nh kh√¥ng.
        N·∫øu kh√¥ng, cu·ªôn chu·ªôt nh·∫π nh√†ng t·ªõi n√≥ (Kh√¥ng d√πng scroll_into_view g√¢y gi·∫≠t).
        """
        try:
            box = element.bounding_box()
            if not box: return False # Element ch∆∞a render

            viewport = self.page.viewport_size
            vh = None
            try:
                if viewport and isinstance(viewport, dict):
                    vh = viewport.get('height')
            except Exception:
                vh = None

            # Fallback: ƒë√¥i khi connect qua CDP => viewport_size = None
            if not vh:
                try:
                    vh = self.page.evaluate("() => window.innerHeight") or 800
                except Exception:
                    vh = 800
            
            # T·ªça ƒë·ªô Y c·ªßa element so v·ªõi ƒë·ªânh m√†n h√¨nh hi·ªán t·∫°i
            element_y = box['y']
            element_height = box['height']

            # Ki·ªÉm tra: N√∫t c√≥ n·∫±m l·ªçt th·ªèm trong m√†n h√¨nh kh√¥ng?
            # (Cho ph√©p l·ªÅ tr√™n 100px, l·ªÅ d∆∞·ªõi 100px ƒë·ªÉ ch·∫Øc ch·∫Øn click ƒë∆∞·ª£c)
            is_in_view = (element_y > 100) and (element_y + element_height < vh - 100)

            if is_in_view:
                return True # ƒêang ƒë·∫πp r·ªìi, kh√¥ng c·∫ßn cu·ªôn

            # N·∫øu n√∫t n·∫±m d∆∞·ªõi ƒë√°y m√†n h√¨nh -> C·∫ßn cu·ªôn xu·ªëng
            if element_y > vh - 100:
                # T√≠nh kho·∫£ng c√°ch c·∫ßn cu·ªôn: ƒê∆∞a n√∫t l√™n v·ªã tr√≠ kho·∫£ng 70% m√†n h√¨nh
                scroll_distance = element_y - (vh * 0.7)
                print(f"    -> üîΩ N√∫t Share b·ªã che, cu·ªôn xu·ªëng {int(scroll_distance)}px")
                
                # Cu·ªôn m∆∞·ª£t
                self.page.mouse.wheel(0, scroll_distance)
                time.sleep(0.5) # Ch·ªù render l·∫°i
                return True
            
            return True
        except Exception as e:
            # Log nh·∫π ƒë·ªÉ kh√¥ng spam, l·ªói th∆∞·ªùng do viewport null / element detach
            print(f"‚ö†Ô∏è L·ªói t√≠nh to√°n cu·ªôn: {e}")
            return False

    def scroll_past_post(self, post_handle):
        """
        Cu·ªôn qua b√†i vi·∫øt hi·ªán t·∫°i m·ªôt c√°ch th√¥ng minh.
        - B√†i ng·∫Øn: Cu·ªôn √≠t.
        - B√†i d√†i: Cu·ªôn nhi·ªÅu.
        -> Tr√°nh vi·ªác d√πng PageDown b·ªã tr√¥i b√†i.
        """
        try:
            box = post_handle.bounding_box()
            if not box:
                # Fallback n·∫øu kh√¥ng l·∫•y ƒë∆∞·ª£c k√≠ch th∆∞·ªõc -> D√πng PageDown
                self.page.keyboard.press("PageDown")
                return

            post_height = box['height']
            post_y = box['y']
            
            # Chi·∫øn thu·∫≠t: Cu·ªôn sao cho ƒê√ÅY b√†i vi·∫øt hi·ªán t·∫°i tr√¥i l√™n m√©p tr√™n m√†n h√¨nh
            # C·ªông th√™m 50px padding ƒë·ªÉ t√°ch bi·ªát b√†i sau
            scroll_distance = post_y + post_height + 50
            
            # N·∫øu kho·∫£ng c√°ch qu√° l·ªõn (b√†i si√™u d√†i), chia nh·ªè ra cu·ªôn cho ƒë·ª° s·ªëc
            if scroll_distance > 2000:
                steps = 3
                step_dist = scroll_distance / steps
                for _ in range(steps):
                    self.page.mouse.wheel(0, step_dist)
                    time.sleep(0.1)
            else:
                self.page.mouse.wheel(0, scroll_distance)
                
            print(f"    -> üìâ ƒê√£ cu·ªôn qua b√†i (height={int(post_height)}px)")
            time.sleep(1) # Ch·ªù b√†i m·ªõi load

        except Exception as e:
            print(f"‚ö†Ô∏è L·ªói scroll_past_post: {e}")
            self.page.keyboard.press("PageDown")
--- END FILE: backend\core\browser.py ---

--- START FILE: backend\core\control.py ---
import json
import threading
import time
from dataclasses import dataclass
from datetime import datetime, timezone
from pathlib import Path
from typing import Any, Dict, Optional, Tuple


BASE_DIR = Path(__file__).resolve().parents[1]  # backend/
CONTROL_STATE_PATH = BASE_DIR / "data" / "runtime_control.json"

_lock = threading.Lock()


def _now_iso() -> str:
    return datetime.now(timezone.utc).isoformat()


def _atomic_write_json(path: Path, data: Dict[str, Any]) -> None:
    path.parent.mkdir(parents=True, exist_ok=True)
    tmp = path.with_suffix(".tmp")
    with tmp.open("w", encoding="utf-8") as f:
        json.dump(data, f, ensure_ascii=False, indent=2)
        f.write("\n")
    tmp.replace(path)


def _default_state() -> Dict[str, Any]:
    return {
        "global_emergency_stop": False,
        "global_pause": False,
        "paused_profiles": [],
        "stopped_profiles": [],  # STOP theo profile (d·ª´ng ngay profile ƒë√≥)
        "profile_states": {},  # {profile_id: RUNNING|PAUSED|STOPPED|ERROR}
        "updated_at": _now_iso(),
    }


def load_state() -> Dict[str, Any]:
    """
    ƒê·ªçc state t·ª´ file runtime_control.json.
    Best-effort: n·∫øu file l·ªói/kh√¥ng t·ªìn t·∫°i -> tr·∫£ default.
    """
    try:
        if not CONTROL_STATE_PATH.exists():
            return _default_state()
        with CONTROL_STATE_PATH.open("r", encoding="utf-8") as f:
            raw = json.load(f)
        if not isinstance(raw, dict):
            return _default_state()
        # Merge default keys ƒë·ªÉ tr√°nh thi·∫øu field
        base = _default_state()
        base.update(raw)
        # normalize
        if not isinstance(base.get("paused_profiles"), list):
            base["paused_profiles"] = []
        if not isinstance(base.get("stopped_profiles"), list):
            base["stopped_profiles"] = []
        if not isinstance(base.get("profile_states"), dict):
            base["profile_states"] = {}
        base["updated_at"] = _now_iso()
        return base
    except Exception:
        return _default_state()


def save_state(state: Dict[str, Any]) -> None:
    state = dict(state or {})
    state.setdefault("paused_profiles", [])
    state.setdefault("stopped_profiles", [])
    state.setdefault("profile_states", {})
    state["updated_at"] = _now_iso()
    _atomic_write_json(CONTROL_STATE_PATH, state)


def get_state() -> Dict[str, Any]:
    with _lock:
        return load_state()


def _update(mutator) -> Dict[str, Any]:
    with _lock:
        st = load_state()
        mutator(st)
        save_state(st)
        return st


def reset_all_state() -> Dict[str, Any]:
    """
    Reset to√†n b·ªô runtime state v·ªÅ m·∫∑c ƒë·ªãnh (S·∫¥N S√ÄNG).
    D√πng cho STOP ki·ªÉu "fresh start".
    """
    def _m(st: Dict[str, Any]) -> None:
        st.clear()
        st.update(_default_state())
    return _update(_m)


def set_global_emergency_stop(value: bool) -> Dict[str, Any]:
    def _m(st: Dict[str, Any]) -> None:
        st["global_emergency_stop"] = bool(value)
        if value:
            # Khi STOP ALL: clear pause + ƒë∆∞a t·∫•t c·∫£ profile_states v·ªÅ STOPPED ƒë·ªÉ tr√°nh "RUNNING" r√°c
            st["global_pause"] = False
            st["paused_profiles"] = []
            ps = st.get("profile_states")
            if not isinstance(ps, dict):
                ps = {}
            for k in list(ps.keys()):
                ps[k] = "STOPPED"
            st["profile_states"] = ps

    return _update(_m)


def set_global_pause(value: bool) -> Dict[str, Any]:
    def _m(st: Dict[str, Any]) -> None:
        st["global_pause"] = bool(value)

    return _update(_m)


def reset_emergency_stop(*, clear_stopped_profiles: bool = False) -> Dict[str, Any]:
    """
    Reset GLOBAL_EMERGENCY_STOP v·ªÅ false ƒë·ªÉ h·ªá th·ªëng ch·∫°y l·∫°i ƒë∆∞·ª£c.
    Optionally clear stopped_profiles (ƒë·ªÉ profile kh√¥ng b·ªã gi·ªØ STOPPED).
    """
    def _m(st: Dict[str, Any]) -> None:
        st["global_emergency_stop"] = False
        if clear_stopped_profiles:
            st["stopped_profiles"] = []
            # kh√¥ng force ƒë·ªïi profile_states n·∫øu caller mu·ªën gi·ªØ audit;
            # nh∆∞ng n·∫øu ƒëang STOPPED m√† clear_stopped_profiles th√¨ set RUNNING ƒë·ªÉ d·ªÖ hi·ªÉu.
            ps = st.get("profile_states")
            if isinstance(ps, dict):
                for k in list(ps.keys()):
                    if str(ps.get(k) or "").upper() == "STOPPED":
                        ps[k] = "RUNNING"

    return _update(_m)


def pause_profile(profile_id: str) -> Dict[str, Any]:
    pid = str(profile_id or "").strip()
    if not pid:
        return get_state()

    def _m(st: Dict[str, Any]) -> None:
        paused = set([str(x).strip() for x in (st.get("paused_profiles") or []) if str(x).strip()])
        paused.add(pid)
        st["paused_profiles"] = sorted(paused)
        # pause kh√¥ng t·ª± clear STOP; n·∫øu ƒëang STOP th√¨ v·∫´n STOP
        # state ch·ªâ l√† "ƒë·ªãnh danh", process th·∫≠t s·ª± s·∫Ω t·ª± update theo loop
        st.setdefault("profile_states", {})
        st["profile_states"][pid] = "PAUSED"

    return _update(_m)


def resume_profile(profile_id: str) -> Dict[str, Any]:
    pid = str(profile_id or "").strip()
    if not pid:
        return get_state()

    def _m(st: Dict[str, Any]) -> None:
        paused = [str(x).strip() for x in (st.get("paused_profiles") or []) if str(x).strip()]
        paused = [x for x in paused if x != pid]
        st["paused_profiles"] = paused
        # resume s·∫Ω clear STOP theo profile (ƒë·ªÉ ch·∫°y l·∫°i ƒë∆∞·ª£c)
        stopped = [str(x).strip() for x in (st.get("stopped_profiles") or []) if str(x).strip()]
        stopped = [x for x in stopped if x != pid]
        st["stopped_profiles"] = stopped
        st.setdefault("profile_states", {})
        st["profile_states"][pid] = "RUNNING"

    return _update(_m)


def stop_profiles(profile_ids: list[str]) -> Dict[str, Any]:
    """
    STOP theo profile: add v√†o stopped_profiles + set state STOPPED.
    """
    ids = []
    for x in (profile_ids or []):
        s = str(x or "").strip()
        if s:
            ids.append(s)

    if not ids:
        return get_state()

    def _m(st: Dict[str, Any]) -> None:
        stopped = set([str(x).strip() for x in (st.get("stopped_profiles") or []) if str(x).strip()])
        for pid in ids:
            stopped.add(pid)
        st["stopped_profiles"] = sorted(stopped)
        # remove kh·ªèi paused ƒë·ªÉ tr√°nh state m√¢u thu·∫´n
        paused = [str(x).strip() for x in (st.get("paused_profiles") or []) if str(x).strip()]
        paused = [p for p in paused if p not in stopped]
        st["paused_profiles"] = paused
        st.setdefault("profile_states", {})
        for pid in ids:
            st["profile_states"][pid] = "STOPPED"

    return _update(_m)


def pause_profiles(profile_ids: list[str]) -> Dict[str, Any]:
    ids = []
    for x in (profile_ids or []):
        s = str(x or "").strip()
        if s:
            ids.append(s)
    if not ids:
        return get_state()

    def _m(st: Dict[str, Any]) -> None:
        paused = set([str(x).strip() for x in (st.get("paused_profiles") or []) if str(x).strip()])
        for pid in ids:
            paused.add(pid)
        st["paused_profiles"] = sorted(paused)
        st.setdefault("profile_states", {})
        for pid in ids:
            # n·∫øu profile ƒëang STOPPED th√¨ gi·ªØ STOPPED
            cur = str(st["profile_states"].get(pid) or "").upper()
            if cur != "STOPPED":
                st["profile_states"][pid] = "PAUSED"

    return _update(_m)


def resume_profiles(profile_ids: list[str]) -> Dict[str, Any]:
    ids = []
    for x in (profile_ids or []):
        s = str(x or "").strip()
        if s:
            ids.append(s)
    if not ids:
        return get_state()

    def _m(st: Dict[str, Any]) -> None:
        paused = [str(x).strip() for x in (st.get("paused_profiles") or []) if str(x).strip()]
        paused = [p for p in paused if p not in set(ids)]
        st["paused_profiles"] = paused
        # resume c≈©ng clear STOP theo profile (ƒë·ªÉ profile ch·∫°y l·∫°i ƒë∆∞·ª£c)
        stopped = [str(x).strip() for x in (st.get("stopped_profiles") or []) if str(x).strip()]
        stopped = [p for p in stopped if p not in set(ids)]
        st["stopped_profiles"] = stopped
        st.setdefault("profile_states", {})
        for pid in ids:
            st["profile_states"][pid] = "RUNNING"

    return _update(_m)


def set_profile_state(profile_id: str, state: str) -> Dict[str, Any]:
    pid = str(profile_id or "").strip()
    if not pid:
        return get_state()
    s = str(state or "").strip().upper()
    if s not in {"RUNNING", "PAUSED", "STOPPED", "ERROR"}:
        s = "ERROR"

    def _m(st: Dict[str, Any]) -> None:
        st.setdefault("profile_states", {})
        st["profile_states"][pid] = s

    return _update(_m)


def check_flags(profile_id: Optional[str] = None) -> Tuple[bool, bool, str]:
    """
    Return: (emergency_stop, paused, pause_reason)
    Priority:
      1) emergency_stop
      2) global_pause
      3) paused_profiles[pid]
    """
    st = get_state()
    if bool(st.get("global_emergency_stop")):
        return True, False, "GLOBAL_EMERGENCY_STOP"

    pid = str(profile_id or "").strip()

    # STOP theo profile (∆∞u ti√™n h∆°n pause)
    stopped_set = set([str(x).strip() for x in (st.get("stopped_profiles") or []) if str(x).strip()])
    if pid and pid in stopped_set:
        return True, False, "STOPPED_PROFILE"

    if bool(st.get("global_pause")):
        return False, True, "GLOBAL_PAUSE"

    paused_set = set([str(x).strip() for x in (st.get("paused_profiles") or []) if str(x).strip()])
    if pid and pid in paused_set:
        return False, True, "PAUSED_PROFILE"

    return False, False, ""


def wait_if_paused(profile_id: Optional[str], sleep_seconds: float = 0.5) -> None:
    """
    N·∫øu PAUSE -> sleep + check flag li√™n t·ª•c.
    N·∫øu emergency_stop -> raise RuntimeError ƒë·ªÉ caller tho√°t ngay.
    """
    pid = str(profile_id or "").strip()
    while True:
        stop, paused, _reason = check_flags(pid)
        if stop:
            raise RuntimeError("EMERGENCY_STOP")
        if not paused:
            return
        time.sleep(max(0.2, float(sleep_seconds)))



--- END FILE: backend\core\control.py ---

--- START FILE: backend\core\join_groups.py ---
import sys
import os
import json
import time
import random
import re
from pathlib import Path

# --- SETUP ƒê∆Ø·ªúNG D·∫™N ƒê·ªÇ IMPORT CORE ---
current_dir = os.path.dirname(os.path.abspath(__file__))
parent_dir = os.path.dirname(current_dir)
sys.path.append(parent_dir)

from core.nst import connect_profile
from core.nst import stop_profile
from core.browser import FBController
from core import control as control_state

# Worker l·∫•y page_id/post_id t·ª´ URL (d√πng cookie theo profile_id trong settings.json)
try:
    from worker.get_id import get_id_from_url
except Exception:
    try:
        from get_id import get_id_from_url
    except Exception:
        get_id_from_url = None

# L∆∞u mapping group -> page_id theo profile_id
GROUPS_JSON_PATH = Path(parent_dir) / "config" / "groups.json"
GROUPS_LOCK_PATH = Path(str(GROUPS_JSON_PATH) + ".lock")


def _normalize_group_url(raw: str) -> str:
    s = str(raw or "").strip()
    if not s:
        return ""
    if re.match(r"^https?://", s, flags=re.IGNORECASE):
        return s
    if s.lower().startswith("facebook.com/") or s.lower().startswith("www.facebook.com/"):
        return "https://" + s
    if "/groups/" in s:
        if s.startswith("/"):
            return "https://www.facebook.com" + s
        return "https://www.facebook.com/" + s.lstrip("/")
    return f"https://www.facebook.com/groups/{s}"


def _acquire_groups_lock(timeout_seconds: float = 60.0, poll: float = 0.1):
    """
    Lock file ƒë∆°n gi·∫£n (cross-platform): t·∫°o file .lock b·∫±ng O_EXCL ƒë·ªÉ ch·ªëng ghi ƒë√® khi nhi·ªÅu process c√πng ghi.
    """
    start = time.time()
    while True:
        try:
            fd = os.open(str(GROUPS_LOCK_PATH), os.O_CREAT | os.O_EXCL | os.O_RDWR)
            return fd
        except FileExistsError:
            # timeout_seconds <= 0 => ch·ªù v√¥ h·∫°n
            if timeout_seconds and timeout_seconds > 0 and (time.time() - start >= timeout_seconds):
                return None
            time.sleep(poll)
        except Exception:
            return None


def _release_groups_lock(fd) -> None:
    try:
        if fd is not None:
            try:
                os.close(fd)
            except Exception:
                pass
        try:
            if GROUPS_LOCK_PATH.exists():
                GROUPS_LOCK_PATH.unlink()
        except Exception:
            pass
    except Exception:
        pass


def _read_groups_json() -> dict:
    try:
        if not GROUPS_JSON_PATH.exists():
            return {}
        raw = GROUPS_JSON_PATH.read_text(encoding="utf-8").strip()
        if not raw:
            return {}
        data = json.loads(raw)
        return data if isinstance(data, dict) else {}
    except Exception:
        return {}


def _write_groups_json(data: dict) -> None:
    GROUPS_JSON_PATH.parent.mkdir(parents=True, exist_ok=True)
    tmp = Path(str(GROUPS_JSON_PATH) + ".tmp")
    tmp.write_text(json.dumps(data, indent=2, ensure_ascii=False) + "\n", encoding="utf-8")
    os.replace(str(tmp), str(GROUPS_JSON_PATH))


def save_group_page_id(profile_id: str, page_id: str, url_page: str) -> bool:
    """
    L∆∞u v√†o backend/config/groups.json theo format:
    {
      "<profile_id>": [
        {"page_id": "...", "url_page": "..."}
      ]
    }
    """
    pid = str(profile_id or "").strip()
    pg = str(page_id or "").strip()
    urlp = str(url_page or "").strip()
    if not pid or not pg or not urlp:
        return False

    fd = _acquire_groups_lock()
    if fd is None:
        # Kh√¥ng c√≥ lock => kh√¥ng ghi ƒë·ªÉ tr√°nh race condition khi ch·∫°y ƒëa process
        print(f"‚ö†Ô∏è [groups.json] Kh√¥ng l·∫•y ƒë∆∞·ª£c lock trong th·ªùi gian ch·ªù -> b·ªè qua ghi (profile_id={pid})")
        return False
    try:
        data = _read_groups_json()
        arr = data.get(pid)
        if not isinstance(arr, list):
            arr = []

        # ch·ªëng tr√πng theo page_id
        updated = False
        for item in arr:
            if isinstance(item, dict) and str(item.get("page_id") or "").strip() == pg:
                item["url_page"] = urlp
                updated = True
                break

        if not updated:
            arr.append({"page_id": pg, "url_page": urlp})

        data[pid] = arr
        _write_groups_json(data)
        return True
    finally:
        _release_groups_lock(fd)

class GroupJoiner(FBController):
    """
    Class chuy√™n d·ª•ng ƒë·ªÉ ƒëi xin v√†o nh√≥m
    """
    def join_group(self, group_id):
        # STOP/PAUSE checkpoint
        try:
            self.control_checkpoint("join_group_start")
        except RuntimeError:
            raise
        raw = str(group_id or "").strip()
        if not raw:
            print("‚ö†Ô∏è group r·ªóng, b·ªè qua")
            return False

        url = _normalize_group_url(raw)
        print(f"\nüöÄ ƒêang truy c·∫≠p nh√≥m: {group_id}")
        print(f"üîó Link: {url}")
        
        try:
            self.control_checkpoint("before_goto_group")
            self.goto(url)
            time.sleep(random.uniform(3, 5)) # Ch·ªù load trang

            # 1. Ki·ªÉm tra xem ƒë√£ tham gia ch∆∞a
            is_joined = self.page.query_selector('div[aria-label="ƒê√£ tham gia"], div[aria-label="M·ªùi"]')
            if is_joined:
                print(f"‚úÖ [SKIP] ƒê√£ l√† th√†nh vi√™n c·ªßa nh√≥m {group_id}")
                # coi nh∆∞ "th√†nh c√¥ng" ƒë·ªÉ v·∫´n l·∫•y page_id v√† l∆∞u groups.json
                return True

            # 2. T√¨m n√∫t "Tham gia nh√≥m"
            join_btn_selector = 'div[aria-label="Tham gia nh√≥m"][role="button"]'
            join_btn = self.page.query_selector(join_btn_selector)

            if not join_btn:
                join_btn = self.page.get_by_text("Tham gia nh√≥m", exact=True).first
            
            if join_btn:
                print("point üëâ T√¨m th·∫•y n√∫t 'Tham gia nh√≥m'. ƒêang click...")
                self.control_checkpoint("before_click_join_group")
                join_btn.click()
                
                # ======================================================
                # [M·ªöI] ·∫§N ESC 2 L·∫¶N ƒê·ªÇ T·∫ÆT POPUP C√ÇU H·ªéI / N·ªòI QUY
                # ======================================================
                # Thay sleep c·ª©ng b·∫±ng auto-wait popup/dialog
                # ======================================================
                try:
                    # Ch·ªù popup dialog (n·∫øu c√≥) r·ªìi ƒë√≥ng
                    self.page.wait_for_selector('div[role="dialog"]', timeout=3000)
                    self.page.keyboard.press("Escape")
                except:
                    pass
                
                try:
                    # Ch·ªù UI c·∫≠p nh·∫≠t sau khi ƒë√≥ng popup (kh√¥ng sleep c·ª©ng)
                    self.page.wait_for_timeout(800)
                except:
                    pass
                
                # 3. Ki·ªÉm tra l·∫°i tr·∫°ng th√°i
                # N·∫øu n√∫t chuy·ªÉn th√†nh "H·ªßy y√™u c·∫ßu" ho·∫∑c "ƒê√£ tham gia" -> Th√†nh c√¥ng
                check_success = None
                try:
                    # ch·ªù UI c·∫≠p nh·∫≠t t·ªëi ƒëa 6s (ƒë·ª° sai do load ch·∫≠m)
                    self.page.wait_for_selector('div[aria-label="H·ªßy y√™u c·∫ßu"], div[aria-label="ƒê√£ tham gia"]', timeout=6000)
                    check_success = self.page.query_selector('div[aria-label="H·ªßy y√™u c·∫ßu"], div[aria-label="ƒê√£ tham gia"]')
                except Exception:
                    check_success = self.page.query_selector('div[aria-label="H·ªßy y√™u c·∫ßu"], div[aria-label="ƒê√£ tham gia"]')

                if check_success:
                    print(f"‚úÖ ƒê√£ g·ª≠i y√™u c·∫ßu tham gia / ƒë√£ tham gia: {group_id}")
                    return True

                # N·∫øu v·∫´n ch∆∞a th·∫•y ƒë·ªïi tr·∫°ng th√°i -> coi l√† ch∆∞a join th√†nh c√¥ng (th∆∞·ªùng do c√¢u h·ªèi b·∫Øt bu·ªôc)
                print(f"‚ö†Ô∏è Click join nh∆∞ng ch∆∞a th·∫•y ƒë·ªïi tr·∫°ng th√°i (c√≥ th·ªÉ c·∫ßn tr·∫£ l·ªùi c√¢u h·ªèi): {group_id}")
                return False
            else:
                print(f"‚ùå Kh√¥ng t√¨m th·∫•y n√∫t tham gia (C√≥ th·ªÉ nh√≥m k√≠n, b·ªã ch·∫∑n, ho·∫∑c layout kh√°c).")
                return False

        except Exception as e:
            if isinstance(e, RuntimeError) and ("EMERGENCY_STOP" in str(e) or "BROWSER_CLOSED" in str(e)):
                raise
            print(f"‚ùå L·ªói khi x·ª≠ l√Ω nh√≥m {group_id}: {e}")
            return False

def run_batch_join_from_list(profile_id, group_ids):
    """
    Ch·∫°y join group cho 1 profile v·ªõi danh s√°ch group truy·ªÅn tr·ª±c ti·∫øp (list).
    D√πng cho API (ƒëa lu·ªìng/ƒëa process).
    """
    try:
        items = list(group_ids or [])
    except Exception:
        items = []

    # Clean
    cleaned = []
    for gid in items:
        s = str(gid or "").strip()
        if s:
            cleaned.append(s)

    if not cleaned:
        print("‚ö†Ô∏è Danh s√°ch group r·ªóng.")
        return

    print(f"üìã T√¨m th·∫•y {len(cleaned)} nh√≥m c·∫ßn tham gia.")

    # 2. K·∫øt n·ªëi Profile
    try:
        # STOP/PAUSE checkpoint tr∆∞·ªõc connect
        stop, paused, reason = control_state.check_flags(profile_id)
        if stop:
            print(f"üõë [JOIN] EMERGENCY_STOP tr∆∞·ªõc khi connect ({reason})")
            return
        if paused:
            print(f"‚è∏Ô∏è [JOIN] PAUSED tr∆∞·ªõc khi connect ({reason})")
            control_state.wait_if_paused(profile_id, sleep_seconds=0.5)

        print(f"üîå ƒêang k·∫øt n·ªëi profile {profile_id}...")
        ws_url = connect_profile(profile_id)
        fb = GroupJoiner(ws_url)
        fb.profile_id = profile_id
        fb.connect()
        
        # 3. Ch·∫°y v√≤ng l·∫∑p
        for idx, gid in enumerate(cleaned):
            # STOP/PAUSE checkpoint tr∆∞·ªõc m·ªói group
            stop, paused, reason = control_state.check_flags(profile_id)
            if stop:
                print(f"üõë [JOIN] {profile_id} EMERGENCY_STOP ({reason}) -> d·ª´ng")
                break
            if paused:
                print(f"‚è∏Ô∏è [JOIN] {profile_id} PAUSED ({reason}) -> sleep")
                control_state.wait_if_paused(profile_id, sleep_seconds=0.5)

            # 3a) Join group (ho·∫∑c skip n·∫øu ƒë√£ join)
            url = _normalize_group_url(gid)
            joined_ok = False
            try:
                joined_ok = bool(fb.join_group(url))
            except Exception as e:
                if isinstance(e, RuntimeError) and ("EMERGENCY_STOP" in str(e) or "BROWSER_CLOSED" in str(e)):
                    raise
                print(f"‚ö†Ô∏è L·ªói join_group: {e}")
                joined_ok = False

            # 3b) Ch·ªâ khi join th√†nh c√¥ng/ƒë√£ l√† member -> l·∫•y page_id v√† l∆∞u groups.json
            if joined_ok and get_id_from_url and url:
                try:
                    fb.control_checkpoint("before_get_id_from_url_group")
                    res = get_id_from_url(url, profile_id)
                    if isinstance(res, dict) and res.get("url_type") == "group":
                        page_id = str(res.get("page_id") or "").strip()
                        if page_id:
                            ok = save_group_page_id(profile_id, page_id, url)
                            if ok:
                                print(f"üíæ ƒê√£ l∆∞u group: profile_id={profile_id} page_id={page_id}")
                            else:
                                print(f"‚ö†Ô∏è Kh√¥ng l∆∞u ƒë∆∞·ª£c groups.json (profile_id={profile_id}, page_id={page_id})")
                except Exception as e:
                    if isinstance(e, RuntimeError) and ("EMERGENCY_STOP" in str(e) or "BROWSER_CLOSED" in str(e)):
                        raise
                    print(f"‚ö†Ô∏è L·ªói get_id_from_url khi join group: {e}")
            
            # Ngh·ªâ ng·∫´u nhi√™n (tr·ª´ khi l√† group cu·ªëi)
            if idx < len(cleaned) - 1:
                sleep_time = random.uniform(10, 20) 
                print(f"üí§ Ngh·ªâ {sleep_time:.1f}s tr∆∞·ªõc khi qua nh√≥m ti·∫øp theo...")
                # sleep theo chunk ƒë·ªÉ v·∫´n stop/pause ƒë∆∞·ª£c ngay
                slept = 0.0
                while slept < sleep_time:
                    stop, paused, reason = control_state.check_flags(profile_id)
                    if stop:
                        print(f"üõë [JOIN] {profile_id} EMERGENCY_STOP trong sleep ({reason}) -> d·ª´ng")
                        raise RuntimeError("EMERGENCY_STOP")
                    if paused:
                        control_state.wait_if_paused(profile_id, sleep_seconds=0.5)
                    time.sleep(0.5)
                    slept += 0.5
            
    except Exception as e:
        print(f"‚ùå L·ªói k·∫øt n·ªëi/browser: {e}")
    finally:
        print("üèÅ Ho√†n t·∫•t danh s√°ch.")
        # ƒê√≥ng s·∫°ch tab/context playwright + stop NST profile (best-effort)
        try:
            if 'fb' in locals() and fb:
                try:
                    if getattr(fb, "page", None):
                        try:
                            fb.page.close()
                        except Exception:
                            pass
                except Exception:
                    pass
                try:
                    if getattr(fb, "browser", None) and getattr(fb.browser, "contexts", None):
                        for ctx in list(fb.browser.contexts):
                            try:
                                ctx.close()
                            except Exception:
                                pass
                except Exception:
                    pass
                try:
                    if getattr(fb, "browser", None):
                        try:
                            fb.browser.close()
                        except Exception:
                            pass
                except Exception:
                    pass
                try:
                    if getattr(fb, "play", None):
                        try:
                            fb.play.stop()
                        except Exception:
                            pass
                except Exception:
                    pass
        finally:
            try:
                stop_profile(profile_id)
            except Exception:
                pass

def run_batch_join(profile_id, json_file_path):
    # 1. ƒê·ªçc file JSON
    try:
        with open(json_file_path, "r", encoding="utf-8") as f:
            group_ids = json.load(f)
        
        if not group_ids:
            print("‚ö†Ô∏è File JSON r·ªóng.")
            return
            
        print(f"üìã T√¨m th·∫•y {len(group_ids)} nh√≥m c·∫ßn tham gia.")
        
    except Exception as e:
        print(f"‚ùå L·ªói ƒë·ªçc file JSON: {e}")
        return

    run_batch_join_from_list(profile_id, group_ids)

if __name__ == "__main__":
    # --- C·∫§U H√åNH ---
    MY_PROFILE_ID = "621e1f5d-0c42-481e-9ddd-7abaafce68ed" 
    JSON_PATH = os.path.join(parent_dir, "data", "groups.json")
    
    run_batch_join(MY_PROFILE_ID, JSON_PATH)
--- END FILE: backend\core\join_groups.py ---

--- START FILE: backend\core\nst.py ---
import requests
import json
import urllib.parse  # C·∫ßn c√°i n√†y ƒë·ªÉ m√£ h√≥a User-Agent c√≥ d·∫•u c√°ch
from typing import Optional, Any

from core.settings import reload_settings

def _get_runtime_settings():
    """
    NST API key/headless c√≥ th·ªÉ ƒë·ªïi trong l√∫c backend ƒëang ch·∫°y.
    V√¨ get_settings() c√≥ cache, d√πng reload_settings() ƒë·ªÉ l·∫•y gi√° tr·ªã m·ªõi nh·∫•t.
    """
    try:
        return reload_settings()
    except Exception:
        # fallback: v·∫´n c·ªë ƒë·ªçc cache n·∫øu reload l·ªói
        from core.settings import get_settings
        return get_settings()
NST_BASE_URLS = [
    "http://127.0.0.1:8848/api/v2",
    "http://127.0.0.1:8848/api/v1",
    "http://127.0.0.1:8848/api",
]


def _nst_request(method: str, path: str, timeout: int = 15, headers: Optional[dict] = None, data: Optional[Any] = None) -> Optional[Any]:
    """
    G·ªçi NST local API. Tr·∫£ v·ªÅ JSON n·∫øu parse ƒë∆∞·ª£c, None n·∫øu l·ªói.
    """
    for base in NST_BASE_URLS:
        url = f"{base}{path}"
        try:
            print(f"      üîó Th·ª≠: {method} {url}")
            if data is not None:
                print(f"         ‚Üí Body: {data}")
            resp = requests.request(method, url, timeout=timeout, headers=headers, json=data if data is not None else None)
            print(f"         ‚Üí Status: {resp.status_code}")
            try:
                json_data = resp.json()
                print(f"         ‚Üí Response: {json_data}")
                return json_data
            except Exception as json_err:
                text_data = {"status_code": resp.status_code, "text": resp.text[:200]}
                print(f"         ‚Üí Response (kh√¥ng ph·∫£i JSON): {text_data}")
                return text_data
        except Exception as req_err:
            print(f"         ‚ùå L·ªói request: {req_err}")
            continue
    print(f"      ‚ö†Ô∏è Kh√¥ng endpoint n√†o th√†nh c√¥ng cho {method} {path}")
    return None


def stop_profile(profile_id: str) -> bool:
    """
    D·ª´ng browser instance c·ªßa profile b·∫±ng DELETE /api/v2/browsers/{profile_id}
    """
    pid = str(profile_id or "").strip()
    if not pid:
        print(f"   ‚ö†Ô∏è [stop_profile] profile_id r·ªóng")
        return False

    print(f"   üîç [stop_profile] ƒêang d·ª´ng profile: {pid}")
    
    cfg = _get_runtime_settings()
    api_key = str(getattr(cfg, "api_key", "") or "").strip()
    hdr = {
        "x-api-key": api_key,
        "Content-Type": "application/json"
    } if api_key else {"Content-Type": "application/json"}
    
    # D√πng DELETE /browsers/{profile_id} (base URL ƒë√£ c√≥ /api/v2)
    path = f"/browsers/{pid}"
    
    print(f"   üìã API Key: {'C√≥' if api_key else 'Kh√¥ng c√≥'}")
    print(f"   üìã Endpoint: DELETE {path}")
    
    data = _nst_request("DELETE", path, headers=hdr)
    if not data:
        print(f"   ‚ùå [stop_profile] Kh√¥ng c√≥ response t·ª´ NST")
        return False
    
    # Ki·ªÉm tra k·∫øt qu·∫£
    if isinstance(data, dict):
        # Idempotent: n·∫øu browser instance kh√¥ng t·ªìn t·∫°i th√¨ coi nh∆∞ ƒë√£ d·ª´ng r·ªìi
        msg_lower = str(data.get("msg") or data.get("message") or "").lower()
        if data.get("code") == 400 and "browser instance not found" in msg_lower:
            print(f"   ‚úÖ [stop_profile] Browser ƒë√£ ƒë√≥ng s·∫µn / kh√¥ng t·ªìn t·∫°i (code=400). Coi nh∆∞ th√†nh c√¥ng.")
            return True

        if data.get("err") is False:
            print(f"   ‚úÖ [stop_profile] TH√ÄNH C√îNG! err=False")
            return True
        status_lower = str(data.get("status", "")).lower()
        if status_lower in {"ok", "success", "stopped", "closed"}:
            print(f"   ‚úÖ [stop_profile] TH√ÄNH C√îNG! status={status_lower}")
            return True
        if data.get("code") in (0, 200):
            print(f"   ‚úÖ [stop_profile] TH√ÄNH C√îNG! code={data.get('code')}")
            return True
        print(f"   ‚ö†Ô∏è [stop_profile] Kh√¥ng match ƒëi·ªÅu ki·ªán th√†nh c√¥ng (err={data.get('err')}, status={data.get('status')}, code={data.get('code')})")
    else:
        print(f"   ‚ö†Ô∏è [stop_profile] Response kh√¥ng ph·∫£i dict: {type(data)}")
    
    return False


def stop_all_browsers() -> bool:
    """
    ƒê√≥ng to√†n b·ªô browser NST b·∫±ng DELETE /api/v2/browsers v·ªõi body l√† array c√°c profile_id.
    """
    print("   üîç [stop_all_browsers] B·∫Øt ƒë·∫ßu ƒë√≥ng to√†n b·ªô NST browser...")
    
    cfg = _get_runtime_settings()
    api_key = str(getattr(cfg, "api_key", "") or "").strip()
    hdr = {
        "x-api-key": api_key,
        "Content-Type": "application/json"
    } if api_key else {"Content-Type": "application/json"}
    
    print(f"   üìã API Key: {'C√≥' if api_key else 'Kh√¥ng c√≥'}")
    
    # L·∫•y danh s√°ch profile_id t·ª´ settings
    try:
        from core.settings import get_settings
        settings = get_settings()
        profile_ids = []
        
        # L·∫•y t·ª´ PROFILE_IDS (c√≥ th·ªÉ l√† dict ho·∫∑c list)
        profile_data = getattr(settings, "profile_ids", None)
        if isinstance(profile_data, dict):
            profile_ids = list(profile_data.keys())
        elif isinstance(profile_data, list):
            profile_ids = profile_data
        elif isinstance(profile_data, str):
            profile_ids = [p.strip() for p in profile_data.split(",") if p.strip()]
        
        profile_ids = [str(pid).strip() for pid in profile_ids if str(pid).strip()]
        
        if not profile_ids:
            print(f"   ‚ö†Ô∏è [stop_all_browsers] Kh√¥ng t√¨m th·∫•y profile_id n√†o trong settings")
            # V·∫´n th·ª≠ g·ªçi v·ªõi array r·ªóng
            profile_ids = []
    except Exception as e:
        print(f"   ‚ö†Ô∏è [stop_all_browsers] L·ªói khi l·∫•y profile_ids: {e}")
        profile_ids = []
    
    print(f"   üìã S·ªë profile s·∫Ω ƒë√≥ng: {len(profile_ids)}")
    if profile_ids:
        print(f"   üìã Profile IDs: {profile_ids}")
    
    # D√πng DELETE /browsers v·ªõi body l√† JSON array c√°c profile_id (base URL ƒë√£ c√≥ /api/v2)
    path = "/browsers"
    payload = profile_ids  # requests s·∫Ω t·ª± ƒë·ªông convert list th√†nh JSON array
    
    print(f"   üìã Endpoint: DELETE {path}")
    print(f"   üìã Body: {payload}")
    
    data = _nst_request("DELETE", path, headers=hdr, data=payload)
    if not data:
        print(f"   ‚ùå [stop_all_browsers] Kh√¥ng c√≥ response t·ª´ NST")
        return False
    
    # Ki·ªÉm tra k·∫øt qu·∫£
    if isinstance(data, dict):
        # Idempotent: n·∫øu kh√¥ng c√≥ browser instance n√†o th√¨ coi nh∆∞ ƒë√£ ƒë√≥ng h·∫øt
        msg_lower = str(data.get("msg") or data.get("message") or "").lower()
        if data.get("code") == 400 and "browser instance not found" in msg_lower:
            print(f"   ‚úÖ [stop_all_browsers] Browser ƒë√£ ƒë√≥ng s·∫µn / kh√¥ng t·ªìn t·∫°i (code=400). Coi nh∆∞ th√†nh c√¥ng.")
            return True

        if data.get("err") is False:
            print(f"   ‚úÖ [stop_all_browsers] TH√ÄNH C√îNG! err=False")
            return True
        status_lower = str(data.get("status", "")).lower()
        if status_lower in {"ok", "success", "stopped", "closed"}:
            print(f"   ‚úÖ [stop_all_browsers] TH√ÄNH C√îNG! status={status_lower}")
            return True
        if data.get("code") in (0, 200):
            print(f"   ‚úÖ [stop_all_browsers] TH√ÄNH C√îNG! code={data.get('code')}")
            return True
        print(f"   ‚ö†Ô∏è [stop_all_browsers] Kh√¥ng match ƒëi·ªÅu ki·ªán th√†nh c√¥ng (err={data.get('err')}, status={data.get('status')}, code={data.get('code')})")
    else:
        print(f"   ‚ö†Ô∏è [stop_all_browsers] Response kh√¥ng ph·∫£i dict: {type(data)}")
    
    return False

def connect_profile(profile_id: str):
    cfg = _get_runtime_settings()
    api_key = str(getattr(cfg, "api_key", "") or "").strip()
    headless = bool(getattr(cfg, "headless", False))
    # C·∫•u h√¨nh chu·∫©n theo JS m·∫´u: D√πng fingerprint ƒë·ªÉ fake User-Agent
    # KH√îNG d√πng 'args' ƒë·ªÉ tr√°nh b·ªã hi·ªán UI
    config = {
        "headless": headless,
        "autoClose": True,
        "fingerprint": {
            # User-Agent x·ªãn ƒë·ªÉ qua m·∫∑t Facebook
            "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
            "hardwareConcurrency": 8,
            "deviceMemory": 8
        }
    }

    # M√£ h√≥a config th√†nh chu·ªói an to√†n cho URL (v√¨ User-Agent c√≥ d·∫•u c√°ch)
    encoded_config = urllib.parse.quote(json.dumps(config))

    # Connect v·∫´n ∆∞u ti√™n v2 v√¨ ƒëang d√πng ·ªïn ƒë·ªãnh
    url = f"http://127.0.0.1:8848/api/v2/connect/{profile_id}?x-api-key={api_key}&config={encoded_config}"

    print(f"üöÄ M·ªü profile {profile_id} (headless={headless})")

    # Th·ª≠ k·∫øt n·ªëi
    try:
        resp = requests.get(url, timeout=20)
        data = resp.json()

        if data.get("err"):
            # Tr·∫£ l·ªói r√µ h∆°n ƒë·ªÉ debug (profile kh√¥ng t·ªìn t·∫°i / api key sai / NST ch∆∞a s·∫µn s√†ng)
            # NST th∆∞·ªùng tr·∫£ key: {err: true, msg: "...", code: ...}
            msg = data.get("msg") or data.get("message") or data.get("error") or data.get("err")
            raise Exception(f"‚ùå NST Error: {msg} | raw={data}")

        ws = data["data"]["webSocketDebuggerUrl"]
        print(f"üîå WebSocket: {ws}")
        return ws
        
    except Exception as e:
        print(f"‚ùå L·ªói k·∫øt n·ªëi: {e}")
        raise e
--- END FILE: backend\core\nst.py ---

--- START FILE: backend\core\runner.py ---
import time  # [C·∫ßn th√™m th∆∞ vi·ªán n√†y ƒë·ªÉ ƒë·∫øm gi·ªù]
from multiprocessing import Process
from typing import Optional, Sequence
from urllib.parse import quote_plus

from core.browser import FBController
from core.nst import connect_profile
from core.scraper import SimpleBot
from core.settings import get_settings
from core.utils import clean_profile_list
from core import control as control_state


class AppRunner:
    def __init__(
        self,
        run_minutes: Optional[int] = None,
        rest_minutes: Optional[int] = None,
        profile_ids: Optional[Sequence[str]] = None,
        text: Optional[str] = None,
        mode: Optional[str] = None,
    ):
        cfg = get_settings()
        self.target_url = cfg.target_url
        # Cho ph√©p override danh s√°ch profile t·ª´ API (/run) ƒë·ªÉ kh√¥ng ch·∫°y h·∫øt.
        base_profiles = profile_ids if profile_ids is not None else cfg.profile_ids
        self.profiles = clean_profile_list(base_profiles)
        self.text = str(text or "").strip()
        self.mode = str(mode or "feed").strip().lower()
        if self.mode not in ("feed", "search"):
            self.mode = "feed"

        # N·∫øu l√† search => target_url s·∫Ω l√† trang search posts.
        # V·∫´n d√πng core/browser.py ƒë·ªÉ scan/like/share/b·∫Øt id.
        if self.mode == "search" and self.text:
            q = quote_plus(self.text)
            self.target_url = f"https://www.facebook.com/search/posts/?q={q}"

        # ∆Øu ti√™n gi√° tr·ªã truy·ªÅn t·ª´ API; fallback c·∫•u h√¨nh; cu·ªëi c√πng l√† default.
        self.RUN_MINUTES = self._coerce_positive_int(
            run_minutes,
            cfg.run_minutes,
            default=30,
        )
        # REST_MINUTES m·∫∑c ƒë·ªãnh 120p (t∆∞∆°ng ƒë∆∞∆°ng 2h nh∆∞ c·∫•u h√¨nh c≈©)
        self.REST_MINUTES = self._coerce_positive_int(
            rest_minutes,
            cfg.rest_minutes,
            default=120,
        )

    @staticmethod
    def _coerce_positive_int(value, fallback=None, default=0):
        """
        Tr·∫£ v·ªÅ s·ªë nguy√™n d∆∞∆°ng; n·∫øu kh√¥ng h·ª£p l·ªá d√πng fallback, cu·ªëi c√πng d√πng default.
        """
        for candidate in (value, fallback, default):
            try:
                num = int(candidate)
                if num > 0:
                    return num
            except (TypeError, ValueError):
                continue
        return default

    def worker(self, profile_id):
        """H√†m x·ª≠ l√Ω cho t·ª´ng profile (Process con)"""
        # tr·∫°ng th√°i profile
        try:
            control_state.set_profile_state(profile_id, "RUNNING")
        except Exception:
            pass
        try:
            # STOP/PAUSE check tr∆∞·ªõc khi connect
            stop, paused, reason = control_state.check_flags(profile_id)
            if stop:
                print(f"üõë [{profile_id}] EMERGENCY_STOP tr∆∞·ªõc khi connect ({reason})")
                try:
                    control_state.set_profile_state(profile_id, "STOPPED")
                except Exception:
                    pass
                return
            if paused:
                print(f"‚è∏Ô∏è [{profile_id}] PAUSED tr∆∞·ªõc khi connect ({reason})")
                control_state.wait_if_paused(profile_id, sleep_seconds=0.5)

            # 1. K·∫øt n·ªëi NST
            ws = connect_profile(profile_id)

            # 2. Kh·ªüi t·∫°o tr√¨nh duy·ªát
            fb = FBController(ws)
            fb.profile_id = profile_id
            # ‚úÖ Ch·ªâ dispatch/get_id trong ph·∫°m vi c√°c profile ƒëang ch·∫°y (ƒë√£ ch·ªçn),
            # tr√°nh loop to√†n b·ªô PROFILE_IDS trong settings.json g√¢y log "thi·∫øu cookie".
            try:
                fb.all_profile_ids = list(self.profiles or [])
            except Exception:
                fb.all_profile_ids = [profile_id]
            # Filter th√™m theo text nh·∫≠p t·ª´ UI (n·∫øu c√≥)
            try:
                raw = self.text
                if raw:
                    # T√°ch theo d·∫•u ph·∫©y / xu·ªëng d√≤ng, gi·ªØ nguy√™n c·ª•m t·ª´ (VD "h√† n·ªôi")
                    parts = []
                    for chunk in raw.replace("\n", ",").split(","):
                        s = " ".join(str(chunk).strip().split())
                        if s:
                            parts.append(s)
                    # unique gi·ªØ th·ª© t·ª±
                    seen = set()
                    user_keywords = []
                    for x in parts:
                        k = x.lower()
                        if k in seen:
                            continue
                        seen.add(k)
                        user_keywords.append(x)
                    fb.user_keywords = user_keywords
                    if user_keywords:
                        print(f"üîé [{profile_id}] Scan filter text: {user_keywords}")
            except Exception:
                pass
            fb.connect()

            # 3. Ch·∫°y bot t∆∞∆°ng t√°c
            bot = SimpleBot(fb)
            
            # ƒê·ªïi th·ªùi gian ch·∫°y sang gi√¢y
            duration_seconds = self.RUN_MINUTES * 60
            
            # Bot s·∫Ω t·ª± tho√°t v√≤ng l·∫∑p sau khi ƒë·ªß th·ªùi gian
            bot.run(self.target_url, duration=duration_seconds) 

            print(f"‚úÖ [{profile_id}] ƒê√£ ch·∫°y ƒë·ªß {self.RUN_MINUTES} ph√∫t. ƒêang t·∫Øt tr√¨nh duy·ªát...")
            
            # [Quan tr·ªçng] ƒê√≥ng tr√¨nh duy·ªát s·∫°ch s·∫Ω ƒë·ªÉ gi·∫£i ph√≥ng RAM
            try:
                if fb.browser: fb.browser.close()
                if fb.play: fb.play.stop()
            except: pass
            
        except Exception as e:
            print(f"‚ùå L·ªói ·ªü profile {profile_id}: {e}")
            try:
                control_state.set_profile_state(profile_id, "ERROR")
            except Exception:
                pass
        finally:
            # n·∫øu ƒëang emergency stop th√¨ set STOPPED
            try:
                stop, _paused, _reason = control_state.check_flags(profile_id)
                if stop:
                    control_state.set_profile_state(profile_id, "STOPPED")
            except Exception:
                pass

    def run(self):
        """H√†m ƒëi·ªÅu ph·ªëi ch√≠nh (V√≤ng l·∫∑p vƒ©nh c·ª≠u)"""
        
        # ƒê·ªïi th·ªùi gian ngh·ªâ sang gi√¢y
        rest_seconds = self.REST_MINUTES * 60
        
        print(f"‚àû K√≠ch ho·∫°t ch·∫ø ƒë·ªô nu√¥i tu·∫ßn ho√†n: Ch·∫°y {self.RUN_MINUTES}p -> Ngh·ªâ {self.REST_MINUTES}p")

        while True:
            # STOP ALL: tho√°t ngay
            stop, _paused, _reason = control_state.check_flags(None)
            if stop:
                print("üõë [RUNNER] EMERGENCY_STOP -> tho√°t v√≤ng l·∫∑p AppRunner")
                break

            print("="*60)
            print(f"‚ñ∂Ô∏è [START] B·∫Øt ƒë·∫ßu phi√™n ch·∫°y m·ªõi l√∫c {time.strftime('%H:%M:%S')}")
            print("="*60)

            # 1. Kh·ªüi ch·∫°y d√†n profile
            processes = []
            for pid in self.profiles:
                # N·∫øu profile ƒë√£ b·ªã STOP theo profile_id th√¨ skip lu√¥n ƒë·ªÉ tr√°nh ‚Äúch·∫°y xong r·ªìi ng·ªß‚Äù
                # (tr∆∞·ªùng h·ª£p user ch·∫°y b·∫±ng CLI main.py).
                try:
                    p_stop, p_paused, p_reason = control_state.check_flags(pid)
                except Exception:
                    p_stop, p_paused, p_reason = False, False, ""

                if p_stop:
                    print(f"üõë [{pid}] B·ªã STOP, b·ªè qua profile ({p_reason})")
                    try:
                        control_state.set_profile_state(pid, "STOPPED")
                    except Exception:
                        pass
                    continue

                p = Process(target=self.worker, args=(pid,))
                p.start()
                processes.append(p)

            # N·∫øu kh√¥ng c√≥ profile n√†o ch·∫°y ƒë∆∞·ª£c th√¨ tho√°t lu√¥n (tr√°nh sleep v√¥ nghƒ©a)
            if len(processes) == 0:
                print("\n" + "=" * 60)
                print("üõë [RUNNER] Kh√¥ng c√≥ profile n√†o ƒë∆∞·ª£c ch·∫°y (t·∫•t c·∫£ ƒëang STOPPED?).")
                print("üëâ G·ª£i √Ω: m·ªü backend/data/runtime_control.json ƒë·ªÉ xo√° stopped_profiles ho·∫∑c g·ªçi RESUME.")
                print("=" * 60 + "\n")
                return

            # 2. Ch·ªù t·∫•t c·∫£ c√°c profile ch·∫°y xong (H·∫øt 30 ph√∫t t·ª•i n√≥ s·∫Ω t·ª± d·ª´ng)
            for p in processes:
                p.join()

            # 3. T√≠nh to√°n th·ªùi gian th·ª©c d·∫≠y
            wake_up_time = time.time() + rest_seconds
            wake_up_str = time.strftime('%H:%M:%S', time.localtime(wake_up_time))

            print("\n" + "="*60)
            print(f"üí§ [SLEEP] Xong phi√™n n√†y. Bot s·∫Ω ng·ªß {self.REST_MINUTES} ph√∫t.")
            print(f"‚è∞ D·ª± ki·∫øn ch·∫°y l·∫°i v√†o l√∫c: {wake_up_str}")
            print("="*60 + "\n")
            
            # 4. Bot ƒëi ng·ªß
            # sleep theo chunk ƒë·ªÉ v·∫´n check ƒë∆∞·ª£c STOP/PAUSE
            slept = 0
            while slept < rest_seconds:
                stop, paused, _reason = control_state.check_flags(None)
                if stop:
                    print("üõë [RUNNER] EMERGENCY_STOP trong l√∫c sleep -> tho√°t")
                    return
                # pause all: v·∫´n cho runner s·ªëng nh∆∞ng kh√¥ng ch·∫°y phi√™n m·ªõi
                if paused:
                    time.sleep(1)
                    continue
                time.sleep(1)
                slept += 1
--- END FILE: backend\core\runner.py ---

--- START FILE: backend\core\scraper.py ---
import time
import random
import os
from core import control as control_state

class SimpleBot:
    def __init__(self, fb):
        self.fb = fb 

    def _sleep_with_pause_check(self, total_seconds, profile_id, active_time_list, last_check_time_list):
        """
        Sleep nh∆∞ng check pause: ch·ªâ t√≠nh th·ªùi gian kh√¥ng pause v√†o active_time.
        active_time_list v√† last_check_time_list l√† list ƒë·ªÉ pass by reference.
        """
        remaining = total_seconds
        chunk = 0.5  # Sleep theo chunk 0.5s ƒë·ªÉ check pause th∆∞·ªùng xuy√™n
        
        while remaining > 0:
            sleep_chunk = min(chunk, remaining)
            
            # Check pause TR∆Ø·ªöC sleep: n·∫øu ƒëang pause th√¨ kh√¥ng sleep, ch·ªâ ƒë·ª£i
            stop, paused_before, _reason = control_state.check_flags(profile_id)
            if stop:
                raise RuntimeError("EMERGENCY_STOP")
            
            if paused_before:
                # ƒêang pause: kh√¥ng sleep, ch·ªâ ƒë·ª£i v√† kh√¥ng t√≠nh v√†o active_time
                time.sleep(sleep_chunk)
                last_check_time_list[0] = time.time()
                remaining -= sleep_chunk
                continue
            
            # Kh√¥ng pause: sleep v√† t√≠nh v√†o active_time
            start_chunk = time.time()
            time.sleep(sleep_chunk)
            end_chunk = time.time()
            actual_elapsed = end_chunk - start_chunk
            
            # Check pause SAU sleep: n·∫øu pause trong l√∫c sleep th√¨ kh√¥ng t√≠nh
            stop, paused_after, _reason = control_state.check_flags(profile_id)
            if stop:
                raise RuntimeError("EMERGENCY_STOP")
            
            # Ch·ªâ c·ªông v√†o active_time n·∫øu kh√¥ng pause c·∫£ tr∆∞·ªõc v√† sau
            if not paused_after:
                active_time_list[0] += actual_elapsed
            
            last_check_time_list[0] = end_chunk
            remaining -= sleep_chunk

    def run(self, url, duration=None):
        print(f"üöÄ ƒêang truy c·∫≠p: {url}")
        self.fb.goto(url) 
        
        # Track "active time" (ch·ªâ tƒÉng khi kh√¥ng pause) thay v√¨ wall clock time
        # D√πng list ƒë·ªÉ pass by reference cho helper function
        active_time_list = [0.0]
        last_check_time_list = [time.time()]
        profile_id = getattr(self.fb, 'profile_id', None)
        
        while True:
            try:
                # STOP/PAUSE checkpoint (∆∞u ti√™n STOP ALL)
                try:
                    if hasattr(self.fb, "control_checkpoint"):
                        self.fb.control_checkpoint("before_loop")
                except RuntimeError as ce:
                    if "EMERGENCY_STOP" in str(ce) or "BROWSER_CLOSED" in str(ce):
                        print("üõë D·ª´ng bot do control flag / browser closed")
                        break
                    raise

                # Ch·ªâ b·∫Øt ƒë·∫ßu ƒëo elapsed SAU checkpoint (v√¨ checkpoint c√≥ th·ªÉ wait khi pause)
                now = time.time()
                elapsed_since_last_check = now - last_check_time_list[0]
                last_check_time_list[0] = now

                # Check pause: n·∫øu kh√¥ng pause th√¨ c·ªông th·ªùi gian ƒë√£ tr√¥i qua v√†o active_time
                stop, paused, _reason = control_state.check_flags(profile_id)
                if stop:
                    print("üõë D·ª´ng bot do STOP flag")
                    break
                
                # Ch·ªâ tƒÉng active_time khi KH√îNG pause (ƒë√≥ng bƒÉng timer khi pause)
                if paused:
                    # N·∫øu v·∫´n ƒëang pause (hi·∫øm), reset m·ªëc th·ªùi gian ƒë·ªÉ kh√¥ng c·ªông d·ªìn
                    last_check_time_list[0] = time.time()
                    continue
                active_time_list[0] += elapsed_since_last_check
                
                # 1. Ki·ªÉm tra th·ªùi gian ch·∫°y (d√πng active_time thay v√¨ wall clock)
                if duration and active_time_list[0] >= duration:
                    print(f"‚è≥ H·∫øt gi·ªù ch·∫°y (ƒë√£ ch·∫°y {active_time_list[0]:.1f}s / {duration}s).")
                    break
                
                # ============================================================
                # CHI·∫æN THU·∫¨T: SCAN & SCROLL (ƒê·ªíNG B·ªò)
                # ============================================================
                
                # Bot cu·ªôn v√† tr·∫£ v·ªÅ b√†i vi·∫øt (n·∫øu c√≥) c√πng lo·∫°i (green/yellow)
                post, post_type = self.fb.scan_while_scrolling()

                if post:
                    self.fb.process_post(post, post_type)

                    delay = random.uniform(5.0, 8.0)
                    print(f"üò¥ Ngh·ªâ sau khi x·ª≠ l√Ω b√†i {delay:.1f}s")
                    # Sleep v·ªõi pause check: ch·ªâ t√≠nh th·ªùi gian kh√¥ng pause v√†o active_time
                    self._sleep_with_pause_check(delay, profile_id, active_time_list, last_check_time_list)
                else:
                    delay = random.uniform(3.0, 5.0)
                    print(f"üò¥ Kh√¥ng c√≥ b√†i ‚Äì ngh·ªâ {delay:.1f}s")
                    # Sleep v·ªõi pause check
                    self._sleep_with_pause_check(delay, profile_id, active_time_list, last_check_time_list)



                # Random mouse move nh·∫π cho ƒë·ª° b·ªã check bot
                
            
            except RuntimeError as e:
                # N·∫øu l√† exception ƒë·∫∑c bi·ªát BROWSER_CLOSED th√¨ d·ª´ng ngay
                if "BROWSER_CLOSED" in str(e) or "EMERGENCY_STOP" in str(e):
                    print(f"üõë D·ª´ng bot ngay l·∫≠p t·ª©c ({e})")
                    break
                raise  # Re-raise n·∫øu kh√¥ng ph·∫£i BROWSER_CLOSED
            except Exception as e:
                error_msg = str(e).lower()
                # N·∫øu browser/page ƒë√£ b·ªã ƒë√≥ng th√¨ d·ª´ng lu√¥n
                if any(keyword in error_msg for keyword in ["closed", "disconnected", "target page", "context or browser"]):
                    print(f"üõë Browser ƒë√£ b·ªã ƒë√≥ng -> D·ª´ng bot")
                    break
                print(f"‚ö†Ô∏è L·ªói scan: {e}")
                # Sleep v·ªõi pause check cho l·ªói
                self._sleep_with_pause_check(2.0, profile_id, active_time_list, last_check_time_list)
--- END FILE: backend\core\scraper.py ---

--- START FILE: backend\core\search_worker.py ---
import sys
import os
import urllib.parse
import time
import re
import random
from typing import Optional

# --- SETUP ƒê∆Ø·ªúNG D·∫™N ƒê·ªÇ IMPORT CORE ---
current_dir = os.path.dirname(os.path.abspath(__file__))
parent_dir = os.path.dirname(current_dir)
sys.path.append(parent_dir)

from core.nst import connect_profile
from core.nst import stop_profile
from core.browser import FBController, JS_EXPAND_SCRIPT, JS_CHECK_AND_HIGHLIGHT_SCOPED
from core.scraper import SimpleBot

# ==============================================================================
# "H√ÄNH VI NG∆Ø·ªúI TH·∫¨T": thi tho·∫£ng m·ªü Th√¥ng b√°o r·ªìi Back (8‚Äì15 ph√∫t/l·∫ßn)
# ==============================================================================
def _random_notification_interval_seconds() -> int:
    return random.randint(12 * 60 , 15 * 60 )


def click_notifications_button(fb: FBController) -> bool:
    """
    Click n√∫t 'Th√¥ng b√°o' tr√™n Facebook (top bar).
    ∆Øu ti√™n role + aria-label, kh√¥ng d√πng class ƒë·ªông.
    """
    if not fb or not getattr(fb, "page", None):
        return False

    page = fb.page

    # ∆Øu ti√™n role=button + aria-label
    try:
        btn = page.get_by_role(
            "button",
            name=re.compile(r"(Th√¥ng b√°o|Notifications)", re.IGNORECASE),
        )
        if btn.count() > 0:
            btn.first.click(timeout=3000)
            return True
    except Exception:
        pass

    # Fallback: querySelector
    try:
        clicked = page.evaluate(
            """
            () => {
                const el = document.querySelector(
                    '[role="button"][aria-label^="Th√¥ng b√°o"], [role="button"][aria-label^="Notifications"]'
                );
                if (el) { el.click(); return true; }
                return false;
            }
            """
        )
        return bool(clicked)
    except Exception:
        return False


def get_notifications_panel(page):
    """
    L·∫•y scope panel Th√¥ng b√°o (dialog).
    N·∫øu kh√¥ng t√¨m ƒë∆∞·ª£c th√¨ fallback v·ªÅ page.
    """
    try:
        panel = page.locator(
            'div[role="dialog"][aria-label^="Th√¥ng b√°o"], div[role="dialog"][aria-label^="Notifications"]'
        )
        if panel.count() > 0:
            return panel.first
    except Exception:
        pass

    return page


def click_random_notification(fb: FBController) -> bool:
    """
    Gi·∫£ ƒë·ªãnh panel Th√¥ng b√°o ƒë√£ m·ªü.
    Click ng·∫´u nhi√™n 1 th√¥ng b√°o h·ª£p l·ªá.
    """
    if not fb or not getattr(fb, "page", None):
        return False

    page = fb.page
    panel = get_notifications_panel(page)

    try:
        links = panel.locator('div[role="listitem"] a[role="link"]')
        count = links.count()
        if count == 0:
            print("‚ö†Ô∏è Kh√¥ng c√≥ th√¥ng b√°o n√†o ƒë·ªÉ click")
            return False

        def skip(href: Optional[str]) -> bool:
            if not href:
                return True
            h = str(href).strip()
            return (
                h == "/notifications/"
                or h.startswith("/notifications/?")
                or "facebook.com/notifications" in h
            )

        for _ in range(min(10, count)):
            idx = random.randint(0, count - 1)
            link = links.nth(idx)
            try:
                href = link.get_attribute("href")
            except Exception:
                href = None
            if skip(href):
                continue

            print(f"üîî Click th√¥ng b√°o random: {href}")
            link.click(timeout=5000)
            return True

        print("‚ö†Ô∏è Kh√¥ng t√¨m ƒë∆∞·ª£c th√¥ng b√°o h·ª£p l·ªá")
        return False

    except Exception as e:
        print(f"‚ùå L·ªói click_random_notification: {e}")
        return False


def open_notifications_random_then_back(
    fb: FBController,
    wait_seconds: Optional[int] = None,
    reload_after_back: bool = False,
) -> bool:
    """
    Flow ho√†n ch·ªânh:
    - M·ªü Th√¥ng b√°o
    - Click random 1 th√¥ng b√°o
    - ƒê·ª£i (10‚Äì15s ho·∫∑c custom)
    - Back
    - (Tu·ª≥ ch·ªçn) Reload ƒë·ªÉ reset feed state (ch·ªâ n√™n d√πng cho Feed)
    """
    if not fb or not getattr(fb, "page", None):
        return False

    page = fb.page

    if not click_notifications_button(fb):
        print("‚ö†Ô∏è Kh√¥ng m·ªü ƒë∆∞·ª£c Th√¥ng b√°o")
        return False

    # Ch·ªù panel render
    try:
        page.wait_for_timeout(5000)
    except Exception:
        time.sleep(5)

    if not click_random_notification(fb):
        return False

    delay = int(wait_seconds) if wait_seconds is not None else random.randint(10, 15)
    print(f"‚è≥ ƒê·ª£i {delay}s r·ªìi back")
    try:
        page.wait_for_timeout(delay * 1000)
    except Exception:
        time.sleep(delay)

    # ===== BACK =====
    try:
        page.go_back(timeout=0)
    except Exception:
        try:
            page.keyboard.press("Alt+ArrowLeft")
        except Exception:
            print("‚ö†Ô∏è go_back fail")
            return False

    # ===== RELOAD (ch·ªâ cho Feed n·∫øu b·∫≠t) =====
    if not reload_after_back:
        return True

    try:
        print("üîÑ Reload feed ƒë·ªÉ reset state")
        time.sleep(random.uniform(1.5, 3.0))  # human-like
        page.reload(wait_until="domcontentloaded")
        page.wait_for_timeout(3000)
        return True
    except Exception as e:
        print(f"‚ö†Ô∏è Reload fail: {e}")
        return False


class HumanLikeBot(SimpleBot):
    """
    K·∫ø th·ª´a SimpleBot ƒë·ªÉ g·∫Øn nh·ªãp m·ªü Th√¥ng b√°o 8‚Äì15 ph√∫t/l·∫ßn,
    CH·ªà trigger sau khi ƒë√£ x·ª≠ l√Ω xong 1 post + ngh·ªâ t·ª± nhi√™n.
    """
    def run(self, url, duration=None):
        print(f"üöÄ ƒêang truy c·∫≠p: {url}")
        self.fb.goto(url)

        start_time = time.time()
        next_notify_time = time.time() + _random_notification_interval_seconds()

        while True:
            try:
                if duration and (time.time() - start_time > duration):
                    print("‚è≥ H·∫øt gi·ªù ch·∫°y.")
                    break

                post, post_type = self.fb.scan_while_scrolling()

                if post:
                    self.fb.process_post(post, post_type)

                    delay = random.uniform(5.0, 8.0)
                    print(f"üò¥ Ngh·ªâ sau khi x·ª≠ l√Ω b√†i {delay:.1f}s")
                    time.sleep(delay)

                    # ===== ƒêI·ªÇM CH·ªêT: ch·ªâ m·ªü th√¥ng b√°o sau DONE + ngh·ªâ =====
                    if time.time() >= next_notify_time:
                        # Ch·ªâ reload sau khi back n·∫øu ƒëang ch·∫°y Feed (trang ch·ªß).
                        is_feed = str(url or "").strip().rstrip("/") == "https://www.facebook.com"
                        open_notifications_random_then_back(self.fb, reload_after_back=is_feed)
                        next_notify_time = time.time() + _random_notification_interval_seconds()
                else:
                    delay = random.uniform(3.0, 5.0)
                    print(f"üò¥ Kh√¥ng c√≥ b√†i ‚Äì ngh·ªâ {delay:.1f}s")
                    time.sleep(delay)

            except Exception as e:
                print(f"‚ùå L·ªói v√≤ng l·∫∑p: {e}")
                time.sleep(2)

def _parse_location_terms(raw_text: str, strip_terms: Optional[list[str]] = None) -> list[str]:
    """
    User input d·∫°ng: "b·∫Øc ninh , b·∫Øc giang" ho·∫∑c "tuy·ªÉn d·ª•ng b·∫Øc ninh , b·∫Øc giang"
    => tr·∫£ v·ªÅ ["b·∫Øc ninh", "b·∫Øc giang"]
    """
    text = str(raw_text or "").strip().lower()
    if not text:
        return []

    parts = [p.strip() for p in re.split(r"[,;\n]+", text) if p.strip()]
    out: list[str] = []
    seen: set[str] = set()
    strip_terms = strip_terms or []

    for part in parts:
        cleaned = part
        # remove "job keywords" kh·ªèi input n·∫øu user d√≠nh v√†o location
        for term in strip_terms:
            t = str(term or "").strip().lower()
            if not t:
                continue
            cleaned = cleaned.replace(t, " ")
        cleaned = re.sub(r"\s+", " ", cleaned).strip()
        if not cleaned:
            continue
        if cleaned in seen:
            continue
        seen.add(cleaned)
        out.append(cleaned)

    return out

# ==============================================================================
# CLASS CONTROLLER M·ªöI (CH·ªà LIKE, KH√îNG SHARE/SAVE)
# ==============================================================================
class SearchBotController(FBController):
    """
    K·∫ø th·ª´a FBController nh∆∞ng s·ª≠a l·∫°i h√†m process_post
    ƒë·ªÉ ch·ªâ th·ª±c hi·ªán h√†nh ƒë·ªông Like, b·ªè qua Share v√† Save ID.
    """
    def process_post(self, post_handle, post_type):
        try:
            print(f"üß† [FilterMode] ƒêang soi b√†i vi·∫øt (type={post_type})...")

            # 1. Expand n·ªôi dung (ƒë·ªÉ check keyword cho chu·∫©n)
            self.page.evaluate(JS_EXPAND_SCRIPT, post_handle)

            required_locations: list[str] = getattr(self, "required_locations", []) or []
            # 2) D√πng ƒë√∫ng h√†m c√≥ s·∫µn c·ªßa browser.py (JS_CHECK_AND_HIGHLIGHT_SCOPED)
            # - has_job_keyword: c√≥ √≠t nh·∫•t 1 keyword m·∫∑c ƒë·ªãnh (job_keywords) trong N·ªòI DUNG B√ÄI
            # - has_location_term: c√≥ √≠t nh·∫•t 1 c·ª•m text user nh·∫≠p (required_locations) trong N·ªòI DUNG B√ÄI
            # => CH·ªà LIKE KHI (job_keyword) AND (location_term)
            has_job_keyword = self.page.evaluate(
                JS_CHECK_AND_HIGHLIGHT_SCOPED,
                [post_handle, self.job_keywords]
            )
            # N·∫øu user kh√¥ng nh·∫≠p text (feed mode), th√¨ b·ªè qua ƒëi·ªÅu ki·ªán location (coi nh∆∞ pass)
            has_location_term = True if not required_locations else self.page.evaluate(
                JS_CHECK_AND_HIGHLIGHT_SCOPED,
                [post_handle, required_locations]
            )

            has_keyword = bool(has_job_keyword and has_location_term)

            if not has_keyword:
                print("‚ùå Kh√¥ng ƒë·∫°t ƒëi·ªÅu ki·ªán (c·∫ßn keyword m·∫∑c ƒë·ªãnh + c√≥ 1 trong text nh·∫≠p) -> B·ªè qua")
                self.mark_post_as_processed(post_handle)
                
                
                
                return False

            print("‚úÖ B√†i ƒë·∫°t ƒëi·ªÅu ki·ªán (keyword m·∫∑c ƒë·ªãnh + text nh·∫≠p)!")

            # Like theo x√°c su·∫•t gi·ªëng ng∆∞·ªùi d√πng:
            # - V·ªõi m·ªói b√†i "ƒë√∫ng", random 1 t·ªâ l·ªá trong kho·∫£ng 40%..60%
            # - Sau ƒë√≥ roll ƒë·ªÉ quy·∫øt ƒë·ªãnh c√≥ Like hay kh√¥ng
            p = random.uniform(0.40, 0.60)
            roll = random.random()
            should_like = roll < p
            print(f"üé≤ [LikeProb] p={p:.2f} roll={roll:.2f} -> {'LIKE' if should_like else 'SKIP'}")
            if should_like:
                # like_current_post t·ª± b·ªè qua n·∫øu b√†i ƒë√£ Like
            self.like_current_post(post_handle)

            # 4. ƒê√°nh d·∫•u ƒë√£ x·ª≠ l√Ω (ƒê·ªÉ bot l∆∞·ªõt ti·∫øp b√†i sau)
            self.mark_post_as_processed(post_handle)
            
            return True

        except Exception as e:
            print(f"‚ùå L·ªói process_post: {e}")
            return False

# ==============================================================================
# H√ÄM 1: T√åM KI·∫æM & LIKE (Trang Search)
# ==============================================================================
def search_and_like(profile_id: str, search_text: str, duration_minutes: int = 30, all_profile_ids=None):
    """Nh·∫≠p t·ª´ kh√≥a -> V√†o trang Search -> L∆∞·ªõt & Like b√†i c√≥ t·ª´ kh√≥a"""
    try:
        # 1. T·∫°o URL T√¨m ki·∫øm
        encoded_query = urllib.parse.quote_plus(search_text)
        target_url = f"https://www.facebook.com/search/posts?q={encoded_query}"
        
        print(f"üîç [Search] T·ª´ kh√≥a: '{search_text}'")
        print(f"üîó Link: {target_url}")

        _run_bot_logic(profile_id, target_url, search_text, duration_minutes, all_profile_ids=all_profile_ids)

    except Exception as e:
        print(f"‚ùå L·ªói search_and_like: {e}")

# ==============================================================================
# H√ÄM 2: L∆Ø·ªöT NEWFEED & LIKE (Trang Ch·ªß)
# ==============================================================================
def feed_and_like(profile_id: str, filter_text: str, duration_minutes: int = 30, all_profile_ids=None):
    """V√†o trang ch·ªß (Feed) -> L∆∞·ªõt -> Ch·ªâ Like b√†i n√†o ch·ª©a filter_text"""
    try:
        # 1. URL l√† Trang ch·ªß
        target_url = "https://www.facebook.com/"
        
        print(f"üè† [Feed] L∆∞·ªõt News Feed t√¨m t·ª´ kh√≥a: '{filter_text}'")
        
        _run_bot_logic(profile_id, target_url, filter_text, duration_minutes, all_profile_ids=all_profile_ids)

    except Exception as e:
        print(f"‚ùå L·ªói feed_and_like: {e}")

# ==============================================================================
# H√ÄM CH·∫†Y CHUNG (CORE LOGIC)
# ==============================================================================
def _run_bot_logic(profile_id, url, raw_text, duration_minutes, all_profile_ids=None):
    try:
        # 1. K·∫øt n·ªëi
        print(f"üöÄ ƒêang m·ªü profile: {profile_id}")
        ws_url = connect_profile(profile_id)
        
        # D√πng Controller ƒë√£ c·∫Øt b·ªè Share/Save
        fb = SearchBotController(ws_url)
        fb.profile_id = profile_id
        # ‚úÖ gi·ªõi h·∫°n dispatch/get_id ch·ªâ trong c√°c profile ƒëang ch·∫°y (ƒë√£ ch·ªçn)
        try:
            if all_profile_ids:
                fb.all_profile_ids = list(all_profile_ids)
            else:
                fb.all_profile_ids = [profile_id]
        except Exception:
            fb.all_profile_ids = [profile_id]
        fb.connect()

        # 2. Setup filter rules
        # - Feed: cho ph√©p raw_text r·ªóng => kh√¥ng l·ªçc location, ch·ªâ d√πng job_keywords m·∫∑c ƒë·ªãnh
        # - N·∫øu user c√≥ nh·∫≠p raw_text nh∆∞ng parse ra r·ªóng (vd ch·ªâ nh·∫≠p "tuy·ªÉn d·ª•ng") th√¨ coi nh∆∞ sai input
        raw_text_str = str(raw_text or "").strip()
        if not raw_text_str:
            locations = []
        else:
            # text nh·∫≠p ch·ªâ d√πng l√†m "location terms" (OR), t√°ch theo d·∫•u ph·∫©y
            locations = _parse_location_terms(raw_text_str, strip_terms=getattr(fb, "job_keywords", []))
            # N·∫øu user ch·ªâ nh·∫≠p keyword (vd: "tuy·ªÉn d·ª•ng") th√¨ locations c√≥ th·ªÉ r·ªóng sau khi strip.
            # Khi ƒë√≥: kh√¥ng l·ªçc location, v·∫´n ch·∫°y b√¨nh th∆∞·ªùng theo job_keywords m·∫∑c ƒë·ªãnh.
            if not locations:
                print("‚ÑπÔ∏è Kh√¥ng c√≥ location t·ª´ input -> ch·ªâ d√πng keyword m·∫∑c ƒë·ªãnh ƒë·ªÉ l·ªçc.")

        fb.required_locations = locations
        if locations:
            print(f"‚úÖ Filter location (OR): {locations}")
        else:
            print("‚úÖ Filter location: (none) -> ch·ªâ d√πng keyword m·∫∑c ƒë·ªãnh")
        print(f"‚úÖ Filter job keywords (default): {getattr(fb, 'job_keywords', [])}")
        
        # 3. Ch·∫°y Bot (human-like: th·ªânh tho·∫£ng m·ªü th√¥ng b√°o)
        bot = HumanLikeBot(fb)
        print(f"‚ñ∂Ô∏è B·∫Øt ƒë·∫ßu l∆∞·ªõt trong {duration_minutes} ph√∫t...")
        duration_seconds = duration_minutes * 60
        
        bot.run(url, duration=duration_seconds)
        
    except Exception as e:
        print(f"‚ùå L·ªói Runner: {e}")
    finally:
        print("üõë K·∫øt th√∫c.")
        # ƒê√≥ng s·∫°ch tab/context playwright + stop NST (gi·ªëng join group / cookie)
        try:
            if 'fb' in locals() and fb:
                try:
                    if getattr(fb, "page", None):
                        try:
                            fb.page.close()
                        except Exception:
                            pass
                except Exception:
                    pass
                try:
                    if getattr(fb, "browser", None) and getattr(fb.browser, "contexts", None):
                        for ctx in list(fb.browser.contexts):
                            try:
                                ctx.close()
                            except Exception:
                                pass
                except Exception:
                    pass
                try:
                    if getattr(fb, "browser", None):
                        try:
                            fb.browser.close()
                        except Exception:
                            pass
                except Exception:
                    pass
                try:
                    if getattr(fb, "play", None):
                        try:
                            fb.play.stop()
                        except Exception:
                            pass
                except Exception:
                    pass
        finally:
            try:
                stop_profile(profile_id)
            except Exception:
                pass

if __name__ == "__main__":
    # Module n√†y ƒë∆∞·ª£c g·ªçi qua FastAPI (/feed/start). Kh√¥ng ch·∫°y standalone.
    pass
--- END FILE: backend\core\search_worker.py ---

--- START FILE: backend\core\settings.py ---
import json
from dataclasses import dataclass, field
from functools import lru_cache
from pathlib import Path
from typing import List, Any, Dict

# ƒê∆∞·ªùng d·∫´n c·ªë ƒë·ªãnh ƒë·ªÉ ƒë·ªçc c·∫•u h√¨nh
SETTINGS_PATH = Path(__file__).resolve().parent.parent / "config" / "settings.json"


def _parse_bool(value: Any) -> bool:
    if isinstance(value, bool):
        return value
    if value is None:
        return False
    if isinstance(value, (int, float)):
        return bool(value)
    if isinstance(value, str):
        return value.strip().lower() in {"1", "true", "yes", "y", "on"}
    return False


def _coerce_positive_int(value: Any, default: int) -> int:
    try:
        num = int(value)
        return num if num > 0 else default
    except (TypeError, ValueError):
        return default


def _parse_profile_ids(value: Any) -> List[str]:
    """
    Tr·∫£ v·ªÅ danh s√°ch profile_id.
    H·ªó tr·ª£ c·∫£ format c≈© (list/string) v√† format m·ªõi (dict {id: {...}}).
    """
    if isinstance(value, dict):
        items = value.keys()
    elif isinstance(value, list):
        items = value
    elif isinstance(value, str):
        items = value.split(",")
    else:
        return []

    return [str(item).strip() for item in items if str(item).strip()]


def _parse_profile_configs(value: Any) -> Dict[str, Any]:
    """
    L∆∞u l·∫°i to√†n b·ªô c·∫•u h√¨nh profile (cookie, access_token, ...)
    ƒë·ªÉ c√≥ th·ªÉ d√πng v·ªÅ sau.
    """
    if isinstance(value, dict):
        return {str(k).strip(): v for k, v in value.items() if str(k).strip()}

    # Fallback cho format c≈©: ch·ªâ t·∫°o map r·ªóng t·ª´ danh s√°ch id
    ids = _parse_profile_ids(value)
    return {pid: {} for pid in ids}


@dataclass
class Settings:
    api_key: str
    headless: bool = False
    target_url: str = "https://facebook.com"
    profile_ids: List[str] = field(default_factory=list)
    profile_configs: Dict[str, Any] = field(default_factory=dict)
    run_minutes: int = 30
    rest_minutes: int = 120


@lru_cache(maxsize=1)
def get_settings() -> Settings:
    """
    ƒê·ªçc v√† cache c·∫•u h√¨nh t·ª´ settings.json.
    G·ªçi get_settings.cache_clear() n·∫øu c·∫ßn reload.
    """
    if not SETTINGS_PATH.exists():
        raise FileNotFoundError(f"Kh√¥ng t√¨m th·∫•y file c·∫•u h√¨nh: {SETTINGS_PATH}")

    with SETTINGS_PATH.open(encoding="utf-8") as f:
        try:
            raw = json.load(f)
        except json.JSONDecodeError as exc:
            raise ValueError(f"settings.json kh√¥ng h·ª£p l·ªá: {exc}") from exc

    return Settings(
        api_key=str(raw.get("API_KEY", "")),
        headless=_parse_bool(raw.get("HEADLESS", False)),
        target_url=str(raw.get("TARGET_URL", "https://facebook.com")),
        profile_ids=_parse_profile_ids(raw.get("PROFILE_IDS", [])),
        profile_configs=_parse_profile_configs(raw.get("PROFILE_IDS", {})),
        run_minutes=_coerce_positive_int(raw.get("RUN_MINUTES", 30), 30),
        rest_minutes=_coerce_positive_int(raw.get("REST_MINUTES", 120), 120),
    )


def reload_settings() -> Settings:
    """X√≥a cache v√† ƒë·ªçc l·∫°i settings.json (d√πng khi file ƒë·ªïi n·ªôi dung)."""
    get_settings.cache_clear()
    return get_settings()



--- END FILE: backend\core\settings.py ---

--- START FILE: backend\core\utils.py ---


import re

def extract_uid_from_url(url):
    """
    Chuy·ªÉn ƒë·ªïi link profile th√†nh UID ho·∫∑c Username
    V√≠ d·ª•: 
    - https://www.facebook.com/profile.php?id=10001234 -> 10001234
    - https://www.facebook.com/zuck?comment_id=... -> zuck
    """
    if not url: return None
    
    # Tr∆∞·ªùng h·ª£p 1: profile.php?id=12345
    match_id = re.search(r'profile\.php\?id=(\d+)', url)
    if match_id:
        return match_id.group(1)
        
    # Tr∆∞·ªùng h·ª£p 2: facebook.com/username
    # Lo·∫°i b·ªè c√°c tham s·ªë r√°c sau d·∫•u ? ho·∫∑c &
    clean_url = url.split('?')[0].split('&')[0]
    parts = clean_url.rstrip('/').split('/')
    
    # L·∫•y ph·∫ßn cu·ªëi c√πng (username)
    if parts:
        user_part = parts[-1]
        if user_part not in ['facebook.com', 'www.facebook.com', '']:
            return user_part
            
    return None

def clean_profile_list(raw):
    """Chu·∫©n h√≥a danh s√°ch profile t·ª´ string ho·∫∑c list."""
    if not raw:
        return []

    items = raw if isinstance(raw, list) else str(raw).split(",")
    return [str(p).strip() for p in items if str(p).strip()]
--- END FILE: backend\core\utils.py ---

--- START FILE: backend\data\runtime_control.json ---
{
  "global_emergency_stop": false,
  "global_pause": false,
  "paused_profiles": [],
  "stopped_profiles": [],
  "profile_states": {},
  "updated_at": "2025-12-22T15:32:33.510761+00:00"
}

--- END FILE: backend\data\runtime_control.json ---

--- START FILE: backend\data\post_ids\b77da63d-af55-43c2-ab7f-364250b20e30.json ---
[]
--- END FILE: backend\data\post_ids\b77da63d-af55-43c2-ab7f-364250b20e30.json ---

--- START FILE: backend\data\results\all_results_20251222_220621.json ---
{
  "total_files": 1,
  "results_by_file": {
    "b77da63d-af55-43c2-ab7f-364250b20e30.json": [
      {
        "post_id": "122152945058694563",
        "flag": "xanh",
        "text": "üéâ üå∏ ‚ÄúT·∫øt ƒë·∫øn xu√¢n v·ªÅ ‚Äì t√¨m vi·ªác ƒë√¢u xa, Vingroup ch√†o ƒë√≥n ‚Äì m·ªü l·ªëi thƒÉng hoa!‚Äù üå∏ üéâ üè¢ VINGROUP ‚Äì TUY·ªÇN D·ª§NG KH·ªêI VƒÇN PH√íNG TO√ÄN QU·ªêC üáªüá≥ üáªüá≥ B·∫°n ƒëang t√¨m ki·∫øm m·ªôt m√¥i tr∆∞·ªùng ·ªïn ƒë·ªãnh ‚Äì chuy√™n nghi·ªáp ‚Äì c√≥ l·ªô tr√¨nh thƒÉng ti·∫øn r√µ r√†ng? üáªüá≥ Vingroup ‚Äì T·∫≠p ƒëo√†n kinh t·∫ø t∆∞ nh√¢n h√†ng ƒë·∫ßu Vi·ªát Nam ‚Äì ƒëang m·ªü r·ªông ƒë·ªôi ng≈© vƒÉn ph√≤ng tr√™n to√†n qu·ªëc, s·∫µn s√†ng ƒë·ªìng h√†nh c√πng b·∫°n b∆∞·ªõc v√†o nƒÉm m·ªõi v·ªõi nhi·ªÅu c∆° h·ªôi ph√°t tri·ªÉn ƒë·ªôt ph√°. üí¢ V·ªä TR√ç ƒêANG TUY·ªÇN üîñ Nh√¢n Vi√™n K·∫ø To√°n üîñ Chuy√™n Vi√™n Qu·∫£n L√Ω Kinh Doanh üîñ Nh√¢n Vi√™n T∆∞ V·∫•n ChƒÉm S√≥c Kh√°ch H√†ng üîñ Tr∆∞·ªüng Ph√≤ng Xu·∫•t Nh·∫≠p Kh·∫©u üîñ Tr∆∞·ªüng Ph√≤ng Ti·∫øp Th·ªã Th∆∞∆°ng M·∫°i üîñ Tr∆∞·ªüng Ph√≤ng H√†nh Ch√≠nh Nh√¢n S·ª± üìç L√†m vi·ªác t·∫°i c√°c vƒÉn ph√≤ng ƒë·∫°i di·ªán tr√™n to√†n qu·ªëc üéØ T·∫†I SAO B·∫†N N√äN ·ª®NG TUY·ªÇN NGAY? ‚ñ™Ô∏è Thu nh·∫≠p h·∫•p d·∫´n, th∆∞·ªüng T·∫øt r√µ r√†ng ‚ñ™Ô∏è B·∫£o hi·ªÉm ƒë·∫ßy ƒë·ªß, ph√∫c l·ª£i ·ªïn ƒë·ªãnh ‚ñ™Ô∏è C∆° h·ªôi ph√°t tri·ªÉn s·ª± nghi·ªáp, ƒë∆∞·ª£c ƒë√†o t·∫°o chuy√™n s√¢u ‚ñ™Ô∏è M√¥i tr∆∞·ªùng l√†m vi·ªác minh b·∫°ch, hi·ªán ƒë·∫°i, chuy√™n nghi·ªáp üì® N·ªôp h·ªì s∆° tr·ª±c tuy·∫øn t·∫°i: https://qrco.de/tuyendungVinGroup üëâ Tag ng∆∞·ªùi ph√π h·ª£p ho·∫∑c chia s·∫ª ngay c∆° h·ªôi tuy·ªát v·ªùi n√†y! üåü VINGROUP ‚Äì N∆°i t√†i nƒÉng ƒë∆∞·ª£c ph√°t huy v√† th√†nh c√¥ng ƒë∆∞·ª£c ghi nh·∫≠n. C√πng kh·ªüi ƒë·ªông nƒÉm m·ªõi v·ªõi b∆∞·ªõc ti·∫øn v·ªØng v√†ng trong s·ª± nghi·ªáp! #Vingroup #TuyenDungTet2025 #CoHoiNgheNghiep #ViecLamVanPhong #DonXuanVingroup",
        "owning_profile": {
          "__typename": "User",
          "name": "Tuy·ªÉn D·ª•ng VinGroup",
          "id": "61570836905496"
        },
        "source_file": "b77da63d-af55-43c2-ab7f-364250b20e30.json",
        "profile_id": "b77da63d-af55-43c2-ab7f-364250b20e30",
        "reactions": [
          {
            "id": "100044138143352",
            "name": "Kh√°nh Ph∆∞∆°ng"
          },
          {
            "id": "1002263592",
            "name": "Ran Kaori"
          },
          {
            "id": "1234976494",
            "name": "Ha Tran"
          },
          {
            "id": "1268544510",
            "name": "VƒÉn ƒê√¨nh L√¢m"
          },
          {
            "id": "1277446090",
            "name": "Nguy·ªÖn VƒÉn Tu·ªá"
          },
          {
            "id": "1485344389",
            "name": "Hong Hanh"
          },
          {
            "id": "1572664685",
            "name": "Vu Ngoc Lan"
          },
          {
            "id": "1790504763",
            "name": "Huong Nguyen"
          },
          {
            "id": "1830492804",
            "name": "Martin Ngo"
          },
          {
            "id": "61550123255824",
            "name": "Jenny Tr·∫ßn"
          },
          {
            "id": "61550963711871",
            "name": "ƒê√†o Quang Hu·∫•n"
          },
          {
            "id": "61551494556150",
            "name": "Nguy·ªÖn Th·ªã Duy·ªát"
          },
          {
            "id": "61551798632228",
            "name": "Tuan Anh"
          },
          {
            "id": "61552652491139",
            "name": "V√µ Ng·ªçc Huy√™n"
          },
          {
            "id": "61552709622705",
            "name": "Ho√†ng M·∫°nh"
          },
          {
            "id": "61553747960696",
            "name": "Long Gia"
          },
          {
            "id": "61553761829719",
            "name": "Nam Hoang"
          },
          {
            "id": "61555731806498",
            "name": "Minh ƒê·ª©c"
          },
          {
            "id": "61556120043116",
            "name": "Mai Tr·∫ßn Minh"
          },
          {
            "id": "61556452044279",
            "name": "Anh Long"
          },
          {
            "id": "61556795983288",
            "name": "Bass House"
          },
          {
            "id": "61557071407694",
            "name": "D∆∞∆°ng Thuy·∫øt"
          },
          {
            "id": "61557775749884",
            "name": "Nguy·ªÖn Th·ªã VƒÉn"
          },
          {
            "id": "61564149783940",
            "name": "Ng·ªçc H√†"
          },
          {
            "id": "61564578580794",
            "name": "Nguy·ªÖn Khanh"
          },
          {
            "id": "61567168498234",
            "name": "H·ªì Ph∆∞∆°ng"
          },
          {
            "id": "61569010118881",
            "name": "Elvis Ph∆∞∆°ng"
          },
          {
            "id": "61569180890275",
            "name": "Nguy·ªÖn Tr∆∞·ªùng"
          },
          {
            "id": "61569272138269",
            "name": "H√¢n S·∫ßu"
          },
          {
            "id": "61570253625383",
            "name": "ƒêinh H·ªìng Tu·ªá Hr"
          },
          {
            "id": "61571187577749",
            "name": "Dung Nguy·ªÖn"
          },
          {
            "id": "61571406964597",
            "name": "L√™ Anh H·∫£i"
          },
          {
            "id": "61571671900364",
            "name": "Nguy·ªÖn V∆∞∆°ng Nhi"
          },
          {
            "id": "61571840248551",
            "name": "Tr·∫ßn Di·ªáp Bƒës"
          },
          {
            "id": "61571848330448",
            "name": "H·ªì Ph∆∞∆°ng"
          },
          {
            "id": "61572490859745",
            "name": "To Lan Thinh"
          },
          {
            "id": "61572842294221",
            "name": "H√† Phan Thu"
          },
          {
            "id": "61573733657294",
            "name": "H·ªì M·ªôc Nh√¢n"
          },
          {
            "id": "61573734497403",
            "name": "Ph·∫°m Th√†nh An"
          },
          {
            "id": "61573744547227",
            "name": "Hu·ª≥nh Th·ª•y Ca"
          },
          {
            "id": "61573852654944",
            "name": "VƒÉn H·∫£i"
          },
          {
            "id": "61573988684453",
            "name": "V≈© Thu·ª≥ Dung"
          },
          {
            "id": "61574010964642",
            "name": "Hu·ª≥nh H·ªìng Qu√¢n"
          },
          {
            "id": "61574110798886",
            "name": "Phan Nh·∫≠t Mi"
          },
          {
            "id": "61574152886242",
            "name": "Phan Thu Nh√¢n"
          },
          {
            "id": "61574175593832",
            "name": "Ng√¥ Thi·ªán Di·ªáp"
          },
          {
            "id": "61574258109121",
            "name": "Kh·∫£i T·ªãnh"
          },
          {
            "id": "61574867364927",
            "name": "Nguy·ªÖn VƒÉn Tr·∫Øng"
          },
          {
            "id": "61574978456212",
            "name": "Bee Bee"
          },
          {
            "id": "61575737576229",
            "name": "T√¥n Long"
          },
          {
            "id": "61576253253121",
            "name": "Le Giap"
          },
          {
            "id": "61576570737659",
            "name": "Ph√°p Thi·ªán Yuuta"
          },
          {
            "id": "61577718142636",
            "name": "Nam Ho√†i L√™"
          },
          {
            "id": "61577831266701",
            "name": "Nh√† Ph·ªë Tr∆∞·ªùng Khang"
          },
          {
            "id": "61577891019065",
            "name": "ƒê·ªó Th·ªã T·ªë Tr√¢n"
          },
          {
            "id": "61577913800061",
            "name": "Phan Tien Thai"
          },
          {
            "id": "61577966011957",
            "name": "L√™ Th·ªã Y·∫øn Nhi"
          },
          {
            "id": "61577990310795",
            "name": "Nguy·ªÖn Th√†nh Luy·∫øn"
          },
          {
            "id": "61578060900327",
            "name": "H·ªì Th·ªã C·∫©m Giang"
          },
          {
            "id": "61578588352981",
            "name": "Anh Minh"
          },
          {
            "id": "61578920644052",
            "name": "H·∫£i Lu√¢n"
          },
          {
            "id": "61579609253307",
            "name": "L∆∞u Hi·ªÅn"
          },
          {
            "id": "61579616184503",
            "name": "D·∫´n Nguy·ªÖn"
          },
          {
            "id": "61579778518833",
            "name": "Vu Huong"
          },
          {
            "id": "61579924336884",
            "name": "Thai Pham"
          },
          {
            "id": "61580075301277",
            "name": "Nguy·ªÖn Th·ªã Kim Dung"
          },
          {
            "id": "61580091380494",
            "name": "Hu·ª≥nh Di·ªÖm"
          },
          {
            "id": "61580652643855",
            "name": "L√™ Quang Nha"
          },
          {
            "id": "61581145032703",
            "name": "Chan Dang Quay"
          },
          {
            "id": "61581397461144",
            "name": "Tran Phuc Gi·∫∑t L√†"
          },
          {
            "id": "61581418713978",
            "name": "Chi√™m Khang D∆∞∆°ng"
          },
          {
            "id": "61581689701972",
            "name": "Kh·ªïng B·∫£o Tu·∫•n"
          },
          {
            "id": "61582487331614",
            "name": "Nguy·ªÖn Khang Land"
          },
          {
            "id": "61582779520068",
            "name": "Thanh ƒêinh Xu√¢n"
          },
          {
            "id": "61582832777139",
            "name": "Tran Phat Ngan"
          },
          {
            "id": "61582869747879",
            "name": "Anh Nguyen"
          },
          {
            "id": "61583102734016",
            "name": "Mai Linh Son"
          },
          {
            "id": "61583218533495",
            "name": "Kh√°nh ƒê√†o"
          },
          {
            "id": "61583648552185",
            "name": "Anh Dung L√™"
          },
          {
            "id": "61584927061788",
            "name": "L√™ Kh√°nh"
          },
          {
            "id": "61585066443817",
            "name": "T√¢m Thi·ªán"
          },
          {
            "id": "100000033162372",
            "name": "L∆∞∆°ng Th√°i S∆°n"
          },
          {
            "id": "100000046953514",
            "name": "Nguyen Thuy Binh"
          },
          {
            "id": "100000074903034",
            "name": "Ngoc Long"
          },
          {
            "id": "100000100445450",
            "name": "Nguyen Xuan Hoang"
          },
          {
            "id": "100000110883929",
            "name": "Ha Thanh Chung"
          },
          {
            "id": "100000118488636",
            "name": "Anh Tuan Dang"
          },
          {
            "id": "100000146503895",
            "name": "Tuan Bui Duc"
          },
          {
            "id": "100000199586797",
            "name": "Ho√†ng H·ªìng"
          },
          {
            "id": "100000206390872",
            "name": "Ha Vo Ngoc"
          },
          {
            "id": "100000227057333",
            "name": "Le van Luu"
          },
          {
            "id": "100000233054222",
            "name": "Nguy·ªÖn ƒê·ª©c C√¥ng"
          },
          {
            "id": "100000233458095",
            "name": "ƒê·ª©c Anh"
          },
          {
            "id": "100000241421870",
            "name": "C∆∞·ªùng L√£ ƒêƒÉng"
          },
          {
            "id": "100000285841717",
            "name": "Trinh Vinh"
          },
          {
            "id": "100000299911498",
            "name": "Thanh B√¨nh"
          },
          {
            "id": "100000335930188",
            "name": "Tien Dang"
          },
          {
            "id": "100000359003842",
            "name": "ƒê√†o Th·ªã H∆∞∆°ng"
          },
          {
            "id": "100000372765424",
            "name": "Beverly Truong"
          },
          {
            "id": "100000391379114",
            "name": "ƒêƒÉng Quang"
          },
          {
            "id": "100000440642840",
            "name": "Yuki Nguyen"
          },
          {
            "id": "100000465101424",
            "name": "Pham Lien"
          },
          {
            "id": "100000471456601",
            "name": "Bon Bon"
          },
          {
            "id": "100000536634518",
            "name": "V≈© Van Th·ª•"
          },
          {
            "id": "100000574898744",
            "name": "L√™ Thu NƒÉm"
          },
          {
            "id": "100000627052981",
            "name": "Nguy·ªÖn Xu√¢n H√≤a"
          },
          {
            "id": "100000778527246",
            "name": "Nay Quy√™n"
          },
          {
            "id": "100000941868141",
            "name": "Thoa Tran"
          },
          {
            "id": "100000980293146",
            "name": "Kh√°nh V√¢n"
          },
          {
            "id": "100000984300799",
            "name": "Tung Vu"
          },
          {
            "id": "100001022243294",
            "name": "Huyen Trieu"
          },
          {
            "id": "100001087908348",
            "name": "T√†i. C·ª≠a T·ª± ƒê·ªông"
          },
          {
            "id": "100001120775721",
            "name": "L√™ Th·ªã Minh Ph∆∞·ª£ng"
          },
          {
            "id": "100001342910831",
            "name": "La Hoa"
          },
          {
            "id": "100001443078158",
            "name": "Bim Lim Dim"
          },
          {
            "id": "100001508086380",
            "name": "Th·∫ø Kh∆∞∆°ng Nguy·ªÖn"
          },
          {
            "id": "100001575392906",
            "name": "Huy·ªÅn Anh Nguy·ªÖn"
          },
          {
            "id": "100001760897883",
            "name": "My Hieu Dao"
          },
          {
            "id": "100001812241811",
            "name": "V≈© Thu Trang"
          },
          {
            "id": "100001911838667",
            "name": "Ph√∫c Pi"
          },
          {
            "id": "100002236262875",
            "name": "D∆∞∆°ng Tr√≠ Th·ª©c"
          },
          {
            "id": "100002239523184",
            "name": "Nguy·ªÖn Ng√¢n Ch√¢u"
          },
          {
            "id": "100002284338356",
            "name": "Phuong Vu Mai"
          },
          {
            "id": "100002380444871",
            "name": "Tr·∫ßn T√¢n"
          },
          {
            "id": "100002395931625",
            "name": "Lyly Dang"
          },
          {
            "id": "100002422973147",
            "name": "Nguy·ªÖn Th√†nh ƒê√¥"
          },
          {
            "id": "100002448663492",
            "name": "B√πi Tuy·∫øt"
          },
          {
            "id": "100002618172780",
            "name": "Tr·∫ßn D≈©ng"
          },
          {
            "id": "100002654683809",
            "name": "Nguy·ªÖn Dung"
          },
          {
            "id": "100002768697384",
            "name": "Van Linh Nguyen"
          },
          {
            "id": "100002828608496",
            "name": "Th·∫Øng L√™ ƒêƒÉng"
          },
          {
            "id": "100002894088361",
            "name": "Ho√†ng Phi H√πng"
          },
          {
            "id": "100002918321046",
            "name": "Thu·ª≥ ƒê·ªó"
          },
          {
            "id": "100002946674698",
            "name": "H√≤e Nguy·ªÖn VƒÉn"
          },
          {
            "id": "100002978226577",
            "name": "Le Quang Tung"
          },
          {
            "id": "100002990355280",
            "name": "Thangmatlon Cutngay"
          },
          {
            "id": "100003112959701",
            "name": "VƒÉn S∆°n"
          },
          {
            "id": "100003137892869",
            "name": "Phihung Hoang"
          },
          {
            "id": "100003143419391",
            "name": "Ti·∫øn D≈©ng"
          },
          {
            "id": "100003187192760",
            "name": "Hoang Anh Ha"
          },
          {
            "id": "100003208886321",
            "name": "Nguy·ªÖn Huy·ªÅn Trang"
          },
          {
            "id": "100003212128126",
            "name": "Ph·∫°m Vƒ©nh"
          },
          {
            "id": "100003219365046",
            "name": "Ho√†i L√™ Th·ªã"
          },
          {
            "id": "100003256625248",
            "name": "Quang Ngoc Nguyen"
          },
          {
            "id": "100003263785363",
            "name": "Thu Tr·∫ßn"
          },
          {
            "id": "100003268721828",
            "name": "Quang T√πng"
          },
          {
            "id": "100003294388608",
            "name": "L√™ T√†i"
          },
          {
            "id": "100003296659152",
            "name": "Ph∆∞∆°ng Nhung"
          },
          {
            "id": "100003349716645",
            "name": "Nguy·ªÖn ƒê·ª©c Nvƒë"
          },
          {
            "id": "100003385221252",
            "name": "C√¢y Phong Ba"
          },
          {
            "id": "100003484607808",
            "name": "Thanh Thu√Ω"
          },
          {
            "id": "100003496539524",
            "name": "Trung Tr∆∞∆°ng VƒÉn"
          },
          {
            "id": "100003527679379",
            "name": "Nhu Tan Nguyen"
          },
          {
            "id": "100003696053635",
            "name": "Ruby Fly"
          },
          {
            "id": "100003730111726",
            "name": "Thach Hoang Van"
          },
          {
            "id": "100003769549026",
            "name": "Tr·∫ßn Trung Nh√¢n"
          },
          {
            "id": "100003772078549",
            "name": "Tuoi Nguyen"
          },
          {
            "id": "100003826431405",
            "name": "Blnh Mlnh"
          },
          {
            "id": "100003826836026",
            "name": "V≈© Linh"
          },
          {
            "id": "100003840960528",
            "name": "√Ånh Nguy·ªÖn"
          },
          {
            "id": "100003856208943",
            "name": "Phan H√≤a"
          },
          {
            "id": "100003869987023",
            "name": "Nguy·ªÖn Th·ªã M·ªπ Nhung"
          },
          {
            "id": "100003894536935",
            "name": "Tr·∫ßn H·ªØu Th√¥ng"
          },
          {
            "id": "100003911883355",
            "name": "C∆∞·ªùng Th√†nh"
          },
          {
            "id": "100003932734095",
            "name": "Th√†nh Kyo"
          },
          {
            "id": "100003946908707",
            "name": "Nguy√™n T√∫"
          },
          {
            "id": "100003951724972",
            "name": "Nguy·ªÖn Th·ªã H√† Ng√¢n"
          },
          {
            "id": "100003953913292",
            "name": "D≈©ng Nguy·ªÖn Minh"
          },
          {
            "id": "100004016275196",
            "name": "H·ªì VƒÉn Tu·∫•n"
          },
          {
            "id": "100004087246460",
            "name": "Nguy·ªÖn H·ªØu ƒê·∫°t"
          },
          {
            "id": "100004135123453",
            "name": "Mung Nguyen Thi"
          },
          {
            "id": "100004138992607",
            "name": "Hong Hai Vu"
          },
          {
            "id": "100004144351309",
            "name": "L√™ Trung Hi·∫øu"
          },
          {
            "id": "100004149012038",
            "name": "Hu·∫ø ƒê·∫∑ng"
          },
          {
            "id": "100004174891392",
            "name": "T·∫•n T√†i"
          },
          {
            "id": "100004256954453",
            "name": "Qu·ª≥nh Nh∆∞"
          },
          {
            "id": "100004273023294",
            "name": "ƒê·ªó Th√πy Linh"
          },
          {
            "id": "100004300397713",
            "name": "Thanh Ngo"
          },
          {
            "id": "100004304313985",
            "name": "H·ªìng Ph√∫c"
          },
          {
            "id": "100004306290359",
            "name": "Hi·ªÅn Ho√†ng"
          },
          {
            "id": "100004316522352",
            "name": "Thu·ª∑ Pro"
          },
          {
            "id": "100004342441972",
            "name": "VƒÉn Trung"
          },
          {
            "id": "100004348142950",
            "name": "Tr·ªãnh Th·ªã Linh"
          },
          {
            "id": "100004355646949",
            "name": "V√µ Ho√†ng B·ª≠u"
          },
          {
            "id": "100004428257202",
            "name": "ƒê·ªó Quang D·ª±"
          },
          {
            "id": "100004429086279",
            "name": "Tr·∫ßn Th√°i ƒê·∫°o"
          },
          {
            "id": "100004437578563",
            "name": "Sen Nh·∫≥ng"
          },
          {
            "id": "100004463476051",
            "name": "Ngoc Anh Tran"
          },
          {
            "id": "100004560970878",
            "name": "H√™nh Ph·∫°m"
          },
          {
            "id": "100004569734453",
            "name": "Lona Cat"
          },
          {
            "id": "100004616855082",
            "name": "Tri·ªáu Hi·ªÉn"
          },
          {
            "id": "100004622803079",
            "name": "Thao Ha"
          },
          {
            "id": "100004654544241",
            "name": "Nguy·ªÖn Th·ªã H·∫°nh"
          },
          {
            "id": "100004746369209",
            "name": "VƒÉn To·∫£n"
          },
          {
            "id": "100004828269961",
            "name": "Tr∆∞·ªüng Tr·∫ßn ƒê√¨nh"
          },
          {
            "id": "100004835741451",
            "name": "Duc Tran"
          },
          {
            "id": "100004841040407",
            "name": "Trung Thuc Hoang"
          },
          {
            "id": "100004854581771",
            "name": "Vi·ªát Nguy·ªÖn"
          },
          {
            "id": "100004907562634",
            "name": "V≈© Kh√°nh Vy"
          },
          {
            "id": "100004933301352",
            "name": "Ho√†ng Dung"
          },
          {
            "id": "100004942956305",
            "name": "Th√∫y Ho√†ng"
          },
          {
            "id": "100005016818649",
            "name": "V≈© Quang Hi·∫øn"
          },
          {
            "id": "100005033012757",
            "name": "Tr·∫ßn V√¢n"
          },
          {
            "id": "100005060382165",
            "name": "L√™ VƒÉn Nam"
          },
          {
            "id": "100005143232807",
            "name": "Lien Nguyen"
          },
          {
            "id": "100005158926907",
            "name": "Nguy·ªÖn V≈©"
          },
          {
            "id": "100005180706859",
            "name": "Thanh Binh Tran"
          },
          {
            "id": "100005198500756",
            "name": "ƒêi·ªÉm Nguy·ªÖn"
          },
          {
            "id": "100005199186637",
            "name": "Tr·∫ßn Nh√¢n"
          },
          {
            "id": "100005293903253",
            "name": "Viet Son"
          },
          {
            "id": "100005316904446",
            "name": "ƒê·∫°t Vinh Ch√¢u"
          },
          {
            "id": "100005328273224",
            "name": "B√°ch Zim"
          },
          {
            "id": "100005355072949",
            "name": "Qu·ªëc Bi·ªÉu"
          },
          {
            "id": "100005443655127",
            "name": "Ty Nguyen"
          },
          {
            "id": "100005476835538",
            "name": "Ph√πng Nghƒ©a"
          },
          {
            "id": "100005491364399",
            "name": "Nguy·ªÖn Th·ªã Th∆∞"
          },
          {
            "id": "100005734712385",
            "name": "√Ånh √Ånh"
          },
          {
            "id": "100005761982763",
            "name": "TranAnh Tran"
          },
          {
            "id": "100005785600557",
            "name": "L√™ B·∫£o Linh"
          },
          {
            "id": "100005987043595",
            "name": "H·∫£i ƒê·ªó"
          },
          {
            "id": "100005989327652",
            "name": "Kiet Duong Tuan"
          },
          {
            "id": "100005998215190",
            "name": "Pham Minh Chi"
          },
          {
            "id": "100006190306738",
            "name": "Vinh Nguy·ªÖn"
          },
          {
            "id": "100006282243357",
            "name": "Tr∆∞∆°ng Quang B·ªïn"
          },
          {
            "id": "100006289752741",
            "name": "Ph·∫°m Thu·ª≥"
          },
          {
            "id": "100006347823477",
            "name": "Dung Anh"
          },
          {
            "id": "100006356471950",
            "name": "L√™ Minh V≈©"
          },
          {
            "id": "100006436550382",
            "name": "Hoang Lan"
          },
          {
            "id": "100006455468722",
            "name": "Nguy·ªÖn Ho√†ng"
          },
          {
            "id": "100006477952681",
            "name": "Thanh Kha"
          },
          {
            "id": "100006492082087",
            "name": "L√¢m V≈©"
          },
          {
            "id": "100006527703159",
            "name": "Dung Nguy·ªÖn"
          },
          {
            "id": "100006534735398",
            "name": "ƒê·∫•t Vi·ªát"
          },
          {
            "id": "100006535210556",
            "name": "D∆∞∆°ng L√™"
          },
          {
            "id": "100006564792292",
            "name": "Nguyet Duong"
          },
          {
            "id": "100006621008888",
            "name": "Ch√∫c An"
          },
          {
            "id": "100006625688182",
            "name": "Ho√†ng Dung"
          },
          {
            "id": "100006629867100",
            "name": "Mai Truc"
          },
          {
            "id": "100006650558886",
            "name": "Hu·ª≥nh Tu·∫•n H·∫£i"
          },
          {
            "id": "100006652847354",
            "name": "th·∫±ng kh·ªù"
          },
          {
            "id": "100006656734334",
            "name": "Anh Tram"
          },
          {
            "id": "100006658449464",
            "name": "Ph·∫°m T·∫°o"
          },
          {
            "id": "100006670560114",
            "name": "Nguy·ªÖn Minh T√¢m"
          },
          {
            "id": "100006714038802",
            "name": "Nguy·ªÖn Thanh Ngh·ªã"
          },
          {
            "id": "100006828812149",
            "name": "Hai Con Cu√¥ng"
          },
          {
            "id": "100006870633964",
            "name": "Cuong Ha"
          },
          {
            "id": "100006910334973",
            "name": "Tra Giang"
          },
          {
            "id": "100006924643905",
            "name": "Huynh Toan"
          },
          {
            "id": "100006954573224",
            "name": "Le Hien"
          },
          {
            "id": "100007021395010",
            "name": "Ph√∫ Sƒ©"
          },
          {
            "id": "100007141772004",
            "name": "Kh∆∞∆°ng Ti·∫øn Th·∫£o"
          },
          {
            "id": "100007147607792",
            "name": "Huy Ph∆∞∆°ng"
          },
          {
            "id": "100007184853225",
            "name": "Phan Qu·ª≥nh"
          },
          {
            "id": "100007210390645",
            "name": "Tran Nhat Thang"
          },
          {
            "id": "100007343377103",
            "name": "Hang Le"
          },
          {
            "id": "100007351243660",
            "name": "Ho√†ng Tr·ªçng"
          },
          {
            "id": "100007393903182",
            "name": "Nguy·ªÖn H·ªìng H·∫£i"
          },
          {
            "id": "100007460525808",
            "name": "Tr·∫ßn Minh ƒê·ª©c"
          },
          {
            "id": "100007508854903",
            "name": "Tuy·∫øt Th√°i"
          },
          {
            "id": "100007541643743",
            "name": "Thanh Ng√†"
          },
          {
            "id": "100007542781938",
            "name": "Bui Viet Vuong"
          },
          {
            "id": "100007737932763",
            "name": "ƒê·∫∑ng Xu√¢n Quang"
          },
          {
            "id": "100007864661236",
            "name": "Ng√¢n Tr·∫ßn"
          },
          {
            "id": "100007882321871",
            "name": "VƒÉn Minh"
          },
          {
            "id": "100007927390679",
            "name": "Hanh Tran"
          },
          {
            "id": "100007967923641",
            "name": "Tony Tp"
          },
          {
            "id": "100008140249491",
            "name": "P√© B·ª±"
          },
          {
            "id": "100008221572096",
            "name": "Huyen Thu"
          },
          {
            "id": "100008234374431",
            "name": "Nguy·ªÖn Thanh Nga"
          },
          {
            "id": "100008248577763",
            "name": "H·∫£o ƒêinh"
          },
          {
            "id": "100008291257535",
            "name": "Nguy·ªÖn Trang Linh"
          },
          {
            "id": "100008425995708",
            "name": "An Thuy"
          },
          {
            "id": "100008451288135",
            "name": "Ph·∫°m H∆∞∆°ng"
          },
          {
            "id": "100008521248711",
            "name": "VƒÉn Tu·∫•n"
          },
          {
            "id": "100008694605147",
            "name": "Nam LE Van"
          },
          {
            "id": "100008993380043",
            "name": "Thi√™n S·ª© B√¥ng H·ªìng"
          },
          {
            "id": "100009041181623",
            "name": "Ho√†ng Th·ªã Nhung"
          },
          {
            "id": "100009076064008",
            "name": "Tr∆∞∆°ng Thi√™n VƒÉn"
          },
          {
            "id": "100009156128207",
            "name": "Nga Nguy·ªÖn"
          },
          {
            "id": "100009492122316",
            "name": "N·ªôi Tpth Vinspex"
          },
          {
            "id": "100009700398050",
            "name": "Dung Dang Hong"
          },
          {
            "id": "100009710115306",
            "name": "Cao Thi Thuy Kieu"
          },
          {
            "id": "100009710402349",
            "name": "Ho√† Mai"
          },
          {
            "id": "100009721188717",
            "name": "Nari Nguy·ªÖn"
          },
          {
            "id": "100009786584855",
            "name": "L√™ B√° Chi·∫øn"
          },
          {
            "id": "100009850141283",
            "name": "H·ªì C∆∞·ªùng"
          },
          {
            "id": "100010045967431",
            "name": "Giang Nguyen"
          },
          {
            "id": "100010125007281",
            "name": "Nguy·ªÖn C√¥ng Ch√≠nh"
          },
          {
            "id": "100010201384092",
            "name": "B√πi To√†n"
          },
          {
            "id": "100010275101767",
            "name": "Nguy·ªÖn Ng·ªçc Phong"
          },
          {
            "id": "100010373340923",
            "name": "B√° Ch√¢u"
          },
          {
            "id": "100010533724426",
            "name": "Quy Phi"
          },
          {
            "id": "100010608222218",
            "name": "Tr·∫ßn Kim Ng√¢n"
          },
          {
            "id": "100010673776672",
            "name": "Ho√†ng Tu·∫•n"
          },
          {
            "id": "100010743184484",
            "name": "Van Trung"
          },
          {
            "id": "100010888540861",
            "name": "Du Le"
          },
          {
            "id": "100010918548956",
            "name": "Thanh Ho√†ng"
          },
          {
            "id": "100010959194633",
            "name": "Ph·∫°m Ng√¢n"
          },
          {
            "id": "100011103738351",
            "name": "L√™ H∆∞·ªùng"
          },
          {
            "id": "100011229511818",
            "name": "Nguy·ªÖn Lan Ph∆∞∆°ngg"
          },
          {
            "id": "100011367592771",
            "name": "Nguy·ªÖn Mai"
          },
          {
            "id": "100011394891822",
            "name": "Nguy·ªÖn Hoc"
          },
          {
            "id": "100011668994702",
            "name": "Mrken 'Tr·∫ßn'"
          },
          {
            "id": "100011798833475",
            "name": "Thanh Huy·ªÅn Nguy·ªÖn"
          },
          {
            "id": "100011866704626",
            "name": "Phan Ngoan"
          },
          {
            "id": "100011931436749",
            "name": "Phan VƒÉn"
          },
          {
            "id": "100011980453016",
            "name": "Nguy·ªÖn Ho√†ng Minh"
          },
          {
            "id": "100012075423028",
            "name": "Nguy·ªÖn Minh"
          },
          {
            "id": "100012373298685",
            "name": "Nguy·ªÖn H·ªØu Th·ªãnh"
          },
          {
            "id": "100012594226421",
            "name": "Ho√†i B√πi"
          },
          {
            "id": "100012713474153",
            "name": "Su·ªëi ƒê√°"
          },
          {
            "id": "100012773562115",
            "name": "L·ªçc N∆∞·ªõc T√¢y Ninh"
          },
          {
            "id": "100013065763040",
            "name": "Luong Tran"
          },
          {
            "id": "100013220139095",
            "name": "C√°i G√¨ Ch·∫≥ng C√≥"
          },
          {
            "id": "100013263695559",
            "name": "ƒê·ª©c Ph·∫°m"
          },
          {
            "id": "100013358612819",
            "name": "Vansao Tran"
          },
          {
            "id": "100013379434358",
            "name": "Hoang Monaco"
          },
          {
            "id": "100013476914535",
            "name": "L∆∞u ƒê·ª©c Duy"
          },
          {
            "id": "100013549770221",
            "name": "D∆∞∆°ng T∆∞·ªùng Duy"
          },
          {
            "id": "100013618568123",
            "name": "Phan ƒê√¨nh ƒê·∫°t"
          },
          {
            "id": "100013769500273",
            "name": "Tr·∫ßn ƒê·ª©c T√¨nh"
          },
          {
            "id": "100014470716662",
            "name": "Ho√†ng Anh BTonio Lecturer"
          },
          {
            "id": "100014518449736",
            "name": "Hanh Chu"
          },
          {
            "id": "100014736707023",
            "name": "Tuan Anh Nguy·ªÖn"
          },
          {
            "id": "100014744434065",
            "name": "Tr·∫ßn T√¢m"
          },
          {
            "id": "100015297154167",
            "name": "Bao Hoa Nguyen"
          },
          {
            "id": "100015327542257",
            "name": "Nguy·ªÖn Dung"
          },
          {
            "id": "100015541562943",
            "name": "Tr·∫ßn Hoa"
          },
          {
            "id": "100015766291522",
            "name": "ƒê√†o Gia Founder"
          },
          {
            "id": "100016384751535",
            "name": "Tr·∫ßn Ph√∫"
          },
          {
            "id": "100016569391198",
            "name": "Tooichi Kuroba"
          },
          {
            "id": "100016784174705",
            "name": "Ng·ªçc To√†n"
          },
          {
            "id": "100016807449887",
            "name": "T√∫ B√πi"
          },
          {
            "id": "100016858773368",
            "name": "D∆∞∆°ng To·∫£n Linh"
          },
          {
            "id": "100016927471613",
            "name": "Thi√™n V√¢n"
          },
          {
            "id": "100017007180195",
            "name": "Xoan Tit Xoan"
          },
          {
            "id": "100017616608808",
            "name": "Nguy·ªÖn V√¢n Th·ªãnh"
          },
          {
            "id": "100017645802520",
            "name": "Tr∆∞∆°ng Tr√≠ ƒê·ª©c"
          },
          {
            "id": "100020736142752",
            "name": "Nguy·ªÖn Huy Gi√°p"
          },
          {
            "id": "100021702982261",
            "name": "Phan Th·ªã M·∫≠n"
          },
          {
            "id": "100021719721075",
            "name": "L√™ H·ªØu H√†"
          },
          {
            "id": "100022269277688",
            "name": "Trung CuChi"
          },
          {
            "id": "100022647950578",
            "name": "L√™ Duy Th·ªç"
          },
          {
            "id": "100022848772578",
            "name": "Nguy·ªÖn Bi√™n"
          },
          {
            "id": "100023066776436",
            "name": "Ken Ken"
          },
          {
            "id": "100023472497923",
            "name": "ƒê√¥ng M√πa"
          },
          {
            "id": "100023906706671",
            "name": "Kim Dung"
          },
          {
            "id": "100024414377599",
            "name": "Hoahong Hoahong"
          },
          {
            "id": "100024616364535",
            "name": "ƒêinh Quang D≈©ng"
          },
          {
            "id": "100024715094699",
            "name": "Ho√†ng Th·ªã Ng√†n"
          },
          {
            "id": "100024755232860",
            "name": "VƒÉn Ch√≠nh"
          },
          {
            "id": "100025032575504",
            "name": "ƒê·∫∑ng VƒÉn T√≠nh"
          },
          {
            "id": "100025033702562",
            "name": "ƒê·ªó Di·ªáp Khanh"
          },
          {
            "id": "100025148075519",
            "name": "Ph√°t Tr∆∞∆°ng"
          },
          {
            "id": "100025417395973",
            "name": "Nhung Dao"
          },
          {
            "id": "100025495093138",
            "name": "C√¥ ƒê·ªôc V∆∞∆°ng"
          },
          {
            "id": "100025667291297",
            "name": "Lyla Larry Nguyen"
          },
          {
            "id": "100026182246416",
            "name": "Pham Minh"
          },
          {
            "id": "100026300572404",
            "name": "Lan Anh Nail"
          },
          {
            "id": "100026896832330",
            "name": "Minh Quang Vu"
          },
          {
            "id": "100027140260785",
            "name": "Nguy·ªÖn Th·∫ø Sinh"
          },
          {
            "id": "100027447045890",
            "name": "Nguyen H·∫±ng"
          },
          {
            "id": "100027773987109",
            "name": "Quan Thu·∫ßn"
          },
          {
            "id": "100027882458875",
            "name": "Tr∆∞∆°ng Thanh Ng√¢n"
          },
          {
            "id": "100027892488162",
            "name": "H·ªì M·ªπ Trang"
          },
          {
            "id": "100028057694355",
            "name": "Nguy·ªÖn Th·∫ø Ng·ªçc"
          },
          {
            "id": "100028183980483",
            "name": "Hoa Nguyen"
          },
          {
            "id": "100028499742249",
            "name": "ƒê√†o ƒê√¨nh Luy·ªán"
          },
          {
            "id": "100028687274030",
            "name": "Tr·∫ßn ƒê√¨nh V≈©"
          },
          {
            "id": "100028696751646",
            "name": "Nga Kim V≈© HR"
          },
          {
            "id": "100028882415709",
            "name": "Th·ªßy Nguy·ªÖn"
          },
          {
            "id": "100029299301680",
            "name": "Vi Hoa"
          },
          {
            "id": "100029670409014",
            "name": "Huy·ªÅn ƒê·∫∑ng"
          },
          {
            "id": "100029798453334",
            "name": "Ng·ª•y Huy·ªÅn Tr√¢m"
          },
          {
            "id": "100029967125807",
            "name": "L√™ Ho√†ng"
          },
          {
            "id": "100030104508772",
            "name": "B·∫£o L√¢m"
          },
          {
            "id": "100030473134367",
            "name": "H√† L√™"
          },
          {
            "id": "100030509079299",
            "name": "Tr·∫ßn VƒÉn H√πng"
          },
          {
            "id": "100030578503940",
            "name": "H·ªØu Th√†nh"
          },
          {
            "id": "100030659791332",
            "name": "L∆∞∆°ng VƒÉn T√¢y"
          },
          {
            "id": "100030833381157",
            "name": "Thoc Luu"
          },
          {
            "id": "100030909782658",
            "name": "V∆∞∆°ng Xu√¢n Trung"
          },
          {
            "id": "100031257766967",
            "name": "Nguy·ªÖn Zin"
          },
          {
            "id": "100031949331540",
            "name": "Ma Th·∫£o"
          },
          {
            "id": "100033158917500",
            "name": "Nhi Th·ªã"
          },
          {
            "id": "100033583038301",
            "name": "Lien Le"
          },
          {
            "id": "100034551607051",
            "name": "Ki·ªÅu Ng·ªçc"
          },
          {
            "id": "100034573387118",
            "name": "Nguy·ªÖn T·∫•n Th·∫°nh"
          },
          {
            "id": "100035312289300",
            "name": "Ph·∫°m B·∫£o Vinh"
          },
          {
            "id": "100035413536551",
            "name": "Nguy·ªÖn To·∫£n"
          },
          {
            "id": "100035471355865",
            "name": "Ph·∫°m Ho√†n √Çn"
          },
          {
            "id": "100035824970612",
            "name": "L√Ω T·∫ßm Hoan"
          },
          {
            "id": "100035891000395",
            "name": "Nguy·ªÖn Ki·ªÅu M·ªµ"
          },
          {
            "id": "100036436549617",
            "name": "ƒêinh Th·ªã Tuy·∫øt Mai"
          },
          {
            "id": "100037302003281",
            "name": "ƒê·ªó L·ª•a"
          },
          {
            "id": "100037465741341",
            "name": "Hi·ªÉu R√¢u"
          },
          {
            "id": "100039006110871",
            "name": "Trang Tr√≤n"
          },
          {
            "id": "100039107282206",
            "name": "Nguy·ªÖn Minh Ph·ª•ng"
          },
          {
            "id": "100039234011717",
            "name": "ƒê√† Chu"
          },
          {
            "id": "100039431713970",
            "name": "ƒêinh VƒÉn Tu·∫•n"
          },
          {
            "id": "100039791821927",
            "name": "Cuong Vu"
          },
          {
            "id": "100040344554026",
            "name": "Nguy·ªÖn H·ªØu To√†n"
          },
          {
            "id": "100040714280187",
            "name": "Khanh An Cam"
          },
          {
            "id": "100040854852044",
            "name": "Kien Nguyen"
          },
          {
            "id": "100041005845935",
            "name": "ƒêo√†n Minh Hi·∫øu"
          },
          {
            "id": "100041138773693",
            "name": "Mai Vinh"
          },
          {
            "id": "100041331110092",
            "name": "Kh·∫Øc Ng·ªçc"
          },
          {
            "id": "100041331771277",
            "name": "H·ªì Ph∆∞·ªõc An"
          },
          {
            "id": "100041741836664",
            "name": "Giang M·ª∑ Duy√™n"
          },
          {
            "id": "100042365281852",
            "name": "Trang L√™"
          },
          {
            "id": "100042843185509",
            "name": "Huy Ho√†ng Ph√°t"
          },
          {
            "id": "100043083728060",
            "name": "Long Quy·ªÅn Hino"
          },
          {
            "id": "100043837155888",
            "name": "Sunny Hu·ª≥nh"
          },
          {
            "id": "100044217855177",
            "name": "Loan Nong"
          },
          {
            "id": "100044322856461",
            "name": "L·ªá H·∫±ng"
          },
          {
            "id": "100044395205424",
            "name": "L√†nh L√™"
          },
          {
            "id": "100044750093304",
            "name": "Minh Kh·∫£i H∆∞ng"
          },
          {
            "id": "100044828802250",
            "name": "Tr·∫ßn Ho√†i VƒÉn"
          },
          {
            "id": "100044982412216",
            "name": "Tuan Anh Phung Quoc"
          },
          {
            "id": "100045239104005",
            "name": "Ph·∫°m Tu·∫•n"
          },
          {
            "id": "100045857166831",
            "name": "Gia Huy"
          },
          {
            "id": "100046073641870",
            "name": "Nguy·ªÖn Th·ªã Duy√™n"
          },
          {
            "id": "100046405936633",
            "name": "H·ªì Xu√¢n Hi·∫øu"
          },
          {
            "id": "100046643683833",
            "name": "Hoang Anh Nguyen"
          },
          {
            "id": "100047608833937",
            "name": "Nguy·ªÖn Th·∫£o Nhi"
          },
          {
            "id": "100047832253096",
            "name": "VƒÉn T·∫•n T√†i"
          },
          {
            "id": "100048950482838",
            "name": "Ng√¥ Thanh Th√πy"
          },
          {
            "id": "100049057852661",
            "name": "Gia Hung"
          },
          {
            "id": "100049137320683",
            "name": "Nguy·ªÖn H·ªØu T√πng"
          },
          {
            "id": "100049364013977",
            "name": "Tri·ªÅu Nguy·ªÖn"
          },
          {
            "id": "100049529929873",
            "name": "Tr·ªçng Nguy·ªÖn"
          },
          {
            "id": "100049933239314",
            "name": "Nguy·ªÖn Thanh Ph∆∞∆°ng"
          },
          {
            "id": "100050313874375",
            "name": "Nguy·ªÖn Kh√°nh An"
          },
          {
            "id": "100050689431203",
            "name": "VƒÉn K·ª∑"
          },
          {
            "id": "100050896924676",
            "name": "Chau Truong"
          },
          {
            "id": "100051580996504",
            "name": "V∆∞∆°ng Ho√†ng"
          },
          {
            "id": "100051631818167",
            "name": "‡∏Ñ‡∏∏‡∏ì ‡∏ß‡∏µ‡∏£‡∏†‡∏±‡∏ó‡∏£"
          },
          {
            "id": "100052289653476",
            "name": "H·ªì Kim Th√†nh Anh"
          },
          {
            "id": "100052330601510",
            "name": "Nguy·ªÖn Xu√¢n H·∫£i"
          },
          {
            "id": "100052797646738",
            "name": "Ng√¥ ƒêƒÉng S·ªπ S·ªπ"
          },
          {
            "id": "100053168822469",
            "name": "Khang Ho√†ng"
          },
          {
            "id": "100053385587217",
            "name": "Hu·ª≥nh M·ªπ An"
          },
          {
            "id": "100053523216470",
            "name": "Tr∆∞∆°ng B·∫£o Kh√°nh"
          },
          {
            "id": "100053618811831",
            "name": "Nguyen Nghia"
          },
          {
            "id": "100053653425560",
            "name": "C√¥ng Anh"
          },
          {
            "id": "100054118547462",
            "name": "L∆∞∆°ng VƒÉn Gi√†u"
          },
          {
            "id": "100055091536978",
            "name": "Nguy·ªÖn Th·ªßy"
          },
          {
            "id": "100055456192661",
            "name": "Hai Nguyen"
          },
          {
            "id": "100056115540240",
            "name": "Vinh Nguy√™n"
          },
          {
            "id": "100056204585461",
            "name": "T√≤ng Vinh L·∫≠p"
          },
          {
            "id": "100056219674828",
            "name": "Nguy·ªÖn ƒêƒÉng Long"
          },
          {
            "id": "100056893673138",
            "name": "Ph·∫°m H∆∞∆°ng"
          },
          {
            "id": "100056971001603",
            "name": "ƒê·ªó Ng·ªçc B√≠ch"
          },
          {
            "id": "100057218484529",
            "name": "An Dong"
          },
          {
            "id": "100057282332889",
            "name": "ƒê·∫∑ng Long"
          },
          {
            "id": "100057294213677",
            "name": "B·∫Øc Chi√™m Ks"
          },
          {
            "id": "100058695786943",
            "name": "Tr∆∞∆°ng Ng·ªçc C∆∞·ªùng"
          },
          {
            "id": "100059470687155",
            "name": "KiLa Kids"
          },
          {
            "id": "100061966165039",
            "name": "Xu√¢n B√πi"
          },
          {
            "id": "100063582972054",
            "name": "Nguy·ªÖn H∆∞∆°ng"
          },
          {
            "id": "100065484991136",
            "name": "H·ªØu Tƒ©nh"
          },
          {
            "id": "100065755574601",
            "name": "L√™ Quang VƒÉn"
          },
          {
            "id": "100065910370542",
            "name": "Aiy Kham Ma Ny"
          },
          {
            "id": "100066564653556",
            "name": "Sen Pham"
          },
          {
            "id": "100066843591263",
            "name": "Ph·∫°m Nh·∫≠t Ti·∫øn"
          },
          {
            "id": "100067012723713",
            "name": "Ph·∫°m Thanh V√¢n"
          },
          {
            "id": "100067050272709",
            "name": "Tr·∫ßn ƒê√†n"
          },
          {
            "id": "100067311587908",
            "name": "Tr·∫ßn VƒÉn Tr∆∞·ªùng"
          },
          {
            "id": "100067495173935",
            "name": "L√™ Ng·ªçc Huy"
          },
          {
            "id": "100067561286987",
            "name": "NT Bii"
          },
          {
            "id": "100067655688411",
            "name": "Ho√†ng Kim T√πng"
          },
          {
            "id": "100067783291879",
            "name": "Nguy·ªÖn Ho√†ng Vinh"
          },
          {
            "id": "100068319355393",
            "name": "Nguy·ªÖn Kh·∫£ Nhi"
          },
          {
            "id": "100069529777480",
            "name": "Nguy·ªÖn V√µ L·ª£i"
          },
          {
            "id": "100069724183977",
            "name": "ƒê√†o H·ªØu Hu·ª≥nh"
          },
          {
            "id": "100070643193025",
            "name": "Nguy·ªÖn Hoan"
          },
          {
            "id": "100070996751630",
            "name": "Thi·ªÅu Nguy·ªÖn VƒÉn"
          },
          {
            "id": "100071772381887",
            "name": "Anan Anan"
          },
          {
            "id": "100071986008443",
            "name": "Ho√†ng S∆°n"
          },
          {
            "id": "100072577917134",
            "name": "H√† Moon"
          },
          {
            "id": "100072884918743",
            "name": "ƒêinh Ng·ªçc Huy·ªÅn"
          },
          {
            "id": "100072973166250",
            "name": "L√™ Minh Ph∆∞∆°ng"
          },
          {
            "id": "100073041764842",
            "name": "Gia An"
          },
          {
            "id": "100073288287437",
            "name": "Kim Yen"
          },
          {
            "id": "100073474667304",
            "name": "Nguy·ªÖn Minh Tu·∫•n"
          },
          {
            "id": "100073518842187",
            "name": "Ken Vy"
          },
          {
            "id": "100074726791534",
            "name": "Thanh Long"
          },
          {
            "id": "100074896790646",
            "name": "Nguy·ªÖn ƒê·ª©c L√¢m"
          },
          {
            "id": "100075442416851",
            "name": "Phan Ph·ª•ng Hi·ªáp"
          },
          {
            "id": "100075498409541",
            "name": "Melvin Balagan"
          },
          {
            "id": "100076228431824",
            "name": "Nguy·ªÖn H·∫±ng Bƒës"
          },
          {
            "id": "100076424797674",
            "name": "ƒê·ªó Nh∆∞ Qu·ª≥nh"
          },
          {
            "id": "100076589088252",
            "name": "Th·∫°ch ƒêi·ªÅn An"
          },
          {
            "id": "100076848668836",
            "name": "Tr·∫ßn Thanh T√†i"
          },
          {
            "id": "100076915989195",
            "name": "Ph·∫°m Th·ªã Th·∫ø"
          },
          {
            "id": "100076937134966",
            "name": "√öt L√™"
          },
          {
            "id": "100078537897171",
            "name": "Tr·∫ßn Ki·ªÅu Trinh"
          },
          {
            "id": "100078714237075",
            "name": "Ph·∫°m Thanh H·ªØu"
          },
          {
            "id": "100078927330919",
            "name": "H√† C√¥ng Minh"
          },
          {
            "id": "100079517160224",
            "name": "Tr·∫ßn Minh Th∆∞"
          },
          {
            "id": "100079825482206",
            "name": "Tr∆∞∆°ng Th·ªã Ng√†"
          },
          {
            "id": "100080216923789",
            "name": "Ho√†ng Huy H·∫£i"
          },
          {
            "id": "100080877782912",
            "name": "Nguy·ªÖn Quang Hi·∫øn"
          },
          {
            "id": "100081124791663",
            "name": "L√™ Ph∆∞∆°ng Nam"
          },
          {
            "id": "100081126481372",
            "name": "Phan Th·ª•c Quy√™n"
          },
          {
            "id": "100081183973040",
            "name": "Ch√¢u Thu Y√™n"
          },
          {
            "id": "100081577131072",
            "name": "Nguy·ªÖn Huy·ªÅn Na"
          },
          {
            "id": "100081774991139",
            "name": "Hu·ª≥nh Trung ƒê·ª©c"
          },
          {
            "id": "100081955574668",
            "name": "Th·∫£o B√π Sab"
          },
          {
            "id": "100082844631646",
            "name": "Mo Hoang"
          },
          {
            "id": "100082951224158",
            "name": "B√πi M·ªπ H·∫°nh"
          },
          {
            "id": "100082966943729",
            "name": "L√¢m B√≠ch Tuy·ªÅn"
          },
          {
            "id": "100083062064527",
            "name": "Tr·∫ßn Kh√°nh H·∫°"
          },
          {
            "id": "100083671045351",
            "name": "Hung Bui"
          },
          {
            "id": "100083821880689",
            "name": "Li√™m Th·∫£o"
          },
          {
            "id": "100083933202691",
            "name": "Phan Phan V≈©"
          },
          {
            "id": "100084120432429",
            "name": "Tr·∫ßn Quang Minh"
          },
          {
            "id": "100084163334065",
            "name": "Nguy·ªÖn Ph∆∞∆°ng Nam"
          },
          {
            "id": "100084168911187",
            "name": "Nguy·ªÖn Phi Long"
          },
          {
            "id": "100084280748476",
            "name": "H·ªì Xu√¢n Ti√™n"
          },
          {
            "id": "100084396496279",
            "name": "L√™ Qu·ªëc Ch∆°n"
          },
          {
            "id": "100085008549707",
            "name": "Qu√°ch Di·ªáu Linh"
          },
          {
            "id": "100085712091260",
            "name": "Ly Kiet"
          },
          {
            "id": "100085914378695",
            "name": "Nguy·ªÖn H·ªìng H·∫£i"
          },
          {
            "id": "100085951737392",
            "name": "Nguy·ªÖn Quang Vi√™n"
          },
          {
            "id": "100086275263199",
            "name": "ƒê·∫∑ng ƒê·ªÅ"
          },
          {
            "id": "100086352774017",
            "name": "Nguy·ªÖn B·∫£o Ng·ªçc"
          },
          {
            "id": "100087102586087",
            "name": "Nguy·ªÖn Kh·∫Øc H·∫£i"
          },
          {
            "id": "100087645018791",
            "name": "L∆∞u Ly Nguy·ªÖn"
          },
          {
            "id": "100088065800439",
            "name": "Lclc Mai Hoang"
          },
          {
            "id": "100088319020681",
            "name": "Mer Malate"
          },
          {
            "id": "100088442995929",
            "name": "Ng√¥ VƒÉn T√†i"
          },
          {
            "id": "100088653865647",
            "name": "Ph·∫°m Thu Hi√™n"
          },
          {
            "id": "100088820324939",
            "name": "ƒê·ªó T·ªë Uy√™n"
          },
          {
            "id": "100089027143175",
            "name": "Hu·ª≥nh Th·∫£o"
          },
          {
            "id": "100089049978165",
            "name": "Phan Di·ªáu Th·∫£o"
          },
          {
            "id": "100089120417250",
            "name": "ƒê·ªó Thu Ph∆∞∆°ng"
          },
          {
            "id": "100089417413352",
            "name": "Nguy·ªÖn Lu·∫≠t"
          },
          {
            "id": "100089649075119",
            "name": "Nguy·ªÖn Tu·∫•n L·ªôc"
          },
          {
            "id": "100089832851412",
            "name": "H∆∞∆°ng L√™"
          },
          {
            "id": "100090085357128",
            "name": "ƒêinh VƒÉn Hi·∫øn"
          },
          {
            "id": "100090241781437",
            "name": "B√πi Ng·ªçc Tr√¢n"
          },
          {
            "id": "100090303896046",
            "name": "ƒê√¨nh H·ªØu"
          },
          {
            "id": "100090614678217",
            "name": "Duy NG"
          },
          {
            "id": "100090678280373",
            "name": "Nguy·ªÖn Ng·ªçc B√≠ch"
          },
          {
            "id": "100090779798919",
            "name": "Jonel Sabay Ilustresimo"
          },
          {
            "id": "100090913833818",
            "name": "Hu·ª≥nh Ng·ªçc H·∫£i"
          },
          {
            "id": "100091399080812",
            "name": "B√πi ƒê·ª©c Vi·ªát"
          },
          {
            "id": "100091552787383",
            "name": "Ng·ªçc Lan"
          },
          {
            "id": "100091835664338",
            "name": "ƒê·∫∑ng Ng·ªçc Hi·ªáu"
          },
          {
            "id": "100092372214965",
            "name": "Trung V≈©"
          },
          {
            "id": "100092597356876",
            "name": "V≈© Th·∫£o V√¢n"
          },
          {
            "id": "100092965899049",
            "name": "Khantavan Vixaisak"
          },
          {
            "id": "100093194018066",
            "name": "Nguy·ªÖn B√° ƒê·ªìng"
          },
          {
            "id": "100093227391507",
            "name": "Cuki Male"
          },
          {
            "id": "100093950400415",
            "name": "Ho√†ng Nam"
          },
          {
            "id": "100094132527257",
            "name": "L√™ Th·ªã L∆∞∆°ng"
          },
          {
            "id": "100094226885826",
            "name": "Thi√™n √Çn T·∫°p Ho√°"
          },
          {
            "id": "100094749792539",
            "name": "Ph·∫°m H∆∞∆°ng Th·∫£o"
          },
          {
            "id": "100094786226589",
            "name": "L√™ T∆∞·ªùng Vy"
          },
          {
            "id": "100094996895373",
            "name": "Ng√¥ Quang To√†n"
          },
          {
            "id": "100095185767836",
            "name": "Nguy·ªÖn Tuan Tuan"
          },
          {
            "id": "100095202421179",
            "name": "Lani ƒê·ªó"
          },
          {
            "id": "100095443894318",
            "name": "Ph·∫°m C√¥ng Huy"
          }
        ],
        "comments": [
          {
            "id": "100008502215600",
            "name": "Toan Phung",
            "text": "Ib",
            "created_time_vn": "2025-12-13 01:36:31"
          },
          {
            "id": "100008502215600",
            "name": "Toan Phung",
            "text": "Chuy√™n vi√™n qu·∫£n l√Ω KD",
            "created_time_vn": "2025-12-13 01:36:54"
          },
          {
            "id": "100000391379114",
            "name": "ƒêƒÉng Quang",
            "text": "Thanh Nho ch√∫ l√†m h√†nh ch√≠nh dc",
            "created_time_vn": "2025-12-15 13:35:42"
          },
          {
            "id": "100009156433293",
            "name": "Ng·ªçc Linh",
            "text": "Th∆∞ Th·ªè",
            "created_time_vn": "2025-12-15 10:18:37"
          },
          {
            "id": "100000292595738",
            "name": "Linh Ph·∫°m",
            "text": "Ph·∫°m Kh√°nh Linhnh",
            "created_time_vn": "2025-12-13 20:02:47"
          },
          {
            "id": "100005379331337",
            "name": "Ha Le",
            "text": "L∆∞u L∆∞u Th√πy",
            "created_time_vn": "2025-12-14 23:03:57"
          },
          {
            "id": "100021760787632",
            "name": "N√™n Ph·∫°m",
            "text": "C·∫ßn t·ªëi thi·ªÉu b·∫±ng c·∫•p j ·∫°.",
            "created_time_vn": "2025-12-18 06:15:38"
          },
          {
            "id": "100038140512546",
            "name": "Tr·∫ßn H√† Huy·ªÅn",
            "text": "·ªû ƒë√¢u",
            "created_time_vn": "2025-12-11 23:14:34"
          },
          {
            "id": "100013436617586",
            "name": "Nhung Cao",
            "text": "Kim Anh Nguyen",
            "created_time_vn": "2025-12-11 21:03:07"
          },
          {
            "id": "61576606707704",
            "name": "Ph·∫°m H·ªØu To√†n",
            "text": "Ph·∫°m Th·ªã Ng·ªçc B·ªôi",
            "created_time_vn": "2025-12-05 22:25:30"
          },
          {
            "id": "100036154251433",
            "name": "Ph·∫°m Ti·∫øn",
            "text": "Ph·∫°m Tr√†",
            "created_time_vn": "2025-12-14 21:15:08"
          },
          {
            "id": "100090804673944",
            "name": "Ph·∫ø Gi·∫•y B√¨a",
            "text": "C√≥ ·ªü h√† huy t·∫≠p gia l√¢m hn ko b",
            "created_time_vn": "2025-12-16 22:13:58"
          },
          {
            "id": "61572424185468",
            "name": "Nguy·ªÖn ƒê·ª©c Tr·ªçng",
            "text": "Inbox",
            "created_time_vn": "2025-12-15 04:08:16"
          },
          {
            "id": "100005916301142",
            "name": "Tai Dao",
            "text": "B√™n m√¨nh c√≥ tuy·ªÉn tham m∆∞u ko em ƒëƒÉng k√Ω su·∫•t",
            "created_time_vn": "2025-12-17 14:27:32"
          },
          {
            "id": "100015011417443",
            "name": "Hoa V≈©",
            "text": "V·ª´a ra tr∆∞·ªùng c√≥ tuy·ªÉn nh√¢n vi√™n kinh doanh kh√¥ng ·∫°",
            "created_time_vn": "2025-12-08 11:31:04"
          },
          {
            "id": "100005138494838",
            "name": "Nguy·ªÖn Anh Tu·∫•n",
            "text": "Inbox",
            "created_time_vn": "2025-12-12 16:30:53"
          },
          {
            "id": "100006534735398",
            "name": "ƒê·∫•t Vi·ªát",
            "text": "C√≥ tuy·ªÉn th·ª£ c∆° kh√≠ kh√¥ng ·∫°",
            "created_time_vn": "2025-12-16 11:42:23"
          },
          {
            "id": "61583260407273",
            "name": "Pco Vi·ªát Nam",
            "text": "Ph·∫°m Hi√™n",
            "created_time_vn": "2025-12-13 06:21:42"
          }
        ],
        "reactions_count": 564,
        "comments_count": 18,
        "reactions_count_before_filter": 564,
        "comments_count_before_filter": 18,
        "status": "success"
      },
      {
        "post_id": "4432161690347913",
        "flag": "v√†ng",
        "text": "[H√† ƒê√¥ng, HN] TUY·ªÇN V·∫¨N H√ÄNH S√ÄN TMƒêT L∆Ø∆†NG 6M - 12M !! KH√îNG YC KINH NGHI·ªÜM",
        "owning_profile": {
          "__typename": "User",
          "name": "Nguy·ªÖn H√† Thu",
          "id": "100007869585114"
        },
        "source_file": "b77da63d-af55-43c2-ab7f-364250b20e30.json",
        "profile_id": "b77da63d-af55-43c2-ab7f-364250b20e30",
        "reactions": [
          {
            "id": "100044138143352",
            "name": "Kh√°nh Ph∆∞∆°ng"
          },
          {
            "id": "100032767399249",
            "name": "H·∫±ng Nguy·ªÖn"
          }
        ],
        "comments": [],
        "reactions_count": 2,
        "comments_count": 0,
        "reactions_count_before_filter": 2,
        "comments_count_before_filter": 0,
        "status": "success"
      },
      {
        "post_id": "122171583440394422",
        "flag": "xanh",
        "text": "‚ú® NHA KHOA META TUY·ªÇN D·ª§NG ‚ú® V·ªã tr√≠: B√°c sƒ© RƒÉng S·ª© Th·∫©m M·ªπ Ch√∫ng t√¥i t√¨m ki·∫øm b√°c sƒ© c√≥ ƒë·ªãnh h∆∞·ªõng ph√°t tri·ªÉn l√¢u d√†i trong lƒ©nh v·ª±c rƒÉng s·ª© th·∫©m m·ªπ, mong mu·ªën l√†m vi·ªác trong m√¥i tr∆∞·ªùng chu·∫©n ch·ªânh, t√¥n tr·ªçng chuy√™n m√¥n v√† gi√° tr·ªã c√° nh√¢n. üí∞ Thu nh·∫≠p: Th·ªèa thu·∫≠n theo nƒÉng l·ª±c (L∆∞∆°ng c·ª©ng + KPI + Th∆∞·ªüng + Ph·ª• c·∫•p) üîπ H·ªá th·ªëng m√°y m√≥c hi·ªán ƒë·∫°i üîπ Ngu·ªìn kh√°ch ·ªïn ƒë·ªãnh üîπ Ekip h·ªó tr·ª£ chuy√™n m√¥n üîπ Quy tr√¨nh r√µ r√†ng ‚Äì minh b·∫°ch üìç ƒê·ªãa ch·ªâ: 391 Tr∆∞·ªùng Chinh, Thanh Xu√¢n, H√† N·ªôi üì≤ Li√™n h·ªá ·ª©ng tuy·ªÉn: 036.903.6666",
        "owning_profile": {
          "__typename": "User",
          "name": "Tuy·ªÉn D·ª•ng Nh√¢n S·ª± Nha Khoa H√† N·ªôi",
          "id": "61561832674763"
        },
        "source_file": "b77da63d-af55-43c2-ab7f-364250b20e30.json",
        "profile_id": "b77da63d-af55-43c2-ab7f-364250b20e30",
        "reactions": [],
        "comments": [],
        "reactions_count": 0,
        "comments_count": 0,
        "reactions_count_before_filter": 0,
        "comments_count_before_filter": 0,
        "status": "success"
      },
      {
        "post_id": "24955032474094131",
        "flag": "v√†ng",
        "text": "[BSV] Tuy·ªÉn d·ª•ng NV cho T·∫≠p ƒêo√†n VIETTEL: - NV VƒÇN PH√íNG l√†m gi·ªù h√†nh ch√≠nh üí∞ Thu nh·∫≠p 8-15tr. Ch∆∞a t√≠nh l∆∞∆°ng th∆∞·ªüng - L√†m t·∫°i tr·ª• s·ªü VIETTEL HCM - ƒê·ªãa ch·ªâ l√†m vi·ªác: 158/2A Ho√†ng Hoa Th√°m, ph∆∞·ªùng 12, Q.T√¢n B√¨nh üëâ kh√¥ng y√™u c·∫ßu kinh nghi·ªám üëâ Ch·∫ø ƒë·ªô ph√∫c l·ª£i t·ªët ‚úÖ Ch·∫•m ƒë·ªÉ nh·∫≠n JD Th√¥ng tin contact: ‚ú´ Li√™n h·ªá b·ªô ph·∫≠n tuy·ªÉn d·ª•ng : 0922312726 Mr Nhi·ªám ‚ú´ Email: truonghuunhiem@bs24vietnam.vn",
        "owning_profile": {
          "__typename": "User",
          "name": "Gia Minh",
          "id": "61568481862081"
        },
        "source_file": "b77da63d-af55-43c2-ab7f-364250b20e30.json",
        "profile_id": "b77da63d-af55-43c2-ab7f-364250b20e30",
        "reactions": [
          {
            "id": "100044138143352",
            "name": "Kh√°nh Ph∆∞∆°ng"
          },
          {
            "id": "61555926982278",
            "name": "Vi·ªác L√†m Ph√∫ M·ªπ"
          },
          {
            "id": "61556361794883",
            "name": "Ng√¥ H√†"
          },
          {
            "id": "61557564590049",
            "name": "Tr·∫ßn Qu·ªëc T√∫"
          },
          {
            "id": "61558261029036",
            "name": "Pun Meo"
          },
          {
            "id": "61561883510251",
            "name": "Channie Quinh"
          },
          {
            "id": "61563309960672",
            "name": "ƒê·∫∑ng H·∫£i Long"
          },
          {
            "id": "61564917926512",
            "name": "L.A Club Bida & Coffee Chill"
          },
          {
            "id": "61565563724536",
            "name": "Nguy·ªÖn Ch√¢u"
          },
          {
            "id": "61572284594958",
            "name": "Sunny Nguy·ªÖn"
          },
          {
            "id": "61573721417341",
            "name": "Nguy·ªÖn B√° Gia"
          },
          {
            "id": "61574207106597",
            "name": "Tr·∫ßn Linhh"
          },
          {
            "id": "61576229670272",
            "name": "Linh Hoang"
          },
          {
            "id": "61577279735800",
            "name": "Qu·ª≥nh Anh Hr"
          },
          {
            "id": "61580336013397",
            "name": "Tuy·ªÉn d·ª•ng Hoa Sen"
          },
          {
            "id": "61581536426647",
            "name": "Nguy·ªÖn Ph·ª•ng"
          },
          {
            "id": "61582805619015",
            "name": "Tuy·ªÉn D·ª•ng ACC GROUP"
          },
          {
            "id": "61583305625966",
            "name": "Thanh Th·∫£o"
          },
          {
            "id": "61583764201891",
            "name": "Tr∆∞∆°ng Tr∆∞∆°ng"
          },
          {
            "id": "61584608215620",
            "name": "Th·∫£o Th·∫£o"
          },
          {
            "id": "100001457361807",
            "name": "B√¨nh Nguy·ªÖn"
          },
          {
            "id": "100002952513568",
            "name": "Hung Nguyen Van"
          },
          {
            "id": "100004481532439",
            "name": "T√¢m Nguy·ªÖn"
          },
          {
            "id": "100004482543910",
            "name": "Th√πy Duy√™n"
          },
          {
            "id": "100005340428521",
            "name": "ƒê√†o Kim Dung"
          },
          {
            "id": "100005469367692",
            "name": "H·∫£i Tr·∫ßn"
          },
          {
            "id": "100005516567580",
            "name": "Nguy·ªÖn Song H·∫£i My"
          },
          {
            "id": "100005955429677",
            "name": "ƒê√†o C·∫©m T√∫"
          },
          {
            "id": "100006028202461",
            "name": "Nguy·ªÖn Quang ƒêƒÉng"
          },
          {
            "id": "100006251405539",
            "name": "√Åi Th·∫£o"
          },
          {
            "id": "100006269208618",
            "name": "Ng·ªçc Ji"
          },
          {
            "id": "100006289146409",
            "name": "L√™ Th·ªã Ng·ªçc Tuy·∫øt"
          },
          {
            "id": "100006726301264",
            "name": "H·ªØu Vinh"
          },
          {
            "id": "100006842225833",
            "name": "Nguy·ªÖn C√¥ng Tu·∫•n"
          },
          {
            "id": "100007223975129",
            "name": "Ho√†ng Ng·ªçc V√¢n"
          },
          {
            "id": "100008214033618",
            "name": "Ph∆∞∆°ngg Thu·ª≥y"
          },
          {
            "id": "100008470120812",
            "name": "Hen Lai Sau"
          },
          {
            "id": "100008819281046",
            "name": "T∆∞·ªùng Vi"
          },
          {
            "id": "100010908542354",
            "name": "Tr∆∞∆°ng Y·∫øn Ng·ªçc"
          },
          {
            "id": "100011164030217",
            "name": "Phan H·∫±ng"
          },
          {
            "id": "100011299489100",
            "name": "Nh√£ H√†n"
          },
          {
            "id": "100011388368250",
            "name": "Ng·ªç Nguy·ªÖn"
          },
          {
            "id": "100011467005548",
            "name": "Mai L√™ Thu√Ω Anh"
          },
          {
            "id": "100011626330258",
            "name": "Chini Yang"
          },
          {
            "id": "100012223865593",
            "name": "B√πi Phi Khanh"
          },
          {
            "id": "100012229563696",
            "name": "Huy Nguy·ªÖn"
          },
          {
            "id": "100013120636790",
            "name": "Nguy·ªÖn H·∫≠u"
          },
          {
            "id": "100013203721316",
            "name": "Thu Ho√†i"
          },
          {
            "id": "100013824304893",
            "name": "V√¢n Trinh"
          },
          {
            "id": "100013891117509",
            "name": "Nguy·ªÖn Tu·∫•n Thanh T√πng"
          },
          {
            "id": "100014181169457",
            "name": "Anh Thi"
          },
          {
            "id": "100014186708092",
            "name": "Thanh Ph√°t"
          },
          {
            "id": "100014468773048",
            "name": "Ngoc Ngoc"
          },
          {
            "id": "100015023324224",
            "name": "Th·∫£o Vy"
          },
          {
            "id": "100021958921727",
            "name": "Nguy·ªÖn Th∆°m"
          },
          {
            "id": "100022909296508",
            "name": "Thu Ho√†i"
          },
          {
            "id": "100023342140984",
            "name": "Ng√¥ Th·ªã Thanh Th·ªßy"
          },
          {
            "id": "100025315715732",
            "name": "Dang Hai Hoang"
          },
          {
            "id": "100026564893365",
            "name": "Tr·∫ßn Th·ªã Ch√¢u Giang"
          },
          {
            "id": "100029755934272",
            "name": "Nguy·ªÖn Y·∫øn Nhi"
          },
          {
            "id": "100034383453231",
            "name": "Thanh Mai"
          },
          {
            "id": "100035525660779",
            "name": "Tr·∫ßn Ch∆∞∆°ng"
          },
          {
            "id": "100038020578188",
            "name": "Pii An"
          },
          {
            "id": "100039707792352",
            "name": "H√† Thanh M·ªπ Tr·∫ßn"
          },
          {
            "id": "100055043149966",
            "name": "Ti·∫øn V√µ"
          },
          {
            "id": "100056627937098",
            "name": "Minh Uy√™n"
          },
          {
            "id": "100056634771689",
            "name": "Hu·ª≥nh Quy√™n"
          },
          {
            "id": "100057082697388",
            "name": "Qu·ª≥nh Qu·ª≥nh"
          },
          {
            "id": "100060628333297",
            "name": "Nh·∫•t Long"
          },
          {
            "id": "100063156952990",
            "name": "John Cris"
          },
          {
            "id": "100068553722908",
            "name": "Ngoc Anh"
          },
          {
            "id": "100070362357401",
            "name": "Mai Ph∆∞∆°ng"
          },
          {
            "id": "100073323880572",
            "name": "Qu·ª≥nh Nh∆∞"
          },
          {
            "id": "100078738384859",
            "name": "Ho√†ng Nam"
          },
          {
            "id": "100079433324177",
            "name": "Vu Hai Anh"
          },
          {
            "id": "100082436944869",
            "name": "V√µ Th√†nh L·∫≠p"
          },
          {
            "id": "100083490734727",
            "name": "Nguy·ªÖn Nhi"
          },
          {
            "id": "100086954269137",
            "name": "Ngoc Khanh"
          },
          {
            "id": "100088595622359",
            "name": "B√∫n B√∫n"
          },
          {
            "id": "100094453605425",
            "name": "Minh Thu"
          },
          {
            "id": "100095678641731",
            "name": "Thanh Th·∫£o"
          }
        ],
        "comments": [],
        "reactions_count": 81,
        "comments_count": 0,
        "reactions_count_before_filter": 81,
        "comments_count_before_filter": 0,
        "status": "success"
      },
      {
        "post_id": "2198533247305479",
        "flag": "v√†ng",
        "text": "V·ªã tr√≠ tuy·ªÉn d·ª•ng: L√†m vi·ªác 8 ti·∫øng ü•∞ ‚Ä¢Nh√¢n vi√™n than Full : 8.500.000vnd ( Tuy·ªÉn nh√¢n vi√™n l√†m vi·ªác l√¢u d√†i ) ‚Ä¢Nh√¢n vi√™n L·ªÖ t√¢n Full ca g√£y ho·∫∑c chuy√™n ca 12h~20h30 . L∆∞∆°ng tho·∫£ thu·∫≠n ‚Ä¢Nh√¢n vi√™n ph·ª•c v·ª•: Nh√¢n vi√™n fulltime Nh√† h√†ng H√†n Qu·ªëc Ca g√£y 10h-14h/17h-22h ho·∫∑c 9h-14h/17h-21h ( ngh·ªâ tr∆∞a 3 ti·∫øng ) ho·∫∑c Ca part xoay ca linh ƒë·ªông 10h-14h v√† 18h - 22h. Ho·∫∑c part 12h-16h30 v√† 13h - 17h30. - Ch·∫ø ƒë·ªô, quy·ªÅn l·ª£i: L∆∞∆°ng c∆° b·∫£n + ƒÉn ca 2 b·ªØa + h·ªó tr·ª£ ti·ªÅn ƒëi l·∫°i + 100% TI·ªÄN TIP. L√†m 26ng√†y/th√°ng - ƒê·ªëi v·ªõi nh√¢n vi√™n full sau 6 th√°ng h∆∞·ªüng ph√©p nƒÉm, v√† ƒë·ªëi v·ªõi t·∫•t c·∫£ nh√¢n vi√™n ng√†y L·ªÖ T·∫øt x 400% l∆∞∆°ng + th∆∞·ªüng . Thu nh·∫≠p t·ª´ 6-10tr ‚Ä¢M√¥i tr∆∞·ªùng tr·∫ª trung, th√¢n thi·ªán, ƒë·ªìng nghi·ªáp d·ªÖ th∆∞∆°ng ‚Ä¢C∆° h·ªôi h·ªçc h·ªèi k·ªπ nƒÉng giao ti·∫øp, ph·ª•c v·ª• chuy√™n nghi·ªáp Y√™u c·∫ßu: ‚Ä¢Kh√¥ng y√™u c·∫ßu kinh nghi·ªám (s·∫Ω ƒë∆∞·ª£c ƒë√†o t·∫°o) ‚Ä¢Nhanh nh·∫πn, chƒÉm ch·ªâ, c√≥ tinh th·∫ßn tr√°ch nhi·ªám ‚Ä¢Th√°i ƒë·ªô vui v·∫ª, l·ªãch s·ª± v·ªõi kh√°ch h√†ng üìç ƒê·ªãa ch·ªâ: Nh√† h√†ng GOJUMONG CASUAL t·∫ßng 6 Lotte Li·ªÖu Giai üìû Li√™n h·ªá tr·ª±c ti·∫øp ho·∫∑c zalo: Qu·∫£n l√Ω Mrs Trang: 0987.469.405",
        "owning_profile": {
          "__typename": "User",
          "name": "Trang L√™",
          "id": "100006577548369"
        },
        "source_file": "b77da63d-af55-43c2-ab7f-364250b20e30.json",
        "profile_id": "b77da63d-af55-43c2-ab7f-364250b20e30",
        "reactions": [
          {
            "id": "100044138143352",
            "name": "Kh√°nh Ph∆∞∆°ng"
          },
          {
            "id": "61563280557067",
            "name": "Nguy·ªÖn H√πng C∆∞·ªùng"
          },
          {
            "id": "61574450648872",
            "name": "Thu√Ω H√†"
          },
          {
            "id": "61576353419525",
            "name": "Ho√†ng Qu·ªëc Vi·ªát"
          },
          {
            "id": "61582825323894",
            "name": "Ng·ªçc Linh - Nem N∆∞·ªõng Nha Trang "
          },
          {
            "id": "100003640788400",
            "name": "Hai Dang"
          },
          {
            "id": "100005960256358",
            "name": "V≈© Th·ªã B√≠ch L·ªá"
          },
          {
            "id": "100009222477267",
            "name": "Ph·∫°m Vi·ªát Anh"
          },
          {
            "id": "100015201542172",
            "name": "Nguy·ªÖn Loan"
          },
          {
            "id": "100025139152808",
            "name": "Tuoi Bui"
          },
          {
            "id": "100027238878170",
            "name": "C·∫©m T√∫"
          },
          {
            "id": "100029778233874",
            "name": "H·∫±ng Ni"
          },
          {
            "id": "100042693051495",
            "name": "Nguy·ªÖn Trang"
          },
          {
            "id": "100046940032349",
            "name": "L∆∞∆°ng √Ånh"
          },
          {
            "id": "100048126162429",
            "name": "Kim Ph·ª•ng"
          },
          {
            "id": "100049220042731",
            "name": "B√¨nh D∆∞∆°ng L√™"
          }
        ],
        "comments": [
          {
            "id": "100023363242962",
            "name": "Tin Tin",
            "text": "Trang L√™ c√≥ tuy·ªÉn nh√¢n vi√™n b·∫øp kh√¥ng ·∫°",
            "created_time_vn": "2025-11-22 17:30:19"
          },
          {
            "id": "100028298443377",
            "name": "B√πi Linh",
            "text": "üì£ NH√Ä H√ÄNG UMAI OMAKASE D·ª§NG ‚Äì PH·ª§C V·ª§ N·ªÆ\n\n‚ú® V·ªã tr√≠: Nh√¢n vi√™n ph·ª•c v·ª• n·ªØ\n‚è∞ Th·ªùi gian: Fulltime 10h -14h, 17h - 22h\n\nY√™u c·∫ßu:\n ‚Ä¢ Ngo·∫°i h√¨nh ∆∞a nh√¨n, nhanh nh·∫πn\n ‚Ä¢ Si√™ng nƒÉng, ch·ªãu kh√≥, h·ªó tr·ª£ ƒë·ªìng ƒë·ªôi t·ªët\n ‚Ä¢ Kh√¥ng c·∫ßn kinh nghi·ªám (s·∫Ω ƒë∆∞·ª£c ƒë√†o t·∫°o)\n\nQuy·ªÅn l·ª£i:\n ‚Ä¢ L∆∞∆°ng 8tr ( 28 c√¥ng ) + th∆∞·ªüng theo nƒÉng l·ª±c\n ‚Ä¢ M√¥i tr∆∞·ªùng l√†m vi·ªác chuy√™n nghi·ªáp, th√¢n thi·ªán\n ‚Ä¢ Tip m·ªói ng√†y\n\nüìç ƒê·ªäA ƒêI·ªÇM L√ÄM VI·ªÜC: Nh√† h√†ng UMAI OMAKASE 11 M·∫°c Th√°i T√¥ng, C·∫ßu Gi·∫•y, H√† N·ªôi\nüìû LI√äN H·ªÜ ·ª®NG TUY·ªÇN: Mr Linh Sƒët: 0949213939",
            "created_time_vn": "2025-12-06 17:02:45"
          },
          {
            "id": "100013761460826",
            "name": "H∆∞∆°ng Ly",
            "text": "üì¢NH√Ä H√ÄNG ONGI JIAJANG ‚Äì QU√ÅN M·ª≤ T∆Ø∆†NG ƒêEN H√ÄN QU·ªêC TUY·ªÇN D·ª§NG G·∫§P\nüìç ƒê·ªãa ch·ªâ l√†m vi·ªác: 230 Nguy·ªÖn VƒÉn Tuy·∫øt, ƒê·ªëng ƒêa, H√† N·ªôi \nüìçGi·ªù l√†m: 10h-13h30 v√† 16h30-22h\nHi·ªán t·∫°i nh√† h√†ng ƒëang c·∫ßn b·ªï sung nh√¢n s·ª± cho c√°c v·ªã tr√≠ sau:\n1Ô∏è‚É£ Qu·∫£n l√Ω\n2Ô∏è‚É£ Ph·ª• b·∫øp (BAO ƒÇN ·ªû)\n3Ô∏è‚É£ Nh√¢n vi√™n ph·ª•c v·ª• (Part-time/Full-time) (BAO ƒÇN CA)\nüì± ·ª©ng tuy·ªÉn Zl: 0877 213 681 (H∆∞∆°ng Ly)",
            "created_time_vn": "2025-11-20 09:49:55"
          },
          {
            "id": "100020526768178",
            "name": "C·∫©m T√∫",
            "text": "TUY·ªÇN D·ª§NG T·∫†I NH√Ä H√ÄNG BBQ ONG MAP Q2‚ú®\nS·ªë l∆∞·ª£ng tuy·ªÉn d·ª•ng:\nü§µüèª V·ªã tr√≠ nh√¢n vi√™n ph·ª•c v·ª• full time v√† part time\n‚≠ê Kh√¥ng y√™u c·∫ßu kinh nghi·ªám, s·∫Ω ƒë∆∞·ª£c ƒë√†o t·∫°o \n‚≠ê ∆Øu ti√™n nh·ªØng b·∫°n c√≥ th·ªÉ giao ti·∫øp ti·∫øng h√†n, nhanh nh·∫πn, chƒÉm ch·ªâ, t√≠nh c√°ch vui v·∫ª, ho√† ƒë·ªìng\n\n* Full time\n‚≠ê L∆∞∆°ng: 9.000.000 - 14.000.000 \n‚≠êÔ∏è Th·ªùi gian l√†m vi·ªác: 12h -10h v√† 15h - 1h \n‚≠ê Bonus t·ª´ 2.000.000/ th√°ng\n\n* Part time\n‚≠ê L∆∞∆°ng 33k/h - 36k/h + bonus cao\n‚≠êÔ∏è Th·ªùi gian l√†m vi·ªác: 11h - 15h, 18h- 23h v√† 18h - 1h \n\nüè† ƒê·ªäA ƒêI·ªÇM L√ÄM VI·ªÜC:\n45 Song H√†nh, An Ph√∫, Q2\nBBQ √îNG M·∫¨P Qu·∫≠n 2\n38 Tr·∫ßn Ng·ªçc Di·ªán, Th·∫£o ƒêi·ªÅn, Q2\nBBQ √îng M·∫≠p Th·∫£o ƒêi·ªÅn Îö±Î≥¥Ïßë ÌÉÄÏò§ÎîîÏóî\n\nüí¨Li√™n h·ªá: 0909886320- Th∆∞",
            "created_time_vn": "2025-12-01 13:54:32"
          },
          {
            "id": "100082569921800",
            "name": "Minh Huy·ªÅn",
            "text": "Trung t√¢m Anh ng·ªØ EFIS English (Ch√πa L√°ng) hi·ªán ƒëang tuy·ªÉn:\n‚Ä¢ Gi·∫£ng vi√™n Ti·∫øng Anh giao ti·∫øp\n‚Ä¢ Chuy√™n vi√™n T∆∞ v·∫•n\n‚Ä¢ Marketing SEO\n‚Ä¢ Event ‚Äì Social\n\nB·∫°n n√†o quan t√¢m comment ho·∫∑c inbox m√¨nh g·ª≠i JD chi ti·∫øt nh√© üå±",
            "created_time_vn": "2025-12-22 09:05:44"
          }
        ],
        "reactions_count": 16,
        "comments_count": 5,
        "reactions_count_before_filter": 16,
        "comments_count_before_filter": 7,
        "status": "success"
      },
      {
        "post_id": "122152945058694563",
        "flag": "xanh",
        "text": "üéâ üå∏ ‚ÄúT·∫øt ƒë·∫øn xu√¢n v·ªÅ ‚Äì t√¨m vi·ªác ƒë√¢u xa, Vingroup ch√†o ƒë√≥n ‚Äì m·ªü l·ªëi thƒÉng hoa!‚Äù üå∏ üéâ üè¢ VINGROUP ‚Äì TUY·ªÇN D·ª§NG KH·ªêI VƒÇN PH√íNG TO√ÄN QU·ªêC üáªüá≥ üáªüá≥ B·∫°n ƒëang t√¨m ki·∫øm m·ªôt m√¥i tr∆∞·ªùng ·ªïn ƒë·ªãnh ‚Äì chuy√™n nghi·ªáp ‚Äì c√≥ l·ªô tr√¨nh thƒÉng ti·∫øn r√µ r√†ng? üáªüá≥ Vingroup ‚Äì T·∫≠p ƒëo√†n kinh t·∫ø t∆∞ nh√¢n h√†ng ƒë·∫ßu Vi·ªát Nam ‚Äì ƒëang m·ªü r·ªông ƒë·ªôi ng≈© vƒÉn ph√≤ng tr√™n to√†n qu·ªëc, s·∫µn s√†ng ƒë·ªìng h√†nh c√πng b·∫°n b∆∞·ªõc v√†o nƒÉm m·ªõi v·ªõi nhi·ªÅu c∆° h·ªôi ph√°t tri·ªÉn ƒë·ªôt ph√°. üí¢ V·ªä TR√ç ƒêANG TUY·ªÇN üîñ Nh√¢n Vi√™n K·∫ø To√°n üîñ Chuy√™n Vi√™n Qu·∫£n L√Ω Kinh Doanh üîñ Nh√¢n Vi√™n T∆∞ V·∫•n ChƒÉm S√≥c Kh√°ch H√†ng üîñ Tr∆∞·ªüng Ph√≤ng Xu·∫•t Nh·∫≠p Kh·∫©u üîñ Tr∆∞·ªüng Ph√≤ng Ti·∫øp Th·ªã Th∆∞∆°ng M·∫°i üîñ Tr∆∞·ªüng Ph√≤ng H√†nh Ch√≠nh Nh√¢n S·ª± üìç L√†m vi·ªác t·∫°i c√°c vƒÉn ph√≤ng ƒë·∫°i di·ªán tr√™n to√†n qu·ªëc üéØ T·∫†I SAO B·∫†N N√äN ·ª®NG TUY·ªÇN NGAY? ‚ñ™Ô∏è Thu nh·∫≠p h·∫•p d·∫´n, th∆∞·ªüng T·∫øt r√µ r√†ng ‚ñ™Ô∏è B·∫£o hi·ªÉm ƒë·∫ßy ƒë·ªß, ph√∫c l·ª£i ·ªïn ƒë·ªãnh ‚ñ™Ô∏è C∆° h·ªôi ph√°t tri·ªÉn s·ª± nghi·ªáp, ƒë∆∞·ª£c ƒë√†o t·∫°o chuy√™n s√¢u ‚ñ™Ô∏è M√¥i tr∆∞·ªùng l√†m vi·ªác minh b·∫°ch, hi·ªán ƒë·∫°i, chuy√™n nghi·ªáp üì® N·ªôp h·ªì s∆° tr·ª±c tuy·∫øn t·∫°i: https://qrco.de/tuyendungVinGroup üëâ Tag ng∆∞·ªùi ph√π h·ª£p ho·∫∑c chia s·∫ª ngay c∆° h·ªôi tuy·ªát v·ªùi n√†y! üåü VINGROUP ‚Äì N∆°i t√†i nƒÉng ƒë∆∞·ª£c ph√°t huy v√† th√†nh c√¥ng ƒë∆∞·ª£c ghi nh·∫≠n. C√πng kh·ªüi ƒë·ªông nƒÉm m·ªõi v·ªõi b∆∞·ªõc ti·∫øn v·ªØng v√†ng trong s·ª± nghi·ªáp! #Vingroup #TuyenDungTet2025 #CoHoiNgheNghiep #ViecLamVanPhong #DonXuanVingroup",
        "owning_profile": {
          "__typename": "User",
          "name": "Tuy·ªÉn D·ª•ng VinGroup",
          "id": "61570836905496"
        },
        "source_file": "b77da63d-af55-43c2-ab7f-364250b20e30.json",
        "profile_id": "b77da63d-af55-43c2-ab7f-364250b20e30",
        "reactions": [
          {
            "id": "100044138143352",
            "name": "Kh√°nh Ph∆∞∆°ng"
          },
          {
            "id": "1002263592",
            "name": "Ran Kaori"
          },
          {
            "id": "1234976494",
            "name": "Ha Tran"
          },
          {
            "id": "1268544510",
            "name": "VƒÉn ƒê√¨nh L√¢m"
          },
          {
            "id": "1277446090",
            "name": "Nguy·ªÖn VƒÉn Tu·ªá"
          },
          {
            "id": "1485344389",
            "name": "Hong Hanh"
          },
          {
            "id": "1572664685",
            "name": "Vu Ngoc Lan"
          },
          {
            "id": "1790504763",
            "name": "Huong Nguyen"
          },
          {
            "id": "1830492804",
            "name": "Martin Ngo"
          },
          {
            "id": "61550123255824",
            "name": "Jenny Tr·∫ßn"
          },
          {
            "id": "61550963711871",
            "name": "ƒê√†o Quang Hu·∫•n"
          },
          {
            "id": "61551494556150",
            "name": "Nguy·ªÖn Th·ªã Duy·ªát"
          },
          {
            "id": "61551798632228",
            "name": "Tuan Anh"
          },
          {
            "id": "61552652491139",
            "name": "V√µ Ng·ªçc Huy√™n"
          },
          {
            "id": "61552709622705",
            "name": "Ho√†ng M·∫°nh"
          },
          {
            "id": "61553747960696",
            "name": "Long Gia"
          },
          {
            "id": "61553761829719",
            "name": "Nam Hoang"
          },
          {
            "id": "61555731806498",
            "name": "Minh ƒê·ª©c"
          },
          {
            "id": "61556120043116",
            "name": "Mai Tr·∫ßn Minh"
          },
          {
            "id": "61556452044279",
            "name": "Anh Long"
          },
          {
            "id": "61556795983288",
            "name": "Bass House"
          },
          {
            "id": "61557071407694",
            "name": "D∆∞∆°ng Thuy·∫øt"
          },
          {
            "id": "61557775749884",
            "name": "Nguy·ªÖn Th·ªã VƒÉn"
          },
          {
            "id": "61564149783940",
            "name": "Ng·ªçc H√†"
          },
          {
            "id": "61564578580794",
            "name": "Nguy·ªÖn Khanh"
          },
          {
            "id": "61567168498234",
            "name": "H·ªì Ph∆∞∆°ng"
          },
          {
            "id": "61569010118881",
            "name": "Elvis Ph∆∞∆°ng"
          },
          {
            "id": "61569180890275",
            "name": "Nguy·ªÖn Tr∆∞·ªùng"
          },
          {
            "id": "61569272138269",
            "name": "H√¢n S·∫ßu"
          },
          {
            "id": "61570253625383",
            "name": "ƒêinh H·ªìng Tu·ªá Hr"
          },
          {
            "id": "61571187577749",
            "name": "Dung Nguy·ªÖn"
          },
          {
            "id": "61571406964597",
            "name": "L√™ Anh H·∫£i"
          },
          {
            "id": "61571671900364",
            "name": "Nguy·ªÖn V∆∞∆°ng Nhi"
          },
          {
            "id": "61571840248551",
            "name": "Tr·∫ßn Di·ªáp Bƒës"
          },
          {
            "id": "61571848330448",
            "name": "H·ªì Ph∆∞∆°ng"
          },
          {
            "id": "61572490859745",
            "name": "To Lan Thinh"
          },
          {
            "id": "61572842294221",
            "name": "H√† Phan Thu"
          },
          {
            "id": "61573733657294",
            "name": "H·ªì M·ªôc Nh√¢n"
          },
          {
            "id": "61573734497403",
            "name": "Ph·∫°m Th√†nh An"
          },
          {
            "id": "61573744547227",
            "name": "Hu·ª≥nh Th·ª•y Ca"
          },
          {
            "id": "61573852654944",
            "name": "VƒÉn H·∫£i"
          },
          {
            "id": "61573988684453",
            "name": "V≈© Thu·ª≥ Dung"
          },
          {
            "id": "61574010964642",
            "name": "Hu·ª≥nh H·ªìng Qu√¢n"
          },
          {
            "id": "61574110798886",
            "name": "Phan Nh·∫≠t Mi"
          },
          {
            "id": "61574152886242",
            "name": "Phan Thu Nh√¢n"
          },
          {
            "id": "61574175593832",
            "name": "Ng√¥ Thi·ªán Di·ªáp"
          },
          {
            "id": "61574258109121",
            "name": "Kh·∫£i T·ªãnh"
          },
          {
            "id": "61574867364927",
            "name": "Nguy·ªÖn VƒÉn Tr·∫Øng"
          },
          {
            "id": "61574978456212",
            "name": "Bee Bee"
          },
          {
            "id": "61575737576229",
            "name": "T√¥n Long"
          },
          {
            "id": "61576253253121",
            "name": "Le Giap"
          },
          {
            "id": "61576570737659",
            "name": "Ph√°p Thi·ªán Yuuta"
          },
          {
            "id": "61577718142636",
            "name": "Nam Ho√†i L√™"
          },
          {
            "id": "61577831266701",
            "name": "Nh√† Ph·ªë Tr∆∞·ªùng Khang"
          },
          {
            "id": "61577891019065",
            "name": "ƒê·ªó Th·ªã T·ªë Tr√¢n"
          },
          {
            "id": "61577913800061",
            "name": "Phan Tien Thai"
          },
          {
            "id": "61577966011957",
            "name": "L√™ Th·ªã Y·∫øn Nhi"
          },
          {
            "id": "61577990310795",
            "name": "Nguy·ªÖn Th√†nh Luy·∫øn"
          },
          {
            "id": "61578060900327",
            "name": "H·ªì Th·ªã C·∫©m Giang"
          },
          {
            "id": "61578588352981",
            "name": "Anh Minh"
          },
          {
            "id": "61578920644052",
            "name": "H·∫£i Lu√¢n"
          },
          {
            "id": "61579609253307",
            "name": "L∆∞u Hi·ªÅn"
          },
          {
            "id": "61579616184503",
            "name": "D·∫´n Nguy·ªÖn"
          },
          {
            "id": "61579778518833",
            "name": "Vu Huong"
          },
          {
            "id": "61579924336884",
            "name": "Thai Pham"
          },
          {
            "id": "61580075301277",
            "name": "Nguy·ªÖn Th·ªã Kim Dung"
          },
          {
            "id": "61580091380494",
            "name": "Hu·ª≥nh Di·ªÖm"
          },
          {
            "id": "61580652643855",
            "name": "L√™ Quang Nha"
          },
          {
            "id": "61581145032703",
            "name": "Chan Dang Quay"
          },
          {
            "id": "61581397461144",
            "name": "Tran Phuc Gi·∫∑t L√†"
          },
          {
            "id": "61581418713978",
            "name": "Chi√™m Khang D∆∞∆°ng"
          },
          {
            "id": "61581689701972",
            "name": "Kh·ªïng B·∫£o Tu·∫•n"
          },
          {
            "id": "61582487331614",
            "name": "Nguy·ªÖn Khang Land"
          },
          {
            "id": "61582779520068",
            "name": "Thanh ƒêinh Xu√¢n"
          },
          {
            "id": "61582832777139",
            "name": "Tran Phat Ngan"
          },
          {
            "id": "61582869747879",
            "name": "Anh Nguyen"
          },
          {
            "id": "61583102734016",
            "name": "Mai Linh Son"
          },
          {
            "id": "61583218533495",
            "name": "Kh√°nh ƒê√†o"
          },
          {
            "id": "61583648552185",
            "name": "Anh Dung L√™"
          },
          {
            "id": "61584927061788",
            "name": "L√™ Kh√°nh"
          },
          {
            "id": "61585066443817",
            "name": "T√¢m Thi·ªán"
          },
          {
            "id": "100000033162372",
            "name": "L∆∞∆°ng Th√°i S∆°n"
          },
          {
            "id": "100000046953514",
            "name": "Nguyen Thuy Binh"
          },
          {
            "id": "100000074903034",
            "name": "Ngoc Long"
          },
          {
            "id": "100000100445450",
            "name": "Nguyen Xuan Hoang"
          },
          {
            "id": "100000110883929",
            "name": "Ha Thanh Chung"
          },
          {
            "id": "100000118488636",
            "name": "Anh Tuan Dang"
          },
          {
            "id": "100000146503895",
            "name": "Tuan Bui Duc"
          },
          {
            "id": "100000199586797",
            "name": "Ho√†ng H·ªìng"
          },
          {
            "id": "100000206390872",
            "name": "Ha Vo Ngoc"
          },
          {
            "id": "100000227057333",
            "name": "Le van Luu"
          },
          {
            "id": "100000233054222",
            "name": "Nguy·ªÖn ƒê·ª©c C√¥ng"
          },
          {
            "id": "100000233458095",
            "name": "ƒê·ª©c Anh"
          },
          {
            "id": "100000241421870",
            "name": "C∆∞·ªùng L√£ ƒêƒÉng"
          },
          {
            "id": "100000285841717",
            "name": "Trinh Vinh"
          },
          {
            "id": "100000299911498",
            "name": "Thanh B√¨nh"
          },
          {
            "id": "100000335930188",
            "name": "Tien Dang"
          },
          {
            "id": "100000359003842",
            "name": "ƒê√†o Th·ªã H∆∞∆°ng"
          },
          {
            "id": "100000372765424",
            "name": "Beverly Truong"
          },
          {
            "id": "100000391379114",
            "name": "ƒêƒÉng Quang"
          },
          {
            "id": "100000440642840",
            "name": "Yuki Nguyen"
          },
          {
            "id": "100000465101424",
            "name": "Pham Lien"
          },
          {
            "id": "100000471456601",
            "name": "Bon Bon"
          },
          {
            "id": "100000536634518",
            "name": "V≈© Van Th·ª•"
          },
          {
            "id": "100000574898744",
            "name": "L√™ Thu NƒÉm"
          },
          {
            "id": "100000627052981",
            "name": "Nguy·ªÖn Xu√¢n H√≤a"
          },
          {
            "id": "100000778527246",
            "name": "Nay Quy√™n"
          },
          {
            "id": "100000941868141",
            "name": "Thoa Tran"
          },
          {
            "id": "100000980293146",
            "name": "Kh√°nh V√¢n"
          },
          {
            "id": "100000984300799",
            "name": "Tung Vu"
          },
          {
            "id": "100001022243294",
            "name": "Huyen Trieu"
          },
          {
            "id": "100001087908348",
            "name": "T√†i. C·ª≠a T·ª± ƒê·ªông"
          },
          {
            "id": "100001120775721",
            "name": "L√™ Th·ªã Minh Ph∆∞·ª£ng"
          },
          {
            "id": "100001342910831",
            "name": "La Hoa"
          },
          {
            "id": "100001443078158",
            "name": "Bim Lim Dim"
          },
          {
            "id": "100001508086380",
            "name": "Th·∫ø Kh∆∞∆°ng Nguy·ªÖn"
          },
          {
            "id": "100001575392906",
            "name": "Huy·ªÅn Anh Nguy·ªÖn"
          },
          {
            "id": "100001760897883",
            "name": "My Hieu Dao"
          },
          {
            "id": "100001812241811",
            "name": "V≈© Thu Trang"
          },
          {
            "id": "100001911838667",
            "name": "Ph√∫c Pi"
          },
          {
            "id": "100002236262875",
            "name": "D∆∞∆°ng Tr√≠ Th·ª©c"
          },
          {
            "id": "100002239523184",
            "name": "Nguy·ªÖn Ng√¢n Ch√¢u"
          },
          {
            "id": "100002284338356",
            "name": "Phuong Vu Mai"
          },
          {
            "id": "100002380444871",
            "name": "Tr·∫ßn T√¢n"
          },
          {
            "id": "100002395931625",
            "name": "Lyly Dang"
          },
          {
            "id": "100002422973147",
            "name": "Nguy·ªÖn Th√†nh ƒê√¥"
          },
          {
            "id": "100002448663492",
            "name": "B√πi Tuy·∫øt"
          },
          {
            "id": "100002618172780",
            "name": "Tr·∫ßn D≈©ng"
          },
          {
            "id": "100002654683809",
            "name": "Nguy·ªÖn Dung"
          },
          {
            "id": "100002768697384",
            "name": "Van Linh Nguyen"
          },
          {
            "id": "100002828608496",
            "name": "Th·∫Øng L√™ ƒêƒÉng"
          },
          {
            "id": "100002894088361",
            "name": "Ho√†ng Phi H√πng"
          },
          {
            "id": "100002918321046",
            "name": "Thu·ª≥ ƒê·ªó"
          },
          {
            "id": "100002946674698",
            "name": "H√≤e Nguy·ªÖn VƒÉn"
          },
          {
            "id": "100002978226577",
            "name": "Le Quang Tung"
          },
          {
            "id": "100002990355280",
            "name": "Thangmatlon Cutngay"
          },
          {
            "id": "100003112959701",
            "name": "VƒÉn S∆°n"
          },
          {
            "id": "100003137892869",
            "name": "Phihung Hoang"
          },
          {
            "id": "100003143419391",
            "name": "Ti·∫øn D≈©ng"
          },
          {
            "id": "100003187192760",
            "name": "Hoang Anh Ha"
          },
          {
            "id": "100003208886321",
            "name": "Nguy·ªÖn Huy·ªÅn Trang"
          },
          {
            "id": "100003212128126",
            "name": "Ph·∫°m Vƒ©nh"
          },
          {
            "id": "100003219365046",
            "name": "Ho√†i L√™ Th·ªã"
          },
          {
            "id": "100003256625248",
            "name": "Quang Ngoc Nguyen"
          },
          {
            "id": "100003263785363",
            "name": "Thu Tr·∫ßn"
          },
          {
            "id": "100003268721828",
            "name": "Quang T√πng"
          },
          {
            "id": "100003294388608",
            "name": "L√™ T√†i"
          },
          {
            "id": "100003296659152",
            "name": "Ph∆∞∆°ng Nhung"
          },
          {
            "id": "100003349716645",
            "name": "Nguy·ªÖn ƒê·ª©c Nvƒë"
          },
          {
            "id": "100003385221252",
            "name": "C√¢y Phong Ba"
          },
          {
            "id": "100003484607808",
            "name": "Thanh Thu√Ω"
          },
          {
            "id": "100003496539524",
            "name": "Trung Tr∆∞∆°ng VƒÉn"
          },
          {
            "id": "100003527679379",
            "name": "Nhu Tan Nguyen"
          },
          {
            "id": "100003696053635",
            "name": "Ruby Fly"
          },
          {
            "id": "100003730111726",
            "name": "Thach Hoang Van"
          },
          {
            "id": "100003769549026",
            "name": "Tr·∫ßn Trung Nh√¢n"
          },
          {
            "id": "100003772078549",
            "name": "Tuoi Nguyen"
          },
          {
            "id": "100003826431405",
            "name": "Blnh Mlnh"
          },
          {
            "id": "100003826836026",
            "name": "V≈© Linh"
          },
          {
            "id": "100003840960528",
            "name": "√Ånh Nguy·ªÖn"
          },
          {
            "id": "100003856208943",
            "name": "Phan H√≤a"
          },
          {
            "id": "100003869987023",
            "name": "Nguy·ªÖn Th·ªã M·ªπ Nhung"
          },
          {
            "id": "100003894536935",
            "name": "Tr·∫ßn H·ªØu Th√¥ng"
          },
          {
            "id": "100003911883355",
            "name": "C∆∞·ªùng Th√†nh"
          },
          {
            "id": "100003932734095",
            "name": "Th√†nh Kyo"
          },
          {
            "id": "100003946908707",
            "name": "Nguy√™n T√∫"
          },
          {
            "id": "100003951724972",
            "name": "Nguy·ªÖn Th·ªã H√† Ng√¢n"
          },
          {
            "id": "100003953913292",
            "name": "D≈©ng Nguy·ªÖn Minh"
          },
          {
            "id": "100004016275196",
            "name": "H·ªì VƒÉn Tu·∫•n"
          },
          {
            "id": "100004087246460",
            "name": "Nguy·ªÖn H·ªØu ƒê·∫°t"
          },
          {
            "id": "100004135123453",
            "name": "Mung Nguyen Thi"
          },
          {
            "id": "100004138992607",
            "name": "Hong Hai Vu"
          },
          {
            "id": "100004144351309",
            "name": "L√™ Trung Hi·∫øu"
          },
          {
            "id": "100004149012038",
            "name": "Hu·∫ø ƒê·∫∑ng"
          },
          {
            "id": "100004174891392",
            "name": "T·∫•n T√†i"
          },
          {
            "id": "100004256954453",
            "name": "Qu·ª≥nh Nh∆∞"
          },
          {
            "id": "100004273023294",
            "name": "ƒê·ªó Th√πy Linh"
          },
          {
            "id": "100004300397713",
            "name": "Thanh Ngo"
          },
          {
            "id": "100004304313985",
            "name": "H·ªìng Ph√∫c"
          },
          {
            "id": "100004306290359",
            "name": "Hi·ªÅn Ho√†ng"
          },
          {
            "id": "100004316522352",
            "name": "Thu·ª∑ Pro"
          },
          {
            "id": "100004342441972",
            "name": "VƒÉn Trung"
          },
          {
            "id": "100004348142950",
            "name": "Tr·ªãnh Th·ªã Linh"
          },
          {
            "id": "100004355646949",
            "name": "V√µ Ho√†ng B·ª≠u"
          },
          {
            "id": "100004428257202",
            "name": "ƒê·ªó Quang D·ª±"
          },
          {
            "id": "100004429086279",
            "name": "Tr·∫ßn Th√°i ƒê·∫°o"
          },
          {
            "id": "100004437578563",
            "name": "Sen Nh·∫≥ng"
          },
          {
            "id": "100004463476051",
            "name": "Ngoc Anh Tran"
          },
          {
            "id": "100004560970878",
            "name": "H√™nh Ph·∫°m"
          },
          {
            "id": "100004569734453",
            "name": "Lona Cat"
          },
          {
            "id": "100004616855082",
            "name": "Tri·ªáu Hi·ªÉn"
          },
          {
            "id": "100004622803079",
            "name": "Thao Ha"
          },
          {
            "id": "100004654544241",
            "name": "Nguy·ªÖn Th·ªã H·∫°nh"
          },
          {
            "id": "100004746369209",
            "name": "VƒÉn To·∫£n"
          },
          {
            "id": "100004828269961",
            "name": "Tr∆∞·ªüng Tr·∫ßn ƒê√¨nh"
          },
          {
            "id": "100004835741451",
            "name": "Duc Tran"
          },
          {
            "id": "100004841040407",
            "name": "Trung Thuc Hoang"
          },
          {
            "id": "100004854581771",
            "name": "Vi·ªát Nguy·ªÖn"
          },
          {
            "id": "100004907562634",
            "name": "V≈© Kh√°nh Vy"
          },
          {
            "id": "100004933301352",
            "name": "Ho√†ng Dung"
          },
          {
            "id": "100004942956305",
            "name": "Th√∫y Ho√†ng"
          },
          {
            "id": "100005016818649",
            "name": "V≈© Quang Hi·∫øn"
          },
          {
            "id": "100005033012757",
            "name": "Tr·∫ßn V√¢n"
          },
          {
            "id": "100005060382165",
            "name": "L√™ VƒÉn Nam"
          },
          {
            "id": "100005143232807",
            "name": "Lien Nguyen"
          },
          {
            "id": "100005158926907",
            "name": "Nguy·ªÖn V≈©"
          },
          {
            "id": "100005180706859",
            "name": "Thanh Binh Tran"
          },
          {
            "id": "100005198500756",
            "name": "ƒêi·ªÉm Nguy·ªÖn"
          },
          {
            "id": "100005199186637",
            "name": "Tr·∫ßn Nh√¢n"
          },
          {
            "id": "100005293903253",
            "name": "Viet Son"
          },
          {
            "id": "100005316904446",
            "name": "ƒê·∫°t Vinh Ch√¢u"
          },
          {
            "id": "100005328273224",
            "name": "B√°ch Zim"
          },
          {
            "id": "100005355072949",
            "name": "Qu·ªëc Bi·ªÉu"
          },
          {
            "id": "100005443655127",
            "name": "Ty Nguyen"
          },
          {
            "id": "100005476835538",
            "name": "Ph√πng Nghƒ©a"
          },
          {
            "id": "100005491364399",
            "name": "Nguy·ªÖn Th·ªã Th∆∞"
          },
          {
            "id": "100005734712385",
            "name": "√Ånh √Ånh"
          },
          {
            "id": "100005761982763",
            "name": "TranAnh Tran"
          },
          {
            "id": "100005785600557",
            "name": "L√™ B·∫£o Linh"
          },
          {
            "id": "100005987043595",
            "name": "H·∫£i ƒê·ªó"
          },
          {
            "id": "100005989327652",
            "name": "Kiet Duong Tuan"
          },
          {
            "id": "100005998215190",
            "name": "Pham Minh Chi"
          },
          {
            "id": "100006190306738",
            "name": "Vinh Nguy·ªÖn"
          },
          {
            "id": "100006282243357",
            "name": "Tr∆∞∆°ng Quang B·ªïn"
          },
          {
            "id": "100006289752741",
            "name": "Ph·∫°m Thu·ª≥"
          },
          {
            "id": "100006347823477",
            "name": "Dung Anh"
          },
          {
            "id": "100006356471950",
            "name": "L√™ Minh V≈©"
          },
          {
            "id": "100006436550382",
            "name": "Hoang Lan"
          },
          {
            "id": "100006455468722",
            "name": "Nguy·ªÖn Ho√†ng"
          },
          {
            "id": "100006477952681",
            "name": "Thanh Kha"
          },
          {
            "id": "100006492082087",
            "name": "L√¢m V≈©"
          },
          {
            "id": "100006527703159",
            "name": "Dung Nguy·ªÖn"
          },
          {
            "id": "100006534735398",
            "name": "ƒê·∫•t Vi·ªát"
          },
          {
            "id": "100006535210556",
            "name": "D∆∞∆°ng L√™"
          },
          {
            "id": "100006564792292",
            "name": "Nguyet Duong"
          },
          {
            "id": "100006621008888",
            "name": "Ch√∫c An"
          },
          {
            "id": "100006625688182",
            "name": "Ho√†ng Dung"
          },
          {
            "id": "100006629867100",
            "name": "Mai Truc"
          },
          {
            "id": "100006650558886",
            "name": "Hu·ª≥nh Tu·∫•n H·∫£i"
          },
          {
            "id": "100006652847354",
            "name": "th·∫±ng kh·ªù"
          },
          {
            "id": "100006656734334",
            "name": "Anh Tram"
          },
          {
            "id": "100006658449464",
            "name": "Ph·∫°m T·∫°o"
          },
          {
            "id": "100006670560114",
            "name": "Nguy·ªÖn Minh T√¢m"
          },
          {
            "id": "100006714038802",
            "name": "Nguy·ªÖn Thanh Ngh·ªã"
          },
          {
            "id": "100006828812149",
            "name": "Hai Con Cu√¥ng"
          },
          {
            "id": "100006870633964",
            "name": "Cuong Ha"
          },
          {
            "id": "100006910334973",
            "name": "Tra Giang"
          },
          {
            "id": "100006924643905",
            "name": "Huynh Toan"
          },
          {
            "id": "100006954573224",
            "name": "Le Hien"
          },
          {
            "id": "100007021395010",
            "name": "Ph√∫ Sƒ©"
          },
          {
            "id": "100007141772004",
            "name": "Kh∆∞∆°ng Ti·∫øn Th·∫£o"
          },
          {
            "id": "100007147607792",
            "name": "Huy Ph∆∞∆°ng"
          },
          {
            "id": "100007184853225",
            "name": "Phan Qu·ª≥nh"
          },
          {
            "id": "100007210390645",
            "name": "Tran Nhat Thang"
          },
          {
            "id": "100007343377103",
            "name": "Hang Le"
          },
          {
            "id": "100007351243660",
            "name": "Ho√†ng Tr·ªçng"
          },
          {
            "id": "100007393903182",
            "name": "Nguy·ªÖn H·ªìng H·∫£i"
          },
          {
            "id": "100007460525808",
            "name": "Tr·∫ßn Minh ƒê·ª©c"
          },
          {
            "id": "100007508854903",
            "name": "Tuy·∫øt Th√°i"
          },
          {
            "id": "100007541643743",
            "name": "Thanh Ng√†"
          },
          {
            "id": "100007542781938",
            "name": "Bui Viet Vuong"
          },
          {
            "id": "100007737932763",
            "name": "ƒê·∫∑ng Xu√¢n Quang"
          },
          {
            "id": "100007864661236",
            "name": "Ng√¢n Tr·∫ßn"
          },
          {
            "id": "100007882321871",
            "name": "VƒÉn Minh"
          },
          {
            "id": "100007927390679",
            "name": "Hanh Tran"
          },
          {
            "id": "100007967923641",
            "name": "Tony Tp"
          },
          {
            "id": "100008140249491",
            "name": "P√© B·ª±"
          },
          {
            "id": "100008221572096",
            "name": "Huyen Thu"
          },
          {
            "id": "100008234374431",
            "name": "Nguy·ªÖn Thanh Nga"
          },
          {
            "id": "100008248577763",
            "name": "H·∫£o ƒêinh"
          },
          {
            "id": "100008291257535",
            "name": "Nguy·ªÖn Trang Linh"
          },
          {
            "id": "100008425995708",
            "name": "An Thuy"
          },
          {
            "id": "100008451288135",
            "name": "Ph·∫°m H∆∞∆°ng"
          },
          {
            "id": "100008521248711",
            "name": "VƒÉn Tu·∫•n"
          },
          {
            "id": "100008694605147",
            "name": "Nam LE Van"
          },
          {
            "id": "100008993380043",
            "name": "Thi√™n S·ª© B√¥ng H·ªìng"
          },
          {
            "id": "100009041181623",
            "name": "Ho√†ng Th·ªã Nhung"
          },
          {
            "id": "100009076064008",
            "name": "Tr∆∞∆°ng Thi√™n VƒÉn"
          },
          {
            "id": "100009156128207",
            "name": "Nga Nguy·ªÖn"
          },
          {
            "id": "100009492122316",
            "name": "N·ªôi Tpth Vinspex"
          },
          {
            "id": "100009700398050",
            "name": "Dung Dang Hong"
          },
          {
            "id": "100009710115306",
            "name": "Cao Thi Thuy Kieu"
          },
          {
            "id": "100009710402349",
            "name": "Ho√† Mai"
          },
          {
            "id": "100009721188717",
            "name": "Nari Nguy·ªÖn"
          },
          {
            "id": "100009786584855",
            "name": "L√™ B√° Chi·∫øn"
          },
          {
            "id": "100009850141283",
            "name": "H·ªì C∆∞·ªùng"
          },
          {
            "id": "100010045967431",
            "name": "Giang Nguyen"
          },
          {
            "id": "100010125007281",
            "name": "Nguy·ªÖn C√¥ng Ch√≠nh"
          },
          {
            "id": "100010201384092",
            "name": "B√πi To√†n"
          },
          {
            "id": "100010275101767",
            "name": "Nguy·ªÖn Ng·ªçc Phong"
          },
          {
            "id": "100010373340923",
            "name": "B√° Ch√¢u"
          },
          {
            "id": "100010533724426",
            "name": "Quy Phi"
          },
          {
            "id": "100010608222218",
            "name": "Tr·∫ßn Kim Ng√¢n"
          },
          {
            "id": "100010673776672",
            "name": "Ho√†ng Tu·∫•n"
          },
          {
            "id": "100010743184484",
            "name": "Van Trung"
          },
          {
            "id": "100010888540861",
            "name": "Du Le"
          },
          {
            "id": "100010918548956",
            "name": "Thanh Ho√†ng"
          },
          {
            "id": "100010959194633",
            "name": "Ph·∫°m Ng√¢n"
          },
          {
            "id": "100011103738351",
            "name": "L√™ H∆∞·ªùng"
          },
          {
            "id": "100011229511818",
            "name": "Nguy·ªÖn Lan Ph∆∞∆°ngg"
          },
          {
            "id": "100011367592771",
            "name": "Nguy·ªÖn Mai"
          },
          {
            "id": "100011394891822",
            "name": "Nguy·ªÖn Hoc"
          },
          {
            "id": "100011668994702",
            "name": "Mrken 'Tr·∫ßn'"
          },
          {
            "id": "100011798833475",
            "name": "Thanh Huy·ªÅn Nguy·ªÖn"
          },
          {
            "id": "100011866704626",
            "name": "Phan Ngoan"
          },
          {
            "id": "100011931436749",
            "name": "Phan VƒÉn"
          },
          {
            "id": "100011980453016",
            "name": "Nguy·ªÖn Ho√†ng Minh"
          },
          {
            "id": "100012075423028",
            "name": "Nguy·ªÖn Minh"
          },
          {
            "id": "100012373298685",
            "name": "Nguy·ªÖn H·ªØu Th·ªãnh"
          },
          {
            "id": "100012594226421",
            "name": "Ho√†i B√πi"
          },
          {
            "id": "100012713474153",
            "name": "Su·ªëi ƒê√°"
          },
          {
            "id": "100012773562115",
            "name": "L·ªçc N∆∞·ªõc T√¢y Ninh"
          },
          {
            "id": "100013065763040",
            "name": "Luong Tran"
          },
          {
            "id": "100013220139095",
            "name": "C√°i G√¨ Ch·∫≥ng C√≥"
          },
          {
            "id": "100013263695559",
            "name": "ƒê·ª©c Ph·∫°m"
          },
          {
            "id": "100013358612819",
            "name": "Vansao Tran"
          },
          {
            "id": "100013379434358",
            "name": "Hoang Monaco"
          },
          {
            "id": "100013476914535",
            "name": "L∆∞u ƒê·ª©c Duy"
          },
          {
            "id": "100013549770221",
            "name": "D∆∞∆°ng T∆∞·ªùng Duy"
          },
          {
            "id": "100013618568123",
            "name": "Phan ƒê√¨nh ƒê·∫°t"
          },
          {
            "id": "100013769500273",
            "name": "Tr·∫ßn ƒê·ª©c T√¨nh"
          },
          {
            "id": "100014470716662",
            "name": "Ho√†ng Anh BTonio Lecturer"
          },
          {
            "id": "100014518449736",
            "name": "Hanh Chu"
          },
          {
            "id": "100014736707023",
            "name": "Tuan Anh Nguy·ªÖn"
          },
          {
            "id": "100014744434065",
            "name": "Tr·∫ßn T√¢m"
          },
          {
            "id": "100015297154167",
            "name": "Bao Hoa Nguyen"
          },
          {
            "id": "100015327542257",
            "name": "Nguy·ªÖn Dung"
          },
          {
            "id": "100015541562943",
            "name": "Tr·∫ßn Hoa"
          },
          {
            "id": "100015766291522",
            "name": "ƒê√†o Gia Founder"
          },
          {
            "id": "100016384751535",
            "name": "Tr·∫ßn Ph√∫"
          },
          {
            "id": "100016569391198",
            "name": "Tooichi Kuroba"
          },
          {
            "id": "100016784174705",
            "name": "Ng·ªçc To√†n"
          },
          {
            "id": "100016807449887",
            "name": "T√∫ B√πi"
          },
          {
            "id": "100016858773368",
            "name": "D∆∞∆°ng To·∫£n Linh"
          },
          {
            "id": "100016927471613",
            "name": "Thi√™n V√¢n"
          },
          {
            "id": "100017007180195",
            "name": "Xoan Tit Xoan"
          },
          {
            "id": "100017616608808",
            "name": "Nguy·ªÖn V√¢n Th·ªãnh"
          },
          {
            "id": "100017645802520",
            "name": "Tr∆∞∆°ng Tr√≠ ƒê·ª©c"
          },
          {
            "id": "100020736142752",
            "name": "Nguy·ªÖn Huy Gi√°p"
          },
          {
            "id": "100021702982261",
            "name": "Phan Th·ªã M·∫≠n"
          },
          {
            "id": "100021719721075",
            "name": "L√™ H·ªØu H√†"
          },
          {
            "id": "100022269277688",
            "name": "Trung CuChi"
          },
          {
            "id": "100022647950578",
            "name": "L√™ Duy Th·ªç"
          },
          {
            "id": "100022848772578",
            "name": "Nguy·ªÖn Bi√™n"
          },
          {
            "id": "100023066776436",
            "name": "Ken Ken"
          },
          {
            "id": "100023472497923",
            "name": "ƒê√¥ng M√πa"
          },
          {
            "id": "100023906706671",
            "name": "Kim Dung"
          },
          {
            "id": "100024414377599",
            "name": "Hoahong Hoahong"
          },
          {
            "id": "100024616364535",
            "name": "ƒêinh Quang D≈©ng"
          },
          {
            "id": "100024715094699",
            "name": "Ho√†ng Th·ªã Ng√†n"
          },
          {
            "id": "100024755232860",
            "name": "VƒÉn Ch√≠nh"
          },
          {
            "id": "100025032575504",
            "name": "ƒê·∫∑ng VƒÉn T√≠nh"
          },
          {
            "id": "100025033702562",
            "name": "ƒê·ªó Di·ªáp Khanh"
          },
          {
            "id": "100025148075519",
            "name": "Ph√°t Tr∆∞∆°ng"
          },
          {
            "id": "100025417395973",
            "name": "Nhung Dao"
          },
          {
            "id": "100025495093138",
            "name": "C√¥ ƒê·ªôc V∆∞∆°ng"
          },
          {
            "id": "100025667291297",
            "name": "Lyla Larry Nguyen"
          },
          {
            "id": "100026182246416",
            "name": "Pham Minh"
          },
          {
            "id": "100026300572404",
            "name": "Lan Anh Nail"
          },
          {
            "id": "100026896832330",
            "name": "Minh Quang Vu"
          },
          {
            "id": "100027140260785",
            "name": "Nguy·ªÖn Th·∫ø Sinh"
          },
          {
            "id": "100027447045890",
            "name": "Nguyen H·∫±ng"
          },
          {
            "id": "100027773987109",
            "name": "Quan Thu·∫ßn"
          },
          {
            "id": "100027882458875",
            "name": "Tr∆∞∆°ng Thanh Ng√¢n"
          },
          {
            "id": "100027892488162",
            "name": "H·ªì M·ªπ Trang"
          },
          {
            "id": "100028057694355",
            "name": "Nguy·ªÖn Th·∫ø Ng·ªçc"
          },
          {
            "id": "100028183980483",
            "name": "Hoa Nguyen"
          },
          {
            "id": "100028499742249",
            "name": "ƒê√†o ƒê√¨nh Luy·ªán"
          },
          {
            "id": "100028687274030",
            "name": "Tr·∫ßn ƒê√¨nh V≈©"
          },
          {
            "id": "100028696751646",
            "name": "Nga Kim V≈© HR"
          },
          {
            "id": "100028882415709",
            "name": "Th·ªßy Nguy·ªÖn"
          },
          {
            "id": "100029299301680",
            "name": "Vi Hoa"
          },
          {
            "id": "100029670409014",
            "name": "Huy·ªÅn ƒê·∫∑ng"
          },
          {
            "id": "100029798453334",
            "name": "Ng·ª•y Huy·ªÅn Tr√¢m"
          },
          {
            "id": "100029967125807",
            "name": "L√™ Ho√†ng"
          },
          {
            "id": "100030104508772",
            "name": "B·∫£o L√¢m"
          },
          {
            "id": "100030473134367",
            "name": "H√† L√™"
          },
          {
            "id": "100030509079299",
            "name": "Tr·∫ßn VƒÉn H√πng"
          },
          {
            "id": "100030578503940",
            "name": "H·ªØu Th√†nh"
          },
          {
            "id": "100030659791332",
            "name": "L∆∞∆°ng VƒÉn T√¢y"
          },
          {
            "id": "100030833381157",
            "name": "Thoc Luu"
          },
          {
            "id": "100030909782658",
            "name": "V∆∞∆°ng Xu√¢n Trung"
          },
          {
            "id": "100031257766967",
            "name": "Nguy·ªÖn Zin"
          },
          {
            "id": "100031949331540",
            "name": "Ma Th·∫£o"
          },
          {
            "id": "100033158917500",
            "name": "Nhi Th·ªã"
          },
          {
            "id": "100033583038301",
            "name": "Lien Le"
          },
          {
            "id": "100034551607051",
            "name": "Ki·ªÅu Ng·ªçc"
          },
          {
            "id": "100034573387118",
            "name": "Nguy·ªÖn T·∫•n Th·∫°nh"
          },
          {
            "id": "100035312289300",
            "name": "Ph·∫°m B·∫£o Vinh"
          },
          {
            "id": "100035413536551",
            "name": "Nguy·ªÖn To·∫£n"
          },
          {
            "id": "100035471355865",
            "name": "Ph·∫°m Ho√†n √Çn"
          },
          {
            "id": "100035824970612",
            "name": "L√Ω T·∫ßm Hoan"
          },
          {
            "id": "100035891000395",
            "name": "Nguy·ªÖn Ki·ªÅu M·ªµ"
          },
          {
            "id": "100036436549617",
            "name": "ƒêinh Th·ªã Tuy·∫øt Mai"
          },
          {
            "id": "100037302003281",
            "name": "ƒê·ªó L·ª•a"
          },
          {
            "id": "100037465741341",
            "name": "Hi·ªÉu R√¢u"
          },
          {
            "id": "100039006110871",
            "name": "Trang Tr√≤n"
          },
          {
            "id": "100039107282206",
            "name": "Nguy·ªÖn Minh Ph·ª•ng"
          },
          {
            "id": "100039234011717",
            "name": "ƒê√† Chu"
          },
          {
            "id": "100039431713970",
            "name": "ƒêinh VƒÉn Tu·∫•n"
          },
          {
            "id": "100039791821927",
            "name": "Cuong Vu"
          },
          {
            "id": "100040344554026",
            "name": "Nguy·ªÖn H·ªØu To√†n"
          },
          {
            "id": "100040714280187",
            "name": "Khanh An Cam"
          },
          {
            "id": "100040854852044",
            "name": "Kien Nguyen"
          },
          {
            "id": "100041005845935",
            "name": "ƒêo√†n Minh Hi·∫øu"
          },
          {
            "id": "100041138773693",
            "name": "Mai Vinh"
          },
          {
            "id": "100041331110092",
            "name": "Kh·∫Øc Ng·ªçc"
          },
          {
            "id": "100041331771277",
            "name": "H·ªì Ph∆∞·ªõc An"
          },
          {
            "id": "100041741836664",
            "name": "Giang M·ª∑ Duy√™n"
          },
          {
            "id": "100042365281852",
            "name": "Trang L√™"
          },
          {
            "id": "100042843185509",
            "name": "Huy Ho√†ng Ph√°t"
          },
          {
            "id": "100043083728060",
            "name": "Long Quy·ªÅn Hino"
          },
          {
            "id": "100043837155888",
            "name": "Sunny Hu·ª≥nh"
          },
          {
            "id": "100044217855177",
            "name": "Loan Nong"
          },
          {
            "id": "100044322856461",
            "name": "L·ªá H·∫±ng"
          },
          {
            "id": "100044395205424",
            "name": "L√†nh L√™"
          },
          {
            "id": "100044750093304",
            "name": "Minh Kh·∫£i H∆∞ng"
          },
          {
            "id": "100044828802250",
            "name": "Tr·∫ßn Ho√†i VƒÉn"
          },
          {
            "id": "100044982412216",
            "name": "Tuan Anh Phung Quoc"
          },
          {
            "id": "100045239104005",
            "name": "Ph·∫°m Tu·∫•n"
          },
          {
            "id": "100045857166831",
            "name": "Gia Huy"
          },
          {
            "id": "100046073641870",
            "name": "Nguy·ªÖn Th·ªã Duy√™n"
          },
          {
            "id": "100046405936633",
            "name": "H·ªì Xu√¢n Hi·∫øu"
          },
          {
            "id": "100046643683833",
            "name": "Hoang Anh Nguyen"
          },
          {
            "id": "100047608833937",
            "name": "Nguy·ªÖn Th·∫£o Nhi"
          },
          {
            "id": "100047832253096",
            "name": "VƒÉn T·∫•n T√†i"
          },
          {
            "id": "100048950482838",
            "name": "Ng√¥ Thanh Th√πy"
          },
          {
            "id": "100049057852661",
            "name": "Gia Hung"
          },
          {
            "id": "100049137320683",
            "name": "Nguy·ªÖn H·ªØu T√πng"
          },
          {
            "id": "100049364013977",
            "name": "Tri·ªÅu Nguy·ªÖn"
          },
          {
            "id": "100049529929873",
            "name": "Tr·ªçng Nguy·ªÖn"
          },
          {
            "id": "100049933239314",
            "name": "Nguy·ªÖn Thanh Ph∆∞∆°ng"
          },
          {
            "id": "100050313874375",
            "name": "Nguy·ªÖn Kh√°nh An"
          },
          {
            "id": "100050689431203",
            "name": "VƒÉn K·ª∑"
          },
          {
            "id": "100050896924676",
            "name": "Chau Truong"
          },
          {
            "id": "100051580996504",
            "name": "V∆∞∆°ng Ho√†ng"
          },
          {
            "id": "100051631818167",
            "name": "‡∏Ñ‡∏∏‡∏ì ‡∏ß‡∏µ‡∏£‡∏†‡∏±‡∏ó‡∏£"
          },
          {
            "id": "100052289653476",
            "name": "H·ªì Kim Th√†nh Anh"
          },
          {
            "id": "100052330601510",
            "name": "Nguy·ªÖn Xu√¢n H·∫£i"
          },
          {
            "id": "100052797646738",
            "name": "Ng√¥ ƒêƒÉng S·ªπ S·ªπ"
          },
          {
            "id": "100053168822469",
            "name": "Khang Ho√†ng"
          },
          {
            "id": "100053385587217",
            "name": "Hu·ª≥nh M·ªπ An"
          },
          {
            "id": "100053523216470",
            "name": "Tr∆∞∆°ng B·∫£o Kh√°nh"
          },
          {
            "id": "100053618811831",
            "name": "Nguyen Nghia"
          },
          {
            "id": "100053653425560",
            "name": "C√¥ng Anh"
          },
          {
            "id": "100054118547462",
            "name": "L∆∞∆°ng VƒÉn Gi√†u"
          },
          {
            "id": "100055091536978",
            "name": "Nguy·ªÖn Th·ªßy"
          },
          {
            "id": "100055456192661",
            "name": "Hai Nguyen"
          },
          {
            "id": "100056115540240",
            "name": "Vinh Nguy√™n"
          },
          {
            "id": "100056204585461",
            "name": "T√≤ng Vinh L·∫≠p"
          },
          {
            "id": "100056219674828",
            "name": "Nguy·ªÖn ƒêƒÉng Long"
          },
          {
            "id": "100056893673138",
            "name": "Ph·∫°m H∆∞∆°ng"
          },
          {
            "id": "100056971001603",
            "name": "ƒê·ªó Ng·ªçc B√≠ch"
          },
          {
            "id": "100057218484529",
            "name": "An Dong"
          },
          {
            "id": "100057282332889",
            "name": "ƒê·∫∑ng Long"
          },
          {
            "id": "100057294213677",
            "name": "B·∫Øc Chi√™m Ks"
          },
          {
            "id": "100058695786943",
            "name": "Tr∆∞∆°ng Ng·ªçc C∆∞·ªùng"
          },
          {
            "id": "100059470687155",
            "name": "KiLa Kids"
          },
          {
            "id": "100061966165039",
            "name": "Xu√¢n B√πi"
          },
          {
            "id": "100063582972054",
            "name": "Nguy·ªÖn H∆∞∆°ng"
          },
          {
            "id": "100065484991136",
            "name": "H·ªØu Tƒ©nh"
          },
          {
            "id": "100065755574601",
            "name": "L√™ Quang VƒÉn"
          },
          {
            "id": "100065910370542",
            "name": "Aiy Kham Ma Ny"
          },
          {
            "id": "100066564653556",
            "name": "Sen Pham"
          },
          {
            "id": "100066843591263",
            "name": "Ph·∫°m Nh·∫≠t Ti·∫øn"
          },
          {
            "id": "100067012723713",
            "name": "Ph·∫°m Thanh V√¢n"
          },
          {
            "id": "100067050272709",
            "name": "Tr·∫ßn ƒê√†n"
          },
          {
            "id": "100067311587908",
            "name": "Tr·∫ßn VƒÉn Tr∆∞·ªùng"
          },
          {
            "id": "100067495173935",
            "name": "L√™ Ng·ªçc Huy"
          },
          {
            "id": "100067561286987",
            "name": "NT Bii"
          },
          {
            "id": "100067655688411",
            "name": "Ho√†ng Kim T√πng"
          },
          {
            "id": "100067783291879",
            "name": "Nguy·ªÖn Ho√†ng Vinh"
          },
          {
            "id": "100068319355393",
            "name": "Nguy·ªÖn Kh·∫£ Nhi"
          },
          {
            "id": "100069529777480",
            "name": "Nguy·ªÖn V√µ L·ª£i"
          },
          {
            "id": "100069724183977",
            "name": "ƒê√†o H·ªØu Hu·ª≥nh"
          },
          {
            "id": "100070643193025",
            "name": "Nguy·ªÖn Hoan"
          },
          {
            "id": "100070996751630",
            "name": "Thi·ªÅu Nguy·ªÖn VƒÉn"
          },
          {
            "id": "100071772381887",
            "name": "Anan Anan"
          },
          {
            "id": "100071986008443",
            "name": "Ho√†ng S∆°n"
          },
          {
            "id": "100072577917134",
            "name": "H√† Moon"
          },
          {
            "id": "100072884918743",
            "name": "ƒêinh Ng·ªçc Huy·ªÅn"
          },
          {
            "id": "100072973166250",
            "name": "L√™ Minh Ph∆∞∆°ng"
          },
          {
            "id": "100073041764842",
            "name": "Gia An"
          },
          {
            "id": "100073288287437",
            "name": "Kim Yen"
          },
          {
            "id": "100073474667304",
            "name": "Nguy·ªÖn Minh Tu·∫•n"
          },
          {
            "id": "100073518842187",
            "name": "Ken Vy"
          },
          {
            "id": "100074726791534",
            "name": "Thanh Long"
          },
          {
            "id": "100074896790646",
            "name": "Nguy·ªÖn ƒê·ª©c L√¢m"
          },
          {
            "id": "100075442416851",
            "name": "Phan Ph·ª•ng Hi·ªáp"
          },
          {
            "id": "100075498409541",
            "name": "Melvin Balagan"
          },
          {
            "id": "100076228431824",
            "name": "Nguy·ªÖn H·∫±ng Bƒës"
          },
          {
            "id": "100076424797674",
            "name": "ƒê·ªó Nh∆∞ Qu·ª≥nh"
          },
          {
            "id": "100076589088252",
            "name": "Th·∫°ch ƒêi·ªÅn An"
          },
          {
            "id": "100076848668836",
            "name": "Tr·∫ßn Thanh T√†i"
          },
          {
            "id": "100076915989195",
            "name": "Ph·∫°m Th·ªã Th·∫ø"
          },
          {
            "id": "100076937134966",
            "name": "√öt L√™"
          },
          {
            "id": "100078537897171",
            "name": "Tr·∫ßn Ki·ªÅu Trinh"
          },
          {
            "id": "100078714237075",
            "name": "Ph·∫°m Thanh H·ªØu"
          },
          {
            "id": "100078927330919",
            "name": "H√† C√¥ng Minh"
          },
          {
            "id": "100079517160224",
            "name": "Tr·∫ßn Minh Th∆∞"
          },
          {
            "id": "100079825482206",
            "name": "Tr∆∞∆°ng Th·ªã Ng√†"
          },
          {
            "id": "100080216923789",
            "name": "Ho√†ng Huy H·∫£i"
          },
          {
            "id": "100080877782912",
            "name": "Nguy·ªÖn Quang Hi·∫øn"
          },
          {
            "id": "100081124791663",
            "name": "L√™ Ph∆∞∆°ng Nam"
          },
          {
            "id": "100081126481372",
            "name": "Phan Th·ª•c Quy√™n"
          },
          {
            "id": "100081183973040",
            "name": "Ch√¢u Thu Y√™n"
          },
          {
            "id": "100081577131072",
            "name": "Nguy·ªÖn Huy·ªÅn Na"
          },
          {
            "id": "100081774991139",
            "name": "Hu·ª≥nh Trung ƒê·ª©c"
          },
          {
            "id": "100081955574668",
            "name": "Th·∫£o B√π Sab"
          },
          {
            "id": "100082844631646",
            "name": "Mo Hoang"
          },
          {
            "id": "100082951224158",
            "name": "B√πi M·ªπ H·∫°nh"
          },
          {
            "id": "100082966943729",
            "name": "L√¢m B√≠ch Tuy·ªÅn"
          },
          {
            "id": "100083062064527",
            "name": "Tr·∫ßn Kh√°nh H·∫°"
          },
          {
            "id": "100083671045351",
            "name": "Hung Bui"
          },
          {
            "id": "100083821880689",
            "name": "Li√™m Th·∫£o"
          },
          {
            "id": "100083933202691",
            "name": "Phan Phan V≈©"
          },
          {
            "id": "100084120432429",
            "name": "Tr·∫ßn Quang Minh"
          },
          {
            "id": "100084163334065",
            "name": "Nguy·ªÖn Ph∆∞∆°ng Nam"
          },
          {
            "id": "100084168911187",
            "name": "Nguy·ªÖn Phi Long"
          },
          {
            "id": "100084280748476",
            "name": "H·ªì Xu√¢n Ti√™n"
          },
          {
            "id": "100084396496279",
            "name": "L√™ Qu·ªëc Ch∆°n"
          },
          {
            "id": "100085008549707",
            "name": "Qu√°ch Di·ªáu Linh"
          },
          {
            "id": "100085712091260",
            "name": "Ly Kiet"
          },
          {
            "id": "100085914378695",
            "name": "Nguy·ªÖn H·ªìng H·∫£i"
          },
          {
            "id": "100085951737392",
            "name": "Nguy·ªÖn Quang Vi√™n"
          },
          {
            "id": "100086275263199",
            "name": "ƒê·∫∑ng ƒê·ªÅ"
          },
          {
            "id": "100086352774017",
            "name": "Nguy·ªÖn B·∫£o Ng·ªçc"
          },
          {
            "id": "100087102586087",
            "name": "Nguy·ªÖn Kh·∫Øc H·∫£i"
          },
          {
            "id": "100087645018791",
            "name": "L∆∞u Ly Nguy·ªÖn"
          },
          {
            "id": "100088065800439",
            "name": "Lclc Mai Hoang"
          },
          {
            "id": "100088319020681",
            "name": "Mer Malate"
          },
          {
            "id": "100088442995929",
            "name": "Ng√¥ VƒÉn T√†i"
          },
          {
            "id": "100088653865647",
            "name": "Ph·∫°m Thu Hi√™n"
          },
          {
            "id": "100088820324939",
            "name": "ƒê·ªó T·ªë Uy√™n"
          },
          {
            "id": "100089027143175",
            "name": "Hu·ª≥nh Th·∫£o"
          },
          {
            "id": "100089049978165",
            "name": "Phan Di·ªáu Th·∫£o"
          },
          {
            "id": "100089120417250",
            "name": "ƒê·ªó Thu Ph∆∞∆°ng"
          },
          {
            "id": "100089417413352",
            "name": "Nguy·ªÖn Lu·∫≠t"
          },
          {
            "id": "100089649075119",
            "name": "Nguy·ªÖn Tu·∫•n L·ªôc"
          },
          {
            "id": "100089832851412",
            "name": "H∆∞∆°ng L√™"
          },
          {
            "id": "100090085357128",
            "name": "ƒêinh VƒÉn Hi·∫øn"
          },
          {
            "id": "100090241781437",
            "name": "B√πi Ng·ªçc Tr√¢n"
          },
          {
            "id": "100090303896046",
            "name": "ƒê√¨nh H·ªØu"
          },
          {
            "id": "100090614678217",
            "name": "Duy NG"
          },
          {
            "id": "100090678280373",
            "name": "Nguy·ªÖn Ng·ªçc B√≠ch"
          },
          {
            "id": "100090779798919",
            "name": "Jonel Sabay Ilustresimo"
          },
          {
            "id": "100090913833818",
            "name": "Hu·ª≥nh Ng·ªçc H·∫£i"
          },
          {
            "id": "100091399080812",
            "name": "B√πi ƒê·ª©c Vi·ªát"
          },
          {
            "id": "100091552787383",
            "name": "Ng·ªçc Lan"
          },
          {
            "id": "100091835664338",
            "name": "ƒê·∫∑ng Ng·ªçc Hi·ªáu"
          },
          {
            "id": "100092372214965",
            "name": "Trung V≈©"
          },
          {
            "id": "100092597356876",
            "name": "V≈© Th·∫£o V√¢n"
          },
          {
            "id": "100092965899049",
            "name": "Khantavan Vixaisak"
          },
          {
            "id": "100093194018066",
            "name": "Nguy·ªÖn B√° ƒê·ªìng"
          },
          {
            "id": "100093227391507",
            "name": "Cuki Male"
          },
          {
            "id": "100093950400415",
            "name": "Ho√†ng Nam"
          },
          {
            "id": "100094132527257",
            "name": "L√™ Th·ªã L∆∞∆°ng"
          },
          {
            "id": "100094226885826",
            "name": "Thi√™n √Çn T·∫°p Ho√°"
          },
          {
            "id": "100094749792539",
            "name": "Ph·∫°m H∆∞∆°ng Th·∫£o"
          },
          {
            "id": "100094786226589",
            "name": "L√™ T∆∞·ªùng Vy"
          },
          {
            "id": "100094996895373",
            "name": "Ng√¥ Quang To√†n"
          },
          {
            "id": "100095185767836",
            "name": "Nguy·ªÖn Tuan Tuan"
          },
          {
            "id": "100095202421179",
            "name": "Lani ƒê·ªó"
          },
          {
            "id": "100095443894318",
            "name": "Ph·∫°m C√¥ng Huy"
          }
        ],
        "comments": [
          {
            "id": "100008502215600",
            "name": "Toan Phung",
            "text": "Ib",
            "created_time_vn": "2025-12-13 01:36:31"
          },
          {
            "id": "100008502215600",
            "name": "Toan Phung",
            "text": "Chuy√™n vi√™n qu·∫£n l√Ω KD",
            "created_time_vn": "2025-12-13 01:36:54"
          },
          {
            "id": "100000391379114",
            "name": "ƒêƒÉng Quang",
            "text": "Thanh Nho ch√∫ l√†m h√†nh ch√≠nh dc",
            "created_time_vn": "2025-12-15 13:35:42"
          },
          {
            "id": "100009156433293",
            "name": "Ng·ªçc Linh",
            "text": "Th∆∞ Th·ªè",
            "created_time_vn": "2025-12-15 10:18:37"
          },
          {
            "id": "100000292595738",
            "name": "Linh Ph·∫°m",
            "text": "Ph·∫°m Kh√°nh Linhnh",
            "created_time_vn": "2025-12-13 20:02:47"
          },
          {
            "id": "100005379331337",
            "name": "Ha Le",
            "text": "L∆∞u L∆∞u Th√πy",
            "created_time_vn": "2025-12-14 23:03:57"
          },
          {
            "id": "100021760787632",
            "name": "N√™n Ph·∫°m",
            "text": "C·∫ßn t·ªëi thi·ªÉu b·∫±ng c·∫•p j ·∫°.",
            "created_time_vn": "2025-12-18 06:15:38"
          },
          {
            "id": "100038140512546",
            "name": "Tr·∫ßn H√† Huy·ªÅn",
            "text": "·ªû ƒë√¢u",
            "created_time_vn": "2025-12-11 23:14:34"
          },
          {
            "id": "100013436617586",
            "name": "Nhung Cao",
            "text": "Kim Anh Nguyen",
            "created_time_vn": "2025-12-11 21:03:07"
          },
          {
            "id": "61576606707704",
            "name": "Ph·∫°m H·ªØu To√†n",
            "text": "Ph·∫°m Th·ªã Ng·ªçc B·ªôi",
            "created_time_vn": "2025-12-05 22:25:30"
          },
          {
            "id": "100036154251433",
            "name": "Ph·∫°m Ti·∫øn",
            "text": "Ph·∫°m Tr√†",
            "created_time_vn": "2025-12-14 21:15:08"
          },
          {
            "id": "100090804673944",
            "name": "Ph·∫ø Gi·∫•y B√¨a",
            "text": "C√≥ ·ªü h√† huy t·∫≠p gia l√¢m hn ko b",
            "created_time_vn": "2025-12-16 22:13:58"
          },
          {
            "id": "61572424185468",
            "name": "Nguy·ªÖn ƒê·ª©c Tr·ªçng",
            "text": "Inbox",
            "created_time_vn": "2025-12-15 04:08:16"
          },
          {
            "id": "100005916301142",
            "name": "Tai Dao",
            "text": "B√™n m√¨nh c√≥ tuy·ªÉn tham m∆∞u ko em ƒëƒÉng k√Ω su·∫•t",
            "created_time_vn": "2025-12-17 14:27:32"
          },
          {
            "id": "100015011417443",
            "name": "Hoa V≈©",
            "text": "V·ª´a ra tr∆∞·ªùng c√≥ tuy·ªÉn nh√¢n vi√™n kinh doanh kh√¥ng ·∫°",
            "created_time_vn": "2025-12-08 11:31:04"
          },
          {
            "id": "100005138494838",
            "name": "Nguy·ªÖn Anh Tu·∫•n",
            "text": "Inbox",
            "created_time_vn": "2025-12-12 16:30:53"
          },
          {
            "id": "100006534735398",
            "name": "ƒê·∫•t Vi·ªát",
            "text": "C√≥ tuy·ªÉn th·ª£ c∆° kh√≠ kh√¥ng ·∫°",
            "created_time_vn": "2025-12-16 11:42:23"
          },
          {
            "id": "61583260407273",
            "name": "Pco Vi·ªát Nam",
            "text": "Ph·∫°m Hi√™n",
            "created_time_vn": "2025-12-13 06:21:42"
          }
        ],
        "reactions_count": 564,
        "comments_count": 18,
        "reactions_count_before_filter": 564,
        "comments_count_before_filter": 18,
        "status": "success"
      },
      {
        "post_id": "4432161690347913",
        "flag": "v√†ng",
        "text": "[H√† ƒê√¥ng, HN] TUY·ªÇN V·∫¨N H√ÄNH S√ÄN TMƒêT L∆Ø∆†NG 6M - 12M !! KH√îNG YC KINH NGHI·ªÜM",
        "owning_profile": {
          "__typename": "User",
          "name": "Nguy·ªÖn H√† Thu",
          "id": "100007869585114"
        },
        "source_file": "b77da63d-af55-43c2-ab7f-364250b20e30.json",
        "profile_id": "b77da63d-af55-43c2-ab7f-364250b20e30",
        "reactions": [
          {
            "id": "100044138143352",
            "name": "Kh√°nh Ph∆∞∆°ng"
          },
          {
            "id": "100032767399249",
            "name": "H·∫±ng Nguy·ªÖn"
          }
        ],
        "comments": [],
        "reactions_count": 2,
        "comments_count": 0,
        "reactions_count_before_filter": 2,
        "comments_count_before_filter": 0,
        "status": "success"
      },
      {
        "post_id": "122171583440394422",
        "flag": "xanh",
        "text": "‚ú® NHA KHOA META TUY·ªÇN D·ª§NG ‚ú® V·ªã tr√≠: B√°c sƒ© RƒÉng S·ª© Th·∫©m M·ªπ Ch√∫ng t√¥i t√¨m ki·∫øm b√°c sƒ© c√≥ ƒë·ªãnh h∆∞·ªõng ph√°t tri·ªÉn l√¢u d√†i trong lƒ©nh v·ª±c rƒÉng s·ª© th·∫©m m·ªπ, mong mu·ªën l√†m vi·ªác trong m√¥i tr∆∞·ªùng chu·∫©n ch·ªânh, t√¥n tr·ªçng chuy√™n m√¥n v√† gi√° tr·ªã c√° nh√¢n. üí∞ Thu nh·∫≠p: Th·ªèa thu·∫≠n theo nƒÉng l·ª±c (L∆∞∆°ng c·ª©ng + KPI + Th∆∞·ªüng + Ph·ª• c·∫•p) üîπ H·ªá th·ªëng m√°y m√≥c hi·ªán ƒë·∫°i üîπ Ngu·ªìn kh√°ch ·ªïn ƒë·ªãnh üîπ Ekip h·ªó tr·ª£ chuy√™n m√¥n üîπ Quy tr√¨nh r√µ r√†ng ‚Äì minh b·∫°ch üìç ƒê·ªãa ch·ªâ: 391 Tr∆∞·ªùng Chinh, Thanh Xu√¢n, H√† N·ªôi üì≤ Li√™n h·ªá ·ª©ng tuy·ªÉn: 036.903.6666",
        "owning_profile": {
          "__typename": "User",
          "name": "Tuy·ªÉn D·ª•ng Nh√¢n S·ª± Nha Khoa H√† N·ªôi",
          "id": "61561832674763"
        },
        "source_file": "b77da63d-af55-43c2-ab7f-364250b20e30.json",
        "profile_id": "b77da63d-af55-43c2-ab7f-364250b20e30",
        "reactions": [],
        "comments": [],
        "reactions_count": 0,
        "comments_count": 0,
        "reactions_count_before_filter": 0,
        "comments_count_before_filter": 0,
        "status": "success"
      },
      {
        "post_id": "24955032474094131",
        "flag": "v√†ng",
        "text": "[BSV] Tuy·ªÉn d·ª•ng NV cho T·∫≠p ƒêo√†n VIETTEL: - NV VƒÇN PH√íNG l√†m gi·ªù h√†nh ch√≠nh üí∞ Thu nh·∫≠p 8-15tr. Ch∆∞a t√≠nh l∆∞∆°ng th∆∞·ªüng - L√†m t·∫°i tr·ª• s·ªü VIETTEL HCM - ƒê·ªãa ch·ªâ l√†m vi·ªác: 158/2A Ho√†ng Hoa Th√°m, ph∆∞·ªùng 12, Q.T√¢n B√¨nh üëâ kh√¥ng y√™u c·∫ßu kinh nghi·ªám üëâ Ch·∫ø ƒë·ªô ph√∫c l·ª£i t·ªët ‚úÖ Ch·∫•m ƒë·ªÉ nh·∫≠n JD Th√¥ng tin contact: ‚ú´ Li√™n h·ªá b·ªô ph·∫≠n tuy·ªÉn d·ª•ng : 0922312726 Mr Nhi·ªám ‚ú´ Email: truonghuunhiem@bs24vietnam.vn",
        "owning_profile": {
          "__typename": "User",
          "name": "Gia Minh",
          "id": "61568481862081"
        },
        "source_file": "b77da63d-af55-43c2-ab7f-364250b20e30.json",
        "profile_id": "b77da63d-af55-43c2-ab7f-364250b20e30",
        "reactions": [
          {
            "id": "100044138143352",
            "name": "Kh√°nh Ph∆∞∆°ng"
          },
          {
            "id": "61555926982278",
            "name": "Vi·ªác L√†m Ph√∫ M·ªπ"
          },
          {
            "id": "61556361794883",
            "name": "Ng√¥ H√†"
          },
          {
            "id": "61557564590049",
            "name": "Tr·∫ßn Qu·ªëc T√∫"
          },
          {
            "id": "61558261029036",
            "name": "Pun Meo"
          },
          {
            "id": "61561883510251",
            "name": "Channie Quinh"
          },
          {
            "id": "61563309960672",
            "name": "ƒê·∫∑ng H·∫£i Long"
          },
          {
            "id": "61564917926512",
            "name": "L.A Club Bida & Coffee Chill"
          },
          {
            "id": "61565563724536",
            "name": "Nguy·ªÖn Ch√¢u"
          },
          {
            "id": "61572284594958",
            "name": "Sunny Nguy·ªÖn"
          },
          {
            "id": "61573721417341",
            "name": "Nguy·ªÖn B√° Gia"
          },
          {
            "id": "61574207106597",
            "name": "Tr·∫ßn Linhh"
          },
          {
            "id": "61576229670272",
            "name": "Linh Hoang"
          },
          {
            "id": "61577279735800",
            "name": "Qu·ª≥nh Anh Hr"
          },
          {
            "id": "61580336013397",
            "name": "Tuy·ªÉn d·ª•ng Hoa Sen"
          },
          {
            "id": "61581536426647",
            "name": "Nguy·ªÖn Ph·ª•ng"
          },
          {
            "id": "61582805619015",
            "name": "Tuy·ªÉn D·ª•ng ACC GROUP"
          },
          {
            "id": "61583305625966",
            "name": "Thanh Th·∫£o"
          },
          {
            "id": "61583764201891",
            "name": "Tr∆∞∆°ng Tr∆∞∆°ng"
          },
          {
            "id": "61584608215620",
            "name": "Th·∫£o Th·∫£o"
          },
          {
            "id": "100001457361807",
            "name": "B√¨nh Nguy·ªÖn"
          },
          {
            "id": "100002952513568",
            "name": "Hung Nguyen Van"
          },
          {
            "id": "100004481532439",
            "name": "T√¢m Nguy·ªÖn"
          },
          {
            "id": "100004482543910",
            "name": "Th√πy Duy√™n"
          },
          {
            "id": "100005340428521",
            "name": "ƒê√†o Kim Dung"
          },
          {
            "id": "100005469367692",
            "name": "H·∫£i Tr·∫ßn"
          },
          {
            "id": "100005516567580",
            "name": "Nguy·ªÖn Song H·∫£i My"
          },
          {
            "id": "100005955429677",
            "name": "ƒê√†o C·∫©m T√∫"
          },
          {
            "id": "100006028202461",
            "name": "Nguy·ªÖn Quang ƒêƒÉng"
          },
          {
            "id": "100006251405539",
            "name": "√Åi Th·∫£o"
          },
          {
            "id": "100006269208618",
            "name": "Ng·ªçc Ji"
          },
          {
            "id": "100006289146409",
            "name": "L√™ Th·ªã Ng·ªçc Tuy·∫øt"
          },
          {
            "id": "100006726301264",
            "name": "H·ªØu Vinh"
          },
          {
            "id": "100006842225833",
            "name": "Nguy·ªÖn C√¥ng Tu·∫•n"
          },
          {
            "id": "100007223975129",
            "name": "Ho√†ng Ng·ªçc V√¢n"
          },
          {
            "id": "100008214033618",
            "name": "Ph∆∞∆°ngg Thu·ª≥y"
          },
          {
            "id": "100008470120812",
            "name": "Hen Lai Sau"
          },
          {
            "id": "100008819281046",
            "name": "T∆∞·ªùng Vi"
          },
          {
            "id": "100010908542354",
            "name": "Tr∆∞∆°ng Y·∫øn Ng·ªçc"
          },
          {
            "id": "100011164030217",
            "name": "Phan H·∫±ng"
          },
          {
            "id": "100011299489100",
            "name": "Nh√£ H√†n"
          },
          {
            "id": "100011388368250",
            "name": "Ng·ªç Nguy·ªÖn"
          },
          {
            "id": "100011467005548",
            "name": "Mai L√™ Thu√Ω Anh"
          },
          {
            "id": "100011626330258",
            "name": "Chini Yang"
          },
          {
            "id": "100012223865593",
            "name": "B√πi Phi Khanh"
          },
          {
            "id": "100012229563696",
            "name": "Huy Nguy·ªÖn"
          },
          {
            "id": "100013120636790",
            "name": "Nguy·ªÖn H·∫≠u"
          },
          {
            "id": "100013203721316",
            "name": "Thu Ho√†i"
          },
          {
            "id": "100013824304893",
            "name": "V√¢n Trinh"
          },
          {
            "id": "100013891117509",
            "name": "Nguy·ªÖn Tu·∫•n Thanh T√πng"
          },
          {
            "id": "100014181169457",
            "name": "Anh Thi"
          },
          {
            "id": "100014186708092",
            "name": "Thanh Ph√°t"
          },
          {
            "id": "100014468773048",
            "name": "Ngoc Ngoc"
          },
          {
            "id": "100015023324224",
            "name": "Th·∫£o Vy"
          },
          {
            "id": "100021958921727",
            "name": "Nguy·ªÖn Th∆°m"
          },
          {
            "id": "100022909296508",
            "name": "Thu Ho√†i"
          },
          {
            "id": "100023342140984",
            "name": "Ng√¥ Th·ªã Thanh Th·ªßy"
          },
          {
            "id": "100025315715732",
            "name": "Dang Hai Hoang"
          },
          {
            "id": "100026564893365",
            "name": "Tr·∫ßn Th·ªã Ch√¢u Giang"
          },
          {
            "id": "100029755934272",
            "name": "Nguy·ªÖn Y·∫øn Nhi"
          },
          {
            "id": "100034383453231",
            "name": "Thanh Mai"
          },
          {
            "id": "100035525660779",
            "name": "Tr·∫ßn Ch∆∞∆°ng"
          },
          {
            "id": "100038020578188",
            "name": "Pii An"
          },
          {
            "id": "100039707792352",
            "name": "H√† Thanh M·ªπ Tr·∫ßn"
          },
          {
            "id": "100055043149966",
            "name": "Ti·∫øn V√µ"
          },
          {
            "id": "100056627937098",
            "name": "Minh Uy√™n"
          },
          {
            "id": "100056634771689",
            "name": "Hu·ª≥nh Quy√™n"
          },
          {
            "id": "100057082697388",
            "name": "Qu·ª≥nh Qu·ª≥nh"
          },
          {
            "id": "100060628333297",
            "name": "Nh·∫•t Long"
          },
          {
            "id": "100063156952990",
            "name": "John Cris"
          },
          {
            "id": "100068553722908",
            "name": "Ngoc Anh"
          },
          {
            "id": "100070362357401",
            "name": "Mai Ph∆∞∆°ng"
          },
          {
            "id": "100073323880572",
            "name": "Qu·ª≥nh Nh∆∞"
          },
          {
            "id": "100078738384859",
            "name": "Ho√†ng Nam"
          },
          {
            "id": "100079433324177",
            "name": "Vu Hai Anh"
          },
          {
            "id": "100082436944869",
            "name": "V√µ Th√†nh L·∫≠p"
          },
          {
            "id": "100083490734727",
            "name": "Nguy·ªÖn Nhi"
          },
          {
            "id": "100086954269137",
            "name": "Ngoc Khanh"
          },
          {
            "id": "100088595622359",
            "name": "B√∫n B√∫n"
          },
          {
            "id": "100094453605425",
            "name": "Minh Thu"
          },
          {
            "id": "100095678641731",
            "name": "Thanh Th·∫£o"
          }
        ],
        "comments": [],
        "reactions_count": 81,
        "comments_count": 0,
        "reactions_count_before_filter": 81,
        "comments_count_before_filter": 0,
        "status": "success"
      },
      {
        "post_id": "2198533247305479",
        "flag": "v√†ng",
        "text": "V·ªã tr√≠ tuy·ªÉn d·ª•ng: L√†m vi·ªác 8 ti·∫øng ü•∞ ‚Ä¢Nh√¢n vi√™n than Full : 8.500.000vnd ( Tuy·ªÉn nh√¢n vi√™n l√†m vi·ªác l√¢u d√†i ) ‚Ä¢Nh√¢n vi√™n L·ªÖ t√¢n Full ca g√£y ho·∫∑c chuy√™n ca 12h~20h30 . L∆∞∆°ng tho·∫£ thu·∫≠n ‚Ä¢Nh√¢n vi√™n ph·ª•c v·ª•: Nh√¢n vi√™n fulltime Nh√† h√†ng H√†n Qu·ªëc Ca g√£y 10h-14h/17h-22h ho·∫∑c 9h-14h/17h-21h ( ngh·ªâ tr∆∞a 3 ti·∫øng ) ho·∫∑c Ca part xoay ca linh ƒë·ªông 10h-14h v√† 18h - 22h. Ho·∫∑c part 12h-16h30 v√† 13h - 17h30. - Ch·∫ø ƒë·ªô, quy·ªÅn l·ª£i: L∆∞∆°ng c∆° b·∫£n + ƒÉn ca 2 b·ªØa + h·ªó tr·ª£ ti·ªÅn ƒëi l·∫°i + 100% TI·ªÄN TIP. L√†m 26ng√†y/th√°ng - ƒê·ªëi v·ªõi nh√¢n vi√™n full sau 6 th√°ng h∆∞·ªüng ph√©p nƒÉm, v√† ƒë·ªëi v·ªõi t·∫•t c·∫£ nh√¢n vi√™n ng√†y L·ªÖ T·∫øt x 400% l∆∞∆°ng + th∆∞·ªüng . Thu nh·∫≠p t·ª´ 6-10tr ‚Ä¢M√¥i tr∆∞·ªùng tr·∫ª trung, th√¢n thi·ªán, ƒë·ªìng nghi·ªáp d·ªÖ th∆∞∆°ng ‚Ä¢C∆° h·ªôi h·ªçc h·ªèi k·ªπ nƒÉng giao ti·∫øp, ph·ª•c v·ª• chuy√™n nghi·ªáp Y√™u c·∫ßu: ‚Ä¢Kh√¥ng y√™u c·∫ßu kinh nghi·ªám (s·∫Ω ƒë∆∞·ª£c ƒë√†o t·∫°o) ‚Ä¢Nhanh nh·∫πn, chƒÉm ch·ªâ, c√≥ tinh th·∫ßn tr√°ch nhi·ªám ‚Ä¢Th√°i ƒë·ªô vui v·∫ª, l·ªãch s·ª± v·ªõi kh√°ch h√†ng üìç ƒê·ªãa ch·ªâ: Nh√† h√†ng GOJUMONG CASUAL t·∫ßng 6 Lotte Li·ªÖu Giai üìû Li√™n h·ªá tr·ª±c ti·∫øp ho·∫∑c zalo: Qu·∫£n l√Ω Mrs Trang: 0987.469.405",
        "owning_profile": {
          "__typename": "User",
          "name": "Trang L√™",
          "id": "100006577548369"
        },
        "source_file": "b77da63d-af55-43c2-ab7f-364250b20e30.json",
        "profile_id": "b77da63d-af55-43c2-ab7f-364250b20e30",
        "reactions": [
          {
            "id": "100044138143352",
            "name": "Kh√°nh Ph∆∞∆°ng"
          },
          {
            "id": "61563280557067",
            "name": "Nguy·ªÖn H√πng C∆∞·ªùng"
          },
          {
            "id": "61574450648872",
            "name": "Thu√Ω H√†"
          },
          {
            "id": "61576353419525",
            "name": "Ho√†ng Qu·ªëc Vi·ªát"
          },
          {
            "id": "61582825323894",
            "name": "Ng·ªçc Linh - Nem N∆∞·ªõng Nha Trang "
          },
          {
            "id": "100003640788400",
            "name": "Hai Dang"
          },
          {
            "id": "100005960256358",
            "name": "V≈© Th·ªã B√≠ch L·ªá"
          },
          {
            "id": "100009222477267",
            "name": "Ph·∫°m Vi·ªát Anh"
          },
          {
            "id": "100015201542172",
            "name": "Nguy·ªÖn Loan"
          },
          {
            "id": "100025139152808",
            "name": "Tuoi Bui"
          },
          {
            "id": "100027238878170",
            "name": "C·∫©m T√∫"
          },
          {
            "id": "100029778233874",
            "name": "H·∫±ng Ni"
          },
          {
            "id": "100042693051495",
            "name": "Nguy·ªÖn Trang"
          },
          {
            "id": "100046940032349",
            "name": "L∆∞∆°ng √Ånh"
          },
          {
            "id": "100048126162429",
            "name": "Kim Ph·ª•ng"
          },
          {
            "id": "100049220042731",
            "name": "B√¨nh D∆∞∆°ng L√™"
          }
        ],
        "comments": [
          {
            "id": "100023363242962",
            "name": "Tin Tin",
            "text": "Trang L√™ c√≥ tuy·ªÉn nh√¢n vi√™n b·∫øp kh√¥ng ·∫°",
            "created_time_vn": "2025-11-22 17:30:19"
          },
          {
            "id": "100028298443377",
            "name": "B√πi Linh",
            "text": "üì£ NH√Ä H√ÄNG UMAI OMAKASE D·ª§NG ‚Äì PH·ª§C V·ª§ N·ªÆ\n\n‚ú® V·ªã tr√≠: Nh√¢n vi√™n ph·ª•c v·ª• n·ªØ\n‚è∞ Th·ªùi gian: Fulltime 10h -14h, 17h - 22h\n\nY√™u c·∫ßu:\n ‚Ä¢ Ngo·∫°i h√¨nh ∆∞a nh√¨n, nhanh nh·∫πn\n ‚Ä¢ Si√™ng nƒÉng, ch·ªãu kh√≥, h·ªó tr·ª£ ƒë·ªìng ƒë·ªôi t·ªët\n ‚Ä¢ Kh√¥ng c·∫ßn kinh nghi·ªám (s·∫Ω ƒë∆∞·ª£c ƒë√†o t·∫°o)\n\nQuy·ªÅn l·ª£i:\n ‚Ä¢ L∆∞∆°ng 8tr ( 28 c√¥ng ) + th∆∞·ªüng theo nƒÉng l·ª±c\n ‚Ä¢ M√¥i tr∆∞·ªùng l√†m vi·ªác chuy√™n nghi·ªáp, th√¢n thi·ªán\n ‚Ä¢ Tip m·ªói ng√†y\n\nüìç ƒê·ªäA ƒêI·ªÇM L√ÄM VI·ªÜC: Nh√† h√†ng UMAI OMAKASE 11 M·∫°c Th√°i T√¥ng, C·∫ßu Gi·∫•y, H√† N·ªôi\nüìû LI√äN H·ªÜ ·ª®NG TUY·ªÇN: Mr Linh Sƒët: 0949213939",
            "created_time_vn": "2025-12-06 17:02:45"
          },
          {
            "id": "100013761460826",
            "name": "H∆∞∆°ng Ly",
            "text": "üì¢NH√Ä H√ÄNG ONGI JIAJANG ‚Äì QU√ÅN M·ª≤ T∆Ø∆†NG ƒêEN H√ÄN QU·ªêC TUY·ªÇN D·ª§NG G·∫§P\nüìç ƒê·ªãa ch·ªâ l√†m vi·ªác: 230 Nguy·ªÖn VƒÉn Tuy·∫øt, ƒê·ªëng ƒêa, H√† N·ªôi \nüìçGi·ªù l√†m: 10h-13h30 v√† 16h30-22h\nHi·ªán t·∫°i nh√† h√†ng ƒëang c·∫ßn b·ªï sung nh√¢n s·ª± cho c√°c v·ªã tr√≠ sau:\n1Ô∏è‚É£ Qu·∫£n l√Ω\n2Ô∏è‚É£ Ph·ª• b·∫øp (BAO ƒÇN ·ªû)\n3Ô∏è‚É£ Nh√¢n vi√™n ph·ª•c v·ª• (Part-time/Full-time) (BAO ƒÇN CA)\nüì± ·ª©ng tuy·ªÉn Zl: 0877 213 681 (H∆∞∆°ng Ly)",
            "created_time_vn": "2025-11-20 09:49:55"
          },
          {
            "id": "100020526768178",
            "name": "C·∫©m T√∫",
            "text": "TUY·ªÇN D·ª§NG T·∫†I NH√Ä H√ÄNG BBQ ONG MAP Q2‚ú®\nS·ªë l∆∞·ª£ng tuy·ªÉn d·ª•ng:\nü§µüèª V·ªã tr√≠ nh√¢n vi√™n ph·ª•c v·ª• full time v√† part time\n‚≠ê Kh√¥ng y√™u c·∫ßu kinh nghi·ªám, s·∫Ω ƒë∆∞·ª£c ƒë√†o t·∫°o \n‚≠ê ∆Øu ti√™n nh·ªØng b·∫°n c√≥ th·ªÉ giao ti·∫øp ti·∫øng h√†n, nhanh nh·∫πn, chƒÉm ch·ªâ, t√≠nh c√°ch vui v·∫ª, ho√† ƒë·ªìng\n\n* Full time\n‚≠ê L∆∞∆°ng: 9.000.000 - 14.000.000 \n‚≠êÔ∏è Th·ªùi gian l√†m vi·ªác: 12h -10h v√† 15h - 1h \n‚≠ê Bonus t·ª´ 2.000.000/ th√°ng\n\n* Part time\n‚≠ê L∆∞∆°ng 33k/h - 36k/h + bonus cao\n‚≠êÔ∏è Th·ªùi gian l√†m vi·ªác: 11h - 15h, 18h- 23h v√† 18h - 1h \n\nüè† ƒê·ªäA ƒêI·ªÇM L√ÄM VI·ªÜC:\n45 Song H√†nh, An Ph√∫, Q2\nBBQ √îNG M·∫¨P Qu·∫≠n 2\n38 Tr·∫ßn Ng·ªçc Di·ªán, Th·∫£o ƒêi·ªÅn, Q2\nBBQ √îng M·∫≠p Th·∫£o ƒêi·ªÅn Îö±Î≥¥Ïßë ÌÉÄÏò§ÎîîÏóî\n\nüí¨Li√™n h·ªá: 0909886320- Th∆∞",
            "created_time_vn": "2025-12-01 13:54:32"
          },
          {
            "id": "100082569921800",
            "name": "Minh Huy·ªÅn",
            "text": "Trung t√¢m Anh ng·ªØ EFIS English (Ch√πa L√°ng) hi·ªán ƒëang tuy·ªÉn:\n‚Ä¢ Gi·∫£ng vi√™n Ti·∫øng Anh giao ti·∫øp\n‚Ä¢ Chuy√™n vi√™n T∆∞ v·∫•n\n‚Ä¢ Marketing SEO\n‚Ä¢ Event ‚Äì Social\n\nB·∫°n n√†o quan t√¢m comment ho·∫∑c inbox m√¨nh g·ª≠i JD chi ti·∫øt nh√© üå±",
            "created_time_vn": "2025-12-22 09:05:44"
          }
        ],
        "reactions_count": 16,
        "comments_count": 5,
        "reactions_count_before_filter": 16,
        "comments_count_before_filter": 7,
        "status": "success"
      }
    ]
  },
  "total_posts_processed": 10,
  "total_reactions": 1326,
  "total_comments": 46
}
--- END FILE: backend\data\results\all_results_20251222_220621.json ---

--- START FILE: backend\data\results\all_results_20251222_221333.json ---
{
  "total_files": 1,
  "results_by_file": {
    "b77da63d-af55-43c2-ab7f-364250b20e30.json": [
      {
        "post_id": "24955032474094131",
        "flag": "v√†ng",
        "text": "[BSV] Tuy·ªÉn d·ª•ng NV cho T·∫≠p ƒêo√†n VIETTEL: - NV VƒÇN PH√íNG l√†m gi·ªù h√†nh ch√≠nh üí∞ Thu nh·∫≠p 8-15tr. Ch∆∞a t√≠nh l∆∞∆°ng th∆∞·ªüng - L√†m t·∫°i tr·ª• s·ªü VIETTEL HCM - ƒê·ªãa ch·ªâ l√†m vi·ªác: 158/2A Ho√†ng Hoa Th√°m, ph∆∞·ªùng 12, Q.T√¢n B√¨nh üëâ kh√¥ng y√™u c·∫ßu kinh nghi·ªám üëâ Ch·∫ø ƒë·ªô ph√∫c l·ª£i t·ªët ‚úÖ Ch·∫•m ƒë·ªÉ nh·∫≠n JD Th√¥ng tin contact: ‚ú´ Li√™n h·ªá b·ªô ph·∫≠n tuy·ªÉn d·ª•ng : 0922312726 Mr Nhi·ªám ‚ú´ Email: truonghuunhiem@bs24vietnam.vn",
        "owning_profile": {
          "__typename": "User",
          "name": "Gia Minh",
          "id": "61568481862081"
        },
        "source_file": "b77da63d-af55-43c2-ab7f-364250b20e30.json",
        "profile_id": "b77da63d-af55-43c2-ab7f-364250b20e30",
        "reactions": [
          {
            "id": "100044138143352",
            "name": "Kh√°nh Ph∆∞∆°ng"
          },
          {
            "id": "61555926982278",
            "name": "Vi·ªác L√†m Ph√∫ M·ªπ"
          },
          {
            "id": "61556361794883",
            "name": "Ng√¥ H√†"
          },
          {
            "id": "61557564590049",
            "name": "Tr·∫ßn Qu·ªëc T√∫"
          },
          {
            "id": "61558261029036",
            "name": "Pun Meo"
          },
          {
            "id": "61561883510251",
            "name": "Channie Quinh"
          },
          {
            "id": "61563309960672",
            "name": "ƒê·∫∑ng H·∫£i Long"
          },
          {
            "id": "61564917926512",
            "name": "L.A Club Bida & Coffee Chill"
          },
          {
            "id": "61565563724536",
            "name": "Nguy·ªÖn Ch√¢u"
          },
          {
            "id": "61572284594958",
            "name": "Sunny Nguy·ªÖn"
          },
          {
            "id": "61573721417341",
            "name": "Nguy·ªÖn B√° Gia"
          },
          {
            "id": "61574207106597",
            "name": "Tr·∫ßn Linhh"
          },
          {
            "id": "61576229670272",
            "name": "Linh Hoang"
          },
          {
            "id": "61577279735800",
            "name": "Qu·ª≥nh Anh Hr"
          },
          {
            "id": "61580336013397",
            "name": "Tuy·ªÉn d·ª•ng Hoa Sen"
          },
          {
            "id": "61581536426647",
            "name": "Nguy·ªÖn Ph·ª•ng"
          },
          {
            "id": "61582805619015",
            "name": "Tuy·ªÉn D·ª•ng ACC GROUP"
          },
          {
            "id": "61583305625966",
            "name": "Thanh Th·∫£o"
          },
          {
            "id": "61583764201891",
            "name": "Tr∆∞∆°ng Tr∆∞∆°ng"
          },
          {
            "id": "61584608215620",
            "name": "Th·∫£o Th·∫£o"
          },
          {
            "id": "100001457361807",
            "name": "B√¨nh Nguy·ªÖn"
          },
          {
            "id": "100002952513568",
            "name": "Hung Nguyen Van"
          },
          {
            "id": "100004481532439",
            "name": "T√¢m Nguy·ªÖn"
          },
          {
            "id": "100004482543910",
            "name": "Th√πy Duy√™n"
          },
          {
            "id": "100005340428521",
            "name": "ƒê√†o Kim Dung"
          },
          {
            "id": "100005469367692",
            "name": "H·∫£i Tr·∫ßn"
          },
          {
            "id": "100005516567580",
            "name": "Nguy·ªÖn Song H·∫£i My"
          },
          {
            "id": "100005955429677",
            "name": "ƒê√†o C·∫©m T√∫"
          },
          {
            "id": "100006028202461",
            "name": "Nguy·ªÖn Quang ƒêƒÉng"
          },
          {
            "id": "100006251405539",
            "name": "√Åi Th·∫£o"
          },
          {
            "id": "100006269208618",
            "name": "Ng·ªçc Ji"
          },
          {
            "id": "100006289146409",
            "name": "L√™ Th·ªã Ng·ªçc Tuy·∫øt"
          },
          {
            "id": "100006726301264",
            "name": "H·ªØu Vinh"
          },
          {
            "id": "100006842225833",
            "name": "Nguy·ªÖn C√¥ng Tu·∫•n"
          },
          {
            "id": "100007223975129",
            "name": "Ho√†ng Ng·ªçc V√¢n"
          },
          {
            "id": "100008214033618",
            "name": "Ph∆∞∆°ngg Thu·ª≥y"
          },
          {
            "id": "100008470120812",
            "name": "Hen Lai Sau"
          },
          {
            "id": "100008819281046",
            "name": "T∆∞·ªùng Vi"
          },
          {
            "id": "100010908542354",
            "name": "Tr∆∞∆°ng Y·∫øn Ng·ªçc"
          },
          {
            "id": "100011164030217",
            "name": "Phan H·∫±ng"
          },
          {
            "id": "100011299489100",
            "name": "Nh√£ H√†n"
          },
          {
            "id": "100011388368250",
            "name": "Ng·ªç Nguy·ªÖn"
          },
          {
            "id": "100011467005548",
            "name": "Mai L√™ Thu√Ω Anh"
          },
          {
            "id": "100011626330258",
            "name": "Chini Yang"
          },
          {
            "id": "100012223865593",
            "name": "B√πi Phi Khanh"
          },
          {
            "id": "100012229563696",
            "name": "Huy Nguy·ªÖn"
          },
          {
            "id": "100013120636790",
            "name": "Nguy·ªÖn H·∫≠u"
          },
          {
            "id": "100013203721316",
            "name": "Thu Ho√†i"
          },
          {
            "id": "100013824304893",
            "name": "V√¢n Trinh"
          },
          {
            "id": "100013891117509",
            "name": "Nguy·ªÖn Tu·∫•n Thanh T√πng"
          },
          {
            "id": "100014181169457",
            "name": "Anh Thi"
          },
          {
            "id": "100014186708092",
            "name": "Thanh Ph√°t"
          },
          {
            "id": "100014468773048",
            "name": "Ngoc Ngoc"
          },
          {
            "id": "100015023324224",
            "name": "Th·∫£o Vy"
          },
          {
            "id": "100021958921727",
            "name": "Nguy·ªÖn Th∆°m"
          },
          {
            "id": "100022909296508",
            "name": "Thu Ho√†i"
          },
          {
            "id": "100023342140984",
            "name": "Ng√¥ Th·ªã Thanh Th·ªßy"
          },
          {
            "id": "100025315715732",
            "name": "Dang Hai Hoang"
          },
          {
            "id": "100026564893365",
            "name": "Tr·∫ßn Th·ªã Ch√¢u Giang"
          },
          {
            "id": "100029755934272",
            "name": "Nguy·ªÖn Y·∫øn Nhi"
          },
          {
            "id": "100034383453231",
            "name": "Thanh Mai"
          },
          {
            "id": "100035525660779",
            "name": "Tr·∫ßn Ch∆∞∆°ng"
          },
          {
            "id": "100038020578188",
            "name": "Pii An"
          },
          {
            "id": "100039707792352",
            "name": "H√† Thanh M·ªπ Tr·∫ßn"
          },
          {
            "id": "100055043149966",
            "name": "Ti·∫øn V√µ"
          },
          {
            "id": "100056627937098",
            "name": "Minh Uy√™n"
          },
          {
            "id": "100056634771689",
            "name": "Hu·ª≥nh Quy√™n"
          },
          {
            "id": "100057082697388",
            "name": "Qu·ª≥nh Qu·ª≥nh"
          },
          {
            "id": "100060628333297",
            "name": "Nh·∫•t Long"
          },
          {
            "id": "100063156952990",
            "name": "John Cris"
          },
          {
            "id": "100068553722908",
            "name": "Ngoc Anh"
          },
          {
            "id": "100070362357401",
            "name": "Mai Ph∆∞∆°ng"
          },
          {
            "id": "100073323880572",
            "name": "Qu·ª≥nh Nh∆∞"
          },
          {
            "id": "100078738384859",
            "name": "Ho√†ng Nam"
          },
          {
            "id": "100079433324177",
            "name": "Vu Hai Anh"
          },
          {
            "id": "100082436944869",
            "name": "V√µ Th√†nh L·∫≠p"
          },
          {
            "id": "100083490734727",
            "name": "Nguy·ªÖn Nhi"
          },
          {
            "id": "100086954269137",
            "name": "Ngoc Khanh"
          },
          {
            "id": "100088595622359",
            "name": "B√∫n B√∫n"
          },
          {
            "id": "100094453605425",
            "name": "Minh Thu"
          },
          {
            "id": "100095678641731",
            "name": "Thanh Th·∫£o"
          }
        ],
        "comments": [],
        "reactions_count": 81,
        "comments_count": 0,
        "reactions_count_before_filter": 81,
        "comments_count_before_filter": 0,
        "status": "success"
      },
      {
        "post_id": "2198533247305479",
        "flag": "v√†ng",
        "text": "V·ªã tr√≠ tuy·ªÉn d·ª•ng: L√†m vi·ªác 8 ti·∫øng ü•∞ ‚Ä¢Nh√¢n vi√™n than Full : 8.500.000vnd ( Tuy·ªÉn nh√¢n vi√™n l√†m vi·ªác l√¢u d√†i ) ‚Ä¢Nh√¢n vi√™n L·ªÖ t√¢n Full ca g√£y ho·∫∑c chuy√™n ca 12h~20h30 . L∆∞∆°ng tho·∫£ thu·∫≠n ‚Ä¢Nh√¢n vi√™n ph·ª•c v·ª•: Nh√¢n vi√™n fulltime Nh√† h√†ng H√†n Qu·ªëc Ca g√£y 10h-14h/17h-22h ho·∫∑c 9h-14h/17h-21h ( ngh·ªâ tr∆∞a 3 ti·∫øng ) ho·∫∑c Ca part xoay ca linh ƒë·ªông 10h-14h v√† 18h - 22h. Ho·∫∑c part 12h-16h30 v√† 13h - 17h30. - Ch·∫ø ƒë·ªô, quy·ªÅn l·ª£i: L∆∞∆°ng c∆° b·∫£n + ƒÉn ca 2 b·ªØa + h·ªó tr·ª£ ti·ªÅn ƒëi l·∫°i + 100% TI·ªÄN TIP. L√†m 26ng√†y/th√°ng - ƒê·ªëi v·ªõi nh√¢n vi√™n full sau 6 th√°ng h∆∞·ªüng ph√©p nƒÉm, v√† ƒë·ªëi v·ªõi t·∫•t c·∫£ nh√¢n vi√™n ng√†y L·ªÖ T·∫øt x 400% l∆∞∆°ng + th∆∞·ªüng . Thu nh·∫≠p t·ª´ 6-10tr ‚Ä¢M√¥i tr∆∞·ªùng tr·∫ª trung, th√¢n thi·ªán, ƒë·ªìng nghi·ªáp d·ªÖ th∆∞∆°ng ‚Ä¢C∆° h·ªôi h·ªçc h·ªèi k·ªπ nƒÉng giao ti·∫øp, ph·ª•c v·ª• chuy√™n nghi·ªáp Y√™u c·∫ßu: ‚Ä¢Kh√¥ng y√™u c·∫ßu kinh nghi·ªám (s·∫Ω ƒë∆∞·ª£c ƒë√†o t·∫°o) ‚Ä¢Nhanh nh·∫πn, chƒÉm ch·ªâ, c√≥ tinh th·∫ßn tr√°ch nhi·ªám ‚Ä¢Th√°i ƒë·ªô vui v·∫ª, l·ªãch s·ª± v·ªõi kh√°ch h√†ng üìç ƒê·ªãa ch·ªâ: Nh√† h√†ng GOJUMONG CASUAL t·∫ßng 6 Lotte Li·ªÖu Giai üìû Li√™n h·ªá tr·ª±c ti·∫øp ho·∫∑c zalo: Qu·∫£n l√Ω Mrs Trang: 0987.469.405",
        "owning_profile": {
          "__typename": "User",
          "name": "Trang L√™",
          "id": "100006577548369"
        },
        "source_file": "b77da63d-af55-43c2-ab7f-364250b20e30.json",
        "profile_id": "b77da63d-af55-43c2-ab7f-364250b20e30",
        "reactions": [
          {
            "id": "100044138143352",
            "name": "Kh√°nh Ph∆∞∆°ng"
          },
          {
            "id": "61563280557067",
            "name": "Nguy·ªÖn H√πng C∆∞·ªùng"
          },
          {
            "id": "61574450648872",
            "name": "Thu√Ω H√†"
          },
          {
            "id": "61576353419525",
            "name": "Ho√†ng Qu·ªëc Vi·ªát"
          },
          {
            "id": "61582825323894",
            "name": "Ng·ªçc Linh - Nem N∆∞·ªõng Nha Trang "
          },
          {
            "id": "100003640788400",
            "name": "Hai Dang"
          },
          {
            "id": "100005960256358",
            "name": "V≈© Th·ªã B√≠ch L·ªá"
          },
          {
            "id": "100009222477267",
            "name": "Ph·∫°m Vi·ªát Anh"
          },
          {
            "id": "100015201542172",
            "name": "Nguy·ªÖn Loan"
          },
          {
            "id": "100025139152808",
            "name": "Tuoi Bui"
          },
          {
            "id": "100027238878170",
            "name": "C·∫©m T√∫"
          },
          {
            "id": "100029778233874",
            "name": "H·∫±ng Ni"
          },
          {
            "id": "100042693051495",
            "name": "Nguy·ªÖn Trang"
          },
          {
            "id": "100046940032349",
            "name": "L∆∞∆°ng √Ånh"
          },
          {
            "id": "100048126162429",
            "name": "Kim Ph·ª•ng"
          },
          {
            "id": "100049220042731",
            "name": "B√¨nh D∆∞∆°ng L√™"
          }
        ],
        "comments": [
          {
            "id": "100023363242962",
            "name": "Tin Tin",
            "text": "Trang L√™ c√≥ tuy·ªÉn nh√¢n vi√™n b·∫øp kh√¥ng ·∫°",
            "created_time_vn": "2025-11-22 17:30:19"
          },
          {
            "id": "100028298443377",
            "name": "B√πi Linh",
            "text": "üì£ NH√Ä H√ÄNG UMAI OMAKASE D·ª§NG ‚Äì PH·ª§C V·ª§ N·ªÆ\n\n‚ú® V·ªã tr√≠: Nh√¢n vi√™n ph·ª•c v·ª• n·ªØ\n‚è∞ Th·ªùi gian: Fulltime 10h -14h, 17h - 22h\n\nY√™u c·∫ßu:\n ‚Ä¢ Ngo·∫°i h√¨nh ∆∞a nh√¨n, nhanh nh·∫πn\n ‚Ä¢ Si√™ng nƒÉng, ch·ªãu kh√≥, h·ªó tr·ª£ ƒë·ªìng ƒë·ªôi t·ªët\n ‚Ä¢ Kh√¥ng c·∫ßn kinh nghi·ªám (s·∫Ω ƒë∆∞·ª£c ƒë√†o t·∫°o)\n\nQuy·ªÅn l·ª£i:\n ‚Ä¢ L∆∞∆°ng 8tr ( 28 c√¥ng ) + th∆∞·ªüng theo nƒÉng l·ª±c\n ‚Ä¢ M√¥i tr∆∞·ªùng l√†m vi·ªác chuy√™n nghi·ªáp, th√¢n thi·ªán\n ‚Ä¢ Tip m·ªói ng√†y\n\nüìç ƒê·ªäA ƒêI·ªÇM L√ÄM VI·ªÜC: Nh√† h√†ng UMAI OMAKASE 11 M·∫°c Th√°i T√¥ng, C·∫ßu Gi·∫•y, H√† N·ªôi\nüìû LI√äN H·ªÜ ·ª®NG TUY·ªÇN: Mr Linh Sƒët: 0949213939",
            "created_time_vn": "2025-12-06 17:02:45"
          },
          {
            "id": "100013761460826",
            "name": "H∆∞∆°ng Ly",
            "text": "üì¢NH√Ä H√ÄNG ONGI JIAJANG ‚Äì QU√ÅN M·ª≤ T∆Ø∆†NG ƒêEN H√ÄN QU·ªêC TUY·ªÇN D·ª§NG G·∫§P\nüìç ƒê·ªãa ch·ªâ l√†m vi·ªác: 230 Nguy·ªÖn VƒÉn Tuy·∫øt, ƒê·ªëng ƒêa, H√† N·ªôi \nüìçGi·ªù l√†m: 10h-13h30 v√† 16h30-22h\nHi·ªán t·∫°i nh√† h√†ng ƒëang c·∫ßn b·ªï sung nh√¢n s·ª± cho c√°c v·ªã tr√≠ sau:\n1Ô∏è‚É£ Qu·∫£n l√Ω\n2Ô∏è‚É£ Ph·ª• b·∫øp (BAO ƒÇN ·ªû)\n3Ô∏è‚É£ Nh√¢n vi√™n ph·ª•c v·ª• (Part-time/Full-time) (BAO ƒÇN CA)\nüì± ·ª©ng tuy·ªÉn Zl: 0877 213 681 (H∆∞∆°ng Ly)",
            "created_time_vn": "2025-11-20 09:49:55"
          },
          {
            "id": "100020526768178",
            "name": "C·∫©m T√∫",
            "text": "TUY·ªÇN D·ª§NG T·∫†I NH√Ä H√ÄNG BBQ ONG MAP Q2‚ú®\nS·ªë l∆∞·ª£ng tuy·ªÉn d·ª•ng:\nü§µüèª V·ªã tr√≠ nh√¢n vi√™n ph·ª•c v·ª• full time v√† part time\n‚≠ê Kh√¥ng y√™u c·∫ßu kinh nghi·ªám, s·∫Ω ƒë∆∞·ª£c ƒë√†o t·∫°o \n‚≠ê ∆Øu ti√™n nh·ªØng b·∫°n c√≥ th·ªÉ giao ti·∫øp ti·∫øng h√†n, nhanh nh·∫πn, chƒÉm ch·ªâ, t√≠nh c√°ch vui v·∫ª, ho√† ƒë·ªìng\n\n* Full time\n‚≠ê L∆∞∆°ng: 9.000.000 - 14.000.000 \n‚≠êÔ∏è Th·ªùi gian l√†m vi·ªác: 12h -10h v√† 15h - 1h \n‚≠ê Bonus t·ª´ 2.000.000/ th√°ng\n\n* Part time\n‚≠ê L∆∞∆°ng 33k/h - 36k/h + bonus cao\n‚≠êÔ∏è Th·ªùi gian l√†m vi·ªác: 11h - 15h, 18h- 23h v√† 18h - 1h \n\nüè† ƒê·ªäA ƒêI·ªÇM L√ÄM VI·ªÜC:\n45 Song H√†nh, An Ph√∫, Q2\nBBQ √îNG M·∫¨P Qu·∫≠n 2\n38 Tr·∫ßn Ng·ªçc Di·ªán, Th·∫£o ƒêi·ªÅn, Q2\nBBQ √îng M·∫≠p Th·∫£o ƒêi·ªÅn Îö±Î≥¥Ïßë ÌÉÄÏò§ÎîîÏóî\n\nüí¨Li√™n h·ªá: 0909886320- Th∆∞",
            "created_time_vn": "2025-12-01 13:54:32"
          },
          {
            "id": "100082569921800",
            "name": "Minh Huy·ªÅn",
            "text": "Trung t√¢m Anh ng·ªØ EFIS English (Ch√πa L√°ng) hi·ªán ƒëang tuy·ªÉn:\n‚Ä¢ Gi·∫£ng vi√™n Ti·∫øng Anh giao ti·∫øp\n‚Ä¢ Chuy√™n vi√™n T∆∞ v·∫•n\n‚Ä¢ Marketing SEO\n‚Ä¢ Event ‚Äì Social\n\nB·∫°n n√†o quan t√¢m comment ho·∫∑c inbox m√¨nh g·ª≠i JD chi ti·∫øt nh√© üå±",
            "created_time_vn": "2025-12-22 09:05:44"
          }
        ],
        "reactions_count": 16,
        "comments_count": 5,
        "reactions_count_before_filter": 16,
        "comments_count_before_filter": 7,
        "status": "success"
      }
    ]
  },
  "total_posts_processed": 2,
  "total_reactions": 97,
  "total_comments": 5
}
--- END FILE: backend\data\results\all_results_20251222_221333.json ---

--- START FILE: backend\data\results\all_results_20251222_221814.json ---
{
  "total_files": 1,
  "results_by_file": {
    "b77da63d-af55-43c2-ab7f-364250b20e30.json": [
      {
        "post_id": "24955032474094131",
        "flag": "v√†ng",
        "text": "[BSV] Tuy·ªÉn d·ª•ng NV cho T·∫≠p ƒêo√†n VIETTEL: - NV VƒÇN PH√íNG l√†m gi·ªù h√†nh ch√≠nh üí∞ Thu nh·∫≠p 8-15tr. Ch∆∞a t√≠nh l∆∞∆°ng th∆∞·ªüng - L√†m t·∫°i tr·ª• s·ªü VIETTEL HCM - ƒê·ªãa ch·ªâ l√†m vi·ªác: 158/2A Ho√†ng Hoa Th√°m, ph∆∞·ªùng 12, Q.T√¢n B√¨nh üëâ kh√¥ng y√™u c·∫ßu kinh nghi·ªám üëâ Ch·∫ø ƒë·ªô ph√∫c l·ª£i t·ªët ‚úÖ Ch·∫•m ƒë·ªÉ nh·∫≠n JD Th√¥ng tin contact: ‚ú´ Li√™n h·ªá b·ªô ph·∫≠n tuy·ªÉn d·ª•ng : 0922312726 Mr Nhi·ªám ‚ú´ Email: truonghuunhiem@bs24vietnam.vn",
        "owning_profile": {
          "__typename": "User",
          "name": "Gia Minh",
          "id": "61568481862081"
        },
        "source_file": "b77da63d-af55-43c2-ab7f-364250b20e30.json",
        "profile_id": "b77da63d-af55-43c2-ab7f-364250b20e30",
        "reactions": [
          {
            "id": "100044138143352",
            "name": "Kh√°nh Ph∆∞∆°ng"
          },
          {
            "id": "61555926982278",
            "name": "Vi·ªác L√†m Ph√∫ M·ªπ"
          },
          {
            "id": "61556361794883",
            "name": "Ng√¥ H√†"
          },
          {
            "id": "61557564590049",
            "name": "Tr·∫ßn Qu·ªëc T√∫"
          },
          {
            "id": "61558261029036",
            "name": "Pun Meo"
          },
          {
            "id": "61561883510251",
            "name": "Channie Quinh"
          },
          {
            "id": "61563309960672",
            "name": "ƒê·∫∑ng H·∫£i Long"
          },
          {
            "id": "61564917926512",
            "name": "L.A Club Bida & Coffee Chill"
          },
          {
            "id": "61565563724536",
            "name": "Nguy·ªÖn Ch√¢u"
          },
          {
            "id": "61572284594958",
            "name": "Sunny Nguy·ªÖn"
          },
          {
            "id": "61573721417341",
            "name": "Nguy·ªÖn B√° Gia"
          },
          {
            "id": "61574207106597",
            "name": "Tr·∫ßn Linhh"
          },
          {
            "id": "61576229670272",
            "name": "Linh Hoang"
          },
          {
            "id": "61577279735800",
            "name": "Qu·ª≥nh Anh Hr"
          },
          {
            "id": "61580336013397",
            "name": "Tuy·ªÉn d·ª•ng Hoa Sen"
          },
          {
            "id": "61581536426647",
            "name": "Nguy·ªÖn Ph·ª•ng"
          },
          {
            "id": "61582805619015",
            "name": "Tuy·ªÉn D·ª•ng ACC GROUP"
          },
          {
            "id": "61583305625966",
            "name": "Thanh Th·∫£o"
          },
          {
            "id": "61583764201891",
            "name": "Tr∆∞∆°ng Tr∆∞∆°ng"
          },
          {
            "id": "61584608215620",
            "name": "Th·∫£o Th·∫£o"
          },
          {
            "id": "100001457361807",
            "name": "B√¨nh Nguy·ªÖn"
          },
          {
            "id": "100002952513568",
            "name": "Hung Nguyen Van"
          },
          {
            "id": "100004481532439",
            "name": "T√¢m Nguy·ªÖn"
          },
          {
            "id": "100004482543910",
            "name": "Th√πy Duy√™n"
          },
          {
            "id": "100005340428521",
            "name": "ƒê√†o Kim Dung"
          },
          {
            "id": "100005469367692",
            "name": "H·∫£i Tr·∫ßn"
          },
          {
            "id": "100005516567580",
            "name": "Nguy·ªÖn Song H·∫£i My"
          },
          {
            "id": "100005955429677",
            "name": "ƒê√†o C·∫©m T√∫"
          },
          {
            "id": "100006028202461",
            "name": "Nguy·ªÖn Quang ƒêƒÉng"
          },
          {
            "id": "100006251405539",
            "name": "√Åi Th·∫£o"
          },
          {
            "id": "100006269208618",
            "name": "Ng·ªçc Ji"
          },
          {
            "id": "100006289146409",
            "name": "L√™ Th·ªã Ng·ªçc Tuy·∫øt"
          },
          {
            "id": "100006726301264",
            "name": "H·ªØu Vinh"
          },
          {
            "id": "100006842225833",
            "name": "Nguy·ªÖn C√¥ng Tu·∫•n"
          },
          {
            "id": "100007223975129",
            "name": "Ho√†ng Ng·ªçc V√¢n"
          },
          {
            "id": "100008214033618",
            "name": "Ph∆∞∆°ngg Thu·ª≥y"
          },
          {
            "id": "100008470120812",
            "name": "Hen Lai Sau"
          },
          {
            "id": "100008819281046",
            "name": "T∆∞·ªùng Vi"
          },
          {
            "id": "100010908542354",
            "name": "Tr∆∞∆°ng Y·∫øn Ng·ªçc"
          },
          {
            "id": "100011164030217",
            "name": "Phan H·∫±ng"
          },
          {
            "id": "100011299489100",
            "name": "Nh√£ H√†n"
          },
          {
            "id": "100011388368250",
            "name": "Ng·ªç Nguy·ªÖn"
          },
          {
            "id": "100011467005548",
            "name": "Mai L√™ Thu√Ω Anh"
          },
          {
            "id": "100011626330258",
            "name": "Chini Yang"
          },
          {
            "id": "100012223865593",
            "name": "B√πi Phi Khanh"
          },
          {
            "id": "100012229563696",
            "name": "Huy Nguy·ªÖn"
          },
          {
            "id": "100013120636790",
            "name": "Nguy·ªÖn H·∫≠u"
          },
          {
            "id": "100013203721316",
            "name": "Thu Ho√†i"
          },
          {
            "id": "100013824304893",
            "name": "V√¢n Trinh"
          },
          {
            "id": "100013891117509",
            "name": "Nguy·ªÖn Tu·∫•n Thanh T√πng"
          },
          {
            "id": "100014181169457",
            "name": "Anh Thi"
          },
          {
            "id": "100014186708092",
            "name": "Thanh Ph√°t"
          },
          {
            "id": "100014468773048",
            "name": "Ngoc Ngoc"
          },
          {
            "id": "100015023324224",
            "name": "Th·∫£o Vy"
          },
          {
            "id": "100021958921727",
            "name": "Nguy·ªÖn Th∆°m"
          },
          {
            "id": "100022909296508",
            "name": "Thu Ho√†i"
          },
          {
            "id": "100023342140984",
            "name": "Ng√¥ Th·ªã Thanh Th·ªßy"
          },
          {
            "id": "100025315715732",
            "name": "Dang Hai Hoang"
          },
          {
            "id": "100026564893365",
            "name": "Tr·∫ßn Th·ªã Ch√¢u Giang"
          },
          {
            "id": "100029755934272",
            "name": "Nguy·ªÖn Y·∫øn Nhi"
          },
          {
            "id": "100034383453231",
            "name": "Thanh Mai"
          },
          {
            "id": "100035525660779",
            "name": "Tr·∫ßn Ch∆∞∆°ng"
          },
          {
            "id": "100038020578188",
            "name": "Pii An"
          },
          {
            "id": "100039707792352",
            "name": "H√† Thanh M·ªπ Tr·∫ßn"
          },
          {
            "id": "100055043149966",
            "name": "Ti·∫øn V√µ"
          },
          {
            "id": "100056627937098",
            "name": "Minh Uy√™n"
          },
          {
            "id": "100056634771689",
            "name": "Hu·ª≥nh Quy√™n"
          },
          {
            "id": "100057082697388",
            "name": "Qu·ª≥nh Qu·ª≥nh"
          },
          {
            "id": "100060628333297",
            "name": "Nh·∫•t Long"
          },
          {
            "id": "100063156952990",
            "name": "John Cris"
          },
          {
            "id": "100068553722908",
            "name": "Ngoc Anh"
          },
          {
            "id": "100070362357401",
            "name": "Mai Ph∆∞∆°ng"
          },
          {
            "id": "100073323880572",
            "name": "Qu·ª≥nh Nh∆∞"
          },
          {
            "id": "100078738384859",
            "name": "Ho√†ng Nam"
          },
          {
            "id": "100079433324177",
            "name": "Vu Hai Anh"
          },
          {
            "id": "100082436944869",
            "name": "V√µ Th√†nh L·∫≠p"
          },
          {
            "id": "100083490734727",
            "name": "Nguy·ªÖn Nhi"
          },
          {
            "id": "100086954269137",
            "name": "Ngoc Khanh"
          },
          {
            "id": "100088595622359",
            "name": "B√∫n B√∫n"
          },
          {
            "id": "100094453605425",
            "name": "Minh Thu"
          },
          {
            "id": "100095678641731",
            "name": "Thanh Th·∫£o"
          }
        ],
        "comments": [],
        "reactions_count": 81,
        "comments_count": 0,
        "reactions_count_before_filter": 81,
        "comments_count_before_filter": 0,
        "status": "success"
      },
      {
        "post_id": "2198533247305479",
        "flag": "v√†ng",
        "text": "V·ªã tr√≠ tuy·ªÉn d·ª•ng: L√†m vi·ªác 8 ti·∫øng ü•∞ ‚Ä¢Nh√¢n vi√™n than Full : 8.500.000vnd ( Tuy·ªÉn nh√¢n vi√™n l√†m vi·ªác l√¢u d√†i ) ‚Ä¢Nh√¢n vi√™n L·ªÖ t√¢n Full ca g√£y ho·∫∑c chuy√™n ca 12h~20h30 . L∆∞∆°ng tho·∫£ thu·∫≠n ‚Ä¢Nh√¢n vi√™n ph·ª•c v·ª•: Nh√¢n vi√™n fulltime Nh√† h√†ng H√†n Qu·ªëc Ca g√£y 10h-14h/17h-22h ho·∫∑c 9h-14h/17h-21h ( ngh·ªâ tr∆∞a 3 ti·∫øng ) ho·∫∑c Ca part xoay ca linh ƒë·ªông 10h-14h v√† 18h - 22h. Ho·∫∑c part 12h-16h30 v√† 13h - 17h30. - Ch·∫ø ƒë·ªô, quy·ªÅn l·ª£i: L∆∞∆°ng c∆° b·∫£n + ƒÉn ca 2 b·ªØa + h·ªó tr·ª£ ti·ªÅn ƒëi l·∫°i + 100% TI·ªÄN TIP. L√†m 26ng√†y/th√°ng - ƒê·ªëi v·ªõi nh√¢n vi√™n full sau 6 th√°ng h∆∞·ªüng ph√©p nƒÉm, v√† ƒë·ªëi v·ªõi t·∫•t c·∫£ nh√¢n vi√™n ng√†y L·ªÖ T·∫øt x 400% l∆∞∆°ng + th∆∞·ªüng . Thu nh·∫≠p t·ª´ 6-10tr ‚Ä¢M√¥i tr∆∞·ªùng tr·∫ª trung, th√¢n thi·ªán, ƒë·ªìng nghi·ªáp d·ªÖ th∆∞∆°ng ‚Ä¢C∆° h·ªôi h·ªçc h·ªèi k·ªπ nƒÉng giao ti·∫øp, ph·ª•c v·ª• chuy√™n nghi·ªáp Y√™u c·∫ßu: ‚Ä¢Kh√¥ng y√™u c·∫ßu kinh nghi·ªám (s·∫Ω ƒë∆∞·ª£c ƒë√†o t·∫°o) ‚Ä¢Nhanh nh·∫πn, chƒÉm ch·ªâ, c√≥ tinh th·∫ßn tr√°ch nhi·ªám ‚Ä¢Th√°i ƒë·ªô vui v·∫ª, l·ªãch s·ª± v·ªõi kh√°ch h√†ng üìç ƒê·ªãa ch·ªâ: Nh√† h√†ng GOJUMONG CASUAL t·∫ßng 6 Lotte Li·ªÖu Giai üìû Li√™n h·ªá tr·ª±c ti·∫øp ho·∫∑c zalo: Qu·∫£n l√Ω Mrs Trang: 0987.469.405",
        "owning_profile": {
          "__typename": "User",
          "name": "Trang L√™",
          "id": "100006577548369"
        },
        "source_file": "b77da63d-af55-43c2-ab7f-364250b20e30.json",
        "profile_id": "b77da63d-af55-43c2-ab7f-364250b20e30",
        "reactions": [
          {
            "id": "100044138143352",
            "name": "Kh√°nh Ph∆∞∆°ng"
          },
          {
            "id": "61563280557067",
            "name": "Nguy·ªÖn H√πng C∆∞·ªùng"
          },
          {
            "id": "61574450648872",
            "name": "Thu√Ω H√†"
          },
          {
            "id": "61576353419525",
            "name": "Ho√†ng Qu·ªëc Vi·ªát"
          },
          {
            "id": "61582825323894",
            "name": "Ng·ªçc Linh - Nem N∆∞·ªõng Nha Trang "
          },
          {
            "id": "100003640788400",
            "name": "Hai Dang"
          },
          {
            "id": "100005960256358",
            "name": "V≈© Th·ªã B√≠ch L·ªá"
          },
          {
            "id": "100009222477267",
            "name": "Ph·∫°m Vi·ªát Anh"
          },
          {
            "id": "100015201542172",
            "name": "Nguy·ªÖn Loan"
          },
          {
            "id": "100025139152808",
            "name": "Tuoi Bui"
          },
          {
            "id": "100027238878170",
            "name": "C·∫©m T√∫"
          },
          {
            "id": "100029778233874",
            "name": "H·∫±ng Ni"
          },
          {
            "id": "100042693051495",
            "name": "Nguy·ªÖn Trang"
          },
          {
            "id": "100046940032349",
            "name": "L∆∞∆°ng √Ånh"
          },
          {
            "id": "100048126162429",
            "name": "Kim Ph·ª•ng"
          },
          {
            "id": "100049220042731",
            "name": "B√¨nh D∆∞∆°ng L√™"
          }
        ],
        "comments": [
          {
            "id": "100023363242962",
            "name": "Tin Tin",
            "text": "Trang L√™ c√≥ tuy·ªÉn nh√¢n vi√™n b·∫øp kh√¥ng ·∫°",
            "created_time_vn": "2025-11-22 17:30:19"
          },
          {
            "id": "100028298443377",
            "name": "B√πi Linh",
            "text": "üì£ NH√Ä H√ÄNG UMAI OMAKASE D·ª§NG ‚Äì PH·ª§C V·ª§ N·ªÆ\n\n‚ú® V·ªã tr√≠: Nh√¢n vi√™n ph·ª•c v·ª• n·ªØ\n‚è∞ Th·ªùi gian: Fulltime 10h -14h, 17h - 22h\n\nY√™u c·∫ßu:\n ‚Ä¢ Ngo·∫°i h√¨nh ∆∞a nh√¨n, nhanh nh·∫πn\n ‚Ä¢ Si√™ng nƒÉng, ch·ªãu kh√≥, h·ªó tr·ª£ ƒë·ªìng ƒë·ªôi t·ªët\n ‚Ä¢ Kh√¥ng c·∫ßn kinh nghi·ªám (s·∫Ω ƒë∆∞·ª£c ƒë√†o t·∫°o)\n\nQuy·ªÅn l·ª£i:\n ‚Ä¢ L∆∞∆°ng 8tr ( 28 c√¥ng ) + th∆∞·ªüng theo nƒÉng l·ª±c\n ‚Ä¢ M√¥i tr∆∞·ªùng l√†m vi·ªác chuy√™n nghi·ªáp, th√¢n thi·ªán\n ‚Ä¢ Tip m·ªói ng√†y\n\nüìç ƒê·ªäA ƒêI·ªÇM L√ÄM VI·ªÜC: Nh√† h√†ng UMAI OMAKASE 11 M·∫°c Th√°i T√¥ng, C·∫ßu Gi·∫•y, H√† N·ªôi\nüìû LI√äN H·ªÜ ·ª®NG TUY·ªÇN: Mr Linh Sƒët: 0949213939",
            "created_time_vn": "2025-12-06 17:02:45"
          },
          {
            "id": "100013761460826",
            "name": "H∆∞∆°ng Ly",
            "text": "üì¢NH√Ä H√ÄNG ONGI JIAJANG ‚Äì QU√ÅN M·ª≤ T∆Ø∆†NG ƒêEN H√ÄN QU·ªêC TUY·ªÇN D·ª§NG G·∫§P\nüìç ƒê·ªãa ch·ªâ l√†m vi·ªác: 230 Nguy·ªÖn VƒÉn Tuy·∫øt, ƒê·ªëng ƒêa, H√† N·ªôi \nüìçGi·ªù l√†m: 10h-13h30 v√† 16h30-22h\nHi·ªán t·∫°i nh√† h√†ng ƒëang c·∫ßn b·ªï sung nh√¢n s·ª± cho c√°c v·ªã tr√≠ sau:\n1Ô∏è‚É£ Qu·∫£n l√Ω\n2Ô∏è‚É£ Ph·ª• b·∫øp (BAO ƒÇN ·ªû)\n3Ô∏è‚É£ Nh√¢n vi√™n ph·ª•c v·ª• (Part-time/Full-time) (BAO ƒÇN CA)\nüì± ·ª©ng tuy·ªÉn Zl: 0877 213 681 (H∆∞∆°ng Ly)",
            "created_time_vn": "2025-11-20 09:49:55"
          },
          {
            "id": "100020526768178",
            "name": "C·∫©m T√∫",
            "text": "TUY·ªÇN D·ª§NG T·∫†I NH√Ä H√ÄNG BBQ ONG MAP Q2‚ú®\nS·ªë l∆∞·ª£ng tuy·ªÉn d·ª•ng:\nü§µüèª V·ªã tr√≠ nh√¢n vi√™n ph·ª•c v·ª• full time v√† part time\n‚≠ê Kh√¥ng y√™u c·∫ßu kinh nghi·ªám, s·∫Ω ƒë∆∞·ª£c ƒë√†o t·∫°o \n‚≠ê ∆Øu ti√™n nh·ªØng b·∫°n c√≥ th·ªÉ giao ti·∫øp ti·∫øng h√†n, nhanh nh·∫πn, chƒÉm ch·ªâ, t√≠nh c√°ch vui v·∫ª, ho√† ƒë·ªìng\n\n* Full time\n‚≠ê L∆∞∆°ng: 9.000.000 - 14.000.000 \n‚≠êÔ∏è Th·ªùi gian l√†m vi·ªác: 12h -10h v√† 15h - 1h \n‚≠ê Bonus t·ª´ 2.000.000/ th√°ng\n\n* Part time\n‚≠ê L∆∞∆°ng 33k/h - 36k/h + bonus cao\n‚≠êÔ∏è Th·ªùi gian l√†m vi·ªác: 11h - 15h, 18h- 23h v√† 18h - 1h \n\nüè† ƒê·ªäA ƒêI·ªÇM L√ÄM VI·ªÜC:\n45 Song H√†nh, An Ph√∫, Q2\nBBQ √îNG M·∫¨P Qu·∫≠n 2\n38 Tr·∫ßn Ng·ªçc Di·ªán, Th·∫£o ƒêi·ªÅn, Q2\nBBQ √îng M·∫≠p Th·∫£o ƒêi·ªÅn Îö±Î≥¥Ïßë ÌÉÄÏò§ÎîîÏóî\n\nüí¨Li√™n h·ªá: 0909886320- Th∆∞",
            "created_time_vn": "2025-12-01 13:54:32"
          },
          {
            "id": "100082569921800",
            "name": "Minh Huy·ªÅn",
            "text": "Trung t√¢m Anh ng·ªØ EFIS English (Ch√πa L√°ng) hi·ªán ƒëang tuy·ªÉn:\n‚Ä¢ Gi·∫£ng vi√™n Ti·∫øng Anh giao ti·∫øp\n‚Ä¢ Chuy√™n vi√™n T∆∞ v·∫•n\n‚Ä¢ Marketing SEO\n‚Ä¢ Event ‚Äì Social\n\nB·∫°n n√†o quan t√¢m comment ho·∫∑c inbox m√¨nh g·ª≠i JD chi ti·∫øt nh√© üå±",
            "created_time_vn": "2025-12-22 09:05:44"
          }
        ],
        "reactions_count": 16,
        "comments_count": 5,
        "reactions_count_before_filter": 16,
        "comments_count_before_filter": 7,
        "status": "success"
      }
    ]
  },
  "total_posts_processed": 2,
  "total_reactions": 97,
  "total_comments": 5
}
--- END FILE: backend\data\results\all_results_20251222_221814.json ---

--- START FILE: backend\worker\check_cookies.py ---
import requests


def _import_get_cookies():
    try:
        from get_payload import get_cookies_by_profile_id  # type: ignore
        return get_cookies_by_profile_id
    except Exception:
        try:
            from backend.worker.get_payload import get_cookies_by_profile_id  # type: ignore
            return get_cookies_by_profile_id
        except Exception:
            from worker.get_payload import get_cookies_by_profile_id  # type: ignore
            return get_cookies_by_profile_id


get_cookies_by_profile_id = _import_get_cookies()


def check_cookie_by_title(profile_id: str) -> dict:
    """
    T·∫£i facebook.com v·ªõi cookies v√† ki·ªÉm tra title ƒëƒÉng nh·∫≠p.
    Title "Facebook ‚Äì log in or sign up" => cookies die.
    """
    cookie = get_cookies_by_profile_id(profile_id)
    if not cookie:
        return {"status": "dead", "message": "‚ùå Kh√¥ng l·∫•y ƒë∆∞·ª£c cookie"}

    url = "https://www.facebook.com/"
    headers = {
        "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8",
        "accept-encoding": "gzip, deflate, br",
        "accept-language": "en,vi;q=0.9,en-US;q=0.8",
        "referer": "https://www.facebook.com/",
        "sec-ch-ua": '"Google Chrome";v="143", "Chromium";v="143", "Not A(Brand";v="24"',
        "sec-ch-ua-mobile": "?0",
        "sec-ch-ua-platform": '"Windows"',
        "upgrade-insecure-requests": "1",
        "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36",
        "cookie": cookie,
    }

    try:
        resp = requests.get(url, headers=headers, timeout=20, allow_redirects=True)
        login_title = '<title id="pageTitle">Facebook ‚Äì log in or sign up</title>'
        html_lower = resp.text.lower()

        if login_title.lower() in html_lower:
            return {
                "status": "dead",
                "message": "‚ùå Ph√°t hi·ªán title login: cookies die",
                "status_code": resp.status_code,
                "final_url": resp.url,
            }

        # Kh√¥ng th·∫•y title login => coi l√† cookies c√≤n s·ªëng (d√π status kh√°c 200)
        return {
            "status": "alive",
            "message": "‚úÖ Kh√¥ng th·∫•y title login, coi cookies c√≤n s·ªëng",
            "status_code": resp.status_code,
            "final_url": resp.url,
        }
    except Exception as e:
        return {"status": "error", "message": f"‚ùå L·ªói: {e}"}


if __name__ == "__main__":
    profile_id = "031ca13d-e8fa-400c-a603-df57a2806788"
    result = check_cookie_by_title(profile_id)
    print(result["message"])


--- END FILE: backend\worker\check_cookies.py ---

--- START FILE: backend\worker\get_all_info.py ---
import json
import os
from pathlib import Path
from datetime import datetime
from single_get_reactions import get_all_users_by_fid
from single_get_comment import get_all_comments_by_post_id
from core import control as control_state


def _import_get_payload_funcs():
    """
    Try multiple import paths for get_payload functions so the worker scripts
    can be run from different working directories.
    Returns tuple: (get_payload_by_profile_id, get_cookies_by_profile_id, get_access_token_by_profile_id)
    """
    try:
        from get_payload import get_payload_by_profile_id, get_cookies_by_profile_id, get_access_token_by_profile_id  # type: ignore
        return get_payload_by_profile_id, get_cookies_by_profile_id, get_access_token_by_profile_id
    except Exception:
        try:
            from backend.worker.get_payload import get_payload_by_profile_id, get_cookies_by_profile_id, get_access_token_by_profile_id  # type: ignore
            return get_payload_by_profile_id, get_cookies_by_profile_id, get_access_token_by_profile_id
        except Exception:
            from worker.get_payload import get_payload_by_profile_id, get_cookies_by_profile_id, get_access_token_by_profile_id  # type: ignore
            return get_payload_by_profile_id, get_cookies_by_profile_id, get_access_token_by_profile_id


# Get payload functions (imported via helper)
get_payload_by_profile_id, get_cookies_by_profile_id, get_access_token_by_profile_id = _import_get_payload_funcs()

# ====== ƒê∆Ø·ªúNG D·∫™N THEO PROJECT ROOT ======
BASE_DIR = Path(__file__).resolve().parents[2]  # Th∆∞ m·ª•c g·ªëc project
POST_IDS_DIR = BASE_DIR / "backend" / "data" / "post_ids"
OUTPUT_DIR = BASE_DIR / "backend" / "data" / "results"
# File all_results k√®m timestamp cho m·ªói l·∫ßn ch·∫°y (ch·ªâ m·ªôt file duy nh·∫•t)
RUN_TS = datetime.now().strftime("%Y%m%d_%H%M%S")
ALL_RESULTS_FILE = OUTPUT_DIR / f"all_results_{RUN_TS}.json"
# B·ªô nh·ªõ ƒë·ªám k·∫øt qu·∫£ ƒë·ªÉ ghi d·∫°ng summary gi·ªëng all_results_summary_selected
ALL_RESULTS_DATA = {
    "total_files": 0,
    "results_by_file": {},
    "total_posts_processed": 0,
    "total_reactions": 0,
    "total_comments": 0,
}

# Bi·∫øn global ƒë·ªÉ l∆∞u ti·∫øn tr√¨nh khi ƒëang l·∫•y th√¥ng tin
INFO_PROGRESS = {
    "is_running": False,
    "current": 0,
    "total": 0,
    "current_file": "",
}

# T·∫°o th∆∞ m·ª•c output n·∫øu ch∆∞a c√≥
os.makedirs(OUTPUT_DIR, exist_ok=True)

# ====== PROFILE ID ======
# Profile ID m·∫∑c ƒë·ªãnh, c√≥ th·ªÉ thay ƒë·ªïi
DEFAULT_PROFILE_ID = "031ca13d-e8fa-400c-a603-df57a2806788"


def filter_by_owner_id(items, owner_id):
    """
    L·ªçc b·ªè c√°c items c√≥ id tr√πng v·ªõi owner_id
    
    Args:
        items (list): Danh s√°ch items (reactions ho·∫∑c comments)
        owner_id (str): ID c·ªßa owner c·∫ßn lo·∫°i b·ªè
        
    Returns:
        list: Danh s√°ch items ƒë√£ ƒë∆∞·ª£c l·ªçc
    """
    if not owner_id or not items:
        return items
    
    filtered = []
    removed_count = 0
    
    for item in items:
        # Reactions: {"id": user_id, "name": user_name}
        # Comments: {"id": user_id, "name": user_name, "text": ...} ho·∫∑c {"id": comment_id, "author": {"id": user_id, ...}}
        item_id = None
        
        # Th·ª≠ l·∫•y id t·ª´ c√°c v·ªã tr√≠ c√≥ th·ªÉ
        if "id" in item:
            # V·ªõi comments, c√≥ th·ªÉ l√† comment_id ho·∫∑c user_id
            # N·∫øu c√≥ "author", th√¨ id l√† comment_id, c·∫ßn l·∫•y t·ª´ author
            if "author" in item and isinstance(item["author"], dict):
                item_id = item["author"].get("id")
            else:
                # N·∫øu kh√¥ng c√≥ author, th√¨ id ch√≠nh l√† user_id
                item_id = item.get("id")
        
        # N·∫øu v·∫´n ch∆∞a c√≥, th·ª≠ c√°c field kh√°c
        if not item_id:
            item_id = item.get("user_id")
        
        # Ch·ªâ th√™m v√†o n·∫øu id kh√°c v·ªõi owner_id
        if item_id != owner_id:
            filtered.append(item)
        else:
            removed_count += 1
    
    if removed_count > 0:
        print(f"   üö´ ƒê√£ l·ªçc b·ªè {removed_count} items t·ª´ owner (ID: {owner_id})")
    
    return filtered


def process_post_id(post_data, file_name, profile_id, payload_dict, cookies):
    """
    X·ª≠ l√Ω m·ªôt post: l·∫•y reactions v√† comments
    
    Args:
        post_data (dict ho·∫∑c str): 
            - N·∫øu l√† dict: {"id": "...", "flag": "...", "text": "...", "owning_profile": {...}}
            - N·∫øu l√† str: post_id (format c≈©, ƒë·ªÉ t∆∞∆°ng th√≠ch)
        file_name (str): T√™n file JSON ch·ª©a post n√†y
        profile_id (str): Profile ID
        payload_dict (dict): Payload dictionary ƒë√£ ƒë∆∞·ª£c load s·∫µn
        cookies (str): Cookie string ƒë√£ ƒë∆∞·ª£c load s·∫µn
        
    Returns:
        dict: K·∫øt qu·∫£ v·ªõi reactions v√† comments
    """
    # X·ª≠ l√Ω c·∫£ format c≈© (string) v√† format m·ªõi (object)
    if isinstance(post_data, str):
        # Format c≈©: ch·ªâ l√† string post_id
        post_id = post_data
        flag = None
        text = None
        owning_profile = None
        owning_profile_id = None
    else:
        # Format m·ªõi: object v·ªõi id, flag, text, owning_profile
        post_id = post_data.get("id")
        flag = post_data.get("flag")
        text = post_data.get("text")
        owning_profile = post_data.get("owning_profile")
        owning_profile_id = owning_profile.get("id") if owning_profile else None
    
    if not post_id:
        print(f"‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y post_id trong post_data")
        return None
    
    print("\n" + "="*70)
    print(f"üìå X·ª≠ l√Ω Post ID: {post_id}")
    if flag:
        print(f"üè∑Ô∏è  Flag: {flag}")
    if owning_profile:
        print(f"üë§ Owner: {owning_profile.get('name', 'N/A')} (ID: {owning_profile_id})")
    print(f"üìÅ T·ª´ file: {file_name}")
    print(f"üë§ Profile ID: {profile_id}")
    print("="*70)
    
    result = {
        "post_id": post_id,
        "flag": flag,
        "text": text,
        "owning_profile": owning_profile,
        "source_file": file_name,
        "profile_id": profile_id,
        "reactions": [],
        "comments": [],
        "reactions_count": 0,
        "comments_count": 0,
        "reactions_count_before_filter": 0,
        "comments_count_before_filter": 0,
        "status": "success"
    }
    
    try:
        # 1. L·∫•y reactions
        print(f"\nüîµ B·∫Øt ƒë·∫ßu l·∫•y REACTIONS cho post_id: {post_id}")
        reactions = get_all_users_by_fid(post_id, payload_dict, profile_id, cookies)
        result["reactions_count_before_filter"] = len(reactions)
        
        # L·ªçc b·ªè reactions t·ª´ owner
        if owning_profile_id:
            reactions = filter_by_owner_id(reactions, owning_profile_id)
            filtered_count = result["reactions_count_before_filter"] - len(reactions)
            if filtered_count > 0:
                print(f"üö´ ƒê√£ l·ªçc b·ªè {filtered_count} reactions t·ª´ owner (ID: {owning_profile_id})")
        
        result["reactions"] = reactions
        result["reactions_count"] = len(reactions)
        print(f"‚úÖ ƒê√£ l·∫•y ƒë∆∞·ª£c {result['reactions_count']} reactions (sau khi l·ªçc)")
        
        # 2. L·∫•y comments
        print(f"\nüü¢ B·∫Øt ƒë·∫ßu l·∫•y COMMENTS cho post_id: {post_id}")
        comments = get_all_comments_by_post_id(post_id, payload_dict, profile_id, cookies)
        result["comments_count_before_filter"] = len(comments)
        
        # L·ªçc b·ªè comments t·ª´ owner
        if owning_profile_id:
            comments = filter_by_owner_id(comments, owning_profile_id)
            filtered_count = result["comments_count_before_filter"] - len(comments)
            if filtered_count > 0:
                print(f"üö´ ƒê√£ l·ªçc b·ªè {filtered_count} comments t·ª´ owner (ID: {owning_profile_id})")
        
        result["comments"] = comments
        result["comments_count"] = len(comments)
        print(f"‚úÖ ƒê√£ l·∫•y ƒë∆∞·ª£c {result['comments_count']} comments (sau khi l·ªçc)")
        
    except RuntimeError as e:
        # Re-raise RuntimeError (EMERGENCY_STOP) ƒë·ªÉ caller c√≥ th·ªÉ d·ª´ng ho√†n to√†n
        if "EMERGENCY_STOP" in str(e):
            raise
        # N·∫øu kh√¥ng ph·∫£i EMERGENCY_STOP th√¨ x·ª≠ l√Ω nh∆∞ l·ªói th√¥ng th∆∞·ªùng
        print(f"‚ùå L·ªói khi x·ª≠ l√Ω post_id {post_id}: {e}")
        import traceback
        traceback.print_exc()
        result["status"] = "error"
        result["error"] = str(e)
    except Exception as e:
        print(f"‚ùå L·ªói khi x·ª≠ l√Ω post_id {post_id}: {e}")
        import traceback
        traceback.print_exc()
        result["status"] = "error"
        result["error"] = str(e)
    
    return result


def append_to_all_results(file_name: str, result: dict):
    """
    Append FULL result v√†o c·∫•u tr√∫c summary (results_by_file) v√† ghi ra all_results_<timestamp>.json NGAY L·∫¨P T·ª®C.
    """
    try:
        # B·ªï sung list cho file n·∫øu ch∆∞a c√≥
        results_by_file = ALL_RESULTS_DATA.get("results_by_file", {})
        file_list = results_by_file.get(file_name)
        if file_list is None:
            file_list = []
            results_by_file[file_name] = file_list
        file_list.append(result)
        ALL_RESULTS_DATA["results_by_file"] = results_by_file

        # C·∫≠p nh·∫≠t counters
        ALL_RESULTS_DATA["total_posts_processed"] = sum(len(v) for v in results_by_file.values())
        ALL_RESULTS_DATA["total_reactions"] += int(result.get("reactions_count", 0) or 0)
        ALL_RESULTS_DATA["total_comments"] += int(result.get("comments_count", 0) or 0)
        ALL_RESULTS_DATA["total_files"] = len(results_by_file.keys())

        # Ghi file NGAY L·∫¨P T·ª®C v√† flush ƒë·ªÉ ƒë·∫£m b·∫£o d·ªØ li·ªáu ƒë∆∞·ª£c ghi ngay
        with open(ALL_RESULTS_FILE, "w", encoding="utf-8") as f:
            json.dump(ALL_RESULTS_DATA, f, ensure_ascii=False, indent=2)
            f.flush()  # ƒê·∫£m b·∫£o d·ªØ li·ªáu ƒë∆∞·ª£c ghi ngay v√†o disk
            os.fsync(f.fileno())  # Force write to disk (n·∫øu h·ªá th·ªëng h·ªó tr·ª£)
        
        post_id = result.get("post_id", "N/A")
        print(f"üíæ ƒê√£ l∆∞u post_id {post_id} v√†o {ALL_RESULTS_FILE}")
    except Exception as e:
        print(f"‚ö†Ô∏è L·ªói khi l∆∞u v√†o {ALL_RESULTS_FILE}: {e}")
        import traceback
        traceback.print_exc()


def _check_stop_pause(profile_id: str | None = None):
    """T√¥n tr·ªçng n√∫t d·ª´ng / pause (global ho·∫∑c theo profile)."""
    stop, paused, reason = control_state.check_flags(profile_id)
    if stop:
        raise RuntimeError(f"EMERGENCY_STOP ({reason})")
    if paused:
        print(f"‚è∏Ô∏è ƒêang t·∫°m d·ª´ng ({reason}), ch·ªù ti·∫øp t·ª•c ...")
        control_state.wait_if_paused(profile_id, sleep_seconds=0.5)


def extract_profile_id_from_filename(file_name):
    """
    T√°ch profile_id t·ª´ t√™n file (v√≠ d·ª•: 031ca13d-e8fa-400c-a603-df57a2806788.json -> 031ca13d-e8fa-400c-a603-df57a2806788)
    
    Args:
        file_name (str): T√™n file (c√≥ th·ªÉ c√≥ ho·∫∑c kh√¥ng c√≥ ƒë∆∞·ªùng d·∫´n)
        
    Returns:
        str: Profile ID ho·∫∑c None n·∫øu kh√¥ng t√°ch ƒë∆∞·ª£c
    """
    # L·∫•y t√™n file kh√¥ng c√≥ extension
    base_name = os.path.splitext(os.path.basename(file_name))[0]
    
    # Ki·ªÉm tra xem c√≥ ph·∫£i l√† UUID format kh√¥ng (c√≥ d·∫•u g·∫°ch ngang)
    if '-' in base_name and len(base_name) == 36:  # UUID format: 8-4-4-4-12
        return base_name
    
    return None


def process_post_ids_file(file_path):
    """
    X·ª≠ l√Ω m·ªôt file JSON ch·ª©a danh s√°ch post_ids
    
    Args:
        file_path (str): ƒê∆∞·ªùng d·∫´n ƒë·∫øn file JSON
        
    Returns:
        list: Danh s√°ch k·∫øt qu·∫£ c·ªßa t·∫•t c·∫£ post_ids trong file
    """
    file_name = os.path.basename(file_path)
    
    # T·ª± ƒë·ªông t√°ch profile_id t·ª´ t√™n file
    profile_id = extract_profile_id_from_filename(file_name)
    
    if not profile_id:
        print(f"‚ö†Ô∏è Kh√¥ng th·ªÉ t√°ch profile_id t·ª´ t√™n file: {file_name}")
        print(f"   S·ª≠ d·ª•ng profile_id m·∫∑c ƒë·ªãnh: {DEFAULT_PROFILE_ID}")
        profile_id = DEFAULT_PROFILE_ID
    else:
        print(f"‚úÖ ƒê√£ t√°ch profile_id t·ª´ t√™n file: {profile_id}")
    
    print("\n" + "="*70)
    print(f"üìÇ ƒêang x·ª≠ l√Ω file: {file_name}")
    print(f"üë§ Profile ID: {profile_id}")
    print("="*70)
    
    try:
        with open(file_path, "r", encoding="utf-8") as f:
            post_ids = json.load(f)
        
        if not isinstance(post_ids, list):
            print(f"‚ö†Ô∏è File {file_name} kh√¥ng ch·ª©a m·∫£ng post_ids")
            return []
        
        # Ki·ªÉm tra n·∫øu file tr·ªëng ho·∫∑c kh√¥ng c√≥ d·ªØ li·ªáu
        if len(post_ids) == 0:
            print(f"‚ö†Ô∏è File {file_name} kh√¥ng c√≥ d·ªØ li·ªáu b√†i vi·∫øt (file tr·ªëng)")
            raise ValueError(f"File {file_name} kh√¥ng c√≥ d·ªØ li·ªáu b√†i vi·∫øt")
        
        print(f"üìã T√¨m th·∫•y {len(post_ids)} post(s) trong file")
        
        # Load payload v√† cookies m·ªôt l·∫ßn cho t·∫•t c·∫£ posts
        print(f"\nüîÑ ƒêang l·∫•y payload v√† cookies t·ª´ profile_id: {profile_id}")
        # Khi b·∫Øt ƒë·∫ßu x·ª≠ l√Ω, ƒë·∫£m b·∫£o profile kh√¥ng b·ªã STOP trong runtime_control
        control_state.resume_profile(profile_id)

        payload_dict = get_payload_by_profile_id(profile_id)
        if not payload_dict:
            print(f"‚ùå Kh√¥ng th·ªÉ l·∫•y payload t·ª´ profile_id: {profile_id}")
            return []
        
        cookies = get_cookies_by_profile_id(profile_id)
        if not cookies:
            print(f"‚ùå Kh√¥ng th·ªÉ l·∫•y cookies t·ª´ profile_id: {profile_id}")
            return []
        
        print(f"‚úÖ ƒê√£ load payload v√† cookies th√†nh c√¥ng (s·∫Ω d√πng chung cho t·∫•t c·∫£ {len(post_ids)} posts)")
        
        results = []
        idx = 0
        while idx < len(post_ids):
            try:
                _check_stop_pause(profile_id)
            except RuntimeError as stp:
                print(f"üõë D·ª´ng x·ª≠ l√Ω file {file_name} do stop/pause: {stp}")
                break

            post_data = post_ids[idx]
            # X·ª≠ l√Ω c·∫£ format c≈© (string) v√† format m·ªõi (object)
            if isinstance(post_data, str):
                post_id = post_data
            else:
                post_id = post_data.get("id")
            
            if not post_id:
                print(f"‚ö†Ô∏è [{idx+1}/{len(post_ids)}] B·ªè qua item kh√¥ng c√≥ post_id: {post_data}")
                idx += 1
                continue
            
            print(f"\n{'='*70}")
            print(f"üìå [{idx+1}/{len(post_ids)}] X·ª≠ l√Ω Post ID: {post_id}")
            print(f"{'='*70}")
            
            try:
                result = process_post_id(post_data, file_name, profile_id, payload_dict, cookies)
            except RuntimeError as stp:
                # N·∫øu l√† EMERGENCY_STOP th√¨ d·ª´ng ngay
                if "EMERGENCY_STOP" in str(stp):
                    print(f"üõë D·ª´ng x·ª≠ l√Ω file {file_name} do stop: {stp}")
                    raise  # Re-raise ƒë·ªÉ caller c√≥ th·ªÉ catch v√† break
                # N·∫øu kh√¥ng ph·∫£i EMERGENCY_STOP th√¨ x·ª≠ l√Ω nh∆∞ l·ªói th√¥ng th∆∞·ªùng
                print(f"‚ùå L·ªói RuntimeError khi x·ª≠ l√Ω post_id {post_id}: {stp}")
                result = None
            
            if result:
                results.append(result)
                
                # Append full result v√†o all_results_<timestamp>.json (summary-style)
                append_to_all_results(file_name, result)

                # C·∫≠p nh·∫≠t ti·∫øn tr√¨nh
                INFO_PROGRESS["current"] += 1

                # X√≥a post_id ƒë√£ x·ª≠ l√Ω kh·ªèi file ngu·ªìn
                post_ids.pop(idx)
                try:
                    with open(file_path, "w", encoding="utf-8") as f:
                        json.dump(post_ids, f, ensure_ascii=False, indent=2)
                    print(f"üóëÔ∏è ƒê√£ x√≥a post_id {post_id} kh·ªèi {file_name}")
                except Exception as e:
                    print(f"‚ö†Ô∏è Kh√¥ng th·ªÉ ghi l·∫°i file {file_name} sau khi x√≥a post_id: {e}")
                # kh√¥ng tƒÉng idx v√¨ ƒë√£ pop, danh s√°ch ƒë√£ d·ªãch sang tr√°i
                continue
            
            # N·∫øu kh√¥ng c√≥ result (l·ªói) th√¨ tƒÉng idx ƒë·ªÉ tr√°nh loop v√¥ h·∫°n
            idx += 1
            # V·∫´n c·∫≠p nh·∫≠t ti·∫øn tr√¨nh d√π c√≥ l·ªói
            INFO_PROGRESS["current"] += 1
        
        return results
        
    except ValueError as e:
        # Re-raise ValueError ƒë·ªÉ caller c√≥ th·ªÉ catch v√† x·ª≠ l√Ω
        if "kh√¥ng c√≥ d·ªØ li·ªáu b√†i vi·∫øt" in str(e):
            raise
        print(f"‚ùå L·ªói: {e}")
        return []
    except FileNotFoundError:
        print(f"‚ùå Kh√¥ng t√¨m th·∫•y file: {file_path}")
        return []
    except json.JSONDecodeError as e:
        print(f"‚ùå L·ªói: File {file_name} kh√¥ng ph·∫£i JSON h·ª£p l·ªá: {e}")
        return []
    except Exception as e:
        print(f"‚ùå L·ªói khi x·ª≠ l√Ω file {file_name}: {e}")
        import traceback
        traceback.print_exc()
        return []


def get_all_info_from_post_ids_dir():
    """
    X·ª≠ l√Ω t·∫•t c·∫£ c√°c file JSON trong th∆∞ m·ª•c data/post_ids/
    M·ªói file s·∫Ω t·ª± ƒë·ªông s·ª≠ d·ª•ng profile_id t·ª´ t√™n file
    """
    global INFO_PROGRESS
    
    print("\n" + "="*70)
    print("üöÄ B·∫ÆT ƒê·∫¶U X·ª¨ L√ù T·∫§T C·∫¢ POST IDs")
    print("="*70)
    print("‚ÑπÔ∏è  M·ªói file s·∫Ω t·ª± ƒë·ªông s·ª≠ d·ª•ng profile_id t·ª´ t√™n file")
    print("="*70)
    
    # L·∫•y t·∫•t c·∫£ file JSON trong th∆∞ m·ª•c
    post_ids_path = Path(POST_IDS_DIR)
    if not post_ids_path.exists():
        print(f"‚ùå Kh√¥ng t√¨m th·∫•y th∆∞ m·ª•c: {POST_IDS_DIR}")
        INFO_PROGRESS["is_running"] = False
        return
    
    json_files = list(post_ids_path.glob("*.json"))
    
    if not json_files:
        print(f"‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y file JSON n√†o trong {POST_IDS_DIR}")
        INFO_PROGRESS["is_running"] = False
        raise ValueError("Kh√¥ng c√≥ d·ªØ li·ªáu b√†i vi·∫øt ƒë·ªÉ x·ª≠ l√Ω")
    
    print(f"üìÅ T√¨m th·∫•y {len(json_files)} file(s) JSON")
    
    # T√≠nh t·ªïng s·ªë b√†i tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu
    total_posts = 0
    for file_path in json_files:
        try:
            with open(file_path, "r", encoding="utf-8") as f:
                data = json.load(f)
                if isinstance(data, list):
                    total_posts += len(data)
        except Exception:
            pass
    
    # Kh·ªüi t·∫°o ti·∫øn tr√¨nh
    INFO_PROGRESS = {
        "is_running": True,
        "current": 0,
        "total": total_posts,
        "current_file": "",
    }
    
    all_results = {}
    has_data = False
    
    # X·ª≠ l√Ω t·ª´ng file (m·ªói file s·∫Ω t·ª± ƒë·ªông extract profile_id t·ª´ t√™n file)
    for file_path in json_files:
        try:
            _check_stop_pause(None)
        except RuntimeError as stp:
            print(f"üõë D·ª´ng to√†n b·ªô do stop/pause: {stp}")
            break
        file_name = file_path.name
        INFO_PROGRESS["current_file"] = file_name
        try:
            results = process_post_ids_file(str(file_path))
            all_results[file_name] = results
            if results:
                has_data = True
        except ValueError as e:
            # N·∫øu file tr·ªëng th√¨ b·ªè qua v√† ti·∫øp t·ª•c v·ªõi file kh√°c
            if "kh√¥ng c√≥ d·ªØ li·ªáu b√†i vi·∫øt" in str(e):
                print(f"‚ö†Ô∏è {e}")
                all_results[file_name] = []
                continue
            raise
    
    # Ki·ªÉm tra n·∫øu kh√¥ng c√≥ file n√†o c√≥ d·ªØ li·ªáu
    if not has_data:
        INFO_PROGRESS["is_running"] = False
        raise ValueError("Kh√¥ng c√≥ d·ªØ li·ªáu b√†i vi·∫øt ƒë·ªÉ x·ª≠ l√Ω")
    
    # K·∫øt qu·∫£ ƒë√£ ƒë∆∞·ª£c ghi v√†o ALL_RESULTS_FILE trong qu√° tr√¨nh ch·∫°y
    print("\n" + "="*70)
    print("‚úÖ HO√ÄN TH√ÄNH X·ª¨ L√ù T·∫§T C·∫¢ POST IDs")
    print("="*70)
    print(f"üìä T·ªïng s·ªë file ƒë√£ x·ª≠ l√Ω: {len(json_files)}")
    print(f"üìä T·ªïng s·ªë post ƒë√£ x·ª≠ l√Ω: {ALL_RESULTS_DATA['total_posts_processed']}")
    print(f"üìä T·ªïng s·ªë reactions: {ALL_RESULTS_DATA['total_reactions']}")
    print(f"üìä T·ªïng s·ªë comments: {ALL_RESULTS_DATA['total_comments']}")
    print(f"üíæ ƒê√£ l∆∞u k·∫øt qu·∫£ v√†o: {ALL_RESULTS_FILE}")
    print("="*70)
    
    # Reset ti·∫øn tr√¨nh
    INFO_PROGRESS["is_running"] = False
    INFO_PROGRESS["current"] = 0
    INFO_PROGRESS["total"] = 0
    INFO_PROGRESS["current_file"] = ""


def get_info_for_profile_ids(profile_ids):
    """
    X·ª≠ l√Ω ch·ªâ c√°c profile_id ƒë∆∞·ª£c ch·ªçn (d·ª±a v√†o file t√™n <profile_id>.json trong data/post_ids).
    
    Args:
        profile_ids (list[str]): Danh s√°ch profile_id c·∫ßn x·ª≠ l√Ω
    
    Returns:
        dict: summary t∆∞∆°ng t·ª± get_all_info_from_post_ids_dir nh∆∞ng ch·ªâ cho profile ƒë√£ ch·ªçn
    """
    if not profile_ids:
        print("‚ö†Ô∏è Kh√¥ng c√≥ profile_id n√†o ƒë∆∞·ª£c cung c·∫•p.")
        return {}

    post_ids_path = Path(POST_IDS_DIR)
    if not post_ids_path.exists():
        print(f"‚ùå Kh√¥ng t√¨m th·∫•y th∆∞ m·ª•c: {POST_IDS_DIR}")
        return {}

    # Chu·∫©n h√≥a v√† lo·∫°i b·ªè tr√πng
    target_ids = {str(pid).strip() for pid in profile_ids if str(pid).strip()}
    if not target_ids:
        print("‚ö†Ô∏è Danh s√°ch profile_id sau khi l·ªçc r·ªóng.")
        return {}

    # L·ªçc file theo profile_id
    json_files = []
    for pid in target_ids:
        candidate = post_ids_path / f"{pid}.json"
        if candidate.exists():
            json_files.append(candidate)
        else:
            print(f"‚ö†Ô∏è B·ªè qua: kh√¥ng t√¨m th·∫•y file post_ids cho profile_id={pid} ({candidate})")

    if not json_files:
        print("‚ö†Ô∏è Kh√¥ng c√≥ file JSON n√†o kh·ªõp profile_id ƒë∆∞·ª£c ch·ªçn.")
        INFO_PROGRESS["is_running"] = False
        raise ValueError("Kh√¥ng c√≥ d·ªØ li·ªáu b√†i vi·∫øt ƒë·ªÉ x·ª≠ l√Ω")

    print(f"üìÅ T√¨m th·∫•y {len(json_files)} file(s) JSON theo danh s√°ch profile ƒë√£ ch·ªçn.")

    # T√≠nh t·ªïng s·ªë b√†i tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu
    total_posts = 0
    for file_path in json_files:
        try:
            with open(file_path, "r", encoding="utf-8") as f:
                data = json.load(f)
                if isinstance(data, list):
                    total_posts += len(data)
        except Exception:
            pass

    # Kh·ªüi t·∫°o ti·∫øn tr√¨nh
    INFO_PROGRESS = {
        "is_running": True,
        "current": 0,
        "total": total_posts,
        "current_file": "",
    }

    all_results = {}
    has_data = False
    for file_path in json_files:
        try:
            _check_stop_pause(None)
        except RuntimeError as stp:
            print(f"üõë D·ª´ng do stop/pause: {stp}")
            break
        file_name = file_path.name
        INFO_PROGRESS["current_file"] = file_name
        try:
            results = process_post_ids_file(str(file_path))
            all_results[file_name] = results
            if results:
                has_data = True
        except ValueError as e:
            # N·∫øu file tr·ªëng th√¨ b·ªè qua v√† ti·∫øp t·ª•c v·ªõi file kh√°c
            if "kh√¥ng c√≥ d·ªØ li·ªáu b√†i vi·∫øt" in str(e):
                print(f"‚ö†Ô∏è {e}")
                all_results[file_name] = []
                continue
            raise
    
    # Ki·ªÉm tra n·∫øu kh√¥ng c√≥ file n√†o c√≥ d·ªØ li·ªáu
    if not has_data:
        INFO_PROGRESS["is_running"] = False
        raise ValueError("Kh√¥ng c√≥ d·ªØ li·ªáu b√†i vi·∫øt ƒë·ªÉ x·ª≠ l√Ω")

    # K·∫øt qu·∫£ ƒë√£ ƒë∆∞·ª£c ghi v√†o ALL_RESULTS_FILE trong qu√° tr√¨nh ch·∫°y
    print("\n" + "="*70)
    print("‚úÖ HO√ÄN TH√ÄNH X·ª¨ L√ù PROFILE ƒê√É CH·ªåN")
    print("="*70)
    print(f"üìä T·ªïng s·ªë file ƒë√£ x·ª≠ l√Ω: {len(json_files)}")
    print(f"üìä T·ªïng s·ªë post ƒë√£ x·ª≠ l√Ω: {ALL_RESULTS_DATA['total_posts_processed']}")
    print(f"üìä T·ªïng s·ªë reactions: {ALL_RESULTS_DATA['total_reactions']}")
    print(f"üìä T·ªïng s·ªë comments: {ALL_RESULTS_DATA['total_comments']}")
    print(f"üíæ ƒê√£ l∆∞u k·∫øt qu·∫£ v√†o: {ALL_RESULTS_FILE}")
    print("="*70)

    # Reset ti·∫øn tr√¨nh
    INFO_PROGRESS["is_running"] = False
    INFO_PROGRESS["current"] = 0
    INFO_PROGRESS["total"] = 0
    INFO_PROGRESS["current_file"] = ""

    return ALL_RESULTS_DATA


if __name__ == "__main__":
    get_all_info_from_post_ids_dir()


--- END FILE: backend\worker\get_all_info.py ---

--- START FILE: backend\worker\get_id.py ---
import requests
import json
import re
import codecs
from urllib.parse import urlencode, urlparse, parse_qs

# ====== L∆ØU √ù ======
# Cookies v√† payload ƒë∆∞·ª£c l·∫•y t·ª´ cookies.json v√† payload.txt th√¥ng qua profile_id
# cookies.json c√≥ c·∫•u tr√∫c: {"profile_id": {"cookie": "...", "access_token": "..."}}
# S·ª≠ d·ª•ng get_payload.get_payload_by_profile_id(profile_id) ƒë·ªÉ l·∫•y payload
# S·ª≠ d·ª•ng get_payload.get_cookies_by_profile_id(profile_id) ƒë·ªÉ l·∫•y cookie


def _import_get_cookies_by_profile_id():
    """
    H·ªó tr·ª£ ch·∫°y ƒë∆∞·ª£c c·∫£ 2 ki·ªÉu:
    - ch·∫°y tr·ª±c ti·∫øp trong folder backend/worker (import get_payload)
    - ch·∫°y qua module backend.worker.get_id (import backend.worker.get_payload)
    """
    try:
        from get_payload import get_cookies_by_profile_id  # type: ignore
        return get_cookies_by_profile_id
    except Exception:
        try:
            from backend.worker.get_payload import get_cookies_by_profile_id  # type: ignore
            return get_cookies_by_profile_id
        except Exception:
            # fallback (n·∫øu sys.path ƒë√£ append worker_path)
            from worker.get_payload import get_cookies_by_profile_id  # type: ignore
            return get_cookies_by_profile_id


# ================================
#   H√ÄM G·ªåI API V·ªöI URL VIDEO
# ================================
def get_post_id(video_url, profile_id, cookies=None):
    """
    L·∫•y post_id v√† owning_profile t·ª´ HTML source (view-source)
    S·ª≠ d·ª•ng cookies ƒë·ªÉ m·ªü nh∆∞ tr√¨nh duy·ªát b√¨nh th∆∞·ªùng
    
    Args:
        video_url (str): URL c·ªßa video Facebook (v√≠ d·ª•: "https://www.facebook.com/reel/1525194028720314/")
        profile_id (str): Profile ID ƒë·ªÉ l·∫•y cookies
        cookies (str, optional): Cookie string (n·∫øu ƒë√£ c√≥ s·∫µn)
        
    Returns:
        tuple: (post_id, owning_profile_dict) ho·∫∑c (None, None) n·∫øu kh√¥ng t√¨m th·∫•y
        owning_profile_dict: {"__typename": "...", "name": "...", "id": "..."} ho·∫∑c None
    """
    # S·ª≠ d·ª•ng HTML source ƒë·ªÉ l·∫•y th√¥ng tin (v·ªõi cookies)
    post_id, owning_profile, post_text = get_post_id_from_html(video_url, profile_id, cookies)
    
    # Decode Unicode escape sequences trong owning_profile name n·∫øu c√≥
    if owning_profile and "name" in owning_profile:
        name = owning_profile['name']
        if isinstance(name, str) and '\\u' in name:
            try:
                name = json.loads(f'"{name}"')
                owning_profile['name'] = name
            except:
                try:
                    name = codecs.decode(name, 'unicode_escape')
                    owning_profile['name'] = name
                except:
                    pass
    
    return post_id, owning_profile, post_text


def get_post_id_from_html(url, profile_id, cookies=None):
    """
    L·∫•y post_id v√† owning_profile t·ª´ HTML source c·ªßa trang (view-source)
    S·ª≠ d·ª•ng cookies ƒë·ªÉ m·ªü nh∆∞ tr√¨nh duy·ªát b√¨nh th∆∞·ªùng
    
    Args:
        url (str): URL c·ªßa Facebook post
        profile_id (str): Profile ID ƒë·ªÉ l·∫•y cookies
        cookies (str, optional): Cookie string (n·∫øu ƒë√£ c√≥ s·∫µn)
        
    Returns:
        tuple: (post_id, owning_profile_dict) ho·∫∑c (None, None) n·∫øu kh√¥ng t√¨m th·∫•y
        owning_profile_dict: {"__typename": "...", "name": "...", "id": "..."} ho·∫∑c None
    """
    get_cookies_by_profile_id = _import_get_cookies_by_profile_id()
    
    # L·∫•y cookies n·∫øu ch∆∞a c√≥
    if cookies is None:
        cookies = get_cookies_by_profile_id(profile_id)
        if not cookies:
            print(f"‚ùå Kh√¥ng th·ªÉ l·∫•y cookies t·ª´ profile_id: {profile_id}")
            return None, None
    
    try:
        # T·∫°o session ƒë·ªÉ qu·∫£n l√Ω cookies t·ªët h∆°n (nh∆∞ tr√¨nh duy·ªát)
        session = requests.Session()
        
        # Parse cookies string th√†nh dict v√† th√™m v√†o session
        # Cookies string format: "name1=value1; name2=value2; ..."
        if cookies:
            cookies_dict = {}
            for cookie_pair in cookies.split(';'):
                cookie_pair = cookie_pair.strip()
                if '=' in cookie_pair:
                    key, value = cookie_pair.split('=', 1)
                    cookies_dict[key.strip()] = value.strip()
            session.cookies.update(cookies_dict)
        
        # Headers cho GET request (gi·ªëng tr√¨nh duy·ªát, CH·ªà gzip/deflate ƒë·ªÉ tr√°nh l·ªói brotli tr√™n m√°y thi·∫øu th∆∞ vi·ªán)
        get_headers = {
            "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8",
            "accept-encoding": "gzip, deflate",
            "accept-language": "en,vi;q=0.9,en-US;q=0.8",
            "referer": "https://www.facebook.com/",
            "sec-ch-ua": '"Google Chrome";v="143", "Chromium";v="143", "Not A(Brand";v="24"',
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": '"Windows"',
            "sec-fetch-dest": "document",
            "sec-fetch-mode": "navigate",
            "sec-fetch-site": "same-origin",
            "upgrade-insecure-requests": "1",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36"
        }
        
        # L·∫•y HTML source tr·ª±c ti·∫øp (view-source) v·ªõi cookies
        print(f"üåê L·∫•y HTML source (view-source) tr·ª±c ti·∫øp t·ª´: {url}")
        response = session.get(url, headers=get_headers)
        
        print(f"üìä Status Code: {response.status_code}")
        print(f"üìÑ Response Length: {len(response.text)} characters")
        
        if response.status_code != 200:
            print(f"‚ùå Status code kh√¥ng ph·∫£i 200: {response.status_code}")
            return None, None
        
        html_content = response.text
        print(f"‚úÖ ƒê√£ l·∫•y HTML content ({len(html_content)} k√Ω t·ª±)")
        
        # Debug: T√¨m c√°c pattern c√≥ th·ªÉ c√≥ trong HTML
        # Facebook c√≥ th·ªÉ escape ho·∫∑c encode kh√°c
        print(f"\nüîç ƒêang t√¨m ki·∫øm patterns...")
        
        # Th·ª≠ t√¨m post_id v·ªõi nhi·ªÅu pattern kh√°c nhau
        post_id = None
        
        # Pattern 1: "post_id":"123456789" (chu·∫©n)
        match = re.search(r'"post_id"\s*:\s*"(\d+)"', html_content)
        if match:
            post_id = match.group(1)
            print(f"‚úÖ T√¨m th·∫•y post_id (pattern 1): {post_id}")
        else:
            # Pattern 2: "post_id":123456789 (kh√¥ng c√≥ quotes)
            match = re.search(r'"post_id"\s*:\s*(\d+)', html_content)
            if match:
                post_id = match.group(1)
                print(f"‚úÖ T√¨m th·∫•y post_id (pattern 2): {post_id}")
            else:
                # Pattern 3: post_id":"123456789" (c√≥ th·ªÉ escape)
                match = re.search(r'post_id["\']?\s*:\s*["\']?(\d+)', html_content)
                if match:
                    post_id = match.group(1)
                    print(f"‚úÖ T√¨m th·∫•y post_id (pattern 3): {post_id}")
                else:
                    # Pattern 4: T√¨m trong JSON structure
                    # C√≥ th·ªÉ l√† JSON ƒë∆∞·ª£c embed trong HTML
                    json_matches = re.findall(r'["\']post_id["\']\s*:\s*["\']?(\d+)', html_content, re.IGNORECASE)
                    if json_matches:
                        post_id = json_matches[0]
                        print(f"‚úÖ T√¨m th·∫•y post_id (pattern 4 - JSON): {post_id}")
                    else:
                        print(f"‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y post_id v·ªõi b·∫•t k·ª≥ pattern n√†o")
                        # Debug: T√¨m m·ªôt s·ªë pattern kh√°c ƒë·ªÉ xem HTML c√≥ g√¨
                        if '"post_id"' in html_content:
                            print(f"   üîç T√¨m th·∫•y chu·ªói 'post_id' trong HTML nh∆∞ng kh√¥ng match pattern")
                            # T√¨m context xung quanh
                            idx = html_content.find('"post_id"')
                            if idx != -1:
                                context = html_content[max(0, idx-50):min(len(html_content), idx+100)]
                                print(f"   üìã Context: {context[:150]}...")
                        else:
                            print(f"   üîç Kh√¥ng t√¨m th·∫•y chu·ªói 'post_id' trong HTML")
        
        # ===== T√åM OWNING_PROFILE ƒê·∫¶U TI√äN TRONG HTML =====
        # Pattern: "owning_profile":{"__typename":"User","name":"...","id":"..."}
        # C√≥ th·ªÉ c√≥ c√°c field kh√°c nh∆∞ "short_name" gi·ªØa c√°c field
        owning_profile = None
        
        # T√¨m owning_profile v·ªõi nhi·ªÅu pattern kh√°c nhau
        
        # Pattern 1: "owning_profile":{ (chu·∫©n)
        pattern = r'"owning_profile"\s*:\s*\{'
        match = re.search(pattern, html_content)
        
        if match:
            print(f"‚úÖ T√¨m th·∫•y 'owning_profile':{{ t·∫°i v·ªã tr√≠ {match.start()}")
            start_pos = match.end()
            
            # T√¨m closing brace t∆∞∆°ng ·ª©ng (balanced braces)
            brace_count = 1
            end_pos = start_pos
            while end_pos < len(html_content) and brace_count > 0:
                if html_content[end_pos] == '{':
                    brace_count += 1
                elif html_content[end_pos] == '}':
                    brace_count -= 1
                end_pos += 1
            
            if brace_count == 0:
                # L·∫•y n·ªôi dung b√™n trong braces
                block_content = html_content[start_pos:end_pos-1]
                print(f"   üìã Block content length: {len(block_content)} characters")
                
                # T√¨m c√°c field trong block n√†y
                owning_profile_data = {}
                
                # T√¨m __typename
                typename_match = re.search(r'"__typename"\s*:\s*"([^"]+)"', block_content)
                if typename_match:
                    owning_profile_data["__typename"] = typename_match.group(1)
                    print(f"   ‚úÖ T√¨m th·∫•y __typename: {typename_match.group(1)}")
                
                # T√¨m name
                name_match = re.search(r'"name"\s*:\s*"([^"]+)"', block_content)
                if name_match:
                    owning_profile_data["name"] = name_match.group(1)
                    print(f"   ‚úÖ T√¨m th·∫•y name: {name_match.group(1)[:50]}...")
                
                # T√¨m id
                id_match = re.search(r'"id"\s*:\s*"([^"]+)"', block_content)
                if id_match:
                    owning_profile_data["id"] = id_match.group(1)
                    print(f"   ‚úÖ T√¨m th·∫•y id: {id_match.group(1)}")
                
                # Ch·ªâ l·∫•y n·∫øu c√≥ ƒë·ªß √≠t nh·∫•t 2 trong 3 fields (__typename, name, id)
                if len(owning_profile_data) >= 2:
                    owning_profile = owning_profile_data
                    print(f"‚úÖ ƒê√£ extract owning_profile th√†nh c√¥ng")
                else:
                    print(f"‚ö†Ô∏è Kh√¥ng ƒë·ªß fields trong owning_profile (ch·ªâ c√≥ {len(owning_profile_data)} fields)")
            else:
                print(f"‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y closing brace t∆∞∆°ng ·ª©ng (brace_count: {brace_count})")
        else:
            print(f"‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y pattern 'owning_profile':{{")
            # Debug: Ki·ªÉm tra xem c√≥ chu·ªói owning_profile kh√¥ng
            if '"owning_profile"' in html_content or "'owning_profile'" in html_content:
                print(f"   üîç T√¨m th·∫•y chu·ªói 'owning_profile' trong HTML nh∆∞ng kh√¥ng match pattern")
                # T√¨m context xung quanh
                idx = html_content.find('owning_profile')
                if idx != -1:
                    context = html_content[max(0, idx-50):min(len(html_content), idx+200)]
                    print(f"   üìã Context: {context[:200]}...")
            else:
                print(f"   üîç Kh√¥ng t√¨m th·∫•y chu·ªói 'owning_profile' trong HTML")
                # C√≥ th·ªÉ HTML ƒë∆∞·ª£c minify, th·ª≠ t√¨m trong JSON blocks
                # Facebook th∆∞·ªùng embed JSON trong script tags
                script_tags = re.findall(r'<script[^>]*>(.*?)</script>', html_content, re.DOTALL)
                print(f"   üîç T√¨m th·∫•y {len(script_tags)} script tags, ƒëang t√¨m trong ƒë√≥...")
                for i, script_content in enumerate(script_tags[:5]):  # Ch·ªâ check 5 script ƒë·∫ßu ti√™n
                    if 'owning_profile' in script_content:
                        print(f"   ‚úÖ T√¨m th·∫•y 'owning_profile' trong script tag #{i+1}")
                        # T√¨m trong script n√†y
                        match = re.search(r'"owning_profile"\s*:\s*\{', script_content)
                        if match:
                            print(f"      ‚úÖ Match pattern trong script tag!")
                            # Extract t·ª´ script content
                            start_pos = match.end()
                            brace_count = 1
                            end_pos = start_pos
                            while end_pos < len(script_content) and brace_count > 0:
                                if script_content[end_pos] == '{':
                                    brace_count += 1
                                elif script_content[end_pos] == '}':
                                    brace_count -= 1
                                end_pos += 1
                            
                            if brace_count == 0:
                                block_content = script_content[start_pos:end_pos-1]
                                owning_profile_data = {}
                                
                                typename_match = re.search(r'"__typename"\s*:\s*"([^"]+)"', block_content)
                                if typename_match:
                                    owning_profile_data["__typename"] = typename_match.group(1)
                                
                                name_match = re.search(r'"name"\s*:\s*"([^"]+)"', block_content)
                                if name_match:
                                    owning_profile_data["name"] = name_match.group(1)
                                
                                id_match = re.search(r'"id"\s*:\s*"([^"]+)"', block_content)
                                if id_match:
                                    owning_profile_data["id"] = id_match.group(1)
                                
                                if len(owning_profile_data) >= 2:
                                    owning_profile = owning_profile_data
                                    print(f"      ‚úÖ ƒê√£ extract owning_profile t·ª´ script tag!")
                                    break
        
        # Decode Unicode escape sequences trong owning_profile name n·∫øu c√≥
        if owning_profile and "name" in owning_profile:
            name = owning_profile['name']
            if isinstance(name, str) and '\\u' in name:
                try:
                    name = json.loads(f'"{name}"')
                    owning_profile['name'] = name
                except:
                    try:
                        name = codecs.decode(name, 'unicode_escape')
                        owning_profile['name'] = name
                    except:
                        pass

        # ===== L·∫§Y N·ªòI DUNG B√ÄI POST =====
        post_text = None

        # ∆Øu ti√™n l·∫•y n·ªôi dung trong block story_message (n·ªôi dung b√†i post)
        content_html = None

        story_match = re.search(
            r'data-ad-rendering-role="story_message"[^>]*>(.*?)</div></div></div>',
            html_content,
            re.DOTALL,
        )
        if story_match:
            content_html = story_match.group(1)
            print("‚úÖ T√¨m th·∫•y block story_message ƒë·ªÉ tr√≠ch n·ªôi dung b√†i post")
        else:
            # Fallback: d√πng m·ªôt ph·∫ßn ƒë·∫ßu HTML
            content_html = html_content[:500_000]
            print("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y block story_message, d√πng fallback (500KB ƒë·∫ßu HTML)")

        # Thay <img ... alt="..."> b·∫±ng ch√≠nh alt (ƒë·ªÉ gi·ªØ emoji/text)
        def _img_alt_to_text(m):
            alt_text = m.group(1) or ""
            return f" {alt_text} "

        content_html = re.sub(
            r'<img[^>]*alt="([^"]*)"[^>]*>',
            _img_alt_to_text,
            content_html,
            flags=re.IGNORECASE,
        )

        # B·ªè to√†n b·ªô tag HTML c√≤n l·∫°i
        text_raw = re.sub(r"<[^>]*>", " ", content_html)
        # Chu·∫©n h√≥a kho·∫£ng tr·∫Øng
        text_clean = re.sub(r"\s+", " ", text_raw).strip()

        if text_clean:
            post_text = text_clean
            preview = post_text[:400] + "..." if len(post_text) > 400 else post_text
            print(f"‚úÖ Post text (preview): {preview}")
        else:
            print("‚ö†Ô∏è Kh√¥ng tr√≠ch ƒë∆∞·ª£c n·ªôi dung b√†i post t·ª´ HTML")

        return post_id, owning_profile, post_text
            
    except Exception as e:
        print(f"‚ùå L·ªói khi l·∫•y HTML source: {e}")
        import traceback
        traceback.print_exc()
        return None, None


def get_page_id_from_html(url, profile_id, cookies=None):
    """
    L·∫•y page_id t·ª´ HTML source c·ªßa trang (view-source)
    S·ª≠ d·ª•ng cookies ƒë·ªÉ m·ªü nh∆∞ tr√¨nh duy·ªát b√¨nh th∆∞·ªùng
    
    Args:
        url (str): URL c·ªßa Facebook page/group
        profile_id (str): Profile ID ƒë·ªÉ l·∫•y cookies
        cookies (str, optional): Cookie string (n·∫øu ƒë√£ c√≥ s·∫µn)
        
    Returns:
        str: page_id ƒë·∫ßu ti√™n t√¨m th·∫•y ho·∫∑c None
    """
    get_cookies_by_profile_id = _import_get_cookies_by_profile_id()

    # ‚úÖ ∆Øu ti√™n tuy·ªát ƒë·ªëi: n·∫øu URL ƒë√£ c√≥ numeric group_id th√¨ tr·∫£ v·ªÅ lu√¥n (·ªïn ƒë·ªãnh nh·∫•t)
    try:
        m_url = re.search(r"/groups/(\d+)", str(url or ""))
        if m_url:
            return m_url.group(1)
    except Exception:
        pass
    
    # L·∫•y cookies n·∫øu ch∆∞a c√≥
    if cookies is None:
        cookies = get_cookies_by_profile_id(profile_id)
        if not cookies:
            print(f"‚ùå Kh√¥ng th·ªÉ l·∫•y cookies t·ª´ profile_id: {profile_id}")
            return None
    
    try:
        # T·∫°o session ƒë·ªÉ qu·∫£n l√Ω cookies t·ªët h∆°n (nh∆∞ tr√¨nh duy·ªát)
        session = requests.Session()
        
        # Parse cookies string th√†nh dict v√† th√™m v√†o session
        if cookies:
            cookies_dict = {}
            for cookie_pair in cookies.split(';'):
                cookie_pair = cookie_pair.strip()
                if '=' in cookie_pair:
                    key, value = cookie_pair.split('=', 1)
                    cookies_dict[key.strip()] = value.strip()
            session.cookies.update(cookies_dict)
        
        # Headers cho GET request (gi·ªëng tr√¨nh duy·ªát, CH·ªà gzip/deflate ƒë·ªÉ tr√°nh l·ªói brotli tr√™n m√°y thi·∫øu th∆∞ vi·ªán)
        get_headers = {
            "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8",
            "accept-encoding": "gzip, deflate",
            "accept-language": "en,vi;q=0.9,en-US;q=0.8",
            "referer": "https://www.facebook.com/",
            "sec-ch-ua": '"Google Chrome";v="143", "Chromium";v="143", "Not A(Brand";v="24"',
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": '"Windows"',
            "sec-fetch-dest": "document",
            "sec-fetch-mode": "navigate",
            "sec-fetch-site": "same-origin",
            "upgrade-insecure-requests": "1",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36"
        }
        
        # L·∫•y HTML source tr·ª±c ti·∫øp (view-source) v·ªõi cookies
        print(f"üåê L·∫•y HTML source (view-source) tr·ª±c ti·∫øp t·ª´: {url}")
        response = session.get(url, headers=get_headers)
        
        if response.status_code != 200:
            return None

        # ‚úÖ N·∫øu Facebook redirect sang URL c√≥ /groups/<id> th√¨ ∆∞u ti√™n l·∫•y lu√¥n t·ª´ response.url
        try:
            m_final = re.search(r"/groups/(\d+)", str(getattr(response, "url", "") or ""))
            if m_final:
                return m_final.group(1)
        except Exception:
            pass
        
        html_content = response.text
        
        # ===== ∆ØU TI√äN L·∫§Y "GROUP ID" (tr√°nh nh·∫∑t nh·∫ßm page_id kh√°c trong HTML) =====
        # 1) C√°c pattern r·∫•t ƒë·∫∑c hi·ªáu cho group
        group_specific_patterns = [
            # page_id_type = group (∆∞u ti√™n)
            r'"page_id"\s*:\s*"(\d+)"\s*,\s*"page_id_type"\s*:\s*"group"',
            r'"page_id_type"\s*:\s*"group"\s*,\s*"page_id"\s*:\s*"(\d+)"',
            # groupID/group_id
            r'"groupID"\s*:\s*"(\d+)"',
            r'"group_id"\s*:\s*"(\d+)"',
        ]
        for pat in group_specific_patterns:
            m = re.search(pat, html_content, flags=re.IGNORECASE)
            if m:
                return m.group(1)

        # 2) N·∫øu HTML c√≥ /groups/<id> th√¨ ∆∞u ti√™n ID xu·∫•t hi·ªán nhi·ªÅu nh·∫•t (tr√°nh d√≠nh 1 ID c·ªë ƒë·ªãnh ·ªü header)
        try:
            group_ids = re.findall(r"/groups/(\d+)", html_content, flags=re.IGNORECASE)
            if group_ids:
                # ch·ªçn ID ph·ªï bi·∫øn nh·∫•t
                freq: dict[str, int] = {}
                for gid in group_ids:
                    freq[gid] = freq.get(gid, 0) + 1
                group_ids_sorted = sorted(freq.items(), key=lambda x: x[1], reverse=True)
                return group_ids_sorted[0][0]
        except Exception:
            pass

        # 3) Fallback cu·ªëi: t√¨m page_id nh∆∞ng ch·ªçn c√°i c√≥ t·∫ßn su·∫•t cao nh·∫•t (ƒë·ª° nh·∫∑t "c√°i ƒë·∫ßu ti√™n")
        try:
            candidates: list[str] = []
            for pat in [
                r'"page_id"\s*:\s*"(\d+)"',
                r'page_id["\']\s*:\s*["\'](\d+)',
                r'page_id=(\d+)',
                r'data-page-id="(\d+)"',
                r'"pageID"\s*:\s*"(\d+)"',
            ]:
                candidates.extend(re.findall(pat, html_content, flags=re.IGNORECASE) or [])
            if candidates:
                freq2: dict[str, int] = {}
                for cid in candidates:
                    freq2[cid] = freq2.get(cid, 0) + 1
                cand_sorted = sorted(freq2.items(), key=lambda x: x[1], reverse=True)
                return cand_sorted[0][0]
        except Exception:
            pass

        return None
            
    except Exception:
        return None


def get_id_from_url(url, profile_id):
    """
    H√†m t·ªïng h·ª£p t·ª± ƒë·ªông ph√°t hi·ªán lo·∫°i URL v√† l·∫•y page_id ho·∫∑c post_id t∆∞∆°ng ·ª©ng
    S·ª≠ d·ª•ng HTML source (view-source) v·ªõi cookies ƒë·ªÉ m·ªü nh∆∞ tr√¨nh duy·ªát b√¨nh th∆∞·ªùng
    
    Logic:
    - N·∫øu URL ch·ª©a "group" ‚Üí l√† group (ch·ªâ l·∫•y page_id)
    - C√≤n l·∫°i t·∫•t c·∫£ ‚Üí l√† post (l·∫•y post_id v√† owning_profile)
    
    Args:
        url (str): URL c·ªßa Facebook (c√≥ th·ªÉ l√† group ho·∫∑c post)
        profile_id (str): Profile ID ƒë·ªÉ l·∫•y cookies
        
    Returns:
        dict: {
            "page_id": str ho·∫∑c None,
            "post_id": str ho·∫∑c None,
            "owning_profile": dict ho·∫∑c None,
            "url_type": str ("group" ho·∫∑c "post")
        }
    """
    get_cookies_by_profile_id = _import_get_cookies_by_profile_id()
    
    # Load cookies m·ªôt l·∫ßn duy nh·∫•t
    cookies = get_cookies_by_profile_id(profile_id)
    
    if not cookies:
        print(f"‚ùå Kh√¥ng th·ªÉ l·∫•y cookies t·ª´ profile_id: {profile_id}")
        return {
            "page_id": None,
            "post_id": None,
            "owning_profile": None,
            "url_type": "post"
        }
    
    url_lower = url.lower()
    result = {
        "page_id": None,
        "post_id": None,
        "owning_profile": None,
        "url_type": "post"  # M·∫∑c ƒë·ªãnh l√† post
    }
    
    # Ph√°t hi·ªán lo·∫°i URL: n·∫øu c√≥ "group" trong URL ‚Üí l√† group
    if "group" in url_lower:
        result["url_type"] = "group"
        page_id = get_page_id_from_html(url, profile_id, cookies)
        result["page_id"] = page_id
        if page_id:
            print(f"page_id: {page_id}")
        return result
    else:
        # T·∫•t c·∫£ c√°c URL kh√°c ƒë·ªÅu l√† post
        result["url_type"] = "post"
        
        # L·∫•y post_id, owning_profile v√† post_text t·ª´ HTML source (v·ªõi cookies)
        post_id, owning_profile, post_text = get_post_id(url, profile_id, cookies)
        
        result["post_id"] = post_id
        result["owning_profile"] = owning_profile
        result["post_text"] = post_text
        
        # In k·∫øt qu·∫£ cu·ªëi c√πng
        if post_id:
            print(f"post_id: {post_id}")
        
        if owning_profile:
            owning_profile_typename = owning_profile.get("__typename")
            owning_profile_name = owning_profile.get("name")
            owning_profile_id = owning_profile.get("id")
            
            if owning_profile_typename:
                print(f"owning_profile.__typename: {owning_profile_typename}")
            if owning_profile_name:
                print(f"owning_profile.name: {owning_profile_name}")
            if owning_profile_id:
                print(f"owning_profile.id: {owning_profile_id}")

        if post_text:
            preview = post_text[:200] + "..." if len(post_text) > 200 else post_text
            print(f"post_text: {preview}")
        
        return result


if __name__ == "__main__":
    # V√≠ d·ª• s·ª≠ d·ª•ng h√†m get_id_from_url (t·ªïng h·ª£p)
    profile_id = "621e1f5d-0c42-481e-9ddd-7abaafce68ed"
    
    # Test v·ªõi group URL
    # group_url = "https://www.facebook.com/groups/987870664956102/"
    # result = get_id_from_url(group_url, profile_id)
    
    # Test v·ªõi video/post URL
    url = "https://www.facebook.com/share/p/18AKfiXuZM/"
    result = get_id_from_url(url, profile_id)
    print("heLLO" ,result)
--- END FILE: backend\worker\get_id.py ---

--- START FILE: backend\worker\get_payload.py ---
import requests
import re
import json
import time
from urllib.parse import parse_qs, unquote_plus
from pathlib import Path

# ====== ƒê∆Ø·ªúNG D·∫™N THEO PROJECT ROOT ======
BASE_DIR = Path(__file__).resolve().parents[2]  # Th∆∞ m·ª•c g·ªëc project
SETTINGS_JSON_FILE = BASE_DIR / "backend" / "config" / "settings.json"
PAYLOAD_TXT_FILE = BASE_DIR / "backend" / "config" / "payload.txt"


def _normalize_cookie(cookie: str | None) -> str | None:
    if cookie is None:
        return None
    cookie = str(cookie).strip()
    if not cookie:
        return None
    # Lo·∫°i b·ªè k√Ω t·ª± xu·ªëng d√≤ng v√† kho·∫£ng tr·∫Øng th·ª´a
    return " ".join(cookie.split())


def _read_settings_profile_config(profile_id: str) -> dict | None:
    """
    ƒê·ªçc PROFILE_IDS[profile_id] t·ª´ backend/config/settings.json.
    Tr·∫£ v·ªÅ dict config ho·∫∑c None n·∫øu kh√¥ng c√≥.
    """
    try:
        if not SETTINGS_JSON_FILE.exists():
            return None
        with open(SETTINGS_JSON_FILE, "r", encoding="utf-8") as f:
            raw = json.load(f)
        profiles = raw.get("PROFILE_IDS")
        if not isinstance(profiles, dict):
            return None
        cfg = profiles.get(profile_id)
        return cfg if isinstance(cfg, dict) else None
    except Exception:
        return None


def get_cookies_by_profile_id(profile_id):
    """
    L·∫•y cookies theo profile_id.

    ∆Øu ti√™n ƒë·ªçc t·ª´ backend/config/settings.json:
      PROFILE_IDS[profile_id].cookie
    
    Args:
        profile_id (str): Profile ID (v√≠ d·ª•: "031ca13d-e8fa-400c-a603-df57a2806788")
    
    Returns:
        str: Cookie string ho·∫∑c None n·∫øu kh√¥ng t√¨m th·∫•y
    """
    # 1) ∆ØU TI√äN: settings.json
    cfg = _read_settings_profile_config(profile_id)
    if cfg is not None:
        cookie = _normalize_cookie(cfg.get("cookie"))
        if cookie:
            return cookie

    print(f"‚ùå Kh√¥ng t√¨m th·∫•y cookie trong {SETTINGS_JSON_FILE} cho profile_id='{profile_id}'")
    return None


def get_access_token_by_profile_id(profile_id):
    """
    L·∫•y access_token theo profile_id.

    ∆Øu ti√™n ƒë·ªçc t·ª´ backend/config/settings.json:
      PROFILE_IDS[profile_id].access_token
    
    Args:
        profile_id (str): Profile ID (v√≠ d·ª•: "031ca13d-e8fa-400c-a603-df57a2806788")
    
    Returns:
        str: Access token ho·∫∑c None n·∫øu kh√¥ng t√¨m th·∫•y
    """
    # 1) ∆ØU TI√äN: settings.json
    cfg = _read_settings_profile_config(profile_id)
    if cfg is not None:
        access_token = str(cfg.get("access_token") or "").strip()
        if access_token:
            return access_token

    print(f"‚ùå Kh√¥ng t√¨m th·∫•y access_token trong {SETTINGS_JSON_FILE} cho profile_id='{profile_id}'")
    return None


def get_base_headers(cookie):
    """
    T·∫°o headers v·ªõi cookie ƒë∆∞·ª£c truy·ªÅn v√†o
    
    Args:
        cookie (str): Cookie string
    
    Returns:
        dict: Headers dictionary
    """
    return {
        "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8",
        "accept-encoding": "gzip, deflate",
        "accept-language": "en,vi;q=0.9,en-US;q=0.8",
        "cookie": cookie,
        "referer": "https://www.facebook.com/",
        "sec-ch-ua": '"Google Chrome";v="143", "Chromium";v="143", "Not A(Brand";v="24"',
        "sec-ch-ua-mobile": "?0",
        "sec-ch-ua-platform": '"Windows"',
        "sec-fetch-dest": "document",
        "sec-fetch-mode": "navigate",
        "sec-fetch-site": "same-origin",
        "upgrade-insecure-requests": "1",
        "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36"
    }


def get_c_user(cookie):
    """
    L·∫•y c_user t·ª´ cookie
    
    Args:
        cookie (str): Cookie string
    
    Returns:
        str: Gi√° tr·ªã c_user ho·∫∑c None n·∫øu kh√¥ng t√¨m th·∫•y
    """
    try:
        match = re.search(r'c_user=(\d+)', cookie)
        if match:
            return match.group(1)
        return None
    except Exception as e:
        print(f"‚ö†Ô∏è L·ªói khi l·∫•y c_user: {e}")
        return None


def get_jazoest(fb_dtsg):
    """
    T√≠nh jazoest t·ª´ fb_dtsg
    
    Args:
        fb_dtsg (str): Gi√° tr·ªã fb_dtsg
    
    Returns:
        str: Gi√° tr·ªã jazoest
    """
    if not fb_dtsg:
        return None
    jazoest = str(sum(ord(c) for c in fb_dtsg))
    return jazoest


def get_lsd(html):
    """
    L·∫•y lsd t·ª´ HTML
    
    Args:
        html (str): HTML content
    
    Returns:
        str: Gi√° tr·ªã lsd ho·∫∑c None n·∫øu kh√¥ng t√¨m th·∫•y
    """
    try:
        match = re.search(r'"LSD",\[\],{"token":"(.*?)"}', html)
        if match:
            return match.group(1)
        return None
    except Exception as e:
        print(f"‚ö†Ô∏è L·ªói khi l·∫•y lsd: {e}")
        return None


def get_spin_r(html):
    """
    L·∫•y __spin_r t·ª´ HTML
    
    Args:
        html (str): HTML content
    
    Returns:
        str: Gi√° tr·ªã __spin_r ho·∫∑c None n·∫øu kh√¥ng t√¨m th·∫•y
    """
    try:
        match = re.search(r'"__spin_r":(\d+)', html)
        if match:
            return match.group(1)
        return None
    except Exception as e:
        print(f"‚ö†Ô∏è L·ªói khi l·∫•y __spin_r: {e}")
        return None


def get_spin_t(html):
    """
    L·∫•y __spin_t t·ª´ HTML
    
    Args:
        html (str): HTML content
    
    Returns:
        str: Gi√° tr·ªã __spin_t ho·∫∑c None n·∫øu kh√¥ng t√¨m th·∫•y
    """
    try:
        match = re.search(r'"__spin_t":(\d+)', html)
        if match:
            return match.group(1)
        return None
    except Exception as e:
        print(f"‚ö†Ô∏è L·ªói khi l·∫•y __spin_t: {e}")
        return None


def get_fb_dtsg(cookie, profile_id: str | None = None, return_page_source: bool = False):
    """
    L·∫•y fb_dtsg t·ª´ Facebook.com
    
    Args:
        cookie (str): Cookie string ƒë·ªÉ s·ª≠ d·ª•ng
    
    Returns:
        str: Gi√° tr·ªã fb_dtsg ho·∫∑c None n·∫øu kh√¥ng t√¨m th·∫•y
    """
    url = "https://www.facebook.com"

    print(f"\nüöÄ B·∫Øt ƒë·∫ßu headless capture t·ª´: {url} (CH·ªà D√ôNG Selenium/WebDriver)")

    # First: if profile_id provided, try reading fb_dtsg from settings.json
    try:
        if profile_id:
            cfg = _read_settings_profile_config(profile_id)
            if isinstance(cfg, dict):
                fb_from_cfg = cfg.get("fb_dtsg") or cfg.get("fb_dtsg_token") or cfg.get("fb_dtsg_value")
                if fb_from_cfg:
                    fb_from_cfg = str(fb_from_cfg).strip()
                    if fb_from_cfg:
                        print(f"‚ÑπÔ∏è L·∫•y fb_dtsg t·ª´ {SETTINGS_JSON_FILE} cho profile_id={profile_id}")
                        if return_page_source:
                            return fb_from_cfg, ""
                        return fb_from_cfg
    except Exception:
        pass

    # Require Selenium + webdriver-manager; fail loudly if unavailable
    try:
        from selenium import webdriver
        from selenium.webdriver.chrome.options import Options
        from selenium.webdriver.chrome.service import Service
        from selenium.common.exceptions import WebDriverException
        from webdriver_manager.chrome import ChromeDriverManager
    except Exception as e:
        print(f"‚ùå Selenium or webdriver_manager not available: {e}")
        return None

    options = Options()
    options.add_argument("--headless")
    options.add_argument("--disable-gpu")
    options.add_argument("--no-sandbox")
    options.add_argument("--disable-dev-shm-usage")
    options.add_argument("--window-size=1200,800")
    options.set_capability("goog:loggingPrefs", {"performance": "ALL"})

    try:
        service = Service(ChromeDriverManager().install())
        driver = webdriver.Chrome(service=service, options=options)
    except WebDriverException as e:
        print(f"‚ùå Kh√¥ng th·ªÉ kh·ªüi t·∫°o Chrome WebDriver: {e}")
        return None
    except Exception as e:
        print(f"‚ùå L·ªói khi c√†i/ch·∫°y ChromeDriver: {e}")
        return None

    try:
        try:
            driver.execute_cdp_cmd("Network.enable", {})
            driver.execute_cdp_cmd("Network.setExtraHTTPHeaders", {"headers": {"cookie": cookie}})
        except Exception:
            pass

        driver.get(url)
        time.sleep(3)

        fb_dtsg = None
        try:
            logs = driver.get_log("performance")
        except Exception:
            logs = []

        for entry in logs:
            try:
                msg = json.loads(entry.get("message", "{}")).get("message", {})
                method = msg.get("method", "")
                params = msg.get("params", {}) or {}
                if method in ("Network.requestWillBeSent", "Network.responseReceived"):
                    req = params.get("request") or params.get("response") or {}
                    url_req = req.get("url") or ""
                    if "api/graphql" in url_req:
                        postData = req.get("postData") or params.get("request", {}).get("postData", "") or ""
                        if postData:
                            m = re.search(r'fb_dtsg["\\\']?\\s*[:=]\\s*["\\\']([^"\\\']+)', postData)
                            if not m:
                                m = re.search(r'fb_dtsg=([^&"\\\']+)', postData)
                            if m:
                                fb_dtsg = m.group(1)
                                print(f"‚úÖ B·∫Øt ƒë∆∞·ª£c fb_dtsg t·ª´ graphql postData: {fb_dtsg[:50]}...")
                                break
            except Exception:
                continue

        if not fb_dtsg:
            # last resort: search in rendered page source (still within headless mode)
            html_content = driver.page_source or ""
            patterns = [
                r'"name":"fb_dtsg","value":"([^"]+)"',
                r'"token":"([^"]+)","type":"fb_dtsg"',
                r'"fb_dtsg"\\s*:\\s*"([^"]+)"',
                r'name="fb_dtsg"\\s+value="([^"]+)"',
                r'DTSGInitData.*?"token":"([^"]+)"'
            ]
            for i, pattern in enumerate(patterns, 1):
                match = re.search(pattern, html_content)
                if match:
                    fb_dtsg = match.group(1)
                    print(f"‚úÖ T√¨m th·∫•y fb_dtsg trong page_source v·ªõi pattern {i}: {fb_dtsg[:50]}...")
                    break

        if return_page_source:
            try:
                page_source = driver.page_source or ""
            except Exception:
                page_source = ""
            return fb_dtsg, page_source
        return fb_dtsg
    finally:
        try:
            driver.quit()
        except Exception:
            pass


def capture_graphql_post_payloads(cookie, timeout: int = 6, first_only: bool = True):
    """
    D√πng headless Chrome (CDP performance logs) ƒë·ªÉ b·∫Øt c√°c request POST t·ªõi /api/graphql/
    Tr·∫£ v·ªÅ danh s√°ch dict ch·ª©a: url, request_id, post_data (raw string), parsed (dict)
    Ch·ªâ tr·∫£ c√°c request c√≥ response status == 200.
    """
    url = "https://www.facebook.com"

    try:
        from selenium import webdriver
        from selenium.webdriver.chrome.options import Options
        from selenium.webdriver.chrome.service import Service
        from selenium.common.exceptions import WebDriverException
        from webdriver_manager.chrome import ChromeDriverManager
    except Exception as e:
        print(f"‚ùå Selenium/webdriver_manager unavailable: {e}")
        return []

    options = Options()
    options.add_argument("--headless")
    options.add_argument("--disable-gpu")
    options.add_argument("--no-sandbox")
    options.add_argument("--disable-dev-shm-usage")
    options.add_argument("--window-size=1200,800")
    options.set_capability("goog:loggingPrefs", {"performance": "ALL"})

    try:
        service = Service(ChromeDriverManager().install())
        driver = webdriver.Chrome(service=service, options=options)
    except Exception as e:
        print(f"‚ùå Cannot start ChromeDriver: {e}")
        return []

    try:
        try:
            driver.execute_cdp_cmd("Network.enable", {})
            driver.execute_cdp_cmd("Network.setExtraHTTPHeaders", {"headers": {"cookie": cookie}})
        except Exception:
            pass

        driver.get(url)
        # allow network activity
        time.sleep(max(2, timeout))

        try:
            logs = driver.get_log("performance")
        except Exception:
            logs = []

        requests_map = {}
        responses_map = {}

        for entry in logs:
            try:
                msg = json.loads(entry.get("message", "{}")).get("message", {})
                method = msg.get("method", "")
                params = msg.get("params", {}) or {}
                request_id = params.get("requestId")

                if method == "Network.requestWillBeSent":
                    req = params.get("request", {}) or {}
                    url_req = req.get("url", "")
                    meth = req.get("method", "").upper()
                    if "/api/graphql" in url_req and meth == "POST":
                        requests_map[request_id] = {
                            "url": url_req,
                            "postData": req.get("postData", ""),
                            "headers": req.get("headers", {})
                        }

                elif method == "Network.responseReceived":
                    resp = params.get("response", {}) or {}
                    status = resp.get("status")
                    responses_map[request_id] = status
            except Exception:
                continue

        results = []
        for req_id, req_info in requests_map.items():
            status = responses_map.get(req_id)
            if status != 200:
                continue
            raw_post = req_info.get("postData", "") or ""
            # postData may be urlencoded form; parse it
            parsed_qs = parse_qs(raw_post, keep_blank_values=True)
            # flatten values to single string
            parsed = {k: (v[0] if isinstance(v, list) and len(v) > 0 else "") for k, v in parsed_qs.items()}
            # also decode pluses for safety
            parsed = {k: unquote_plus(v) if isinstance(v, str) else v for k, v in parsed.items()}

            results.append({
                "request_id": req_id,
                "url": req_info.get("url"),
                "raw_post_data": raw_post,
                "parsed": parsed,
                "status": status,
                "headers": req_info.get("headers", {})
            })

            if first_only and results:
                break

        if not results:
            print("‚ö†Ô∏è Kh√¥ng b·∫Øt ƒë∆∞·ª£c POST /api/graphql/ v·ªõi status 200 trong kho·∫£ng th·ªùi gian n√†y.")
        else:
            print(f"‚úÖ B·∫Øt ƒë∆∞·ª£c {len(results)} POST /api/graphql/ (status=200).")

        return results
    finally:
        try:
            driver.quit()
        except Exception:
            pass


def get_all_payload_values(cookie, profile_id: str | None = None):
    """
    L·∫•y t·∫•t c·∫£ c√°c gi√° tr·ªã payload t·ª´ Facebook.com
    
    Args:
        cookie (str): Cookie string ƒë·ªÉ s·ª≠ d·ª•ng
    
    Returns:
        dict: Dictionary ch·ª©a c_user, av, __user, fb_dtsg, jazoest, lsd, spin_r, spin_t ho·∫∑c None n·∫øu l·ªói
    """
    # CH·ªà D√ôNG HEADLESS SELENIUM: kh√¥ng c√≤n fallback b·∫±ng requests.get
    try:
        # L·∫•y c_user t·ª´ cookie (t·ª´ cookie string)
        c_user = get_c_user(cookie)
        if c_user:
            print(f"‚úÖ T√¨m th·∫•y c_user: {c_user}")
        else:
            print(f"‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y c_user trong cookie")

        # Try to get fb_dtsg from settings.json first (if profile_id provided)
        fb_from_cfg = None
        if profile_id:
            try:
                cfg = _read_settings_profile_config(profile_id)
                if isinstance(cfg, dict):
                    fb_from_cfg = cfg.get("fb_dtsg") or cfg.get("fb_dtsg_token") or cfg.get("fb_dtsg_value")
                    if fb_from_cfg:
                        fb_from_cfg = str(fb_from_cfg).strip()
            except Exception:
                fb_from_cfg = None

        fb_dtsg = None
        html_content = ""
        payload = {}

        # If fb_dtsg not present in settings, capture graphql POST payload to extract it and other values.
        if not fb_from_cfg:
            parsed_post = capture_graphql_post_payload(cookie, timeout=5)
            if not parsed_post:
                print("‚ùå Kh√¥ng t√¨m th·∫•y POST /api/graphql ho·∫∑c kh√¥ng parse ƒë∆∞·ª£c payload")
                return None
            payload = parsed_post  # dict of string->string
            fb_dtsg = payload.get("fb_dtsg") or payload.get("fb_dtsg_token") or None
            if fb_dtsg:
                print(f"‚úÖ fb_dtsg t·ª´ payload: {fb_dtsg[:30]}...")
                # Persist fb_dtsg into settings.json for this profile_id if provided
                if profile_id:
                    try:
                        if SETTINGS_JSON_FILE.exists():
                            with open(SETTINGS_JSON_FILE, "r", encoding="utf-8") as sf:
                                sdata = json.load(sf)
                        else:
                            sdata = {}
                        profiles = sdata.get("PROFILE_IDS") or {}
                        if not isinstance(profiles, dict):
                            profiles = {}
                        profile_cfg = profiles.get(profile_id) or {}
                        if not isinstance(profile_cfg, dict):
                            profile_cfg = {}
                        profile_cfg["fb_dtsg"] = fb_dtsg
                        profiles[profile_id] = profile_cfg
                        sdata["PROFILE_IDS"] = profiles
                        with open(SETTINGS_JSON_FILE, "w", encoding="utf-8") as sf:
                            json.dump(sdata, sf, ensure_ascii=False, indent=2)
                        print(f"‚úÖ ƒê√£ ghi fb_dtsg v√†o {SETTINGS_JSON_FILE} cho profile_id={profile_id}")
                    except Exception as e:
                        print(f"‚ö†Ô∏è Kh√¥ng th·ªÉ ghi fb_dtsg v√†o settings.json: {e}")
        else:
            fb_dtsg = fb_from_cfg
            payload = {}
            print(f"‚ÑπÔ∏è S·ª≠ d·ª•ng fb_dtsg t·ª´ {SETTINGS_JSON_FILE} cho profile_id={profile_id} ‚Äî kh√¥ng kh·ªüi ƒë·ªông headless capture")

        # prefer payload __user/av when present, otherwise use c_user
        av = payload.get("av") or payload.get("__user") or payload.get("__aaid") or c_user
        __user = payload.get("__user") or av or c_user
        c_user_final = c_user or __user or av

        # jazoest may be present in payload, otherwise compute from fb_dtsg
        jazoest = payload.get("jazoest") or (get_jazoest(fb_dtsg) if fb_dtsg else None)

        # lsd / spin values may be present in payload or in page source
        lsd = payload.get("lsd") or payload.get("x-fb-lsd") or None
        spin_r = payload.get("__spin_r") or None
        spin_t = payload.get("__spin_t") or None

        print(f"‚úÖ B·∫Øt ƒë∆∞·ª£c graphql payload keys: {list(payload.keys())}")
        if fb_dtsg:
            print(f"‚úÖ fb_dtsg: {fb_dtsg[:30]}...")

        result = {
            "c_user": c_user_final,
            "av": av,
            "__user": __user,
            "fb_dtsg": fb_dtsg,
            "jazoest": jazoest,
            "lsd": lsd,
            "spin_r": spin_r,
            "spin_t": spin_t
        }
        return result
    except Exception as e:
        print(f"‚ùå L·ªói khi l·∫•y payload values (headless): {e}")
        import traceback
        traceback.print_exc()
        return None


def capture_graphql_post_payload(cookie, timeout: int = 8):
    """
    D√πng headless Selenium + performance logs ƒë·ªÉ b·∫Øt POST requests t·ªõi /api/graphql/
    Tr·∫£ v·ªÅ dictionary t·ª´ postData (form-urlencoded) c·ªßa request ƒë·∫ßu t√¨m ƒë∆∞·ª£c.

    Args:
        cookie (str): Cookie string ƒë·ªÉ inject
        timeout (int): S·ªë gi√¢y ch·ªù sau khi load trang ƒë·ªÉ thu logs

    Returns:
        dict | None: parsed payload (string->string) ho·∫∑c None n·∫øu kh√¥ng t√¨m th·∫•y
    """
    try:
        from selenium import webdriver
        from selenium.webdriver.chrome.options import Options
        from selenium.webdriver.chrome.service import Service
        from selenium.common.exceptions import WebDriverException
        from webdriver_manager.chrome import ChromeDriverManager
        from urllib.parse import parse_qs, unquote_plus
    except Exception as e:
        print(f"‚ùå Selenium/webdriver_manager ho·∫∑c urllib kh√¥ng c√≥: {e}")
        return None

    options = Options()
    options.add_argument("--headless")
    options.add_argument("--disable-gpu")
    options.add_argument("--no-sandbox")
    options.add_argument("--disable-dev-shm-usage")
    options.add_argument("--window-size=1200,800")
    options.set_capability("goog:loggingPrefs", {"performance": "ALL"})

    try:
        service = Service(ChromeDriverManager().install())
        driver = webdriver.Chrome(service=service, options=options)
    except WebDriverException as e:
        print(f"‚ùå Kh√¥ng th·ªÉ kh·ªüi t·∫°o Chrome WebDriver: {e}")
        return None
    except Exception as e:
        print(f"‚ùå L·ªói khi c√†i/ch·∫°y ChromeDriver: {e}")
        return None

    try:
        try:
            driver.execute_cdp_cmd("Network.enable", {})
            driver.execute_cdp_cmd("Network.setExtraHTTPHeaders", {"headers": {"cookie": cookie}})
        except Exception:
            pass

        driver.get("https://www.facebook.com")
        time.sleep(timeout)

        try:
            logs = driver.get_log("performance")
        except Exception:
            logs = []

        for entry in logs:
            try:
                msg = json.loads(entry.get("message", "{}")).get("message", {})
                method = msg.get("method", "")
                params = msg.get("params", {}) or {}
                # requestWillBeSent contains request with postData
                if method == "Network.requestWillBeSent":
                    req = params.get("request", {}) or {}
                    url_req = req.get("url", "") or ""
                    postData = req.get("postData", "") or ""
                    if "/api/graphql" in url_req and postData:
                        # postData is form-urlencoded string; parse it
                        try:
                            parsed = parse_qs(postData, keep_blank_values=True)
                            # flatten values: take first value and url-decode
                            flat = {k: unquote_plus(v[0]) if isinstance(v, list) and v else (v if isinstance(v, str) else "") for k, v in parsed.items()}
                            print(f"‚úÖ B·∫Øt ƒë∆∞·ª£c graphql POST t·∫°i {url_req}, keys: {list(flat.keys())}")
                            return flat
                        except Exception as e:
                            print(f"‚ö†Ô∏è L·ªói khi parse postData: {e}")
                            # try manual parse fallback
                            try:
                                parts = postData.split("&")
                                flat = {}
                                for p in parts:
                                    if "=" in p:
                                        k, v = p.split("=", 1)
                                        flat[k] = unquote_plus(v)
                                if flat:
                                    print(f"‚úÖ B·∫Øt ƒë∆∞·ª£c graphql POST (manual parse), keys: {list(flat.keys())}")
                                    return flat
                            except Exception:
                                pass
                # also consider Network.responseReceived -> might include requestId, skip for now
            except Exception:
                continue

        print("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y POST t·ªõi /api/graphql/ trong performance logs")
        return None
    finally:
        try:
            driver.quit()
        except Exception:
            pass


def create_payload_dict(payload_values):
    """
    T·∫°o payload dictionary t·ª´ payload.txt v√† payload_values
    
    Args:
        payload_values (dict): Dictionary ch·ª©a c√°c gi√° tr·ªã ƒë·ªông (fb_dtsg, jazoest, lsd, etc.)
    
    Returns:
        dict: Payload dictionary ho√†n ch·ªânh
    """
    try:
        # ƒê·ªçc file payload.txt
        with open(PAYLOAD_TXT_FILE, "r", encoding="utf-8") as f:
            content = f.read().strip()
        
        # Parse t·ª´ng d√≤ng key: value
        payload_dict = {}
        for line in content.split('\n'):
            line = line.strip()
            if not line or not ':' in line:
                continue
            
            # T√°ch key v√† value
            parts = line.split(':', 1)
            if len(parts) == 2:
                key = parts[0].strip().replace('"', '').replace("'", '')
                value = parts[1].strip().replace('"', '').replace("'", '').rstrip(',').strip()
                if key and value:
                    payload_dict[key] = value
        
        # C·∫≠p nh·∫≠t c√°c gi√° tr·ªã ƒë·ªông t·ª´ payload_values
        if payload_values.get('c_user'):
            payload_dict['av'] = payload_values['c_user']
            payload_dict['__user'] = payload_values['c_user']
        
        if payload_values.get('fb_dtsg'):
            payload_dict['fb_dtsg'] = payload_values['fb_dtsg']
        
        if payload_values.get('jazoest'):
            payload_dict['jazoest'] = payload_values['jazoest']
        
        if payload_values.get('lsd'):
            payload_dict['lsd'] = payload_values['lsd']
        
        if payload_values.get('spin_r'):
            payload_dict['__spin_r'] = payload_values['spin_r']
        
        if payload_values.get('spin_t'):
            payload_dict['__spin_t'] = payload_values['spin_t']
        
        print(f"‚úÖ ƒê√£ t·∫°o payload dictionary v·ªõi {len(payload_dict)} keys")
        return payload_dict
        
    except FileNotFoundError:
        print(f"‚ùå Kh√¥ng t√¨m th·∫•y file {PAYLOAD_TXT_FILE}!")
        return None
    except Exception as e:
        print(f"‚ùå L·ªói khi t·∫°o payload dict: {e}")
        return None


def get_payload_by_profile_id(profile_id):
    """
    L·∫•y payload dictionary d·ª±a tr√™n profile_id
    
    Args:
        profile_id (str): Profile ID (v√≠ d·ª•: "031ca13d-e8fa-400c-a603-df57a2806788")
    
    Returns:
        dict: Payload dictionary ho√†n ch·ªânh ho·∫∑c None n·∫øu l·ªói
    """
    # L·∫•y cookies t·ª´ profile_id
    cookie = get_cookies_by_profile_id(profile_id)
    if not cookie:
        return None
    
    # L·∫•y payload values t·ª´ Facebook (truy·ªÅn profile_id ƒë·ªÉ ∆∞u ti√™n fb_dtsg t·ª´ settings.json)
    payload_values = get_all_payload_values(cookie, profile_id=profile_id)
    if not payload_values:
        return None
    
    # T·∫°o payload dict t·ª´ payload.txt v√† payload_values
    payload_dict = create_payload_dict(payload_values)
    return payload_dict


def update_payload_file(payload_values):
    """
    C·∫≠p nh·∫≠t file payload.txt v·ªõi c√°c gi√° tr·ªã m·ªõi
    
    Args:
        payload_values (dict): Dictionary ch·ª©a c√°c gi√° tr·ªã c·∫ßn c·∫≠p nh·∫≠t
            - c_user: Gi√° tr·ªã c_user (s·∫Ω thay cho av v√† __user)
            - fb_dtsg: Gi√° tr·ªã fb_dtsg
            - jazoest: Gi√° tr·ªã jazoest
            - lsd: Gi√° tr·ªã lsd
            - spin_r: Gi√° tr·ªã __spin_r
            - spin_t: Gi√° tr·ªã __spin_t
    
    Returns:
        bool: True n·∫øu th√†nh c√¥ng, False n·∫øu l·ªói
    """
    PAYLOAD_FILE = "backend/config/payload.txt"
    
    try:
        # ƒê·ªçc file payload hi·ªán t·∫°i
        with open(PAYLOAD_FILE, "r", encoding="utf-8") as f:
            lines = f.readlines()
        
        # C·∫≠p nh·∫≠t c√°c gi√° tr·ªã
        updated_lines = []
        for line in lines:
            original_line = line
            
            # C·∫≠p nh·∫≠t av v√† __user n·∫øu c√≥ c_user
            if payload_values.get('c_user'):
                if line.strip().startswith('"av":'):
                    line = f'"av": "{payload_values["c_user"]}",\n'
                elif line.strip().startswith('"__user":'):
                    line = f'"__user": "{payload_values["c_user"]}",\n'
            
            # C·∫≠p nh·∫≠t fb_dtsg
            if payload_values.get('fb_dtsg') and line.strip().startswith('"fb_dtsg":'):
                line = f'"fb_dtsg": "{payload_values["fb_dtsg"]}",\n'
            
            # C·∫≠p nh·∫≠t jazoest
            if payload_values.get('jazoest') and line.strip().startswith('"jazoest":'):
                line = f'"jazoest": "{payload_values["jazoest"]}",\n'
            
            # C·∫≠p nh·∫≠t lsd
            if payload_values.get('lsd') and line.strip().startswith('"lsd":'):
                line = f'"lsd": "{payload_values["lsd"]}",\n'
            
            # C·∫≠p nh·∫≠t __spin_r
            if payload_values.get('spin_r') and line.strip().startswith('"__spin_r":'):
                line = f'"__spin_r": "{payload_values["spin_r"]}",\n'
            
            # C·∫≠p nh·∫≠t __spin_t
            if payload_values.get('spin_t') and line.strip().startswith('"__spin_t":'):
                line = f'"__spin_t": "{payload_values["spin_t"]}",\n'
            
            updated_lines.append(line)
        
        # Ghi l·∫°i file
        with open(PAYLOAD_FILE, "w", encoding="utf-8") as f:
            f.writelines(updated_lines)
        
        print(f"‚úÖ ƒê√£ c·∫≠p nh·∫≠t file {PAYLOAD_FILE}")
        return True
        
    except Exception as e:
        print(f"‚ùå L·ªói khi c·∫≠p nh·∫≠t file payload: {e}")
        import traceback
        traceback.print_exc()
        return False


def ensure_payload_from_bad_response(profile_id: str | None, cookie: str | None, response_text: str | None = None, timeout: int = 8):
    """
    Khi g·∫∑p response kh√¥ng ph·∫£i JSON (v√≠ d·ª• tr·∫£ v·ªÅ 'for (;;);{...error...}'), c·ªë g·∫Øng:
      - L·∫•y fb_dtsg, lsd t·ª´ `response_text` n·∫øu c√≥
      - N·∫øu kh√¥ng, kh·ªüi ƒë·ªông headless capture (`capture_graphql_post_payload`) ƒë·ªÉ b·∫Øt postData
      - Ghi c√°c gi√° tr·ªã t√¨m ƒë∆∞·ª£c v√†o `settings.json` trong PROFILE_IDS[profile_id]
    Tr·∫£ v·ªÅ dict v·ªõi c√°c gi√° tr·ªã t√¨m ƒë∆∞·ª£c ho·∫∑c None n·∫øu th·∫•t b·∫°i.
    """
    try:
        fb_dtsg = None
        lsd = None

        text = response_text or ""
        # Remove facebook XSSI prefix if present
        if isinstance(text, str) and text.startswith("for (;;);"):
            text = text[len("for (;;);"):]

        # Try parse JSON body if possible and extract known fields
        try:
            parsed_json = json.loads(text) if text else {}
            if isinstance(parsed_json, dict):
                # some responses may include tokens under nested structures
                # quick search for common keys
                for k in ("fb_dtsg", "fb_dtsg_token", "fb_dtsg_value"):
                    v = parsed_json.get(k)
                    if v:
                        fb_dtsg = str(v)
                        break
                # lsd may appear as x-fb-lsd or lsd
                for k in ("lsd", "x-fb-lsd"):
                    v = parsed_json.get(k)
                    if v:
                        lsd = str(v)
                        break
        except Exception:
            parsed_json = {}

        # Fallback: regex search in raw text
        if not fb_dtsg and isinstance(text, str):
            fb_patterns = [
                r'"name":"fb_dtsg","value":"([^"]+)"',
                r'"token":"([^"]+)","type":"fb_dtsg"',
                r'"fb_dtsg"\s*:\s*"([^"]+)"',
                r'name="fb_dtsg"\s+value="([^"]+)"',
                r'DTSGInitData.*?"token":"([^"]+)"'
            ]
            for p in fb_patterns:
                m = re.search(p, text)
                if m:
                    fb_dtsg = m.group(1)
                    break

        if not lsd and isinstance(text, str):
            lsd_patterns = [
                r'"LSD",\[\],{"token":"(.*?)"}',
                r'"x-fb-lsd"\s*:\s*"([^"]+)"',
                r'"lsd"\s*:\s*"([^"]+)"'
            ]
            for p in lsd_patterns:
                m = re.search(p, text)
                if m:
                    lsd = m.group(1)
                    break

        # If still not found, attempt headless capture to parse graphql postData
        if not fb_dtsg or not lsd:
            try:
                parsed = capture_graphql_post_payload(cookie, timeout=timeout)
                if isinstance(parsed, dict):
                    if not fb_dtsg:
                        fb_dtsg = parsed.get("fb_dtsg") or parsed.get("fb_dtsg_token") or parsed.get("fb_dtsg_value")
                    if not lsd:
                        lsd = parsed.get("lsd") or parsed.get("x-fb-lsd")
            except Exception as e:
                print(f"‚ö†Ô∏è Headless capture failed: {e}")

        # Persist into settings.json if profile_id provided and we found anything
        if profile_id and (fb_dtsg or lsd):
            try:
                if SETTINGS_JSON_FILE.exists():
                    with open(SETTINGS_JSON_FILE, "r", encoding="utf-8") as sf:
                        sdata = json.load(sf)
                else:
                    sdata = {}
                profiles = sdata.get("PROFILE_IDS") or {}
                if not isinstance(profiles, dict):
                    profiles = {}
                profile_cfg = profiles.get(profile_id) or {}
                if not isinstance(profile_cfg, dict):
                    profile_cfg = {}
                if fb_dtsg:
                    profile_cfg["fb_dtsg"] = fb_dtsg
                if lsd:
                    profile_cfg["lsd"] = lsd
                profiles[profile_id] = profile_cfg
                sdata["PROFILE_IDS"] = profiles
                with open(SETTINGS_JSON_FILE, "w", encoding="utf-8") as sf:
                    json.dump(sdata, sf, ensure_ascii=False, indent=2)
                print(f"‚úÖ ƒê√£ ghi payload values v√†o {SETTINGS_JSON_FILE} cho profile_id={profile_id}")
            except Exception as e:
                print(f"‚ö†Ô∏è Kh√¥ng th·ªÉ ghi v√†o settings.json: {e}")

        result = {"fb_dtsg": fb_dtsg, "lsd": lsd}
        return result
    except Exception as e:
        print(f"‚ùå ensure_payload_from_bad_response failed: {e}")
        return None
if __name__ == "__main__":
    # V√≠ d·ª• s·ª≠ d·ª•ng v·ªõi profile_id
    profile_id = "031ca13d-e8fa-400c-a603-df57a2806788"
    payload_dict = get_payload_by_profile_id(profile_id)
    
    if payload_dict:
        print(f"\nüìã Payload dictionary ƒë√£ t·∫°o th√†nh c√¥ng!")
        print(f"   S·ªë l∆∞·ª£ng keys: {len(payload_dict)}")
        print(f"   Sample keys: {list(payload_dict.keys())[:5]}")
    else:
        print(f"\n‚ùå Kh√¥ng th·ªÉ t·∫°o payload dictionary")


--- END FILE: backend\worker\get_payload.py ---

--- START FILE: backend\worker\get_post_from_page.py ---
import requests
import json
from pathlib import Path
from datetime import datetime, timezone, timedelta
from urllib.parse import urlparse, parse_qs

# ====== L∆ØU √ù ======
# L·∫•y access_token t·ª´ cookies.json th√¥ng qua profile_id
# S·ª≠ d·ª•ng get_payload.get_access_token_by_profile_id(profile_id) ƒë·ªÉ l·∫•y access_token


def get_access_token_by_profile_id(profile_id):
    """
    L·∫•y access_token t·ª´ cookies.json d·ª±a tr√™n profile_id
    
    Args:
        profile_id (str): Profile ID (v√≠ d·ª•: "031ca13d-e8fa-400c-a603-df57a2806788")
    
    Returns:
        str: Access token ho·∫∑c None n·∫øu kh√¥ng t√¨m th·∫•y
    """
    from get_payload import get_access_token_by_profile_id as get_token
    return get_token(profile_id)


def parse_datetime_string(dt_string):
    """
    Parse datetime string t·ª´ Facebook API (format: "2025-12-14T17:58:05+0000")
    
    Args:
        dt_string (str): Datetime string t·ª´ Facebook API
        
    Returns:
        datetime: Datetime object ho·∫∑c None n·∫øu parse l·ªói
    """
    try:
        # Format: "2025-12-14T17:58:05+0000"
        # Chuy·ªÉn th√†nh: "2025-12-14T17:58:05+00:00" ƒë·ªÉ parse ƒë∆∞·ª£c
        if dt_string.endswith("+0000"):
            dt_string = dt_string.replace("+0000", "+00:00")
        elif dt_string.endswith("-0000"):
            dt_string = dt_string.replace("-0000", "-00:00")
        
        return datetime.fromisoformat(dt_string)
    except Exception as e:
        print(f"‚ö†Ô∏è L·ªói khi parse datetime '{dt_string}': {e}")
        return None


def convert_to_vietnam_datetime(dt_string):
    """
    Chuy·ªÉn ƒë·ªïi datetime string t·ª´ Facebook API sang ng√†y th√°ng nƒÉm theo m√∫i gi·ªù Vi·ªát Nam (UTC+7)
    
    Args:
        dt_string (str): Datetime string t·ª´ Facebook API (format: "2025-12-14T17:58:05+0000")
        
    Returns:
        str: Ng√†y th√°ng nƒÉm theo format "YYYY-MM-DD HH:MM:SS" (m√∫i gi·ªù Vi·ªát Nam) ho·∫∑c None n·∫øu l·ªói
    """
    try:
        # Parse datetime t·ª´ API (UTC)
        dt_utc = parse_datetime_string(dt_string)
        if not dt_utc:
            return None
        
        # Chuy·ªÉn sang m√∫i gi·ªù Vi·ªát Nam (UTC+7)
        vietnam_tz = timezone(timedelta(hours=7))
        dt_vietnam = dt_utc.astimezone(vietnam_tz)
        
        # Format th√†nh ng√†y th√°ng nƒÉm
        return dt_vietnam.strftime("%Y-%m-%d %H:%M:%S")
    except Exception as e:
        print(f"‚ö†Ô∏è L·ªói khi chuy·ªÉn ƒë·ªïi datetime '{dt_string}' sang gi·ªù Vi·ªát Nam: {e}")
        return None


def parse_vietnam_datetime(date_str, is_end_of_day=False):
    """
    Parse ng√†y th√°ng nƒÉm theo m√∫i gi·ªù Vi·ªát Nam (UTC+7) v√† chuy·ªÉn sang UTC
    
    H·ªó tr·ª£ c√°c format:
    - "2025-12-14" ho·∫∑c "2025/12/14"
    - "14-12-2025" ho·∫∑c "14/12/2025"
    - "2025-12-14 00:00:00" ho·∫∑c "2025-12-14 23:59:59"
    
    Args:
        date_str (str): Chu·ªói ng√†y th√°ng nƒÉm
        is_end_of_day (bool): N·∫øu True, ƒë·∫∑t th·ªùi gian l√† 23:59:59, n·∫øu False l√† 00:00:00
        
    Returns:
        tuple: (datetime_utc, datetime_string_for_api) ho·∫∑c (None, None) n·∫øu l·ªói
    """
    try:
        # M√∫i gi·ªù Vi·ªát Nam (UTC+7)
        vietnam_tz = timezone(timedelta(hours=7))
        
        # Lo·∫°i b·ªè kho·∫£ng tr·∫Øng th·ª´a
        date_str = date_str.strip()
        
        # X·ª≠ l√Ω c√°c format kh√°c nhau
        dt = None
        
        # Format: "2025-12-14" ho·∫∑c "2025/12/14"
        if "-" in date_str or "/" in date_str:
            # Thay th·∫ø "/" b·∫±ng "-"
            date_str = date_str.replace("/", "-")
            
            # T√°ch ph·∫ßn ng√†y v√† gi·ªù (n·∫øu c√≥)
            parts = date_str.split()
            date_part = parts[0]
            time_part = parts[1] if len(parts) > 1 else None
            
            # Parse date part
            date_parts = date_part.split("-")
            
            if len(date_parts) == 3:
                # Ki·ªÉm tra format: YYYY-MM-DD ho·∫∑c DD-MM-YYYY
                if len(date_parts[0]) == 4:  # YYYY-MM-DD
                    year, month, day = date_parts
                else:  # DD-MM-YYYY
                    day, month, year = date_parts
                
                year = int(year)
                month = int(month)
                day = int(day)
                
                # Parse time part (n·∫øu c√≥)
                if time_part:
                    time_parts = time_part.split(":")
                    hour = int(time_parts[0])
                    minute = int(time_parts[1]) if len(time_parts) > 1 else 0
                    second = int(time_parts[2]) if len(time_parts) > 2 else 0
                else:
                    # N·∫øu kh√¥ng c√≥ time, ƒë·∫∑t theo is_end_of_day
                    if is_end_of_day:
                        hour, minute, second = 23, 59, 59
                    else:
                        hour, minute, second = 0, 0, 0
                
                # T·∫°o datetime v·ªõi m√∫i gi·ªù Vi·ªát Nam
                dt = datetime(year, month, day, hour, minute, second, tzinfo=vietnam_tz)
        
        # N·∫øu kh√¥ng parse ƒë∆∞·ª£c, th·ª≠ parse tr·ª±c ti·∫øp
        if dt is None:
            # Th·ª≠ parse v·ªõi c√°c format kh√°c
            formats = [
                "%Y-%m-%d",
                "%d-%m-%Y",
                "%Y/%m/%d",
                "%d/%m/%Y",
                "%Y-%m-%d %H:%M:%S",
                "%d-%m-%Y %H:%M:%S",
            ]
            
            for fmt in formats:
                try:
                    dt = datetime.strptime(date_str, fmt)
                    # Th√™m m√∫i gi·ªù Vi·ªát Nam
                    dt = dt.replace(tzinfo=vietnam_tz)
                    # N·∫øu kh√¥ng c√≥ gi·ªù, ƒë·∫∑t theo is_end_of_day
                    if "%H" not in fmt:
                        if is_end_of_day:
                            dt = dt.replace(hour=23, minute=59, second=59)
                        else:
                            dt = dt.replace(hour=0, minute=0, second=0)
                    break
                except ValueError:
                    continue
        
        if dt is None:
            raise ValueError(f"Kh√¥ng th·ªÉ parse date string: {date_str}")
        
        # Chuy·ªÉn sang UTC
        dt_utc = dt.astimezone(timezone.utc)
        
        # Format cho API: Unix timestamp ho·∫∑c ISO format
        # S·ª≠ d·ª•ng Unix timestamp (d·ªÖ d√†ng h∆°n)
        unix_timestamp = str(int(dt_utc.timestamp()))
        
        return dt_utc, unix_timestamp
        
    except Exception as e:
        print(f"‚ö†Ô∏è L·ªói khi parse Vietnam datetime '{date_str}': {e}")
        return None, None


def get_posts_from_page(page_id, profile_id, start_date=None, end_date=None, limit=None):
    """
    L·∫•y danh s√°ch posts t·ª´ page/group qua Graph API v·ªõi ƒëi·ªÅu ki·ªán l·ªçc theo th·ªùi gian
    
    Args:
        page_id (str): Page ID ho·∫∑c Group ID
        profile_id (str): Profile ID ƒë·ªÉ l·∫•y access_token
        start_date (str, required): Ng√†y b·∫Øt ƒë·∫ßu theo m√∫i gi·ªù Vi·ªát Nam (format: "2025-12-14" ho·∫∑c "14/12/2025")
        end_date (str, required): Ng√†y k·∫øt th√∫c theo m√∫i gi·ªù Vi·ªát Nam (format: "2025-12-14" ho·∫∑c "14/12/2025")
        limit (int, optional): Gi·ªõi h·∫°n s·ªë l∆∞·ª£ng posts (None = kh√¥ng gi·ªõi h·∫°n)
        
    Returns:
        list: Danh s√°ch posts ph√π h·ª£p ƒëi·ªÅu ki·ªán th·ªùi gian [{"id": "...", "updated_time": "..."}, ...]
    """
    # Validate th·ªùi gian
    if not start_date or not end_date:
        print(f"‚ùå L·ªói: C·∫ßn cung c·∫•p c·∫£ start_date v√† end_date")
        return []
    
    # L·∫•y access_token
    access_token = get_access_token_by_profile_id(profile_id)
    if not access_token:
        print(f"‚ùå Kh√¥ng th·ªÉ l·∫•y access_token t·ª´ profile_id: {profile_id}")
        return []
    
    # Parse ng√†y th√°ng nƒÉm theo m√∫i gi·ªù Vi·ªát Nam v√† chuy·ªÉn sang UTC
    start_dt, start_timestamp = parse_vietnam_datetime(start_date, is_end_of_day=False)
    end_dt, end_timestamp = parse_vietnam_datetime(end_date, is_end_of_day=True)
    
    if not start_dt or not end_dt:
        print(f"‚ùå L·ªói: Kh√¥ng th·ªÉ parse ng√†y th√°ng")
        return []
    
    # Validate: start_date ph·∫£i <= end_date
    if start_dt > end_dt:
        print(f"‚ùå L·ªói: start_date ({start_date}) ph·∫£i <= end_date ({end_date})")
        return []
    
    # Base URL cho Graph API
    base_url = f"https://graph.facebook.com/v24.0/{page_id}"
    
    # Parameters cho request (s·ª≠ d·ª•ng Unix timestamp)
    # S·ª≠ d·ª•ng feed.limit(1000) ƒë·ªÉ l·∫•y nhi·ªÅu posts m·ªói trang (t·ªëi ƒëa 1000)
    params = {
        "access_token": access_token,
        "fields": "feed.limit(1000){id,created_time}",
        "format": "json",
        "method": "get",
        "pretty": "0",
        "suppress_http_code": "1",
        "since": start_timestamp,  # Unix timestamp (UTC)
        "until": end_timestamp,     # Unix timestamp (UTC)
        "debug": "all",
        "origin_graph_explorer": "1",
        "transport": "cors"
    }
    
    all_posts = []
    next_url = None
    page_count = 0
    
    print(f"\nüöÄ B·∫Øt ƒë·∫ßu l·∫•y posts t·ª´ page_id: {page_id}")
    print(f"   üìÖ Ng√†y b·∫Øt ƒë·∫ßu (VN): {start_date} ‚Üí UTC: {start_dt.strftime('%Y-%m-%d %H:%M:%S UTC')}")
    print(f"   üìÖ Ng√†y k·∫øt th√∫c (VN): {end_date} ‚Üí UTC: {end_dt.strftime('%Y-%m-%d %H:%M:%S UTC')}")
    
    while True:
        # G·ª≠i request
        if next_url:
            # S·ª≠ d·ª•ng URL pagination t·ª´ response tr∆∞·ªõc
            url = next_url
            response = requests.get(url)
        else:
            # Request ƒë·∫ßu ti√™n
            url = base_url
            response = requests.get(url, params=params)
        
        page_count += 1
        print(f"\nüìÑ Trang {page_count}: {url[:100]}...")
        
        if response.status_code != 200:
            print(f"‚ùå L·ªói: Status code {response.status_code}")
            print(f"Response: {response.text[:500]}")
            break
        
        try:
            data = response.json()
            
            # Ki·ªÉm tra l·ªói t·ª´ API
            if "error" in data:
                print(f"‚ùå L·ªói t·ª´ API: {data['error']}")
                break
            
            # L·∫•y feed data
            feed_data = data.get("feed", {})
            posts = feed_data.get("data", [])
            
            if not posts:
                print(f"   ‚ÑπÔ∏è Kh√¥ng c√≥ posts n√†o trong trang n√†y")
                break
            
            print(f"   üìã T√¨m th·∫•y {len(posts)} posts trong trang n√†y")
            
            # L·ªçc posts theo ƒëi·ªÅu ki·ªán th·ªùi gian
            matched_count = 0
            for post in posts:
                post_id = post.get("id")
                created_time_str = post.get("created_time")
                
                if not post_id or not created_time_str:
                    continue
                
                # Parse created_time
                created_dt = parse_datetime_string(created_time_str)
                if not created_dt:
                    continue
                
                # Ki·ªÉm tra ƒëi·ªÅu ki·ªán th·ªùi gian: start_time <= created_time <= end_time
                # ƒê·∫£m b·∫£o created_time n·∫±m trong kho·∫£ng [start_dt, end_dt]
                if start_dt <= created_dt <= end_dt:
                    # Chuy·ªÉn ƒë·ªïi sang ng√†y th√°ng nƒÉm theo m√∫i gi·ªù Vi·ªát Nam
                    created_time_vn = convert_to_vietnam_datetime(created_time_str)
                    
                    all_posts.append({
                        "id": post_id,
                        "created_time": created_time_vn if created_time_vn else created_time_str
                    })
                    matched_count += 1
            
            print(f"   ‚úÖ C√≥ {matched_count} posts ph√π h·ª£p ƒëi·ªÅu ki·ªán trong trang n√†y")
            
            # Ki·ªÉm tra limit
            if limit and len(all_posts) >= limit:
                print(f"   ‚èπÔ∏è ƒê√£ ƒë·∫°t gi·ªõi h·∫°n {limit} posts")
                all_posts = all_posts[:limit]
                break
            
            # Ki·ªÉm tra pagination
            paging = feed_data.get("paging", {})
            if "next" in paging:
                next_url = paging["next"]
            else:
                print(f"   ‚ÑπÔ∏è Kh√¥ng c√≤n trang ti·∫øp theo")
                break
                
        except json.JSONDecodeError as e:
            print(f"‚ùå L·ªói: Response kh√¥ng ph·∫£i JSON h·ª£p l·ªá")
            print(f"Response text (500 k√Ω t·ª± ƒë·∫ßu): {response.text[:500]}")
            break
        except Exception as e:
            print(f"‚ùå L·ªói khi x·ª≠ l√Ω response: {e}")
            import traceback
            traceback.print_exc()
            break
    
    print(f"\n‚úÖ Ho√†n th√†nh! T·ªïng c·ªông l·∫•y ƒë∆∞·ª£c {len(all_posts)} posts ph√π h·ª£p ƒëi·ªÅu ki·ªán")
    return all_posts


def get_post_ids_from_page(page_id, profile_id, start_date=None, end_date=None, limit=None):
    """
    L·∫•y danh s√°ch post IDs t·ª´ page/group (ch·ªâ tr·∫£ v·ªÅ IDs, kh√¥ng c√≥ th√¥ng tin th·ªùi gian)
    
    Args:
        page_id (str): Page ID ho·∫∑c Group ID
        profile_id (str): Profile ID ƒë·ªÉ l·∫•y access_token
        start_date (str, required): Ng√†y b·∫Øt ƒë·∫ßu theo m√∫i gi·ªù Vi·ªát Nam (format: "2025-12-14" ho·∫∑c "14/12/2025")
        end_date (str, required): Ng√†y k·∫øt th√∫c theo m√∫i gi·ªù Vi·ªát Nam (format: "2025-12-14" ho·∫∑c "14/12/2025")
        limit (int, optional): Gi·ªõi h·∫°n s·ªë l∆∞·ª£ng posts
        
    Returns:
        list: Danh s√°ch post IDs (strings)
    """
    posts = get_posts_from_page(page_id, profile_id, start_date, end_date, limit)
    return [post["id"] for post in posts]


if __name__ == "__main__":
    import os
    
    # V√≠ d·ª• s·ª≠ d·ª•ng
    profile_id = "b77da63d-af55-43c2-ab7f-364250b20e30"
    page_id = "445142479459290"
    
    # L·∫•y posts v·ªõi ƒëi·ªÅu ki·ªán th·ªùi gian (theo m√∫i gi·ªù Vi·ªát Nam)
    start_date = "2025-12-8"  # Ng√†y b·∫Øt ƒë·∫ßu (s·∫Ω t·ª± ƒë·ªông ƒë·∫∑t 00:00:00 VN = 17:00:00 UTC ng√†y h√¥m tr∆∞·ªõc)
    end_date = "2025-12-14"    # Ng√†y k·∫øt th√∫c (s·∫Ω t·ª± ƒë·ªông ƒë·∫∑t 23:59:59 VN = 16:59:59 UTC ng√†y h√¥m sau)
    
    posts = get_posts_from_page(page_id, profile_id, start_date, end_date, limit=None)
    
    # In k·∫øt qu·∫£
    print(f"\nüìä K·∫øt qu·∫£:")
    print(f"   T·ªïng s·ªë posts: {len(posts)}")
    if posts:
        print(f"   V√≠ d·ª• 5 posts ƒë·∫ßu ti√™n:")
        for post in posts[:5]:
            print(f"      - {post['id']} (created: {post['created_time']})")
    
    # L∆∞u ra file JSON (theo project root)
    base_dir = Path(__file__).resolve().parents[2]
    output_dir = base_dir / "backend" / "data"
    os.makedirs(output_dir, exist_ok=True)
    
    # T·∫°o t√™n file d·ª±a tr√™n page_id v√† ng√†y
    filename = f"{page_id}_posts_{start_date.replace('/', '-')}_to_{end_date.replace('/', '-')}.json"
    filepath = output_dir / filename
    
    # T·∫°o d·ªØ li·ªáu ƒë·ªÉ l∆∞u
    output_data = {
        "page_id": page_id,
        "profile_id": profile_id,
        "start_date": start_date,
        "end_date": end_date,
        "total_posts": len(posts),
        "posts": posts
    }
    
    # L∆∞u file JSON
    with open(filepath, "w", encoding="utf-8") as f:
        json.dump(output_data, f, ensure_ascii=False, indent=2)
    
    print(f"\nüíæ ƒê√£ l∆∞u k·∫øt qu·∫£ v√†o: {filepath}")
    print(f"   T·ªïng s·ªë posts: {len(posts)}")
    
    # L·∫•y ch·ªâ post IDs
    post_ids = get_post_ids_from_page(page_id, profile_id, start_date, end_date)
    print(f"\nüìã Post IDs: {len(post_ids)}")
    if post_ids:
        print(f"   V√≠ d·ª•: {post_ids[:5]}")


--- END FILE: backend\worker\get_post_from_page.py ---

--- START FILE: backend\worker\single_get_comment.py ---
import requests
from requests.adapters import HTTPAdapter
from urllib3.util.retry import Retry
import json
import base64
from urllib.parse import urlencode
from datetime import datetime, timezone, timedelta

# Import control state ƒë·ªÉ check stop/pause
try:
    from backend.core.control import check_flags, wait_if_paused
except ImportError:
    try:
        from core.control import check_flags, wait_if_paused
    except ImportError:
        # Fallback: n·∫øu kh√¥ng import ƒë∆∞·ª£c th√¨ d√πng dummy functions
        def check_flags(profile_id=None):
            return False, False, ""
        def wait_if_paused(profile_id=None, sleep_seconds=0.5):
            pass

# ====== L∆ØU √ù ======
# Cookies v√† payload ƒë∆∞·ª£c l·∫•y t·ª´ cookies.json v√† payload.txt th√¥ng qua profile_id
# cookies.json c√≥ c·∫•u tr√∫c: {"profile_id": {"cookie": "...", "access_token": "..."}}
# S·ª≠ d·ª•ng get_payload.get_payload_by_profile_id(profile_id) ƒë·ªÉ l·∫•y payload
# S·ª≠ d·ª•ng get_payload.get_cookies_by_profile_id(profile_id) ƒë·ªÉ l·∫•y cookie

# ====== T·∫†O FEEDBACK ID T·ª™ POST_ID ======
def create_feedback_id(post_id):
    """Chuy·ªÉn ƒë·ªïi post_id th√†nh feedback ID b·∫±ng base64"""
    s = f"feedback:{post_id}"
    feedback_id = base64.b64encode(s.encode()).decode()
    return feedback_id


# ====== CHUY·ªÇN ƒê·ªîI TIMESTAMP SANG GI·ªú VI·ªÜT NAM (UTC+7) ======
def convert_timestamp_to_vietnam_time(timestamp):
    """
    Chuy·ªÉn ƒë·ªïi Unix timestamp sang gi·ªù Vi·ªát Nam (UTC+7)
    
    Args:
        timestamp (int): Unix timestamp (s·ªë gi√¢y t·ª´ epoch)
        
    Returns:
        str: Th·ªùi gian ƒë·ªãnh d·∫°ng "YYYY-MM-DD HH:MM:SS" (gi·ªù Vi·ªát Nam) ho·∫∑c None n·∫øu timestamp kh√¥ng h·ª£p l·ªá
    """
    if timestamp is None:
        return None
    
    try:
        # T·∫°o datetime t·ª´ timestamp (UTC)
        dt_utc = datetime.fromtimestamp(timestamp, tz=timezone.utc)
        
        # Chuy·ªÉn sang gi·ªù Vi·ªát Nam (UTC+7)
        vietnam_tz = timezone(timedelta(hours=7))
        dt_vietnam = dt_utc.astimezone(vietnam_tz)
        
        # Format th√†nh string
        return dt_vietnam.strftime("%Y-%m-%d %H:%M:%S")
    except (ValueError, OSError, TypeError) as e:
        print(f"‚ö†Ô∏è L·ªói khi chuy·ªÉn ƒë·ªïi timestamp {timestamp}: {e}")
        return None


# ====== EXTRACT USERS T·ª™ JSON ======
def extract_users_from_json(data, users_list, seen_ids):
    """
    ƒê·ªá quy ƒë·ªÉ t√¨m t·∫•t c·∫£ c√°c user objects trong JSON structure v√† l·∫•y text c·ªßa comment
    
    Args:
        data: JSON data (dict, list, ho·∫∑c primitive)
        users_list: List ƒë·ªÉ l∆∞u c√°c user ƒë√£ t√¨m th·∫•y
        seen_ids: Set ƒë·ªÉ track c√°c id ƒë√£ th·∫•y, tr√°nh tr√πng l·∫∑p
    """
    if isinstance(data, dict):
        # N·∫øu c√≥ key "user" v√† value l√† dict c√≥ "id" v√† "name"
        if "user" in data and isinstance(data["user"], dict):
            user = data["user"]
            user_id = user.get("id")
            user_name = user.get("name")
            
            # L·∫•y text t·ª´ body n·∫øu c√≥
            comment_text = None
            if "body" in data and isinstance(data["body"], dict):
                comment_text = data["body"].get("text")
            
            # L·∫•y created_time n·∫øu c√≥
            created_time = data.get("created_time")
            created_time_vn = None
            if created_time:
                created_time_vn = convert_timestamp_to_vietnam_time(created_time)
            
            if user_id and user_name:
                # T·∫°o key duy nh·∫•t t·ª´ user_id v√† text (ƒë·ªÉ tr√°nh tr√πng comment)
                unique_key = f"{user_id}_{comment_text}" if comment_text else user_id
                
                # Ch·ªâ th√™m n·∫øu ch∆∞a c√≥ trong seen_ids
                if unique_key not in seen_ids:
                    seen_ids.add(unique_key)
                    user_data = {
                        "id": user_id,
                        "name": user_name,
                        "text": comment_text if comment_text else ""
                    }
                    # Th√™m created_time_vn n·∫øu c√≥ (ch·ªâ l∆∞u gi·ªù Vi·ªát Nam)
                    if created_time_vn:
                        user_data["created_time_vn"] = created_time_vn
                    
                    users_list.append(user_data)
        
        # ƒê·ªá quy v√†o t·∫•t c·∫£ c√°c values
        for value in data.values():
            extract_users_from_json(value, users_list, seen_ids)
    
    elif isinstance(data, list):
        # ƒê·ªá quy v√†o t·∫•t c·∫£ c√°c items trong list
        for item in data:
            extract_users_from_json(item, users_list, seen_ids)


# ================================
#   G·ª¨I REQUEST GRAPHQL V·ªöI CURSOR
# ================================
def send_request(post_id, payload_dict, profile_id, cookies, commentsAfterCursor=None):
    """G·ª≠i request GraphQL ƒë·ªÉ l·∫•y comments v·ªõi post_id v√† commentsAfterCursor (n·∫øu c√≥)"""
    
    # T·∫°o feedback ID t·ª´ post_id
    feedback_id = create_feedback_id(post_id)
    
    # Variables cho comments API
    variables = {
        "commentsAfterCount": -1,
        "commentsAfterCursor": commentsAfterCursor if commentsAfterCursor else None,
        "commentsBeforeCount": None,
        "commentsBeforeCursor": None,
        "commentsIntentToken": "RANKED_UNFILTERED_CHRONOLOGICAL_REPLIES_INTENT_V1",
        "feedLocation": "POST_PERMALINK_DIALOG",
        "focusCommentID": None,
        "scale": 1,
        "useDefaultActor": False,
        "id": feedback_id,
        "__relay_internal__pv__CometUFICommentAvatarStickerAnimatedImagerelayprovider": False,
        "__relay_internal__pv__IsWorkUserrelayprovider": False
    }
    
    # Th√™m commentsAfterCursor n·∫øu c√≥
    if commentsAfterCursor:
        print(f"   üîÑ S·ª≠ d·ª•ng commentsAfterCursor: {commentsAfterCursor[:50]}...")
    else:
        print(f"   üîÑ Kh√¥ng c√≥ commentsAfterCursor (trang ƒë·∫ßu ti√™n)")
    
    # Debug: In ra variables ƒë·ªÉ ki·ªÉm tra
    print(f"   üìã Variables: {json.dumps(variables, ensure_ascii=False)}")
    
    # S·ª≠ d·ª•ng payload ƒë∆∞·ª£c truy·ªÅn v√†o v√† th√™m variables, doc_id, fb_api_req_friendly_name, __crn
    payload_dict = payload_dict.copy()
    payload_dict["variables"] = json.dumps(variables, ensure_ascii=False)
    payload_dict["doc_id"] = "25515916584706508"
    payload_dict["fb_api_req_friendly_name"] = "CommentListComponentsRootQuery"
    payload_dict["__crn"] = "comet.fbweb.CometSinglePostDialogRoute"  # Route ri√™ng cho comments

    # Chuy·ªÉn dictionary th√†nh form-urlencoded string
    payload = urlencode(payload_dict)
    
    # Debug: In ra payload ƒë·ªÉ ki·ªÉm tra (ch·ªâ 500 k√Ω t·ª± ƒë·∫ßu)
    print(f"   üîç Payload preview: {payload[:500]}...")

    # T·∫°o headers v·ªõi cookies
    headers = {
        "accept": "*/*",
        "accept-encoding": "gzip, deflate",
        "accept-language": "en,vi;q=0.9,en-US;q=0.8",
        "content-type": "application/x-www-form-urlencoded",
        "cookie": cookies,
        "origin": "https://www.facebook.com",
        "priority": "u=1, i",
        "referer": "https://www.facebook.com/photo/?fbid=965661036626847&set=a.777896542069965",
        "sec-ch-ua": '"Google Chrome";v="143", "Chromium";v="143", "Not A(Brand";v="24"',
        "sec-ch-ua-mobile": "?0",
        "sec-ch-ua-platform": '"Windows"',
        "sec-fetch-dest": "empty",
        "sec-fetch-mode": "cors",
        "sec-fetch-site": "same-origin",
        "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36",
        "x-asbd-id": "359341",
        "x-fb-friendly-name": "CommentListComponentsRootQuery",
        "x-fb-lsd": payload_dict.get("lsd", "")
    }

    url = "https://www.facebook.com/api/graphql/"
    
    # Session v·ªõi retry ƒë·ªÉ h·∫°n ch·∫ø timeout/connection reset
    session = requests.Session()
    retry_cfg = Retry(
        total=2,
        backoff_factor=0.5,
        status_forcelist=[429, 500, 502, 503, 504],
        allowed_methods=["POST"],
    )
    adapter = HTTPAdapter(max_retries=retry_cfg)
    session.mount("https://", adapter)
    session.mount("http://", adapter)

    # G·ª≠i payload d∆∞·ªõi d·∫°ng form-urlencoded v·ªõi headers
    response = session.post(url, data=payload, headers=headers, timeout=20)
    
    return response


# ================================
#   H√ÄM HO√ÄN CH·ªàNH: L·∫§Y T·∫§T C·∫¢ COMMENTS T·ª™ POST_ID
# ================================
def get_all_comments_by_post_id(post_id, payload_dict, profile_id, cookies):
    """
    H√†m ho√†n ch·ªânh ƒë·ªÉ l·∫•y t·∫•t c·∫£ comments t·ª´ post_id
    
    Args:
        post_id (str): Facebook ID c·ªßa post
        payload_dict (dict): Dictionary ch·ª©a payload parameters
        profile_id (str): Profile ID
        cookies (str): Cookie string ƒë·ªÉ s·ª≠ d·ª•ng trong request
        
    Returns:
        list: Danh s√°ch comments v·ªõi format [{"id": "...", "text": "...", "author": {...}}, ...]
    """
    # T·∫°o feedback ID t·ª´ post_id
    feedback_id = create_feedback_id(post_id)
    
    print("\n" + "="*50)
    print(f"üöÄ B·∫Øt ƒë·∫ßu l·∫•y comments t·ª´ Post ID: {post_id}")
    print(f"üîó Feedback ID: {feedback_id}")
    print("="*50)
    
    all_responses = []  # L∆∞u t·∫•t c·∫£ response JSON
    all_users = []  # L∆∞u t·∫•t c·∫£ users t·ª´ comments
    seen_user_ids = set()  # Set ƒë·ªÉ track c√°c user id ƒë√£ th·∫•y
    cursors_info = {}  # L∆∞u th√¥ng tin cursors
    commentsAfterCursor = None  # Cursor ƒë·ªÉ pagination
    page_number = 1
    
    while True:
        # Check stop/pause tr∆∞·ªõc m·ªói request
        try:
            stop, paused, reason = check_flags(profile_id)
            if stop:
                print(f"üõë D·ª´ng l·∫•y comments do stop: {reason}")
                raise RuntimeError(f"EMERGENCY_STOP ({reason})")
            if paused:
                print(f"‚è∏Ô∏è ƒêang t·∫°m d·ª´ng ({reason}), ch·ªù ti·∫øp t·ª•c...")
                wait_if_paused(profile_id, sleep_seconds=0.5)
                continue  # Ti·∫øp t·ª•c check sau khi resume
        except RuntimeError:
            raise  # Re-raise RuntimeError ƒë·ªÉ caller c√≥ th·ªÉ catch
        except Exception as e:
            print(f"‚ö†Ô∏è L·ªói khi check stop/pause: {e}")
            # Ti·∫øp t·ª•c n·∫øu c√≥ l·ªói check
        
        print(f"\nüìÑ Trang {page_number} - ƒêang g·ª≠i request...")
        if commentsAfterCursor:
            print(f"   CommentsAfterCursor: {commentsAfterCursor[:50]}...")
        
        # G·ª≠i request v·ªõi post_id, payload, profile_id, cookies v√† commentsAfterCursor
        response = send_request(post_id, payload_dict, profile_id, cookies, commentsAfterCursor)
        
        print(f"   STATUS: {response.status_code}")
        
        if response.status_code != 200:
            print(f"‚ùå L·ªói: Status code {response.status_code}")
            print(f"   üìã Response text (500 k√Ω t·ª± ƒë·∫ßu):")
            print(f"   {response.text[:500]}")
            
            # Th·ª≠ parse JSON ƒë·ªÉ xem c√≥ error message kh√¥ng
            try:
                error_json = response.json()
                if "errors" in error_json:
                    print(f"   ‚ùå Errors t·ª´ response: {json.dumps(error_json.get('errors'), indent=2, ensure_ascii=False)}")
                else:
                    print(f"   üìã Response JSON: {json.dumps(error_json, indent=2, ensure_ascii=False)[:1000]}")
            except:
                pass
            
            # L∆∞u response ƒë·ªÉ debug
            with open("error_response_comment.txt", "w", encoding="utf-8") as f:
                f.write(f"Status Code: {response.status_code}\n")
                f.write(f"Headers: {dict(response.headers)}\n")
                f.write(f"\nResponse Text:\n{response.text}")
            print(f"   üíæ ƒê√£ l∆∞u response v√†o error_response_comment.txt")
            break
        
        # Parse response th√†nh JSON
        try:
            response_json = response.json()
            
            # L∆∞u response v√†o list ƒë·ªÉ l∆∞u t·∫•t c·∫£ v√†o m·ªôt file sau
            all_responses.append(response_json)
            
            # Extract users t·ª´ response JSON
            extract_users_from_json(response_json, all_users, seen_user_ids)
            
            # Debug: Ki·ªÉm tra c·∫•u tr√∫c response
            if "data" not in response_json:
                print(f"   ‚ö†Ô∏è Response kh√¥ng c√≥ 'data': {list(response_json.keys())}")
            if "errors" in response_json:
                print(f"   ‚ùå Response c√≥ errors: {response_json.get('errors')}")
            
            # Tr√≠ch xu·∫•t page_info t·ª´ response
            try:
                # C·∫•u tr√∫c response: data.node.comment_rendering_instance_for_feed_location.comments
                node = response_json.get("data", {}).get("node", {})
                comment_rendering = node.get("comment_rendering_instance_for_feed_location", {})
                comments = comment_rendering.get("comments", {})
                edges = comments.get("edges", [])
                page_info = comments.get("page_info", {})
                end_cursor = page_info.get("end_cursor")
                start_cursor = page_info.get("start_cursor")
                has_next_page = page_info.get("has_next_page", False)
                
                print(f"   üîç Debug: S·ªë edges trong response: {len(edges)}")
                print(f"   üîó End cursor: {end_cursor if end_cursor else 'None'}")
                print(f"   üîó Start cursor: {start_cursor if start_cursor else 'None'}")
                print(f"   üìÑ Has next page: {has_next_page}")
                
                # L∆∞u cursors v√†o dict (l∆∞u c·ªßa trang cu·ªëi c√πng)
                cursors_info = {
                    "end_cursor": end_cursor,
                    "start_cursor": start_cursor,
                    "has_next_page": has_next_page,
                    "edges_count": len(edges),
                    "page_number": page_number
                }
                
                if len(edges) == 0:
                    print(f"   ‚ö†Ô∏è Kh√¥ng c√≥ edges trong response!")
                    print(f"   üîç Debug: Comments keys: {list(comments.keys()) if comments else 'None'}")
                
                # Ki·ªÉm tra c√≥ trang ti·∫øp theo kh√¥ng
                if not has_next_page:
                    print(f"\n‚úÖ ƒê√£ l·∫•y h·∫øt t·∫•t c·∫£ comments! (has_next_page = False)")
                    break
                
                if not end_cursor:
                    print(f"\n‚ö†Ô∏è Kh√¥ng c√≥ end_cursor ƒë·ªÉ ti·∫øp t·ª•c, d·ª´ng l·∫°i")
                    break
                
                # C·∫≠p nh·∫≠t commentsAfterCursor cho l·∫ßn l·∫∑p ti·∫øp theo
                commentsAfterCursor = end_cursor
                page_number += 1
                print(f"   ‚û°Ô∏è CommentsAfterCursor ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t: {commentsAfterCursor[:50]}...")
                
            except Exception as e:
                print(f"‚ö†Ô∏è L·ªói khi tr√≠ch xu·∫•t page_info: {e}")
                import traceback
                traceback.print_exc()
                break
                
        except json.JSONDecodeError as e:
            print(f"‚ùå L·ªói: Response kh√¥ng ph·∫£i JSON h·ª£p l·ªá")
            print(f"   Chi ti·∫øt: {e}")
            # L∆∞u response ƒë·ªÉ debug
            with open("response_debug.txt", "w", encoding="utf-8") as f:
                f.write(response.text)
            print(f"   ƒê√£ l∆∞u response v√†o response_debug.txt")
            break
    
    # Hi·ªÉn th·ªã k·∫øt qu·∫£
    print(f"\n" + "="*50)
    print(f"‚úÖ Ho√†n th√†nh!")
    print(f"üìÑ T·ªïng s·ªë response: {len(all_responses)}")
    
    # Hi·ªÉn th·ªã cursors info
    if cursors_info:
        print(f"   üîó End cursor: {cursors_info.get('end_cursor', 'None')}")
        print(f"   üîó Start cursor: {cursors_info.get('start_cursor', 'None')}")
    
    # Hi·ªÉn th·ªã users ƒë√£ extract
    if all_users:
        print(f"\nüìã Danh s√°ch users (10 ƒë·∫ßu ti√™n):")
        for i, user in enumerate(all_users[:10], 1):
            text_preview = user.get('text', '')[:50] + "..." if len(user.get('text', '')) > 50 else user.get('text', '')
            created_time_vn = user.get('created_time_vn', 'N/A')
            print(f"  {i}. ID: {user['id']}, Name: {user['name']}, Text: {text_preview}, Created: {created_time_vn}")
        if len(all_users) > 10:
            print(f"  ... v√† {len(all_users) - 10} users kh√°c")
    
    print("="*50)
    
    return all_users


# ================================
#   H√ÄM ƒê∆†N GI·∫¢N: L·∫§Y COMMENTS T·ª™ CURSOR
# ================================
def get_comments_by_cursor(post_id, payload_dict, profile_id, cookies, cursor=None):
    """
    H√†m ƒë∆°n gi·∫£n: truy·ªÅn cursor v√†o, tr·∫£ v·ªÅ comments v√† end_cursor
    
    Args:
        post_id (str): Facebook ID c·ªßa post
        payload_dict (dict): Dictionary ch·ª©a payload parameters
        profile_id (str): Profile ID
        cookies (str): Cookie string ƒë·ªÉ s·ª≠ d·ª•ng trong request
        cursor (str, optional): Cursor ƒë·ªÉ l·∫•y trang ti·∫øp theo. None n·∫øu l√† trang ƒë·∫ßu ti√™n
        
    Returns:
        dict: {
            "comments": [{"id": "...", "text": "...", "author": {...}}, ...],
            "end_cursor": "...",
            "has_next_page": bool
        }
    """
    # G·ª≠i request
    response = send_request(post_id, payload_dict, profile_id, cookies, cursor)
    
    if response.status_code != 200:
        print(f"‚ùå L·ªói: Status code {response.status_code}")
        return {"comments": [], "end_cursor": None, "has_next_page": False}
    
    # Parse response
    try:
        response_json = response.json()
        node = response_json.get("data", {}).get("node", {})
        comments = node.get("comments", {})
        edges = comments.get("edges", [])
        page_info = comments.get("page_info", {})
        end_cursor = page_info.get("end_cursor")
        has_next_page = page_info.get("has_next_page", False)
        
        # T√°ch l·∫•y comments
        comments_list = []
        for edge in edges:
            comment_node = edge.get("node", {})
            comment_id = comment_node.get("id")
            comment_text = comment_node.get("text")
            author = comment_node.get("author", {})
            created_time = comment_node.get("created_time")
            
            # Chuy·ªÉn ƒë·ªïi created_time sang gi·ªù Vi·ªát Nam
            created_time_vn = None
            if created_time:
                created_time_vn = convert_timestamp_to_vietnam_time(created_time)
            
            if comment_id:
                comment_data = {
                    "id": comment_id,
                    "text": comment_text,
                    "author": author
                }
                # Th√™m created_time_vn n·∫øu c√≥ (ch·ªâ l∆∞u gi·ªù Vi·ªát Nam)
                if created_time_vn:
                    comment_data["created_time_vn"] = created_time_vn
                
                comments_list.append(comment_data)
                
                # Print created_time
                author_name = author.get("name", "Unknown") if isinstance(author, dict) else "Unknown"
                text_preview = (comment_text[:50] + "...") if comment_text and len(comment_text) > 50 else (comment_text or "")
                print(f"   üí¨ Comment ID: {comment_id}, Author: {author_name}, Created: {created_time_vn or 'N/A'}, Text: {text_preview}")
        
        return {
            "comments": comments_list,
            "end_cursor": end_cursor,
            "has_next_page": has_next_page
        }
        
    except json.JSONDecodeError as e:
        print(f"‚ùå L·ªói: Response kh√¥ng ph·∫£i JSON h·ª£p l·ªá: {e}")
        return {"comments": [], "end_cursor": None, "has_next_page": False}
    except Exception as e:
        print(f"‚ùå L·ªói khi parse response: {e}")
        return {"comments": [], "end_cursor": None, "has_next_page": False}


if __name__ == "__main__":
    # V√≠ d·ª• s·ª≠ d·ª•ng h√†m ho√†n ch·ªânh v·ªõi v√≤ng l·∫∑p t·ª± ƒë·ªông
    from get_payload import get_payload_by_profile_id, get_cookies_by_profile_id
    
    profile_id = "b77da63d-af55-43c2-ab7f-364250b20e30"
    payload_dict = get_payload_by_profile_id(profile_id)
    cookies = get_cookies_by_profile_id(profile_id)
    
    if payload_dict and cookies:
        post_id = "2672966333102287"  # Thay ƒë·ªïi Post ID ·ªü ƒë√¢y
        comments = get_all_comments_by_post_id(post_id, payload_dict, profile_id, cookies)
        with open("comments.json", "w", encoding="utf-8") as f:
            json.dump(comments, f, ensure_ascii=False, indent=4)


--- END FILE: backend\worker\single_get_comment.py ---

--- START FILE: backend\worker\single_get_reactions.py ---
import requests
from requests.adapters import HTTPAdapter
from urllib3.util.retry import Retry
import json
import base64
from urllib.parse import urlencode
import os
from datetime import datetime
from pathlib import Path

# Import control state ƒë·ªÉ check stop/pause
try:
    from backend.core.control import check_flags, wait_if_paused
except ImportError:
    try:
        from core.control import check_flags, wait_if_paused
    except ImportError:
        # Fallback: n·∫øu kh√¥ng import ƒë∆∞·ª£c th√¨ d√πng dummy functions
        def check_flags(profile_id=None):
            return False, False, ""
        def wait_if_paused(profile_id=None, sleep_seconds=0.5):
            pass

# ====== L∆ØU √ù ======
# Cookies v√† payload ƒë∆∞·ª£c l·∫•y t·ª´ cookies.json v√† payload.txt th√¥ng qua profile_id
# cookies.json c√≥ c·∫•u tr√∫c: {"profile_id": {"cookie": "...", "access_token": "..."}}
# S·ª≠ d·ª•ng get_payload.get_payload_by_profile_id(profile_id) ƒë·ªÉ l·∫•y payload
# S·ª≠ d·ª•ng get_payload.get_cookies_by_profile_id(profile_id) ƒë·ªÉ l·∫•y cookie

# ====== T·∫†O FEEDBACK TARGET ID T·ª™ FID ======
def create_feedback_target_id(fid):
    """Chuy·ªÉn ƒë·ªïi fid th√†nh feedbackTargetID b·∫±ng base64"""
    s = f"feedback:{fid}"
    feedback_target_id = base64.b64encode(s.encode()).decode()
    return feedback_target_id


# ================================
#   G·ª¨I REQUEST GRAPHQL V·ªöI CURSOR
# ================================
def send_request(feedback_target_id, payload_dict, profile_id, cookies, cursor=None):
    """G·ª≠i request GraphQL v·ªõi feedbackTargetID v√† cursor (n·∫øu c√≥)"""
    
    # Payload d∆∞·ªõi d·∫°ng dictionary (t·ª´ ƒëi·ªÉn)
    variables = {
        "count": 100,
        "feedbackTargetID": feedback_target_id,
        "reactionID": None,
        "scale": 1,
        "id": feedback_target_id
    }
    
    # Th√™m cursor n·∫øu c√≥
    if cursor:
        variables["cursor"] = cursor
        print(f"   üîÑ S·ª≠ d·ª•ng cursor: {cursor[:50]}...")
    else:
        print(f"   üîÑ Kh√¥ng c√≥ cursor (trang ƒë·∫ßu ti√™n)")
    
    # Debug: In ra variables ƒë·ªÉ ki·ªÉm tra
    print(f"   üìã Variables: {json.dumps(variables, ensure_ascii=False)}")
    
    # S·ª≠ d·ª•ng payload ƒë∆∞·ª£c truy·ªÅn v√†o v√† th√™m variables, doc_id, fb_api_req_friendly_name
    payload_dict = payload_dict.copy()
    # If caller provided a forced payload dict under key "__force_payload", use/merge it
    force_payload = payload_dict.pop("__force_payload", None)
    if isinstance(force_payload, dict):
        # merge force_payload into payload_dict (force overrides)
        for k, v in force_payload.items():
            payload_dict[k] = v

    payload_dict["variables"] = json.dumps(variables, ensure_ascii=False)
    payload_dict["doc_id"] = "31470716059194219"
    payload_dict["fb_api_req_friendly_name"] = "CometUFIReactionsDialogTabContentRefetchQuery"

    # Chuy·ªÉn dictionary th√†nh form-urlencoded string
    payload = urlencode(payload_dict)

    # T·∫°o headers v·ªõi cookies
    headers = {
        "accept": "*/*",
        "accept-encoding": "gzip, deflate",
        "accept-language": "en,vi;q=0.9,en-US;q=0.8",
        "content-type": "application/x-www-form-urlencoded",
        "cookie": cookies,
        "origin": "https://www.facebook.com",
        "priority": "u=1, i",
        "referer": "https://www.facebook.com/photo/?fbid=965661036626847&set=a.777896542069965",
        "sec-ch-ua": '"Google Chrome";v="143", "Chromium";v="143", "Not A(Brand";v="24"',
        "sec-ch-ua-mobile": "?0",
        "sec-ch-ua-platform": '"Windows"',
        "sec-fetch-dest": "empty",
        "sec-fetch-mode": "cors",
        "sec-fetch-site": "same-origin",
        "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36",
        "x-asbd-id": "359341",
        "x-fb-friendly-name": "CommentListComponentsRootQuery",
        "x-fb-lsd": payload_dict.get("lsd", "")
    }

    url = "https://www.facebook.com/api/graphql/"
    
    # Chu·∫©n b·ªã session v·ªõi retry ƒë·ªÉ gi·∫£m timeout/connection reset
    session = requests.Session()
    retry_cfg = Retry(
        total=2,
        backoff_factor=0.5,
        status_forcelist=[429, 500, 502, 503, 504],
        allowed_methods=["POST"],
    )
    adapter = HTTPAdapter(max_retries=retry_cfg)
    session.mount("https://", adapter)
    session.mount("http://", adapter)

    # G·ª≠i payload d∆∞·ªõi d·∫°ng form-urlencoded v·ªõi headers
    response = session.post(url, data=payload, headers=headers, timeout=20)
    
    return response


# ================================
#   H√ÄM HO√ÄN CH·ªàNH: L·∫§Y T·∫§T C·∫¢ USERS T·ª™ FID
# ================================
def get_all_users_by_fid(fid, payload_dict, profile_id, cookies):
    """
    H√†m ho√†n ch·ªânh ƒë·ªÉ l·∫•y t·∫•t c·∫£ users (id v√† name) t·ª´ FID
    
    Args:
        fid (str): Facebook ID c·ªßa post/photo
        payload_dict (dict): Dictionary ch·ª©a payload parameters
        profile_id (str): Profile ID
        cookies (str): Cookie string ƒë·ªÉ s·ª≠ d·ª•ng trong request
        
    Returns:
        list: Danh s√°ch users v·ªõi format [{"id": "...", "name": "..."}, ...]
    """
    # T·∫°o feedbackTargetID t·ª´ FID
    feedback_target_id = create_feedback_target_id(fid)
    
    print("\n" + "="*50)
    print(f"üöÄ B·∫Øt ƒë·∫ßu l·∫•y users t·ª´ FID: {fid}")
    print(f"üîó FeedbackTargetID: {feedback_target_id}")
    print("="*50)
    
    all_users = []
    seen_ids = set()  # Set ƒë·ªÉ track c√°c id ƒë√£ th·∫•y, tr√°nh tr√πng l·∫∑p
    cursor = None
    page_number = 1
    duplicate_count = 0  # ƒê·∫øm s·ªë user tr√πng ƒë√£ b·ªè qua
    
    while True:
        # Check stop/pause tr∆∞·ªõc m·ªói request
        try:
            stop, paused, reason = check_flags(profile_id)
            if stop:
                print(f"üõë D·ª´ng l·∫•y reactions do stop: {reason}")
                raise RuntimeError(f"EMERGENCY_STOP ({reason})")
            if paused:
                print(f"‚è∏Ô∏è ƒêang t·∫°m d·ª´ng ({reason}), ch·ªù ti·∫øp t·ª•c...")
                wait_if_paused(profile_id, sleep_seconds=0.5)
                continue  # Ti·∫øp t·ª•c check sau khi resume
        except RuntimeError:
            raise  # Re-raise RuntimeError ƒë·ªÉ caller c√≥ th·ªÉ catch
        except Exception as e:
            print(f"‚ö†Ô∏è L·ªói khi check stop/pause: {e}")
            # Ti·∫øp t·ª•c n·∫øu c√≥ l·ªói check
        
        print(f"\nüìÑ Trang {page_number} - ƒêang g·ª≠i request...")
        if cursor:
            print(f"   Cursor: {cursor[:50]}...")
        
        # G·ª≠i request v·ªõi feedbackTargetID, payload, profile_id, cookies v√† cursor
        response = send_request(feedback_target_id, payload_dict, profile_id, cookies, cursor)
        
        print(f"   STATUS: {response.status_code}")

        # Decode response text for inspection (no file saving)
        saved_text = ""
        content_encoding = (response.headers.get("content-encoding") or "").lower()
        if "br" in content_encoding:
            try:
                import brotli
                saved_text = brotli.decompress(response.content).decode("utf-8", errors="replace")
            except Exception as e:
                print(f"   ‚ö†Ô∏è Brotli decompress failed: {e}")
                try:
                    saved_text = (response.content or b"").decode("utf-8", errors="replace")
                except Exception:
                    saved_text = ""
        else:
            # rely on requests to handle gzip/deflate; fall back to manual decode
            try:
                saved_text = response.text or ""
            except Exception:
                try:
                    saved_text = (response.content or b"").decode("utf-8", errors="replace")
                except Exception:
                    saved_text = ""

        if response.status_code != 200:
            print(f"‚ùå L·ªói: Status code {response.status_code}")
            break
        
        # Parse response th√†nh JSON
        try:
            response_json = response.json()
            
            # Debug: Ki·ªÉm tra c·∫•u tr√∫c response
            if "data" not in response_json:
                print(f"   ‚ö†Ô∏è Response kh√¥ng c√≥ 'data': {list(response_json.keys())}")
            if "errors" in response_json:
                print(f"   ‚ùå Response c√≥ errors: {response_json.get('errors')}")
            
            # Tr√≠ch xu·∫•t id v√† name t·ª´ m·ªói node
            try:
                reactors = response_json.get("data", {}).get("node", {}).get("reactors", {})
                edges = reactors.get("edges", [])
                page_info = reactors.get("page_info", {})
                end_cursor = page_info.get("end_cursor")
                has_next_page = page_info.get("has_next_page", False)
                
                print(f"   üîç Debug: S·ªë edges trong response: {len(edges)}")
                if len(edges) == 0:
                    print(f"   ‚ö†Ô∏è Kh√¥ng c√≥ edges trong response!")
                    print(f"   üîç Debug: Reactors keys: {list(reactors.keys()) if reactors else 'None'}")
                    print(f"   üîç Debug: Data structure: {json.dumps(response_json.get('data', {}), indent=2, ensure_ascii=False)[:500]}")
                elif len(edges) > 0:
                    # Debug: In ra node ƒë·∫ßu ti√™n ƒë·ªÉ ki·ªÉm tra
                    first_node = edges[0].get("node", {})
                    first_id = first_node.get("id")
                    first_name = first_node.get("name")
                    print(f"   üîç Debug node ƒë·∫ßu ti√™n: id={first_id}, name={first_name}, ƒë√£ c√≥ trong seen_ids: {first_id in seen_ids if first_id else 'N/A'}")
                
                page_users = []
                last_cursor = None
                
                for edge in edges:
                    node = edge.get("node", {})
                    node_id = node.get("id")
                    node_name = node.get("name")
                    edge_cursor = edge.get("cursor")  # L·∫•y cursor t·ª´ edge
                    
                    # Debug: In ra node ƒë·∫ßu ti√™n ƒë·ªÉ ki·ªÉm tra
                    if len(page_users) == 0 and len(edges) > 0:
                        print(f"   üîç Debug node ƒë·∫ßu ti√™n: id={node_id}, name={node_name}, node_keys={list(node.keys())}")
                    
                    if node_id and node_name:
                        # Ki·ªÉm tra xem id ƒë√£ t·ªìn t·∫°i ch∆∞a
                        if node_id not in seen_ids:
                            seen_ids.add(node_id)
                            page_users.append({
                                "id": node_id,
                                "name": node_name
                            })
                        else:
                            duplicate_count += 1
                    elif not node_id:
                        print(f"   ‚ö†Ô∏è Node kh√¥ng c√≥ id: {node}")
                    elif not node_name:
                        print(f"   ‚ö†Ô∏è Node kh√¥ng c√≥ name: id={node_id}")
                    
                    # L∆∞u cursor c·ªßa edge cu·ªëi c√πng
                    if edge_cursor:
                        last_cursor = edge_cursor
                
                all_users.extend(page_users)
                
                # S·ª≠ d·ª•ng end_cursor t·ª´ page_info (theo y√™u c·∫ßu)
                next_cursor = end_cursor
                
                print(f"   ‚úÖ L·∫•y ƒë∆∞·ª£c {len(page_users)} users m·ªõi (T·ªïng: {len(all_users)}, Tr√πng: {duplicate_count})")
                print(f"   üîó End cursor (page_info): {end_cursor[:50] if end_cursor else 'None'}...")
                print(f"   üîó Last cursor (edge): {last_cursor[:50] if last_cursor else 'None'}...")
                print(f"   üîó Next cursor s·∫Ω d√πng: {next_cursor[:50] if next_cursor else 'None'}...")
                print(f"   üìÑ Has next page: {has_next_page}")
                
                # Ki·ªÉm tra c√≥ trang ti·∫øp theo kh√¥ng
                if not has_next_page:
                    print(f"\n‚úÖ ƒê√£ l·∫•y h·∫øt t·∫•t c·∫£ users! (has_next_page = False)")
                    break
                
                if not next_cursor:
                    print(f"\n‚ö†Ô∏è Kh√¥ng c√≥ cursor ƒë·ªÉ ti·∫øp t·ª•c, d·ª´ng l·∫°i")
                    break
                
                # C·∫≠p nh·∫≠t cursor cho l·∫ßn l·∫∑p ti·∫øp theo
                cursor = next_cursor
                page_number += 1
                print(f"   ‚û°Ô∏è Cursor ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t: {cursor[:50]}...")
                
            except Exception as e:
                print(f"‚ö†Ô∏è L·ªói khi tr√≠ch xu·∫•t nodes: {e}")
                break
                
        except json.JSONDecodeError as e:
            print(f"‚ùå L·ªói: Response kh√¥ng ph·∫£i JSON h·ª£p l·ªá")
            print(f"   Chi ti·∫øt: {e}")
            # Attempt to extract dynamic payload values (fb_dtsg, lsd, __spin_r, __spin_t)
            try:
                from get_payload import ensure_payload_from_bad_response, get_payload_by_profile_id, update_payload_file
                print("‚ÑπÔ∏è Th·ª±c hi·ªán headless capture ƒë·ªÉ l·∫•y c√°c gi√° tr·ªã ƒë·ªông v√† c·∫≠p nh·∫≠t settings.json/payload.txt...")
                payload_values = ensure_payload_from_bad_response(profile_id, cookies, response_text=saved_text, timeout=8)
                if not payload_values:
                    print("‚ùå Headless capture kh√¥ng tr·∫£ v·ªÅ gi√° tr·ªã n√†o, d·ª´ng.")
                    break

                # Update payload.txt with discovered dynamic values
                try:
                    updated = update_payload_file(payload_values)
                    if updated:
                        print("‚úÖ ƒê√£ c·∫≠p nh·∫≠t backend/config/payload.txt t·ª´ headless capture")
                    else:
                        print("‚ö†Ô∏è Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t backend/config/payload.txt t·ª´ headless capture")
                except Exception as e_up:
                    print(f"‚ö†Ô∏è L·ªói khi c·∫≠p nh·∫≠t payload.txt: {e_up}")

                # Rebuild payload_dict from updated payload.txt / settings.json and retry once
                payload_dict = get_payload_by_profile_id(profile_id)
                if payload_dict:
                    print("‚ÑπÔ∏è Th·ª≠ g·ª≠i l·∫°i request sau khi c·∫≠p nh·∫≠t payload...")
                    response = send_request(feedback_target_id, payload_dict, profile_id, cookies, cursor)
                    try:
                        response_json = response.json()
                        print("‚úÖ Retry th√†nh c√¥ng, response JSON h·ª£p l·ªá.")
                        # continue processing with new response_json
                    except Exception as e2:
                        print(f"‚ùå Retry v·∫´n kh√¥ng tr·∫£ v·ªÅ JSON h·ª£p l·ªá: {e2}")
                        break
                else:
                    print("‚ùå Kh√¥ng th·ªÉ t·∫°o payload m·ªõi t·ª´ payload.txt/settings.json, d·ª´ng.")
                    break
            except Exception as ee:
                print(f"‚ö†Ô∏è L·ªói khi c·ªë g·∫Øng fix b·∫±ng headless: {ee}")
                break
    
    # Hi·ªÉn th·ªã k·∫øt qu·∫£
    print(f"\n" + "="*50)
    print(f"‚úÖ Ho√†n th√†nh!")
    print(f"üìä T·ªïng s·ªë users (sau khi l·ªçc tr√πng): {len(all_users)}")
    print(f"üîÑ S·ªë user tr√πng ƒë√£ b·ªè qua: {duplicate_count}")
    print(f"üìÑ T·ªïng s·ªë trang: {page_number}")
    print(f"\nüìã Danh s√°ch users (10 ƒë·∫ßu ti√™n):")
    for i, user in enumerate(all_users[:10], 1):
        print(f"  {i}. ID: {user['id']}, Name: {user['name']}")
    if len(all_users) > 10:
        print(f"  ... v√† {len(all_users) - 10} users kh√°c")
    
    # L∆∞u v√†o file
    if all_users:
        extracted_data = {
            "users": all_users,
            "total_users": len(all_users),
            "duplicate_users_skipped": duplicate_count,
            "total_pages": page_number,
            "fid": fid,
            "feedback_target_id": feedback_target_id
        }
        
        print(f"\n‚úÖ ƒê√£ l·∫•y {len(all_users)} users")
    else:
        print("\n‚ö†Ô∏è Kh√¥ng c√≥ users")
    
    print("="*50)
    
    return all_users


# ================================
#   H√ÄM ƒê∆†N GI·∫¢N: L·∫§Y USERS T·ª™ CURSOR
# ================================
def get_users_by_cursor(fid, payload_dict, profile_id, cookies, cursor=None):
    """
    H√†m ƒë∆°n gi·∫£n: truy·ªÅn cursor v√†o, tr·∫£ v·ªÅ users (id, name) v√† end_cursor
    
    Args:
        fid (str): Facebook ID c·ªßa post/photo
        payload_dict (dict): Dictionary ch·ª©a payload parameters
        profile_id (str): Profile ID
        cookies (str): Cookie string ƒë·ªÉ s·ª≠ d·ª•ng trong request
        cursor (str, optional): Cursor ƒë·ªÉ l·∫•y trang ti·∫øp theo. None n·∫øu l√† trang ƒë·∫ßu ti√™n
        
    Returns:
        dict: {
            "users": [{"id": "...", "name": "..."}, ...],
            "end_cursor": "...",
            "has_next_page": bool
        }
    """
    # T·∫°o feedbackTargetID t·ª´ FID
    feedback_target_id = create_feedback_target_id(fid)
    
    # G·ª≠i request
    response = send_request(feedback_target_id, payload_dict, profile_id, cookies, cursor)
    
    if response.status_code != 200:
        print(f"‚ùå L·ªói: Status code {response.status_code}")
        return {"users": [], "end_cursor": None, "has_next_page": False}
    
    # Parse response
    try:
        response_json = response.json()
        reactors = response_json.get("data", {}).get("node", {}).get("reactors", {})
        edges = reactors.get("edges", [])
        page_info = reactors.get("page_info", {})
        end_cursor = page_info.get("end_cursor")
        has_next_page = page_info.get("has_next_page", False)
        
        # T√°ch l·∫•y users (id v√† name)
        users = []
        for edge in edges:
            node = edge.get("node", {})
            node_id = node.get("id")
            node_name = node.get("name")
            
            if node_id and node_name:
                users.append({
                    "id": node_id,
                    "name": node_name
                })
        
        return {
            "users": users,
            "end_cursor": end_cursor,
            "has_next_page": has_next_page
        }
        
    except json.JSONDecodeError as e:
        print(f"‚ùå L·ªói: Response kh√¥ng ph·∫£i JSON h·ª£p l·ªá: {e}")
        return {"users": [], "end_cursor": None, "has_next_page": False}
    except Exception as e:
        print(f"‚ùå L·ªói khi parse response: {e}")
        return {"users": [], "end_cursor": None, "has_next_page": False}


# ================================
#   H√ÄM G·ªåI C≈® (gi·ªØ l·∫°i ƒë·ªÉ t∆∞∆°ng th√≠ch)
# ================================
def call_graphql(fid=None, profile_id=None):
    """H√†m wrapper ƒë·ªÉ g·ªçi get_all_users_by_fid"""
    if fid is None:
        fid = "965661076626843"  # FID m·∫∑c ƒë·ªãnh
    
    if profile_id is None:
        profile_id = "031ca13d-e8fa-400c-a603-df57a2806788"  # Profile ID m·∫∑c ƒë·ªãnh
    
    from get_payload import get_payload_by_profile_id, get_cookies_by_profile_id
    
    payload_dict = get_payload_by_profile_id(profile_id)
    cookies = get_cookies_by_profile_id(profile_id)
    
    if payload_dict and cookies:
        all_users = get_all_users_by_fid(fid, payload_dict, profile_id, cookies)
    else:
        print("‚ùå Kh√¥ng th·ªÉ t·∫°o payload dictionary ho·∫∑c l·∫•y cookies")
        all_users = []
    
    # Hi·ªÉn th·ªã k·∫øt qu·∫£
    if all_users:
        print(f"\n‚úÖ ƒê√£ l·∫•y {len(all_users)} users")
    else:
        print("\n‚ö†Ô∏è Kh√¥ng l·∫•y ƒë∆∞·ª£c users n√†o")


if __name__ == "__main__":
    # V√≠ d·ª• s·ª≠ d·ª•ng h√†m ho√†n ch·ªânh v·ªõi v√≤ng l·∫∑p t·ª± ƒë·ªông
    from get_payload import get_payload_by_profile_id, get_cookies_by_profile_id
    
    profile_id = "b77da63d-af55-43c2-ab7f-364250b20e30"
    payload_dict = get_payload_by_profile_id(profile_id)
    cookies = get_cookies_by_profile_id(profile_id)
    
    if payload_dict and cookies:
        fid = "2672966333102287"  # Thay ƒë·ªïi FID ·ªü ƒë√¢y
        users = get_all_users_by_fid(fid, payload_dict, profile_id, cookies)
    
--- END FILE: backend\worker\single_get_reactions.py ---

--- START FILE: frontend\data.json ---
[
  { "id": 1, "type": "type1", "time": "08:30:15" },
  { "id": 2, "type": "type1", "time": "08:30:20" },
  { "id": 3, "type": "type2", "time": "08:30:25" },
  { "id": 4, "type": "type3", "time": "08:30:25" }
]


--- END FILE: frontend\data.json ---

--- START FILE: frontend\index.html ---
<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>H·ªá th·ªëng Qu√©t Facebook</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
  <!-- Splash Screen -->
  <div id="splashScreen" class="splash-screen">
    <div class="splash-content">
      <h1 class="splash-title">H·ªÜ TH·ªêNG ADS FACEBOOK</h1>
      <p class="splash-subtitle">Gi·∫£i ph√°p t·ª± ƒë·ªông h√≥a ‚Äì qu·∫£n l√Ω & scale qu·∫£ng c√°o</p>
      <button id="splashStartBtn" class="splash-btn">B·∫Øt ƒë·∫ßu</button>
    </div>
  </div>

  <div class="container">
    <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>
    <header class="header">
      <div class="header-content">
        <h1>H·ªÜ TH·ªêNG ADS FACEBOOK</h1>
        <p class="subtitle">Gi·∫£i ph√°p t·ª± ƒë·ªông h√≥a ‚Äì qu·∫£n l√Ω & scale qu·∫£ng c√°o</p>
      </div>
    </header>

    <div class="layout">
      <div class="left-panel">
        <div class="panel-header">
          <h3>‚öôÔ∏è ƒêi·ªÅu khi·ªÉn</h3>
        </div>
        <div class="panel-body">
          <div class="field">
            <button id="startBtn" class="btn-primary">
              <span class="btn-icon">‚ñ∂Ô∏è</span>
              <span>B·∫Øt ƒë·∫ßu qu√©t</span>
            </button>
          </div>
          <div class="field">
            <button id="stopBtn" class="btn-danger stop">
              <span class="btn-icon">‚èπÔ∏è</span>
              <span>D·ª´ng qu√©t</span>
            </button>
          </div>
          <div class="field">
            <label for="interval">
              <span class="label-icon">‚è±Ô∏è</span>
              Th·ªùi gian l·∫∑p l·∫°i (ph√∫t)
            </label>
            <input id="interval" type="number" min="1" value="1" placeholder="Nh·∫≠p s·ªë ph√∫t" />
          </div>
          <div class="field">
            <label for="runMinutes">
              <span class="label-icon">‚è≥</span>
              Th·ªùi gian ch·∫°y m·ªói phi√™n (ph√∫t)
            </label>
            <input id="runMinutes" type="number" min="1" value="30" placeholder="VD: 30" />
          </div>
          <div class="field">
            <label for="postCount">
              <span class="label-icon">üìù</span>
              S·ªê B√ÄI VI·∫æT theo d√µi
            </label>
            <input id="postCount" type="number" min="0" value="0" placeholder="Nh·∫≠p s·ªë b√†i vi·∫øt" />
          </div>

          <div class="field">
            <button id="exportExcelBtn" class="btn-success">
              <span class="btn-icon">üìä</span>
              <span>Xu·∫•t file Excel</span>
            </button>
          </div>

          <div class="status-line">
            <span id="statusDot" class="status-dot"></span>
            <div class="status-text-group">
              <div class="status-label">Tr·∫°ng th√°i backend</div>
              <div id="backendStatus" class="status-text">Ch∆∞a kh·ªüi ƒë·ªông</div>
            </div>
          </div>
        </div>
      </div>

      <div class="right-panel">
        <div class="panel-header">
          <div class="panel-tabs">
            <button id="tabScanList" type="button" class="tab-button active">üìã Danh s√°ch qu√©t</button>
            <button id="tabPostManager" type="button" class="tab-button">üìù Qu·∫£n l√Ω post</button>
            <button id="tabSettings" type="button" class="tab-button">‚öôÔ∏è Setting profile</button>
          </div>
          <span id="rowCount" class="badge">0</span>
        </div>

        <!-- View: Danh s√°ch qu√©t -->
        <div id="scanView">
          <div class="filter-container">
            <div class="filter-group">
              <div class="filter-label">üîç L·ªçc theo m√†u:</div>
              <div class="filter-buttons">
                <button class="filter-btn filter-all active" data-filter="all">
                  <span>T·∫•t c·∫£</span>
                </button>
                <button class="filter-btn filter-green" data-filter="type-green">
                  <span class="filter-dot filter-dot-green"></span>
                  <span>Xanh (type1)</span>
                </button>
                <button class="filter-btn filter-yellow" data-filter="type-yellow">
                  <span class="filter-dot filter-dot-yellow"></span>
                  <span>V√†ng (type2)</span>
                </button>
                <button class="filter-btn filter-red" data-filter="type-red">
                  <span class="filter-dot filter-dot-red"></span>
                  <span>ƒê·ªè (type3)</span>
                </button>
              </div>
            </div>
            <div class="filter-group">
              <div class="filter-label">üìä L·ªçc theo:</div>
              <div class="filter-buttons">
                <button class="filter-btn filter-react" data-filter-react="has">
                  <span>‚úì C√≥ React</span>
                </button>
                <button class="filter-btn filter-react" data-filter-react="none">
                  <span>‚úó Kh√¥ng React</span>
                </button>
                <button class="filter-btn filter-comment" data-filter-comment="has">
                  <span>üí¨ C√≥ Comment</span>
                </button>
                <button class="filter-btn filter-comment" data-filter-comment="none">
                  <span>‚úó Kh√¥ng Comment</span>
                </button>
              </div>
            </div>
            <div class="filter-group">
              <div class="filter-label">‚è∞ L·ªçc theo th·ªùi gian:</div>
              <div class="time-filter-compact">
                <div class="time-filter-inline">
                  <input type="datetime-local" id="timeFilterFrom" class="time-filter-input-compact" placeholder="T·ª´" />
                  <span class="time-filter-separator">‚Üí</span>
                  <input type="datetime-local" id="timeFilterTo" class="time-filter-input-compact" placeholder="ƒê·∫øn" />
                  <button id="applyTimeFilterBtn" class="time-filter-btn-compact time-filter-apply-compact"
                    title="√Åp d·ª•ng">
                    <span>‚úì</span>
                  </button>
                  <button id="clearTimeFilterBtn" class="time-filter-btn-compact time-filter-clear-compact" title="X√≥a">
                    <span>‚úó</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="table-container">
            <table id="listTable">
              <thead>
                <tr>
                  <th>ID B√†i Post</th>
                  <th>ID User</th>
                  <th>Name</th>
                  <th>React</th>
                  <th>Comment</th>
                  <th>Time</th>
                  <th>Type</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div id="emptyState" class="empty">
            <div class="empty-icon">üì≠</div>
            <p>Ch∆∞a c√≥ d·ªØ li·ªáu</p>
            <p class="empty-hint">Nh·∫•n "B·∫Øt ƒë·∫ßu qu√©t" ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
          </div>
        </div>

        <!-- View: Qu·∫£n l√Ω post -->
        <div id="postView" style="display:none;">
          <div class="table-container">
            <table id="postTable">
              <thead>
                <tr>
                  <th>ID Post</th>
                  <th>N·ªôi dung</th>
                  <th>Type</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div id="postEmptyState" class="empty">
            <div class="empty-icon">üì≠</div>
            <p>Ch∆∞a c√≥ d·ªØ li·ªáu post</p>
            <p class="empty-hint">Ki·ªÉm tra l·∫°i file JSON trong th∆∞ m·ª•c post_ids</p>
          </div>
        </div>

        <!-- View: Setting profile -->
        <div id="settingsView" style="display:none;">
          <div class="settings-stack">
            <div class="setting-card">
              <div class="setting-card-header">
                <div>
                  <h4>API Key</h4>

                </div>
              </div>
              <div class="inline-field">
                <input id="settingApiKey" type="text" placeholder="Nh·∫≠p API Key" />
                <button id="saveApiKeyBtn" class="btn-primary" type="button">L∆∞u API Key</button>
              </div>
              <p class="hint">API Key ƒë∆∞·ª£c l∆∞u tr√™n tr√¨nh duy·ªát; ƒë·ªïi th√¨ nh·∫≠p m·ªõi r·ªìi b·∫•m L∆∞u.</p>
            </div>

            <div class="setting-card">
              <div class="setting-card-header">
                <div>
                  <h4>Danh s√°ch profile</h4>
                  <p class="muted">Th√™m profile_id v√† thao t√°c nhanh</p>
                </div>
                <div class="setting-card-actions">
                  <button id="runAllInfoBtn" class="btn-primary" type="button">L·∫•y th√¥ng tin to√†n b·ªô</button>
                  <button id="runSelectedInfoBtn" class="btn-secondary" type="button">L·∫•y th√¥ng tin profile ƒë√£ ch·ªçn</button>
                  <button id="scanPostsSettingBtn" class="btn-success" type="button">Qu√©t b√†i vi·∫øt</button>
                  <button id="scanGroupSettingBtn" class="btn-yellow" type="button">Qu√©t theo group</button>
                  <button id="autoJoinGroupBtn" class="btn-primary" type="button">T·ª± ƒë·ªông tham gia group</button>
                  <button id="feedAccountSettingBtn" class="btn-nuoiacc" type="button">Nu√¥i acc</button>
                  <button id="pauseAllBtn" class="btn-yellow" type="button">T·∫°m d·ª´ng t·∫•t c·∫£</button>
                  <button id="pauseSelectedProfilesBtn" class="btn-pause" type="button">T·∫°m d·ª´ng profile ƒë√£ ch·ªçn</button>
                  <button id="stopSelectedProfilesBtn" class="btn-orange" type="button">D·ª´ng profile ƒë√£ ch·ªçn</button>
                  <button id="stopAllSettingBtn" class="btn-danger" type="button">D·ª´ng t·∫•t c·∫£</button>
                </div>
                <!-- Hi·ªÉn th·ªã s·ªë b√†i ƒë√£ qu√©t ƒë∆∞·ª£c cho t·ª´ng profile -->
                <div id="scanStatsContainer" style="margin-top: 15px; padding: 10px; background: #f5f5f5; border-radius: 5px; display: none;">
                  <div style="font-weight: bold; margin-bottom: 8px;">S·ªë b√†i ƒë√£ qu√©t ƒë∆∞·ª£c:</div>
                  <div id="scanStatsList"></div>
                </div>
                <!-- Hi·ªÉn th·ªã ti·∫øn tr√¨nh khi l·∫•y th√¥ng tin -->
                <div id="infoProgressContainer" style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 5px; display: none;">
                  <div id="infoProgressText" style="font-weight: bold;"></div>
                </div>
              </div>
              <div id="feedConfigPanel" class="feed-panel" style="display:none;">
                <div class="feed-panel-row">
                  <label class="feed-radio">
                    <input type="radio" name="feedMode" value="feed" checked />
                    <span>Feed</span>
                  </label>
                  <label class="feed-radio">
                    <input type="radio" name="feedMode" value="search" />
                    <span>Search</span>
                  </label>
                  <div class="feed-duration">
                    <span class="feed-label">Ch·∫°y (ph√∫t)</span>
                    <input id="feedRunMinutesInput" type="number" min="1" value="30" />
                  </div>
                  <div class="feed-duration">
                    <span class="feed-label">Th·ªùi gian l·∫∑p l·∫°i (ph√∫t)</span>
                    <input id="feedRestMinutesInput" type="number" min="0" value="120" />
                  </div>
                </div>
                <div class="feed-panel-row">
                  <textarea id="feedTextInput"
                    placeholder="Nh·∫≠p text. VD: b·∫Øc ninh , b·∫Øc giang  |  ho·∫∑c: tuy·ªÉn d·ª•ng b·∫Øc ninh , b·∫Øc giang"></textarea>
                </div>
                <div class="feed-panel-row feed-panel-actions">
                  <button id="feedStartBtn" class="btn-success" type="button">Ch·∫°y</button>
                  <button id="feedCancelBtn" class="btn-secondary" type="button">H·ªßy</button>
                </div>
                <p class="hint">
                  Rule like: b√†i ph·∫£i c√≥ (tuy·ªÉn d·ª•ng/tuy·ªÉn g·∫•p/tuy·ªÉn nh√¢n vi√™n) <b>v√†</b> c√≥ (b·∫Øc ninh <b>ho·∫∑c</b> b·∫Øc
                  giang).
                </p>
              </div>

              <!-- Panel: Qu√©t b√†i vi·∫øt (d√πng core/browser.py: scan + like + share + b·∫Øt id) -->
              <div id="scanConfigPanel" class="feed-panel" style="display:none;">
                <div class="feed-panel-row">
                  <label class="feed-radio">
                    <input type="radio" name="scanMode" value="feed" checked />
                    <span>Feed</span>
                  </label>
                  <label class="feed-radio">
                    <input type="radio" name="scanMode" value="search" />
                    <span>Search</span>
                  </label>
                  <div class="feed-duration">
                    <span class="feed-label">Ch·∫°y (ph√∫t)</span>
                    <input id="scanRunMinutesInput" type="number" min="1" value="30" />
                  </div>
                  <div class="feed-duration">
                    <span class="feed-label">Th·ªùi gian l·∫∑p l·∫°i (ph√∫t)</span>
                    <input id="scanRestMinutesInput" type="number" min="0" value="120" />
                  </div>
                </div>
                <div class="feed-panel-row">
                  <textarea id="scanTextInput"
                    placeholder="Nh·∫≠p text. VD: b·∫Øc ninh , b·∫Øc giang  |  ho·∫∑c: tuy·ªÉn d·ª•ng b·∫Øc ninh , b·∫Øc giang"></textarea>
                </div>
                <div class="feed-panel-row feed-panel-actions">
                  <button id="scanStartBtn" class="btn-success" type="button">Ch·∫°y</button>
                  <button id="scanCancelBtn" class="btn-secondary" type="button">H·ªßy</button>
                </div>
                <p class="hint">
                  Rule scan: b√†i ph·∫£i c√≥ keyword m·∫∑c ƒë·ªãnh (tuy·ªÉn d·ª•ng/l∆∞∆°ng/...) <b>v√†</b> c√≥ √≠t nh·∫•t 1 c·ª•m t·ª´ trong
                  text
                  nh·∫≠p (n·∫øu c√≥).
                </p>
              </div>

              <!-- Panel: Qu√©t theo group (UI only - ch∆∞a n·ªëi API) -->
              <div id="groupScanPanel" class="feed-panel" style="display:none;">
                <div class="feed-panel-row">
                  <div class="feed-duration feed-duration-left">
                    <span class="feed-label">S·ªë b√†i vi·∫øt theo d√µi</span>
                    <input id="groupScanPostCountInput" type="number" min="0" value="0" placeholder="VD: 100" />
                  </div>
                  <div class="feed-duration">
                    <span class="feed-label">T·ª´ (ng√†y/gi·ªù)</span>
                    <input id="groupScanStartDateInput" type="datetime-local" />
                  </div>
                  <div class="feed-duration">
                    <span class="feed-label">ƒê·∫øn (ng√†y/gi·ªù)</span>
                    <input id="groupScanEndDateInput" type="datetime-local" />
                  </div>
                </div>
                <div class="feed-panel-row">
                  <textarea id="groupScanUrlInput"
                    placeholder="Nh·∫≠p URL group (m·ªói d√≤ng 1 URL). VD:
https://www.facebook.com/groups/tuyendungkisuIT
https://www.facebook.com/groups/abc123"></textarea>
                </div>
                <div class="feed-panel-row feed-panel-actions">
                  <button id="groupScanStartBtn" class="btn-success" type="button">Ch·∫°y</button>
                  <button id="groupScanCancelBtn" class="btn-secondary" type="button">ƒê√≥ng</button>
                </div>
                <p class="hint">Ch·ªâ UI ƒë·ªÉ nh·∫≠p URL + kho·∫£ng th·ªùi gian (ch∆∞a n·ªëi API).</p>
              </div>

              <div id="profileList" class="profile-list empty-state-box">
                <p class="muted">Ch∆∞a c√≥ profile n√†o</p>
              </div>

              <div class="add-profile-row">
                <button id="addProfileRowBtn" class="btn-success" type="button">+ Th√™m profile</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Help button v·ªõi tooltip -->
  <button id="helpBtn" class="help-button" title="Xem gi·∫£i th√≠ch m√†u s·∫Øc">
    <span>?</span>
  </button>
  <div id="helpTooltip" class="help-tooltip">
    <div class="tooltip-header">
      <h4>üìã Gi·∫£i th√≠ch m√†u s·∫Øc</h4>
      <button class="tooltip-close">&times;</button>
    </div>
    <div class="tooltip-body">
      <div class="tooltip-item">
        <span class="tooltip-dot tooltip-green"></span>
        <div>
          <strong>Xanh (type1):</strong> data ∆∞u ti√™n , data ƒë·ªëi th·ªß
        </div>
      </div>
      <div class="tooltip-item">
        <span class="tooltip-dot tooltip-yellow"></span>
        <div>
          <strong>V√†ng (type2):</strong> data ∆∞u ti√™n , data ƒë·ªëi th·ªß
        </div>
      </div>
      <div class="tooltip-item">
        <span class="tooltip-dot tooltip-red"></span>
        <div>
          <strong>ƒê·ªè (type3):</strong>data kh√°ch t√¨m ki·∫øm tr√™n facebook
        </div>
      </div>
    </div>
  </div>

  <!-- N√∫t chat Messenger & Zalo -->
  <div class="chat-floating">
    <a href="https://m.me/" target="_blank" rel="noopener noreferrer" class="chat-btn chat-mess" title="Chat Messenger">
      <img src="icon/logo-messenger-inkythuatso-2-01-30-15-47-51.jpg" alt="Messenger" class="chat-img" />
    </a>
    <a href="https://zalo.me/" target="_blank" rel="noopener noreferrer" class="chat-btn chat-zalo" title="Chat Zalo">
      <img src="icon/zalo-icon.png" alt="Zalo" class="chat-img" />
    </a>
  </div>

  <script src="script.js"></script>
</body>

</html>
--- END FILE: frontend\index.html ---

--- START FILE: frontend\script.js ---
// Splash Screen
const splashScreen = document.getElementById('splashScreen');
const splashStartBtn = document.getElementById('splashStartBtn');

// Th√™m class splash-active khi trang load ƒë·ªÉ ·∫©n container
if (splashScreen) {
  document.body.classList.add('splash-active');
}

// ·∫®n splash screen khi click n√∫t "B·∫Øt ƒë·∫ßu"
if (splashStartBtn) {
  splashStartBtn.addEventListener('click', () => {
    if (splashScreen) {
      splashScreen.classList.add('hidden');
      // Cho ph√©p hi·ªÉn th·ªã container v√† scroll sau khi ·∫©n splash
      setTimeout(() => {
        document.body.classList.remove('splash-active');
      }, 600); // ƒê·ª£i animation ho√†n th√†nh
    }
  });
}

const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const runMinutesInput = document.getElementById('runMinutes');
const intervalInput = document.getElementById('interval');
const stopAllBtn = document.getElementById('stopAllBtn');
const pauseAllBtn = document.getElementById('pauseAllBtn');
const tbody = document.querySelector('#listTable tbody');
const emptyState = document.getElementById('emptyState');
const rowCount = document.getElementById('rowCount');
const statusDot = document.getElementById('statusDot');
const backendStatus = document.getElementById('backendStatus');
// Tabs & view cho danh s√°ch qu√©t / qu·∫£n l√Ω post
const tabScanList = document.getElementById('tabScanList');
const tabPostManager = document.getElementById('tabPostManager');
const tabSettings = document.getElementById('tabSettings');
const scanView = document.getElementById('scanView');
const postView = document.getElementById('postView');
const settingsView = document.getElementById('settingsView');
// B·∫£ng qu·∫£n l√Ω post
const postTableBody = document.querySelector('#postTable tbody');
const postEmptyState = document.getElementById('postEmptyState');
// Setting profile elements
const settingApiKeyInput = document.getElementById('settingApiKey');
const saveApiKeyBtn = document.getElementById('saveApiKeyBtn');
const profileList = document.getElementById('profileList');
// (Preview settings.json ƒë√£ b·ªã b·ªè kh·ªèi UI)
const addProfileRowBtn = document.getElementById('addProfileRowBtn');
const autoJoinGroupBtn = document.getElementById('autoJoinGroupBtn');
const stopAllSettingBtn = document.getElementById('stopAllSettingBtn');
const stopSelectedProfilesBtn = document.getElementById('stopSelectedProfilesBtn');
const pauseSelectedProfilesBtn = document.getElementById('pauseSelectedProfilesBtn');
const feedAccountSettingBtn = document.getElementById('feedAccountSettingBtn');
const scanPostsSettingBtn = document.getElementById('scanPostsSettingBtn');
const scanGroupSettingBtn = document.getElementById('scanGroupSettingBtn');
const runAllInfoBtn = document.getElementById('runAllInfoBtn');
const runSelectedInfoBtn = document.getElementById('runSelectedInfoBtn');
const feedConfigPanel = document.getElementById('feedConfigPanel');
const scanConfigPanel = document.getElementById('scanConfigPanel');
const groupScanPanel = document.getElementById('groupScanPanel');
const groupScanUrlInput = document.getElementById('groupScanUrlInput');
const groupScanPostCountInput = document.getElementById('groupScanPostCountInput');
const groupScanStartDateInput = document.getElementById('groupScanStartDateInput');
const groupScanEndDateInput = document.getElementById('groupScanEndDateInput');
const groupScanStartBtn = document.getElementById('groupScanStartBtn');
const groupScanCancelBtn = document.getElementById('groupScanCancelBtn');
const scanTextInput = document.getElementById('scanTextInput');
const scanRunMinutesInput = document.getElementById('scanRunMinutesInput');
const scanRestMinutesInput = document.getElementById('scanRestMinutesInput');
const scanStartBtn = document.getElementById('scanStartBtn');
const scanCancelBtn = document.getElementById('scanCancelBtn');
const feedTextInput = document.getElementById('feedTextInput');
const feedRunMinutesInput = document.getElementById('feedRunMinutesInput');
const feedRestMinutesInput = document.getElementById('feedRestMinutesInput');
const feedStartBtn = document.getElementById('feedStartBtn');
const feedCancelBtn = document.getElementById('feedCancelBtn');

const API_BASE = 'http://localhost:8000';
const SETTINGS_STORAGE_KEY = 'profileSettings';
const toastContainer = document.getElementById('toastContainer');

let counter = 1;
let timerId = null;
let initialLoaded = false;
let dataCheckInterval = null; // Interval ƒë·ªÉ ki·ªÉm tra d·ªØ li·ªáu m·ªõi
let loadedPostIds = new Set(); // L∆∞u c√°c post_id ƒë√£ load ƒë·ªÉ tr√°nh tr√πng l·∫∑p
let postsLoaded = false; // ƒê√£ load d·ªØ li·ªáu qu·∫£n l√Ω post hay ch∆∞a
let profileState = {
  apiKey: '',
  profiles: {}, // { [profileId]: { cookie: '', access_token: '', groups: string[] } }
  selected: {}, // { [profileId]: true/false } (frontend-only)
};
let addRowEl = null; // Row t·∫°m ƒë·ªÉ nh·∫≠p profile m·ªõi
let joinGroupPollTimer = null;
let feedPollTimer = null;
let scanBackendPollTimer = null; // Poll tr·∫°ng th√°i bot runner ƒë·ªÉ sync UI sau F5
let isScanning = false; // Tr·∫°ng th√°i ƒëang qu√©t
let isPausedAll = false; // Tr·∫°ng th√°i pause all (UI)
let lastJobsStatus = null; // cache /jobs/status ƒë·ªÉ badge kh√¥ng b·ªã sai khi m·ªõi m·ªü trang

function setPauseAllButtonLabel(paused) {
  if (!pauseAllBtn) return;
  const isPaused = !!paused;
  // Support c·∫£ 2 ki·ªÉu: button c√≥ span icon/text ho·∫∑c button text thu·∫ßn
  const icon = pauseAllBtn.querySelector ? pauseAllBtn.querySelector('span.btn-icon') : null;
  const textSpan = pauseAllBtn.querySelector ? pauseAllBtn.querySelector('span:last-child') : null;
  if (icon || textSpan) {
    if (icon) icon.textContent = isPaused ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
    if (textSpan) textSpan.textContent = isPaused ? 'Ti·∫øp t·ª•c t·∫•t c·∫£' : 'T·∫°m d·ª´ng t·∫•t c·∫£';
  } else {
    pauseAllBtn.textContent = isPaused ? 'Ti·∫øp t·ª•c t·∫•t c·∫£' : 'T·∫°m d·ª´ng t·∫•t c·∫£';
  }
}

stopBtn.disabled = true;
// M·∫∑c ƒë·ªãnh: ch∆∞a bi·∫øt backend c√≥ ch·∫°y g√¨ => disable STOP/PAUSE ALL tr∆∞·ªõc, l√°t s·∫Ω resync theo /jobs/status
try {
  if (pauseAllBtn) pauseAllBtn.disabled = true;
  if (stopAllSettingBtn) stopAllSettingBtn.disabled = true;
  if (stopSelectedProfilesBtn) stopSelectedProfilesBtn.disabled = true;
  if (pauseSelectedProfilesBtn) pauseSelectedProfilesBtn.disabled = true;
} catch (_) { }

function updateRowCount() {
  const count = tbody.children.length;
  rowCount.textContent = count;
}

// Load d·ªØ li·ªáu qu·∫£n l√Ω post t·ª´ file post_ids
async function loadPostsForManager() {
  if (postsLoaded || !postTableBody) return;
  try {
    const res = await fetch('../backend/data/post_ids/031ca13d-e8fa-400c-a603-df57a2806788.json');
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    if (!Array.isArray(data) || data.length === 0) {
      postEmptyState && postEmptyState.classList.add('show');
      postsLoaded = true;
      return;
    }

    data.forEach((post) => appendPostRow(post));
    postEmptyState && postEmptyState.classList.remove('show');
    postsLoaded = true;
  } catch (err) {
    console.error('Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu post_ids:', err);
    postEmptyState && postEmptyState.classList.add('show');
  }
}

function setScanning(isOn) {
  isScanning = isOn;
  startBtn.disabled = isOn;
  const startBtnText = startBtn.querySelector('span:last-child');
  startBtnText.textContent = isOn ? (isPausedAll ? 'ƒêang t·∫°m d·ª´ng...' : 'ƒêang qu√©t...') : 'B·∫Øt ƒë·∫ßu qu√©t';
  stopBtn.disabled = !isOn;
  
  // Disable/enable c√°c n√∫t qu√©t kh√°c khi ƒëang qu√©t
  if (scanStartBtn) {
    scanStartBtn.disabled = isOn;
  }
  if (scanPostsSettingBtn) {
    scanPostsSettingBtn.disabled = isOn;
  }

  // Khi d·ª´ng qu√©t: g·ª° h·∫øt tr·∫°ng th√°i loading/spinner ·ªü c√°c n√∫t li√™n quan
  // (tr√°nh tr∆∞·ªùng h·ª£p backend stop ch·∫≠m l√†m UI b·ªã k·∫πt, kh√¥ng b·∫•m l·∫°i ƒë∆∞·ª£c)
  if (!isOn) {
    setButtonLoading(scanStartBtn, false);
    setButtonLoading(scanPostsSettingBtn, false);
    // D·ª´ng poll s·ªë b√†i ƒë√£ qu√©t ƒë∆∞·ª£c
    if (scanStatsInterval) {
      clearInterval(scanStatsInterval);
      scanStatsInterval = null;
    }
    // ·∫®n container s·ªë b√†i ƒë√£ qu√©t
    const container = document.getElementById('scanStatsContainer');
    if (container) container.style.display = 'none';
  }
  // Th√™m loading spinner cho n√∫t b·∫Øt ƒë·∫ßu qu√©t
  if (startBtn) {
    if (isOn) {
      if (!startBtn.classList.contains('btn-loading')) {
        startBtn.classList.add('btn-loading');
      }
    } else {
      startBtn.classList.remove('btn-loading');
    }
  }
}

function syncRunningLabelsWithPauseState() {
  // Khi PAUSE ALL b·∫≠t, ƒë·ªïi text c√°c n√∫t ƒëang "loading" ƒë·ªÉ user bi·∫øt ƒëang t·∫°m d·ª´ng,
  // tr√°nh hi·ªÉu nh·∫ßm v·∫´n "ƒëang qu√©t/ƒëang ch·∫°y".
  try {
    if (isScanning) {
      const startBtnText = startBtn?.querySelector?.('span:last-child');
      if (startBtnText) startBtnText.textContent = isPausedAll ? 'ƒêang t·∫°m d·ª´ng...' : 'ƒêang qu√©t...';

      if (scanStartBtn && scanStartBtn.classList.contains('btn-loading')) {
        scanStartBtn.textContent = isPausedAll ? 'ƒêang t·∫°m d·ª´ng...' : 'ƒêang ch·∫°y...';
      }
      if (scanPostsSettingBtn && scanPostsSettingBtn.classList.contains('btn-loading')) {
        scanPostsSettingBtn.textContent = isPausedAll ? 'ƒêang t·∫°m d·ª´ng...' : 'ƒêang qu√©t...';
      }
    }

    if (feedPollTimer) {
      if (feedStartBtn && feedStartBtn.classList.contains('btn-loading')) {
        feedStartBtn.textContent = isPausedAll ? 'ƒêang t·∫°m d·ª´ng...' : 'ƒêang ch·∫°y...';
      }
      if (feedAccountSettingBtn && feedAccountSettingBtn.classList.contains('btn-loading')) {
        feedAccountSettingBtn.textContent = isPausedAll ? 'ƒêang t·∫°m d·ª´ng...' : 'ƒêang nu√¥i acc...';
      }
    }

    if (joinGroupPollTimer) {
      if (autoJoinGroupBtn && autoJoinGroupBtn.classList.contains('btn-loading')) {
        autoJoinGroupBtn.textContent = isPausedAll ? 'ƒêang t·∫°m d·ª´ng...' : 'ƒêang auto join...';
      }
    }
  } catch (_) { }
}

function applyControlStateToProfileRows(st) {
  // ƒê·ªìng b·ªô badge tr·∫°ng th√°i cho m·ªçi profile row
  const pausedAll = Boolean(st && st.global_pause);
  const pausedProfiles = new Set(Array.isArray(st && st.paused_profiles) ? st.paused_profiles.map((x) => String(x)) : []);
  const profileStates = (st && typeof st.profile_states === 'object' && st.profile_states) ? st.profile_states : {};
  const jobs = lastJobsStatus || {};
  const botRunning = Boolean(jobs && jobs.bot_running);
  const botProfileIds = new Set(Array.isArray(jobs && jobs.bot_profile_ids) ? jobs.bot_profile_ids.map((x) => String(x)) : []);
  const joinRunning = new Set(Array.isArray(jobs && jobs.join_groups_running) ? jobs.join_groups_running.map((x) => String(x)) : []);
  const feedRunning = new Set(Array.isArray(jobs && jobs.feed_running) ? jobs.feed_running.map((x) => String(x)) : []);
  const sessionRunning = Boolean(
    botRunning
    || joinRunning.size > 0
    || feedRunning.size > 0
  );

  const rows = document.querySelectorAll('.profile-row-wrap');
  rows.forEach((wrap) => {
    const pid = String(wrap.dataset.profileId || '').trim();
    if (!pid) return;
    const badge = wrap.querySelector('.profile-state-badge');

    // --- Effective state ---
    // Default: READY (m·ªõi v√†o / ch∆∞a c√≥ job)
    let eff = 'READY';
    // N·∫øu kh√¥ng c√≥ session n√†o ch·∫°y -> lu√¥n READY
    if (sessionRunning) {
      // N·∫øu ƒëang pause (global ho·∫∑c profile) -> PAUSED
      if (pausedAll || pausedProfiles.has(pid)) {
        eff = 'PAUSED';
      } else {
        // RUNNING n·∫øu profile ƒëang c√≥ feed/join ho·∫∑c runner ƒëang ch·∫°y v√† profile_state RUNNING
        if (feedRunning.has(pid) || joinRunning.has(pid)) {
          eff = 'RUNNING';
        } else if (botRunning) {
          const ps = String(profileStates[pid] || '').toUpperCase();
          // ∆Øu ti√™n list t·ª´ backend: bot_profile_ids
          const inBot = botProfileIds.size > 0 ? botProfileIds.has(pid) : false;
          eff = (ps === 'RUNNING' || inBot) ? 'RUNNING' : 'READY';
        } else {
          eff = 'READY';
        }
      }
    }

    if (badge) {
      badge.classList.remove('state-running', 'state-paused', 'state-ready', 'state-idle', 'state-unknown', 'state-stopping', 'state-stopped', 'state-error');
      if (eff === 'PAUSED') badge.classList.add('state-paused');
      else if (eff === 'RUNNING') badge.classList.add('state-running');
      else badge.classList.add('state-ready');
      badge.textContent = (eff === 'READY') ? 'S·∫¥N S√ÄNG' : (eff === 'RUNNING') ? 'ƒêANG CH·∫†Y' : 'ƒêANG T·∫†M D·ª™NG';
    }
  });
}

function updateStopPauseButtonsByJobs() {
  const jobs = lastJobsStatus || {};
  const botHasProfiles = Array.isArray(jobs && jobs.bot_profile_ids) && jobs.bot_profile_ids.length > 0;
  const sessionRunning = Boolean(
    (jobs && jobs.bot_running && botHasProfiles)
    || (Array.isArray(jobs && jobs.join_groups_running) && jobs.join_groups_running.length > 0)
    || (Array.isArray(jobs && jobs.feed_running) && jobs.feed_running.length > 0)
  );
  const hasSelected = getSelectedProfileIds().length > 0;
  
  // N·∫øu ƒëang ch·∫°y info collector th√¨ lu√¥n enable c√°c n√∫t pause/d·ª´ng
  const shouldEnableButtons = sessionRunning || isInfoCollectorRunning;

  // Ch·ªâ khi c√≥ ti·∫øn tr√¨nh ch·∫°y m·ªõi cho b·∫•m STOP/PAUSE
  const stopBtns = [stopBtn, stopAllSettingBtn].filter(Boolean);
  stopBtns.forEach((b) => {
    if (b.classList && b.classList.contains('btn-loading')) return;
    b.disabled = !shouldEnableButtons;
    if (shouldEnableButtons) {
      b.style.opacity = '1';
      b.style.pointerEvents = 'auto';
      b.style.cursor = 'pointer';
    }
  });

  const pauseBtns = [pauseAllBtn].filter(Boolean);
  pauseBtns.forEach((b) => {
    if (b.classList && b.classList.contains('btn-loading')) return;
    b.disabled = !shouldEnableButtons;
    if (shouldEnableButtons) {
      b.style.opacity = '1';
      b.style.pointerEvents = 'auto';
      b.style.cursor = 'pointer';
    }
  });

  if (pauseSelectedProfilesBtn && !pauseSelectedProfilesBtn.classList.contains('btn-loading')) {
    pauseSelectedProfilesBtn.disabled = !shouldEnableButtons || !hasSelected;
    if (shouldEnableButtons && hasSelected) {
      pauseSelectedProfilesBtn.style.opacity = '1';
      pauseSelectedProfilesBtn.style.pointerEvents = 'auto';
      pauseSelectedProfilesBtn.style.cursor = 'pointer';
    }
  }
  if (stopSelectedProfilesBtn && !stopSelectedProfilesBtn.classList.contains('btn-loading')) {
    stopSelectedProfilesBtn.disabled = !shouldEnableButtons || !hasSelected;
    if (shouldEnableButtons && hasSelected) {
      stopSelectedProfilesBtn.style.opacity = '1';
      stopSelectedProfilesBtn.style.pointerEvents = 'auto';
      stopSelectedProfilesBtn.style.cursor = 'pointer';
    }
  }
}

// ==== Settings (frontend-only) ====
async function tryLoadProfileStateFromBackend() {
  try {
    const raw = await callBackendNoAlert('/settings', { method: 'GET' });
    if (!raw) return false;

    const apiKey = raw.API_KEY || raw.api_key || '';
    const profileIds = raw.PROFILE_IDS || raw.profile_ids || {};

    profileState.apiKey = String(apiKey || '').trim();

    // PROFILE_IDS c√≥ th·ªÉ l√† list/string/dict; normalize v·ªÅ dict
    const nextProfiles = {};
    if (Array.isArray(profileIds)) {
      profileIds.forEach((pid) => {
        const key = String(pid || '').trim();
        if (key) nextProfiles[key] = { cookie: '', access_token: '' };
      });
    } else if (typeof profileIds === 'string') {
      profileIds.split(',').map((s) => s.trim()).filter(Boolean).forEach((pid) => {
        nextProfiles[pid] = { cookie: '', access_token: '' };
      });
    } else if (profileIds && typeof profileIds === 'object') {
      Object.entries(profileIds).forEach(([pid, cfg]) => {
        const key = String(pid || '').trim();
        if (!key) return;
        nextProfiles[key] = {
          cookie: (cfg && cfg.cookie) ? String(cfg.cookie) : '',
          access_token: (cfg && (cfg.access_token || cfg.accessToken)) ? String(cfg.access_token || cfg.accessToken) : '',
          groups: (cfg && Array.isArray(cfg.groups)) ? cfg.groups.map((x) => String(x || '').trim()).filter(Boolean) : [],
        };
      });
    }

    profileState.profiles = nextProfiles;
    // gi·ªØ selected n·∫øu c√≥
    if (!profileState.selected || typeof profileState.selected !== 'object') profileState.selected = {};
    localStorage.setItem(SETTINGS_STORAGE_KEY, JSON.stringify(profileState));
    return true;
  } catch (err) {
    return false;
  }
}

async function loadProfileState() {
  // ∆Øu ti√™n l·∫•y t·ª´ backend n·∫øu c√≥
  const loadedFromBackend = await tryLoadProfileStateFromBackend();
  if (loadedFromBackend) {
    if (settingApiKeyInput) settingApiKeyInput.value = profileState.apiKey || '';
    renderProfileList();
    updateSettingsActionButtons();
    return;
  }

  try {
    const stored = localStorage.getItem(SETTINGS_STORAGE_KEY);
    if (stored) {
      const parsed = JSON.parse(stored);
      profileState = {
        apiKey: parsed.apiKey || '',
        profiles: parsed.profiles || {},
        selected: parsed.selected || {},
      };
    }
  } catch (err) {
    console.warn('Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c d·ªØ li·ªáu settings t·ª´ localStorage', err);
  }

  if (settingApiKeyInput) settingApiKeyInput.value = profileState.apiKey || '';
  renderProfileList();
  updateSettingsActionButtons();
}

function saveProfileState() {
  localStorage.setItem(SETTINGS_STORAGE_KEY, JSON.stringify(profileState));
}

function getSelectedProfileIds() {
  return Object.keys(profileState.selected || {}).filter((pid) => profileState.selected[pid]);
}

function updateSettingsActionButtons() {
  const selected = getSelectedProfileIds();
  const hasSelected = selected.length > 0;

  // C√°c n√∫t "h√†nh ƒë·ªông" ·ªü Setting profile: y√™u c·∫ßu tick √≠t nh·∫•t 1 profile
  const needSelectedBtns = [
    scanPostsSettingBtn,
    scanGroupSettingBtn,
    autoJoinGroupBtn,
    feedAccountSettingBtn,
    stopSelectedProfilesBtn,
    pauseSelectedProfilesBtn,
    runSelectedInfoBtn,
  ].filter(Boolean);

  needSelectedBtns.forEach((b) => {
    // n·∫øu ƒëang loading th√¨ gi·ªØ nguy√™n tr·∫°ng th√°i disabled
    if (b.classList && b.classList.contains('btn-loading')) return;
    b.disabled = !hasSelected;
  });

  // C√°c n√∫t ALL (kh√¥ng ph·ª• thu·ªôc tick)
  // L∆∞u √Ω: stop/pause ALL s·∫Ω ƒë∆∞·ª£c enable/disable theo /jobs/status (updateStopPauseButtonsByJobs)
  // n√™n kh√¥ng set ·ªü ƒë√¢y ƒë·ªÉ tr√°nh ghi ƒë√® logic.

  // C√°c n√∫t "Ch·∫°y" trong c√°c panel c≈©ng y√™u c·∫ßu tick profile
  const runBtns = [feedStartBtn, scanStartBtn, groupScanStartBtn].filter(Boolean);
  runBtns.forEach((b) => {
    if (b.classList && b.classList.contains('btn-loading')) return;
    b.disabled = !hasSelected;
  });

  // N·∫øu ƒëang PAUSE ALL th√¨ disable c√°c n√∫t "Ch·∫°y" ƒë·ªÉ tr√°nh b·∫•m l·∫°i v√¥ nghƒ©a
  if (isPausedAll) {
    [scanPostsSettingBtn, scanGroupSettingBtn, autoJoinGroupBtn, feedAccountSettingBtn, feedStartBtn, scanStartBtn, groupScanStartBtn]
      .filter(Boolean)
      .forEach((b) => {
        if (b.classList && b.classList.contains('btn-loading')) return;
        b.disabled = true;
      });
  }

  // N·∫øu kh√¥ng c√≥ selection th√¨ auto ƒë√≥ng panel ƒë·ªÉ tr√°nh ng∆∞·ªùi d√πng nh·∫≠p r·ªìi m·ªõi bi·∫øt kh√¥ng ch·∫°y ƒë∆∞·ª£c
  if (!hasSelected) {
    if (feedConfigPanel) feedConfigPanel.style.display = 'none';
    if (scanConfigPanel) scanConfigPanel.style.display = 'none';
    if (groupScanPanel) groupScanPanel.style.display = 'none';
  }

  // ƒê·ªìng b·ªô enable/disable cho STOP/PAUSE theo tr·∫°ng th√°i backend (sessionRunning)
  try { updateStopPauseButtonsByJobs(); } catch (_) { }
}

function showToast(message, type = 'success', ms = 1600) {
  if (!toastContainer) return;
  const el = document.createElement('div');
  el.className = `toast ${type}`;
  el.textContent = message;
  toastContainer.appendChild(el);
  requestAnimationFrame(() => el.classList.add('show'));
  setTimeout(() => {
    el.classList.remove('show');
    setTimeout(() => el.remove(), 220);
  }, ms);
}

function setButtonLoading(btn, isLoading, loadingText) {
  if (!btn) return;
  if (isLoading) {
    if (!btn.dataset.origText) {
      btn.dataset.origText = btn.textContent || '';
    }
    btn.disabled = true;
    btn.classList.add('btn-loading');
    if (loadingText) btn.textContent = loadingText;
  } else {
    btn.disabled = false;
    btn.classList.remove('btn-loading');
    if (btn.dataset.origText) {
      btn.textContent = btn.dataset.origText;
      delete btn.dataset.origText;
    }
  }
}

// (Preview settings.json ƒë√£ b·ªã b·ªè kh·ªèi UI)

function createPill(text) {
  const pill = document.createElement('span');
  pill.className = 'pill';
  pill.textContent = text;
  return pill;
}

function setProfileListEmptyStateIfNeeded() {
  if (!profileList) return;
  const hasRow = Boolean(profileList.querySelector('.profile-row:not(.add-profile-form)'));
  if (hasRow) {
    profileList.classList.remove('empty-state-box');
    const p = profileList.querySelector('p.muted');
    if (p && p.textContent && p.textContent.includes('Ch∆∞a c√≥ profile')) {
      // n·∫øu ƒëang l√† empty placeholder th√¨ x√≥a
      profileList.innerHTML = '';
    }
    return;
  }
  profileList.classList.add('empty-state-box');
  profileList.innerHTML = '<p class="muted">Ch∆∞a c√≥ profile n√†o</p>';
}

function buildProfileRow(initialPid, initialInfo) {
  let currentPid = initialPid;
  const wrap = document.createElement('div');
  wrap.className = 'profile-row-wrap';
  wrap.dataset.profileId = String(currentPid || '').trim();

  const row = document.createElement('div');
  row.className = 'profile-row';

  const selectWrap = document.createElement('div');
  selectWrap.className = 'profile-select';

  const selectCb = document.createElement('input');
  selectCb.type = 'checkbox';
  selectCb.className = 'profile-select-cb';
  selectCb.title = 'Ch·ªçn profile';
  selectCb.checked = Boolean(profileState.selected && profileState.selected[currentPid]);

  const pidInput = document.createElement('input');
  pidInput.className = 'profile-id-input';
  pidInput.type = 'text';
  pidInput.value = currentPid;
  pidInput.addEventListener('change', () => {
    wrap.dataset.profileId = String(pidInput.value || '').trim();
  });

  const actions = document.createElement('div');
  actions.className = 'profile-actions';

  const saveBtn = document.createElement('button');
  saveBtn.type = 'button';
  saveBtn.className = 'btn-success';
  saveBtn.textContent = 'L∆∞u';

  const removeBtn = document.createElement('button');
  removeBtn.type = 'button';
  removeBtn.className = 'btn-danger';
  removeBtn.textContent = 'X√≥a';

  const groupBtn = document.createElement('button');
  groupBtn.type = 'button';
  groupBtn.className = 'btn-primary';
  groupBtn.textContent = 'Th√™m Groups';

  // Badge hi·ªÉn th·ªã tr·∫°ng th√°i profile (RUNNING/PAUSED/STOPPED)
  const stateBadge = document.createElement('span');
  stateBadge.className = 'profile-state-badge state-idle';
  stateBadge.textContent = 'IDLE';

  // ===== Group editor panel (div) =====
  const groupPanel = document.createElement('div');
  groupPanel.className = 'group-panel';
  groupPanel.style.display = 'none';

  const groupPanelHeader = document.createElement('div');
  groupPanelHeader.className = 'group-panel-header';
  groupPanelHeader.textContent = 'Danh s√°ch group (m·ªói d√≤ng 1 group)';

  const groupTextarea = document.createElement('textarea');
  groupTextarea.className = 'group-textarea';
  groupTextarea.placeholder = 'D√°n group ·ªü ƒë√¢y...\nVD:\nhttps://www.facebook.com/groups/tuyendungkisuIT\n3013041542259942';

  const groupPanelActions = document.createElement('div');
  groupPanelActions.className = 'group-panel-actions';

  const groupSaveBtn = document.createElement('button');
  groupSaveBtn.type = 'button';
  groupSaveBtn.className = 'btn-success';
  groupSaveBtn.textContent = 'L∆∞u groups';

  const groupCloseBtn = document.createElement('button');
  groupCloseBtn.type = 'button';
  groupCloseBtn.className = 'btn-secondary';
  groupCloseBtn.textContent = 'ƒê√≥ng';

  groupPanelActions.appendChild(groupSaveBtn);
  groupPanelActions.appendChild(groupCloseBtn);
  groupPanel.appendChild(groupPanelHeader);
  groupPanel.appendChild(groupTextarea);
  groupPanel.appendChild(groupPanelActions);

  function getLocalGroups(pid) {
    const info = profileState.profiles[pid] || {};
    const gs = info.groups;
    if (Array.isArray(gs)) return gs.map((x) => String(x || '').trim()).filter(Boolean);
    return [];
  }

  function setLocalGroups(pid, groups) {
    if (!profileState.profiles[pid]) profileState.profiles[pid] = { cookie: '', access_token: '', groups: [] };
    profileState.profiles[pid].groups = Array.isArray(groups) ? groups : [];
  }

  function updateGroupBtnLabel() {
    const count = getLocalGroups(currentPid).length;
    groupBtn.textContent = count > 0 ? `Groups (${count})` : 'Groups';
  }
  // init label from initialInfo/profileState
  if (initialInfo && Array.isArray(initialInfo.groups)) {
    setLocalGroups(currentPid, initialInfo.groups);
  } else if (!profileState.profiles[currentPid]?.groups) {
    // ensure field exists
    setLocalGroups(currentPid, getLocalGroups(currentPid));
  }
  updateGroupBtnLabel();

  selectCb.addEventListener('change', () => {
    if (!profileState.selected || typeof profileState.selected !== 'object') profileState.selected = {};
    if (selectCb.checked) profileState.selected[currentPid] = true;
    else delete profileState.selected[currentPid];
    saveProfileState();
    updateSettingsActionButtons();
  });

  const cookieBtn = document.createElement('button');
  cookieBtn.type = 'button';
  cookieBtn.className = 'btn-primary';
  cookieBtn.textContent = 'C·∫≠p nh·∫≠t cookie';

  const tokenBtn = document.createElement('button');
  tokenBtn.type = 'button';
  tokenBtn.className = 'btn-success';
  tokenBtn.textContent = initialInfo?.access_token ? 'C·∫≠p nh·∫≠t token' : 'L·∫•y access_token';

  groupBtn.addEventListener('click', async () => {
    const isOpen = groupPanel.style.display !== 'none';
    if (isOpen) {
      groupPanel.style.display = 'none';
      return;
    }

    // m·ªü panel + load groups t·ª´ backend ƒë·ªÉ textarea ƒë√∫ng d·ªØ li·ªáu hi·ªán t·∫°i
    groupBtn.disabled = true;
    try {
      const settings = await callBackendNoAlert('/settings', { method: 'GET' });
      const profiles = (settings && (settings.PROFILE_IDS || settings.profile_ids)) || {};
      const cfg = (profiles && typeof profiles === 'object') ? profiles[currentPid] : null;
      const rawGroups = cfg && typeof cfg === 'object' ? cfg.groups : null;
      const groups = Array.isArray(rawGroups) ? rawGroups.map((x) => String(x || '').trim()).filter(Boolean) : [];
      setLocalGroups(currentPid, groups);
      saveProfileState();
      updateGroupBtnLabel();
      groupTextarea.value = groups.join('\n');
      groupPanel.style.display = 'block';
      groupTextarea.focus();
    } catch (e) {
      // fallback: hi·ªán theo local n·∫øu backend l·ªói
      const groups = getLocalGroups(currentPid);
      groupTextarea.value = groups.join('\n');
      groupPanel.style.display = 'block';
      showToast('Kh√¥ng load ƒë∆∞·ª£c groups t·ª´ backend, ƒëang d√πng d·ªØ li·ªáu local.', 'error');
    } finally {
      groupBtn.disabled = false;
    }
  });

  groupCloseBtn.addEventListener('click', () => {
    groupPanel.style.display = 'none';
  });

  groupSaveBtn.addEventListener('click', async () => {
    const nextGroups = String(groupTextarea.value || '')
      .split(/\r?\n/)
      .map((s) => s.trim())
      .filter(Boolean);

    groupSaveBtn.disabled = true;
    try {
      // replace (ƒë√® l√™n c√°i c≈©)
      const res = await callBackend(`/settings/profiles/${encodeURIComponent(currentPid)}/groups`, {
        method: 'PUT',
        body: JSON.stringify({ groups: nextGroups }),
      });
      const saved = (res && Array.isArray(res.groups)) ? res.groups : nextGroups;
      setLocalGroups(currentPid, saved);
      saveProfileState();
      updateGroupBtnLabel();
      showToast(`ƒê√£ l∆∞u groups: ${saved.length}`, 'success');
      // L∆∞u xong th√¨ ƒë√≥ng textarea panel
      groupPanel.style.display = 'none';
    } catch (e) {
      showToast('Kh√¥ng l∆∞u ƒë∆∞·ª£c groups (ki·ªÉm tra FastAPI).', 'error');
    } finally {
      groupSaveBtn.disabled = false;
    }
  });

  saveBtn.addEventListener('click', async () => {
    const nextPid = (pidInput.value || '').replace(/\s+/g, '').trim();
    if (!nextPid) {
      showToast('profile_id kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng', 'error');
      pidInput.value = currentPid;
      pidInput.focus();
      return;
    }
    // normalize hi·ªÉn th·ªã ƒë·ªÉ tr√°nh d√≠nh space
    if (pidInput.value !== nextPid) pidInput.value = nextPid;

    const cur = profileState.profiles[currentPid] || { cookie: '', access_token: '', groups: [] };
    saveBtn.disabled = true;
    try {
      if (nextPid !== currentPid) {
        // rename = add new -> copy data -> delete old
        await callBackend('/settings/profiles', {
          method: 'POST',
          body: JSON.stringify({ profile_id: nextPid }),
        });
        await callBackend(`/settings/profiles/${encodeURIComponent(nextPid)}`, {
          method: 'PUT',
          body: JSON.stringify({
            cookie: cur.cookie || '',
            access_token: cur.access_token || '',
          }),
        });
        // copy groups sang profile m·ªõi (tr√°nh m·∫•t)
        await callBackend(`/settings/profiles/${encodeURIComponent(nextPid)}/groups`, {
          method: 'PUT',
          body: JSON.stringify({ groups: Array.isArray(cur.groups) ? cur.groups : [] }),
        });
        await callBackend(`/settings/profiles/${encodeURIComponent(currentPid)}`, { method: 'DELETE' });

        delete profileState.profiles[currentPid];
        profileState.profiles[nextPid] = { ...cur };
        // chuy·ªÉn checkbox selection sang key m·ªõi
        if (profileState.selected && profileState.selected[currentPid]) {
          delete profileState.selected[currentPid];
          profileState.selected[nextPid] = true;
        }
        currentPid = nextPid;
        pidInput.value = currentPid;
        selectCb.checked = Boolean(profileState.selected && profileState.selected[currentPid]);
        updateGroupBtnLabel();
      } else {
        await callBackend(`/settings/profiles/${encodeURIComponent(currentPid)}`, {
          method: 'PUT',
          body: JSON.stringify({
            cookie: cur.cookie || '',
            access_token: cur.access_token || '',
          }),
        });
      }

      saveProfileState();
      tokenBtn.textContent = (profileState.profiles[currentPid]?.access_token) ? 'C·∫≠p nh·∫≠t token' : 'L·∫•y access_token';
      showToast('ƒê√£ l∆∞u', 'success');
    } catch (e) {
      showToast('Kh√¥ng l∆∞u ƒë∆∞·ª£c (ki·ªÉm tra FastAPI).', 'error');
      pidInput.value = currentPid;
    } finally {
      saveBtn.disabled = false;
    }
  });

  removeBtn.addEventListener('click', () => {
    if (!confirm(`X√≥a profile ${currentPid}?`)) return;
    removeBtn.disabled = true;
    callBackend(`/settings/profiles/${encodeURIComponent(currentPid)}`, { method: 'DELETE' })
      .then(() => {
        delete profileState.profiles[currentPid];
        saveProfileState();
        row.remove();
        setProfileListEmptyStateIfNeeded();
        showToast('ƒê√£ x√≥a', 'success');
      })
      .catch(() => showToast('Kh√¥ng x√≥a ƒë∆∞·ª£c (ki·ªÉm tra FastAPI).', 'error'))
      .finally(() => (removeBtn.disabled = false));
  });

  cookieBtn.addEventListener('click', () => {
    cookieBtn.disabled = true;
    showToast('ƒêang b·∫≠t NST & l·∫•y cookie...', 'success', 900);
    const safePid = String(currentPid || '').replace(/\s+/g, '');
    callBackend(`/settings/profiles/${encodeURIComponent(safePid)}/cookie/fetch`, {
      method: 'POST',
      body: JSON.stringify({}),
    })
      .then(() => {
        // Cookie ƒë√£ ƒë∆∞·ª£c backend l∆∞u v√†o backend/config/settings.json, frontend kh√¥ng l∆∞u/kh√¥ng hi·ªÉn th·ªã
        showToast('ƒê√£ l∆∞u cookie v√†o settings.json', 'success');
      })
      .catch(() => showToast('Kh√¥ng l·∫•y ƒë∆∞·ª£c cookie (ki·ªÉm tra FastAPI / ƒëƒÉng nh·∫≠p NST).', 'error'))
      .finally(() => (cookieBtn.disabled = false));
  });

  tokenBtn.addEventListener('click', () => {
    const info = profileState.profiles[currentPid] || {};
    const newVal = prompt(`D√°n access token cho profile ${currentPid}:`, info.access_token || '');
    if (newVal === null) return;
    const nextToken = newVal.trim();
    tokenBtn.disabled = true;
    callBackend(`/settings/profiles/${encodeURIComponent(currentPid)}`, {
      method: 'PUT',
      body: JSON.stringify({ access_token: nextToken }),
    })
      .then(() => {
        profileState.profiles[currentPid] = { ...profileState.profiles[currentPid], access_token: nextToken };
        saveProfileState();
        tokenBtn.textContent = nextToken ? 'C·∫≠p nh·∫≠t token' : 'L·∫•y access_token';
        showToast('ƒê√£ l∆∞u token', 'success');
      })
      .catch(() => showToast('Kh√¥ng l∆∞u token (ki·ªÉm tra FastAPI).', 'error'))
      .finally(() => (tokenBtn.disabled = false));
  });

  actions.appendChild(stateBadge);
  actions.appendChild(saveBtn);
  actions.appendChild(removeBtn);
  actions.appendChild(groupBtn);
  actions.appendChild(cookieBtn);
  actions.appendChild(tokenBtn);

  selectWrap.appendChild(selectCb);
  row.appendChild(selectWrap);
  row.appendChild(pidInput);
  row.appendChild(actions);
  wrap.appendChild(row);
  wrap.appendChild(groupPanel);
  // init label
  try { updatePauseBtnLabel(); } catch (_) { }
  return wrap;
}

function renderProfileList() {
  if (!profileList) return;
  // n·∫øu ƒëang c√≥ row th√™m m·ªõi, b·ªè tr∆∞·ªõc khi render l·∫°i
  if (addRowEl && addRowEl.parentNode) {
    addRowEl.parentNode.removeChild(addRowEl);
    addRowEl = null;
  }
  profileList.innerHTML = '';
  const ids = Object.keys(profileState.profiles || {});
  if (ids.length === 0) {
    profileList.classList.add('empty-state-box');
    profileList.innerHTML = '<p class="muted">Ch∆∞a c√≥ profile n√†o</p>';
    return;
  }

  profileList.classList.remove('empty-state-box');
  ids.forEach((pid) => {
    const info = profileState.profiles[pid] || {};
    profileList.appendChild(buildProfileRow(pid, info));
  });
  updateSettingsActionButtons();
}

function showAddProfileRow() {
  if (!profileList) return;
  if (addRowEl && addRowEl.parentNode) return;

  addRowEl = document.createElement('div');
  addRowEl.className = 'profile-row add-profile-form';

  const input = document.createElement('input');
  input.type = 'text';
  input.placeholder = 'Nh·∫≠p profile_id (UUID)';

  const saveBtn = document.createElement('button');
  saveBtn.type = 'button';
  saveBtn.className = 'btn-success';
  saveBtn.textContent = 'L∆∞u';
  saveBtn.addEventListener('click', () => {
    const value = (input.value || '').trim();
    if (!value) {
      showToast('Vui l√≤ng nh·∫≠p profile_id', 'error');
      return;
    }
    callBackend('/settings/profiles', {
      method: 'POST',
      body: JSON.stringify({ profile_id: value }),
    })
      .then(() => {
        if (!profileState.profiles[value]) {
          profileState.profiles[value] = { cookie: '', access_token: '', groups: [] };
        }
        saveProfileState();
        // Th√™m row m·ªõi m√† kh√¥ng render l·∫°i to√†n b·ªô (tr√°nh nh√°y)
        if (profileList.classList.contains('empty-state-box')) {
          profileList.classList.remove('empty-state-box');
          profileList.innerHTML = '';
        }
        const newRow = buildProfileRow(value, profileState.profiles[value]);
        // insert tr∆∞·ªõc addRowEl ƒë·ªÉ form v·∫´n ·ªü cu·ªëi
        profileList.insertBefore(newRow, addRowEl);
        // remove form add
        addRowEl.remove();
        addRowEl = null;
      })
      .catch(() => showToast('Kh√¥ng th√™m ƒë∆∞·ª£c profile (ki·ªÉm tra FastAPI).', 'error'));
  });

  const cancelBtn = document.createElement('button');
  cancelBtn.type = 'button';
  cancelBtn.className = 'btn-secondary';
  cancelBtn.textContent = 'H·ªßy';
  cancelBtn.addEventListener('click', () => {
    if (addRowEl && addRowEl.parentNode) {
      addRowEl.parentNode.removeChild(addRowEl);
      addRowEl = null;
    }
  });

  addRowEl.appendChild(input);
  addRowEl.appendChild(saveBtn);
  addRowEl.appendChild(cancelBtn);
  // lu√¥n ƒë·ªÉ form ·ªü cu·ªëi list
  if (profileList.classList.contains('empty-state-box')) {
    profileList.classList.remove('empty-state-box');
    profileList.innerHTML = '';
  }
  profileList.appendChild(addRowEl);
  input.focus();
}

if (saveApiKeyBtn) {
  saveApiKeyBtn.addEventListener('click', () => {
    profileState.apiKey = (settingApiKeyInput?.value || '').trim();
    // L∆∞u local tr∆∞·ªõc ƒë·ªÉ kh√¥ng m·∫•t d·ªØ li·ªáu n·∫øu backend l·ªói
    saveProfileState();

    callBackend('/settings/api-key', {
      method: 'PUT',
      body: JSON.stringify({ api_key: profileState.apiKey }),
    })
      .then(() => showToast('ƒê√£ l∆∞u API Key', 'success'))
      .catch(() => {
        showToast('Kh√¥ng l∆∞u ƒë∆∞·ª£c API Key (ki·ªÉm tra FastAPI).', 'error');
      });
  });
}

if (addProfileRowBtn) {
  addProfileRowBtn.addEventListener('click', showAddProfileRow);
}

if (feedAccountSettingBtn) {
  feedAccountSettingBtn.addEventListener('click', () => {
    const selected = getSelectedProfileIds();
    if (selected.length === 0) {
      showToast('H√£y tick √≠t nh·∫•t 1 profile tr∆∞·ªõc.', 'error');
      try { switchTab('settings'); } catch (_) { }
      return;
    }
    if (!feedConfigPanel) {
      showToast('Thi·∫øu UI feedConfigPanel.', 'error');
      return;
    }
    // N·∫øu panel qu√©t b√†i vi·∫øt ƒëang m·ªü th√¨ t·∫Øt ƒëi ƒë·ªÉ kh·ªèi ch·ªìng UI
    if (scanConfigPanel) scanConfigPanel.style.display = 'none';
    // N·∫øu panel qu√©t theo group ƒëang m·ªü th√¨ t·∫Øt ƒëi ƒë·ªÉ kh·ªèi ch·ªìng UI
    if (groupScanPanel) groupScanPanel.style.display = 'none';
    feedConfigPanel.style.display = (feedConfigPanel.style.display === 'none' || !feedConfigPanel.style.display) ? 'block' : 'none';
  });
}

if (feedCancelBtn && feedConfigPanel) {
  feedCancelBtn.addEventListener('click', () => {
    feedConfigPanel.style.display = 'none';
  });
}

if (feedStartBtn) {
  feedStartBtn.addEventListener('click', async () => {
    const selected = Object.keys(profileState.selected || {}).filter((pid) => profileState.selected[pid]);
    if (selected.length === 0) {
      showToast('Ch·ªçn (tick) √≠t nh·∫•t 1 profile ƒë·ªÉ nu√¥i acc.', 'error');
      return;
    }

    const modeEl = document.querySelector('input[name="feedMode"]:checked');
    const mode = modeEl ? String(modeEl.value || 'feed') : 'feed';
    const text = String(feedTextInput?.value || '').trim();
    const runMinutes = parseInt(String(feedRunMinutesInput?.value || '30').trim(), 10);
    const restMinutes = parseInt(String(feedRestMinutesInput?.value || '0').trim(), 10);

    // Feed: cho ph√©p text r·ªóng (qu√©t theo keyword m·∫∑c ƒë·ªãnh). Search: b·∫Øt bu·ªôc c√≥ text.
    if (!text && mode === 'search') {
      showToast('Search c·∫ßn nh·∫≠p text.', 'error');
      return;
    }
    if (!runMinutes || runMinutes <= 0) {
      showToast('Ch·∫°y (ph√∫t) kh√¥ng h·ª£p l·ªá.', 'error');
      return;
    }
    if (!Number.isFinite(restMinutes) || restMinutes < 0) {
      showToast('Ngh·ªâ (ph√∫t) kh√¥ng h·ª£p l·ªá.', 'error');
      return;
    }

    setButtonLoading(feedStartBtn, true, 'ƒêang ch·∫°y...');
    setButtonLoading(feedAccountSettingBtn, true, 'ƒêang nu√¥i acc...');
    try {
      const res = await callBackend('/feed/start', {
        method: 'POST',
        body: JSON.stringify({
          profile_ids: selected,
          mode,
          text,
          run_minutes: runMinutes,
          rest_minutes: restMinutes,
        }),
      });
      const started = res && Array.isArray(res.started) ? res.started.length : 0;
      const skipped = res && Array.isArray(res.skipped) ? res.skipped.length : 0;
      const loopText = (restMinutes > 0) ? ` (loop: ${runMinutes}p / ngh·ªâ ${restMinutes}p)` : '';
      showToast(`ƒê√£ ch·∫°y nu√¥i acc (${mode})${loopText}: started=${started}, skipped=${skipped}`, 'success', 2600);
      if (feedConfigPanel) feedConfigPanel.style.display = 'none';

      // N·∫øu ch·∫°y v√≤ng l·∫∑p (restMinutes > 0) th√¨ coi nh∆∞ ch·∫°y li√™n t·ª•c -> kh√¥ng poll "ho√†n th√†nh"
      if (restMinutes <= 0) {
        if (feedPollTimer) clearInterval(feedPollTimer);
        feedPollTimer = setInterval(async () => {
          try {
            const st = await callBackendNoAlert('/feed/status', { method: 'GET' });
            const running = (st && Array.isArray(st.running)) ? st.running : [];
            const still = selected.filter((pid) => running.includes(pid));
            if (still.length === 0) {
              clearInterval(feedPollTimer);
              feedPollTimer = null;
              setButtonLoading(feedStartBtn, false);
              setButtonLoading(feedAccountSettingBtn, false);
              showToast('‚úÖ Nu√¥i acc: Ho√†n th√†nh', 'success', 2000);
            }
          } catch (e) {
            clearInterval(feedPollTimer);
            feedPollTimer = null;
            setButtonLoading(feedStartBtn, false);
            setButtonLoading(feedAccountSettingBtn, false);
            showToast('Kh√¥ng l·∫•y ƒë∆∞·ª£c tr·∫°ng th√°i nu√¥i acc (ki·ªÉm tra FastAPI).', 'error');
          }
        }, 4000);
      }
    } catch (e) {
      setButtonLoading(feedStartBtn, false);
      setButtonLoading(feedAccountSettingBtn, false);
      showToast('Kh√¥ng ch·∫°y ƒë∆∞·ª£c nu√¥i acc (ki·ªÉm tra FastAPI).', 'error');
    }
  });
}

if (autoJoinGroupBtn) {
  autoJoinGroupBtn.addEventListener('click', async () => {
    const selected = Object.keys(profileState.selected || {}).filter((pid) => profileState.selected[pid]);
    if (selected.length === 0) {
      showToast('Ch·ªçn (tick) √≠t nh·∫•t 1 profile ƒë·ªÉ auto join group.', 'error');
      return;
    }

    // Spinner + th√¥ng b√°o
    setButtonLoading(autoJoinGroupBtn, true, 'ƒêang auto join...');
    try {
      const res = await callBackend('/groups/join', {
        method: 'POST',
        body: JSON.stringify({ profile_ids: selected }),
      });
      const started = res && Array.isArray(res.started) ? res.started.length : 0;
      const skipped = res && Array.isArray(res.skipped) ? res.skipped.length : 0;
      showToast(`ƒê√£ ch·∫°y auto join group: started=${started}, skipped=${skipped}`, 'success', 2200);

      // Poll ƒë·∫øn khi ho√†n t·∫•t (running kh√¥ng c√≤n c√°c profile ƒë√£ ch·ªçn)
      if (joinGroupPollTimer) clearInterval(joinGroupPollTimer);
      joinGroupPollTimer = setInterval(async () => {
        try {
          const st = await callBackendNoAlert('/groups/join/status', { method: 'GET' });
          const running = (st && Array.isArray(st.running)) ? st.running : [];
          const still = selected.filter((pid) => running.includes(pid));
          if (still.length === 0) {
            clearInterval(joinGroupPollTimer);
            joinGroupPollTimer = null;
            setButtonLoading(autoJoinGroupBtn, false);
            showToast('‚úÖ Auto join group: Ho√†n th√†nh', 'success', 2000);
          }
        } catch (e) {
          // N·∫øu l·ªói poll th√¨ d·ª´ng poll ƒë·ªÉ kh√¥ng spam
          clearInterval(joinGroupPollTimer);
          joinGroupPollTimer = null;
          setButtonLoading(autoJoinGroupBtn, false);
          showToast('Kh√¥ng l·∫•y ƒë∆∞·ª£c tr·∫°ng th√°i auto join (ki·ªÉm tra FastAPI).', 'error');
        }
      }, 4000);
    } catch (e) {
      showToast('Kh√¥ng ch·∫°y ƒë∆∞·ª£c auto join group (ki·ªÉm tra FastAPI).', 'error');
      setButtonLoading(autoJoinGroupBtn, false);
    }
  });
}

// N√∫t "Qu√©t b√†i vi·∫øt" trong tab Setting profile
if (scanPostsSettingBtn) {
  scanPostsSettingBtn.addEventListener('click', () => {
    const selected = getSelectedProfileIds();
    if (selected.length === 0) {
      showToast('H√£y tick √≠t nh·∫•t 1 profile tr∆∞·ªõc.', 'error');
      try { switchTab('settings'); } catch (_) { }
      return;
    }
    if (!scanConfigPanel) {
      showToast('Thi·∫øu UI scanConfigPanel.', 'error');
      return;
    }
    // ƒê√≥ng panel nu√¥i acc n·∫øu ƒëang m·ªü ƒë·ªÉ kh·ªèi r·ªëi
    if (feedConfigPanel) feedConfigPanel.style.display = 'none';
    // ƒê√≥ng panel qu√©t theo group n·∫øu ƒëang m·ªü
    if (groupScanPanel) groupScanPanel.style.display = 'none';
    const isOpen = scanConfigPanel.style.display !== 'none';
    scanConfigPanel.style.display = isOpen ? 'none' : 'block';
  });
}

if (scanCancelBtn && scanConfigPanel) {
  scanCancelBtn.addEventListener('click', () => {
    scanConfigPanel.style.display = 'none';
  });
}

// N√∫t "Qu√©t theo group" (UI only)
if (scanGroupSettingBtn) {
  scanGroupSettingBtn.addEventListener('click', () => {
    const selected = Object.keys(profileState.selected || {}).filter((pid) => profileState.selected[pid]);
    if (selected.length === 0) {
      showToast('Ch·ªçn (tick) √≠t nh·∫•t 1 profile tr∆∞·ªõc.', 'error');
      try { switchTab('settings'); } catch (_) { }
      return;
    }
    if (!groupScanPanel) {
      showToast('Thi·∫øu UI groupScanPanel.', 'error');
      return;
    }
    // ƒê√≥ng c√°c panel kh√°c ƒë·ªÉ kh·ªèi ch·ªìng UI
    if (feedConfigPanel) feedConfigPanel.style.display = 'none';
    if (scanConfigPanel) scanConfigPanel.style.display = 'none';

    const isOpen = groupScanPanel.style.display !== 'none';
    groupScanPanel.style.display = isOpen ? 'none' : 'block';
    if (!isOpen && groupScanUrlInput) groupScanUrlInput.focus();
  });
}

if (groupScanCancelBtn && groupScanPanel) {
  groupScanCancelBtn.addEventListener('click', () => {
    groupScanPanel.style.display = 'none';
  });
}

// UI only: b·∫•m "Ch·∫°y" th√¨ ch·ªâ validate + toast (ch∆∞a g·ªçi API)
if (groupScanStartBtn) {
  groupScanStartBtn.addEventListener('click', () => {
    const selected = Object.keys(profileState.selected || {}).filter((pid) => profileState.selected[pid]);
    if (selected.length === 0) {
      showToast('Ch·ªçn (tick) √≠t nh·∫•t 1 profile tr∆∞·ªõc.', 'error');
      return;
    }
    const raw = String(groupScanUrlInput?.value || '');
    const urls = raw
      .split(/\r?\n/)
      .map((s) => String(s || '').trim())
      .filter(Boolean);
    const postCount = parseInt(String(groupScanPostCountInput?.value || '0').trim(), 10);
    const startDate = String(groupScanStartDateInput?.value || '').trim();
    const endDate = String(groupScanEndDateInput?.value || '').trim();
    if (urls.length === 0) {
      showToast('Nh·∫≠p √≠t nh·∫•t 1 URL group (m·ªói d√≤ng 1 URL).', 'error');
      return;
    }
    if (!Number.isFinite(postCount) || postCount < 0) {
      showToast('S·ªë b√†i vi·∫øt theo d√µi kh√¥ng h·ª£p l·ªá.', 'error');
      return;
    }
    if (!startDate || !endDate) {
      showToast('Nh·∫≠p ƒë·ªß th·ªùi gian b·∫Øt ƒë·∫ßu v√† k·∫øt th√∫c.', 'error');
      return;
    }
    const startTs = Date.parse(startDate);
    const endTs = Date.parse(endDate);
    if (!Number.isFinite(startTs) || !Number.isFinite(endTs)) {
      showToast('Th·ªùi gian kh√¥ng h·ª£p l·ªá.', 'error');
      return;
    }
    if (startTs > endTs) {
      showToast('Th·ªùi gian b·∫Øt ƒë·∫ßu ph·∫£i ‚â§ th·ªùi gian k·∫øt th√∫c.', 'error');
      return;
    }

    showToast(
      `‚úÖ ƒê√£ nh·∫≠n ${urls.length} group URL, s·ªë b√†i: ${postCount}, t·ª´ ${startDate} ƒë·∫øn ${endDate}`,
      'success',
      2400
    );
  });
}

if (scanStartBtn) {
  scanStartBtn.addEventListener('click', async () => {
    // N·∫øu ƒëang qu√©t th√¨ kh√¥ng cho b·∫•m l·∫°i
    if (isScanning) {
      showToast('ƒêang qu√©t, vui l√≤ng ƒë·ª£i ho·∫∑c b·∫•m d·ª´ng tr∆∞·ªõc', 'warning');
      return;
    }
    
    // N·∫øu n√∫t ƒëang loading th√¨ kh√¥ng cho b·∫•m l·∫°i
    if (scanStartBtn.classList.contains('btn-loading')) {
      return;
    }
    
    const selected = Object.keys(profileState.selected || {}).filter((pid) => profileState.selected[pid]);
    if (selected.length === 0) {
      showToast('Ch·ªçn (tick) √≠t nh·∫•t 1 profile ƒë·ªÉ qu√©t b√†i vi·∫øt.', 'error');
      try { switchTab('settings'); } catch (_) { }
      return;
    }

    const runMinutes = parseInt(String(scanRunMinutesInput?.value || '0').trim(), 10);
    const restMinutes = parseInt(String(scanRestMinutesInput?.value || '0').trim(), 10);
    const text = String(scanTextInput?.value || '').trim();
    const mode = String(document.querySelector('input[name="scanMode"]:checked')?.value || 'feed').trim().toLowerCase();

    if (mode === 'search' && !text) {
      showToast('Search c·∫ßn nh·∫≠p text ƒë·ªÉ search.', 'error');
      return;
    }

    setButtonLoading(scanStartBtn, true, 'ƒêang ch·∫°y...');
    setButtonLoading(scanPostsSettingBtn, true, 'ƒêang qu√©t...');
    try {
      await startScanFlow({ runMinutes, restMinutes, text, mode });
      // ƒë√≥ng panel sau khi ch·∫°y
      if (scanConfigPanel) scanConfigPanel.style.display = 'none';
    } catch (e) {
      showToast('Kh√¥ng ch·∫°y ƒë∆∞·ª£c qu√©t b√†i vi·∫øt (ki·ªÉm tra FastAPI).', 'error');
      setButtonLoading(scanStartBtn, false);
      setButtonLoading(scanPostsSettingBtn, false);
      setScanning(false);
    }
    // Kh√¥ng reset loading ·ªü ƒë√¢y v√¨ setScanning(true) s·∫Ω gi·ªØ tr·∫°ng th√°i
  });
}

async function handleStopAll() {
  console.log('[UI] STOP ALL triggered');
  // Reset flag info collector n·∫øu ƒëang ch·∫°y
  isInfoCollectorRunning = false;
  // Reset loading c·ªßa c√°c n√∫t info collector
  if (runAllInfoBtn) setButtonLoading(runAllInfoBtn, false);
  if (runSelectedInfoBtn) setButtonLoading(runSelectedInfoBtn, false);
  // D·ª´ng poll ti·∫øn tr√¨nh
  if (infoProgressInterval) {
    clearInterval(infoProgressInterval);
    infoProgressInterval = null;
  }
  // ·∫®n container ti·∫øn tr√¨nh
  const container = document.getElementById('infoProgressContainer');
  if (container) container.style.display = 'none';
  // stop-all c√≥ th·ªÉ b·∫•m t·ª´ left panel ho·∫∑c t·ª´ setting header
  const btns = [stopAllBtn, stopAllSettingBtn].filter(Boolean);
  btns.forEach((b) => setButtonLoading(b, true, 'ƒêang d·ª´ng t·∫•t c·∫£...'));
  try {
    // ∆Øu ti√™n endpoint m·ªõi theo spec, fallback endpoint c≈© ƒë·ªÉ kh·ªèi v·ª° UI
    let res = null;
    try {
      res = await callBackend('/control/stop-all', { method: 'POST' });
    } catch (_) {
      res = await callBackend('/jobs/stop-all', { method: 'POST' }); // backward-compat
    }
    const botStopped = res && res.stopped ? Boolean(res.stopped.bot) : false;
    const joinStopped = res && res.stopped && Array.isArray(res.stopped.join_groups) ? res.stopped.join_groups.length : 0;
    const nstOk = res && Array.isArray(res.nst_stop_ok) ? res.nst_stop_ok.length : 0;
    const nstAttempted = res && Array.isArray(res.nst_stop_attempted) ? res.nst_stop_attempted.length : 0;
    const nstAll = res && typeof res.nst_stop_all_ok === 'boolean' ? res.nst_stop_all_ok : false;
    showToast(`ƒê√£ d·ª´ng t·∫•t c·∫£: bot=${botStopped ? 'OK' : 'NO'}, join_groups=${joinStopped}, NST=${nstOk}/${nstAttempted}${nstAll ? ' +ALL' : ''}`, 'success', 2800);
  } catch (e) {
    showToast('Kh√¥ng d·ª´ng ƒë∆∞·ª£c t·∫•t c·∫£ (ki·ªÉm tra FastAPI).', 'error');
  } finally {
    // Reset UI qu√©t (tr√°nh k·∫πt spinner n·∫øu user d·ª´ng b·∫±ng stop-all)
    if (timerId) {
      clearInterval(timerId);
      timerId = null;
    }
    if (dataCheckInterval) {
      clearInterval(dataCheckInterval);
      dataCheckInterval = null;
    }
    setScanning(false);
    setButtonLoading(scanStartBtn, false);
    setButtonLoading(scanPostsSettingBtn, false);
    setButtonLoading(stopBtn, false);

    btns.forEach((b) => setButtonLoading(b, false));
    if (joinGroupPollTimer) {
      clearInterval(joinGroupPollTimer);
      joinGroupPollTimer = null;
    }
    if (feedPollTimer) {
      clearInterval(feedPollTimer);
      feedPollTimer = null;
    }
    setButtonLoading(autoJoinGroupBtn, false);
    setButtonLoading(feedAccountSettingBtn, false);
    setButtonLoading(feedStartBtn, false);
    if (feedConfigPanel) feedConfigPanel.style.display = 'none';
  }
}

async function handleStopSelectedProfiles() {
  const selected = Object.keys(profileState.selected || {}).filter((pid) => profileState.selected[pid]);
  if (selected.length === 0) {
    showToast('Ch·ªçn (tick) √≠t nh·∫•t 1 profile ƒë·ªÉ d·ª´ng.', 'error');
    return;
  }
  if (!stopSelectedProfilesBtn) return;
  if (stopSelectedProfilesBtn.classList.contains('btn-loading')) return;

  // Reset flag info collector n·∫øu ƒëang ch·∫°y
  isInfoCollectorRunning = false;
  // Reset loading c·ªßa c√°c n√∫t info collector
  if (runAllInfoBtn) setButtonLoading(runAllInfoBtn, false);
  if (runSelectedInfoBtn) setButtonLoading(runSelectedInfoBtn, false);
  // D·ª´ng poll ti·∫øn tr√¨nh
  if (infoProgressInterval) {
    clearInterval(infoProgressInterval);
    infoProgressInterval = null;
  }
  // ·∫®n container ti·∫øn tr√¨nh
  const container = document.getElementById('infoProgressContainer');
  if (container) container.style.display = 'none';
  console.log(`[UI] STOP selected profiles=${selected.join(',')}`);
  setButtonLoading(stopSelectedProfilesBtn, true, 'ƒêang d·ª´ng...');

  try {
    const res = await callBackend('/control/stop-profiles', {
      method: 'POST',
      body: JSON.stringify({ profile_ids: selected }),
    });

    const okCount = res && Array.isArray(res.nst_ok) ? res.nst_ok.length : 0;
    const failCount = res && Array.isArray(res.nst_fail) ? res.nst_fail.length : 0;
    showToast(`ƒê√£ d·ª´ng ${selected.length} profile (NST ok=${okCount}, fail=${failCount})`, 'success', 2400);

    // Refresh state ƒë·ªÉ badge v·ªÅ S·∫¥N S√ÄNG ngay
    try {
      const jobs = await callBackendNoAlert('/jobs/status', { method: 'GET' });
      if (jobs) lastJobsStatus = jobs;
    } catch (_) { }
    try { await refreshControlState(); } catch (_) { }
    try { updateStopPauseButtonsByJobs(); } catch (_) { }
    // N·∫øu kh√¥ng c√≤n bot_profile_ids th√¨ UI qu√©t ph·∫£i v·ªÅ "S·∫µn s√†ng"
    try {
      const botHasProfiles = Array.isArray(lastJobsStatus && lastJobsStatus.bot_profile_ids) && lastJobsStatus.bot_profile_ids.length > 0;
      if (!botHasProfiles) {
        if (dataCheckInterval) { clearInterval(dataCheckInterval); dataCheckInterval = null; }
        setScanning(false);
        setButtonLoading(scanStartBtn, false);
        setButtonLoading(scanPostsSettingBtn, false);
      }
    } catch (_) { }
  } catch (e) {
    showToast('Kh√¥ng d·ª´ng ƒë∆∞·ª£c profile ƒë√£ ch·ªçn (ki·ªÉm tra FastAPI).', 'error');
  } finally {
    setButtonLoading(stopSelectedProfilesBtn, false);
  }
}

if (stopSelectedProfilesBtn) {
  stopSelectedProfilesBtn.addEventListener('click', handleStopSelectedProfiles);
}

async function handlePauseSelectedProfiles() {
  const selected = Object.keys(profileState.selected || {}).filter((pid) => profileState.selected[pid]);
  if (selected.length === 0) {
    showToast('Ch·ªçn (tick) √≠t nh·∫•t 1 profile ƒë·ªÉ pause.', 'error');
    return;
  }
  if (!pauseSelectedProfilesBtn) return;
  if (pauseSelectedProfilesBtn.classList.contains('btn-loading')) return;

  // Toggle: n·∫øu c√≥ √≠t nh·∫•t 1 profile ƒëang paused -> RESUME, ng∆∞·ª£c l·∫°i -> PAUSE
  const st0 = await callBackendNoAlert('/control/state', { method: 'GET' });
  const pausedSet = new Set(Array.isArray(st0 && st0.paused_profiles) ? st0.paused_profiles.map((x) => String(x)) : []);
  const anyPaused = selected.some((pid) => pausedSet.has(String(pid)));
  const action = anyPaused ? 'RESUME' : 'PAUSE';
  console.log(`[UI] ${action} selected profiles=${selected.join(',')}`);
  setButtonLoading(pauseSelectedProfilesBtn, true, anyPaused ? 'ƒêang ti·∫øp t·ª•c...' : 'ƒêang t·∫°m d·ª´ng...');
  try {
    const endpoint = anyPaused ? '/control/resume-profiles' : '/control/pause-profiles';
    await callBackend(endpoint, { method: 'POST', body: JSON.stringify({ profile_ids: selected }) });
    showToast(anyPaused ? `ƒê√£ ti·∫øp t·ª•c ${selected.length} profile` : `ƒê√£ t·∫°m d·ª´ng ${selected.length} profile`, 'success', 2200);
  } catch (e) {
    showToast('Kh√¥ng pause ƒë∆∞·ª£c profile ƒë√£ tick (ki·ªÉm tra FastAPI).', 'error');
  } finally {
    setButtonLoading(pauseSelectedProfilesBtn, false);
    try { await refreshControlState(); } catch (_) { }
  }
}

if (pauseSelectedProfilesBtn) {
  pauseSelectedProfilesBtn.addEventListener('click', handlePauseSelectedProfiles);
}

async function refreshControlState() {
  try {
    const st = await callBackendNoAlert('/control/state', { method: 'GET' });
    if (!st) return;
    isPausedAll = Boolean(st.global_pause);
    try { updateSettingsActionButtons(); } catch (_) { }
    try { syncRunningLabelsWithPauseState(); } catch (_) { }
    setPauseAllButtonLabel(isPausedAll);
    try { applyControlStateToProfileRows(st); } catch (_) { }
    try { updateStopPauseButtonsByJobs(); } catch (_) { }
    // Update label c·ªßa n√∫t pause-selected theo tr·∫°ng th√°i paused_profiles
    try {
      if (pauseSelectedProfilesBtn && !pauseSelectedProfilesBtn.classList.contains('btn-loading')) {
        const selected = getSelectedProfileIds();
        const pausedSet = new Set(Array.isArray(st.paused_profiles) ? st.paused_profiles.map((x) => String(x)) : []);
        const anyPaused = selected.some((pid) => pausedSet.has(String(pid)));
        pauseSelectedProfilesBtn.textContent = anyPaused ? 'Ti·∫øp t·ª•c profile ƒë√£ ch·ªçn' : 'T·∫°m d·ª´ng profile ƒë√£ ch·ªçn';
      }
    } catch (_) { }
  } catch (_) { }
}

function _clearIntervalSafe(kind) {
  try {
    if (kind === 'scan' && scanBackendPollTimer) clearInterval(scanBackendPollTimer);
    if (kind === 'join' && joinGroupPollTimer) clearInterval(joinGroupPollTimer);
    if (kind === 'feed' && feedPollTimer) clearInterval(feedPollTimer);
  } catch (_) { }
  if (kind === 'scan') scanBackendPollTimer = null;
  if (kind === 'join') joinGroupPollTimer = null;
  if (kind === 'feed') feedPollTimer = null;
}

function startScanBackendPoll({ silent = true } = {}) {
  _clearIntervalSafe('scan');
  scanBackendPollTimer = setInterval(async () => {
    const st = await callBackendNoAlert('/jobs/status', { method: 'GET' });
    if (st) lastJobsStatus = st;
    updateStopPauseButtonsByJobs();
    const botHasProfiles = Array.isArray(st && st.bot_profile_ids) && st.bot_profile_ids.length > 0;
    const running = !!(st && st.bot_running && botHasProfiles);
    if (!running) {
      _clearIntervalSafe('scan');
      if (dataCheckInterval) {
        clearInterval(dataCheckInterval);
        dataCheckInterval = null;
      }
      setScanning(false);
      setButtonLoading(scanStartBtn, false);
      setButtonLoading(scanPostsSettingBtn, false);
      if (!silent) showToast('‚úÖ Qu√©t: Ho√†n th√†nh', 'success', 1800);
    } else {
      syncRunningLabelsWithPauseState();
      try { refreshControlState(); } catch (_) { }
    }
  }, 4000);
}

function startJoinBackendPoll({ silent = true } = {}) {
  _clearIntervalSafe('join');
  joinGroupPollTimer = setInterval(async () => {
    const st = await callBackendNoAlert('/jobs/status', { method: 'GET' });
    if (st) lastJobsStatus = st;
    updateStopPauseButtonsByJobs();
    const running = (st && Array.isArray(st.join_groups_running)) ? st.join_groups_running : [];
    if (running.length === 0) {
      _clearIntervalSafe('join');
      setButtonLoading(autoJoinGroupBtn, false);
      if (!silent) showToast('‚úÖ Auto join group: Ho√†n th√†nh', 'success', 1800);
    } else {
      syncRunningLabelsWithPauseState();
      try { refreshControlState(); } catch (_) { }
    }
  }, 4000);
}

function startFeedBackendPoll({ silent = true } = {}) {
  _clearIntervalSafe('feed');
  feedPollTimer = setInterval(async () => {
    const st = await callBackendNoAlert('/jobs/status', { method: 'GET' });
    if (st) lastJobsStatus = st;
    updateStopPauseButtonsByJobs();
    const running = (st && Array.isArray(st.feed_running)) ? st.feed_running : [];
    if (running.length === 0) {
      _clearIntervalSafe('feed');
      setButtonLoading(feedStartBtn, false);
      setButtonLoading(feedAccountSettingBtn, false);
      if (!silent) showToast('‚úÖ Nu√¥i acc: Ho√†n th√†nh', 'success', 1800);
    } else {
      syncRunningLabelsWithPauseState();
      try { refreshControlState(); } catch (_) { }
    }
  }, 4000);
}

async function resyncUiFromBackendAfterReload() {
  // Sync pause state tr∆∞·ªõc ƒë·ªÉ label chu·∫©n
  await refreshControlState();

  const jobs = await callBackendNoAlert('/jobs/status', { method: 'GET' });
  if (!jobs) return;
  lastJobsStatus = jobs;
  updateStopPauseButtonsByJobs();

  // --- Scan (AppRunner) ---
  if (jobs.bot_running) {
    setScanning(true);
    setButtonLoading(scanStartBtn, true, isPausedAll ? 'ƒêang t·∫°m d·ª´ng...' : 'ƒêang ch·∫°y...');
    setButtonLoading(scanPostsSettingBtn, true, isPausedAll ? 'ƒêang t·∫°m d·ª´ng...' : 'ƒêang qu√©t...');
    if (!dataCheckInterval) dataCheckInterval = setInterval(checkForNewData, 5000);
    startScanBackendPoll({ silent: true });
  } else {
    setScanning(false);
    setButtonLoading(scanStartBtn, false);
    setButtonLoading(scanPostsSettingBtn, false);
    _clearIntervalSafe('scan');
  }

  // --- Join groups ---
  const joinRunning = Array.isArray(jobs.join_groups_running) ? jobs.join_groups_running : [];
  if (joinRunning.length > 0) {
    setButtonLoading(autoJoinGroupBtn, true, isPausedAll ? 'ƒêang t·∫°m d·ª´ng...' : 'ƒêang auto join...');
    startJoinBackendPoll({ silent: true });
  } else {
    setButtonLoading(autoJoinGroupBtn, false);
    _clearIntervalSafe('join');
  }

  // --- Feed ---
  const feedRunning = Array.isArray(jobs.feed_running) ? jobs.feed_running : [];
  if (feedRunning.length > 0) {
    setButtonLoading(feedStartBtn, true, isPausedAll ? 'ƒêang t·∫°m d·ª´ng...' : 'ƒêang ch·∫°y...');
    setButtonLoading(feedAccountSettingBtn, true, isPausedAll ? 'ƒêang t·∫°m d·ª´ng...' : 'ƒêang nu√¥i acc...');
    startFeedBackendPoll({ silent: true });
  } else {
    setButtonLoading(feedStartBtn, false);
    setButtonLoading(feedAccountSettingBtn, false);
    _clearIntervalSafe('feed');
  }

  syncRunningLabelsWithPauseState();
  // Re-apply control state sau khi ƒë√£ c√≥ lastJobsStatus ƒë·ªÉ badge kh√¥ng b·ªã sai l√∫c v·ª´a v√†o trang
  try { await refreshControlState(); } catch (_) { }
}

async function handlePauseAllToggle() {
  if (!pauseAllBtn) return;
  if (pauseAllBtn.classList.contains('btn-loading')) return;
  try {
    if (!isPausedAll) {
      console.log('[UI] PAUSE ALL triggered');
      setButtonLoading(pauseAllBtn, true, 'ƒêang t·∫°m d·ª´ng...');
      // update UI ngay ƒë·ªÉ tr√°nh user th·∫•y "ƒëang qu√©t" khi ƒë√£ pause
      isPausedAll = true;
      syncRunningLabelsWithPauseState();
      await callBackend('/control/pause-all', { method: 'POST' });
      showToast('ƒê√£ t·∫°m d·ª´ng t·∫•t c·∫£', 'success');
    } else {
      console.log('[UI] RESUME ALL triggered');
      setButtonLoading(pauseAllBtn, true, 'ƒêang ti·∫øp t·ª•c...');
      isPausedAll = false;
      syncRunningLabelsWithPauseState();
      await callBackend('/control/resume-all', { method: 'POST' });
      showToast('ƒê√£ ti·∫øp t·ª•c t·∫•t c·∫£', 'success');
    }
  } catch (e) {
    showToast('Kh√¥ng pause/resume ƒë∆∞·ª£c (ki·ªÉm tra FastAPI).', 'error');
  } finally {
    setButtonLoading(pauseAllBtn, false);
    await refreshControlState();
  }
}

if (pauseAllBtn) {
  pauseAllBtn.addEventListener('click', handlePauseAllToggle);
}

if (stopAllBtn) {
  stopAllBtn.addEventListener('click', handleStopAll);
}

if (stopAllSettingBtn) {
  stopAllSettingBtn.addEventListener('click', handleStopAll);
}

function getTypeColorClass(type) {
  const typeLower = String(type).toLowerCase().trim();

  // Xanh cho: scan, success, ok, completed
  if (typeLower === 'type1' || typeLower === 'success' || typeLower === 'ok' || typeLower === 'completed') {
    return 'type-green';
  }

  // V√†ng cho: retry, warning, pending, processing
  if (typeLower === 'type2' || typeLower === 'warning' || typeLower === 'pending' || typeLower === 'processing') {
    return 'type-yellow';
  }

  // ƒê·ªè cho: error, fail, failed, cancel
  if (typeLower === 'type3' || typeLower === 'fail' || typeLower === 'failed' || typeLower === 'cancel') {
    return 'type-red';
  }

  // M·∫∑c ƒë·ªãnh: xanh
  return 'type-green';
}

// Map flag -> type cho qu·∫£n l√Ω post
function mapFlagToType(flag) {
  const f = String(flag || '').toLowerCase();
  if (f === 'xanh') return 'type1';
  if (f === 'v√†ng' || f === 'vang') return 'type2';
  if (f === 'ƒë·ªè' || f === 'do') return 'type3';
  return 'type1';
}

function appendRow({ id, userId, name, react, comment, time, type }) {
  const tr = document.createElement('tr');
  const typeColorClass = getTypeColorClass(type);
  // React: hi·ªÉn th·ªã d·∫•u t√≠ch n·∫øu c√≥, kh√¥ng th√¨ ƒë·ªÉ tr·ªëng
  const reactDisplay = react ? '‚úì' : '';
  // Link cho ID B√†i Post v√† ID User
  const postIdDisplay = id
    ? `<a href="https://fb.com/${id}" target="_blank" rel="noopener noreferrer" class="id-link">${id}</a>`
    : '';
  const userIdDisplay = userId
    ? `<a href="https://fb.com/${userId}" target="_blank" rel="noopener noreferrer" class="id-link">${userId}</a>`
    : '';
  // Comment: n·∫øu c√≥ comment th√¨ hi·ªÉn th·ªã icon con m·∫Øt, click m·ªõi xem n·ªôi dung
  const hasComment = !!comment;
  const commentDisplay = hasComment ? '<button class="comment-eye-btn" type="button" title="Xem comment">üëÅ</button>' : '';

  // L∆∞u timestamp ƒë·ªÉ s·∫Øp x·∫øp
  const timestamp = parseTime(time || '');
  tr.dataset.timestamp = timestamp;
  tr.dataset.hasReact = react ? 'true' : 'false';
  tr.dataset.hasComment = hasComment ? 'true' : 'false';

  tr.innerHTML = `
    <td>${postIdDisplay}</td>
    <td>${userIdDisplay}</td>
    <td>${name || ''}</td>
    <td>${reactDisplay}</td>
    <td>${commentDisplay}</td>
    <td>${time || ''}</td>
    <td class="type-cell ${typeColorClass}">${type || ''}</td>
  `;
  tr.style.opacity = '0';
  tr.style.transform = 'translateY(-10px)';
  tbody.appendChild(tr);

  // G·∫Øn d·ªØ li·ªáu comment v√† s·ª± ki·ªán click cho icon con m·∫Øt
  if (hasComment) {
    const commentCell = tr.children[4]; // c·ªôt Comment
    commentCell.dataset.comment = comment;
    commentCell.dataset.showingText = 'false'; // Tr·∫°ng th√°i: false = ƒëang hi·ªÉn th·ªã icon, true = ƒëang hi·ªÉn th·ªã text

    const eyeBtn = commentCell.querySelector('.comment-eye-btn');
    if (eyeBtn) {
      // H√†m toggle gi·ªØa icon v√† text
      const toggleComment = (e) => {
        if (e) e.stopPropagation();
        const text = commentCell.dataset.comment || '';
        if (!text) return;

        const isShowingText = commentCell.dataset.showingText === 'true';

        if (isShowingText) {
          // ƒêang hi·ªÉn th·ªã text ‚Üí chuy·ªÉn v·ªÅ icon
          commentCell.innerHTML = '<button class="comment-eye-btn" type="button" title="Xem comment">üëÅ</button>';
          commentCell.dataset.showingText = 'false';
          // G·∫Øn l·∫°i event listener cho icon m·ªõi
          const newEyeBtn = commentCell.querySelector('.comment-eye-btn');
          if (newEyeBtn) {
            newEyeBtn.addEventListener('click', toggleComment);
          }
        } else {
          // ƒêang hi·ªÉn th·ªã icon ‚Üí chuy·ªÉn sang text
          commentCell.innerHTML = `<span class="comment-text" style="cursor: pointer; color: var(--text-primary);">${text}</span>`;
          commentCell.dataset.showingText = 'true';
          // G·∫Øn event listener cho text ƒë·ªÉ click l·∫°i s·∫Ω hi·ªán icon
          const commentText = commentCell.querySelector('.comment-text');
          if (commentText) {
            commentText.addEventListener('click', toggleComment);
          }
        }
      };

      eyeBtn.addEventListener('click', toggleComment);
    }
  }

  // Animation
  setTimeout(() => {
    tr.style.transition = 'all 0.3s ease';
    tr.style.opacity = '1';
    tr.style.transform = 'translateY(0)';
  }, 10);

  emptyState.classList.remove('show');
  updateRowCount();
}

// Th√™m d√≤ng cho b·∫£ng Qu·∫£n l√Ω post
function appendPostRow(post) {
  if (!postTableBody) return;
  const type = mapFlagToType(post.flag);
  const typeClass = getTypeColorClass(type);
  const tr = document.createElement('tr');
  const postId = post.id || '';
  const text = post.text || '';

  const postLink = postId
    ? `<a href="https://fb.com/${postId}" target="_blank" rel="noopener noreferrer" class="id-link">${postId}</a>`
    : '';

  tr.innerHTML = `
    <td>${postLink}</td>
    <td>${text}</td>
    <td class="type-cell ${typeClass}">${type}</td>
  `;

  postTableBody.appendChild(tr);
}

function addGeneratedRow() {
  // T·∫°o type ng·∫´u nhi√™n ƒë·ªÉ c√≥ m√†u s·∫Øc ƒëa d·∫°ng
  const types = ['type1', 'type2', 'type3'];
  const randomType = types[Math.floor(Math.random() * types.length)];
  const names = ['Nguy·ªÖn VƒÉn A', 'Tr·∫ßn Th·ªã B', 'L√™ VƒÉn C', 'Ph·∫°m Th·ªã D', 'Ho√†ng VƒÉn E'];
  const randomName = names[Math.floor(Math.random() * names.length)];
  const comments = ['R·∫•t hay!', 'C·∫£m ∆°n b·∫°n', 'Tuy·ªát v·ªùi', 'ƒê·ªìng √Ω', ''];
  const randomComment = comments[Math.floor(Math.random() * comments.length)];

  appendRow({
    id: counter++,
    userId: `user_${Math.floor(Math.random() * 1000000)}`,
    name: randomName,
    react: Math.random() > 0.3, // 70% c√≥ react
    comment: randomComment,
    time: new Date().toLocaleTimeString('vi-VN'),
    type: randomType,
  });
}

// H√†m ki·ªÉm tra v√† th√™m d·ªØ li·ªáu m·ªõi
async function checkForNewData() {
  try {
    const res = await fetch('../backend/data/results/all_results_summary.json');
    if (!res.ok) throw new Error('Fetch failed');
    const data = await res.json();

    // L·∫•y t·∫•t c·∫£ posts t·ª´ results_by_file
    const allPosts = [];
    Object.values(data.results_by_file || {}).forEach(filePosts => {
      if (Array.isArray(filePosts)) {
        allPosts.push(...filePosts);
      }
    });

    let newCount = 0;
    // Ch·ªâ th√™m nh·ªØng user m·ªõi (g·ªôp c·∫£ react & comment)
    allPosts.forEach((post) => {
      const postId = post.post_id || '';
      if (!postId) return;

      // Map flag th√†nh type
      let type = 'type1';
      const flag = (post.flag || '').toLowerCase();
      if (flag === 'xanh') {
        type = 'type1';
      } else if (flag === 'v√†ng' || flag === 'vang') {
        type = 'type2';
      } else if (flag === 'ƒë·ªè' || flag === 'do') {
        type = 'type3';
      }

      // Th·ªùi gian m·∫∑c ƒë·ªãnh: comment m·ªõi nh·∫•t c·ªßa b√†i (n·∫øu c√≥)
      let defaultTime = new Date().toLocaleTimeString('vi-VN');
      if (post.comments && post.comments.length > 0) {
        const sortedAllComments = [...post.comments].sort((a, b) => {
          const timeA = new Date(a.created_time_vn || 0);
          const timeB = new Date(b.created_time_vn || 0);
          return timeB - timeA;
        });
        if (sortedAllComments[0] && sortedAllComments[0].created_time_vn) {
          defaultTime = sortedAllComments[0].created_time_vn;
        }
      }

      // Gom reactions theo userId
      const reactionsByUser = new Map();
      if (post.reactions && post.reactions.length > 0) {
        post.reactions.forEach((r) => {
          const uid = r && r.id ? String(r.id) : '';
          if (!uid) return;
          reactionsByUser.set(uid, r);
        });
      }

      // Gom comments theo userId (l·∫•y comment m·ªõi nh·∫•t c·ªßa t·ª´ng user)
      const commentsByUser = new Map();
      if (post.comments && post.comments.length > 0) {
        post.comments.forEach((c) => {
          const uid = c && c.id ? String(c.id) : '';
          if (!uid) return;
          const prev = commentsByUser.get(uid);
          if (!prev) {
            commentsByUser.set(uid, c);
          } else {
            const prevTime = new Date(prev.created_time_vn || 0);
            const curTime = new Date(c.created_time_vn || 0);
            if (curTime > prevTime) {
              commentsByUser.set(uid, c);
            }
          }
        });
      }

      // T·∫≠p t·∫•t c·∫£ user xu·∫•t hi·ªán ·ªü react ho·∫∑c comment
      const allUserIds = new Set([
        ...reactionsByUser.keys(),
        ...commentsByUser.keys(),
      ]);

      allUserIds.forEach((uid) => {
        const reaction = reactionsByUser.get(uid);
        const comment = commentsByUser.get(uid);

        const userId = uid;
        const name =
          (reaction && reaction.name) ||
          (comment && comment.name) ||
          '';

        const hasReact = !!reaction;
        const commentText = comment && comment.text ? comment.text : '';
        const time =
          (comment && comment.created_time_vn) ? comment.created_time_vn : defaultTime;

        const uniqueKey = `${postId}_${userId}`;
        if (uniqueKey && !loadedPostIds.has(uniqueKey)) {
          appendRow({
            id: postId,
            userId: userId,
            name: name,
            react: hasReact,        // ch·ªâ tick n·∫øu c√≥ trong reactions
            comment: commentText,   // ch·ªâ c√≥ text n·∫øu user c√≥ comment
            time: time,
            type: type,
          });

          loadedPostIds.add(uniqueKey);
          newCount++;
        }
      });
    });

    if (newCount > 0) {
      console.log(`ƒê√£ th√™m ${newCount} d√≤ng d·ªØ li·ªáu m·ªõi`);
    }
  } catch (err) {
    console.error('Kh√¥ng ki·ªÉm tra ƒë∆∞·ª£c d·ªØ li·ªáu m·ªõi:', err);
  }
}

async function loadInitialData() {
  // Reset ƒë·ªÉ c√≥ th·ªÉ load l·∫°i khi click
  initialLoaded = false;
  // X√≥a d·ªØ li·ªáu c≈© tr∆∞·ªõc khi load m·ªõi
  tbody.innerHTML = '';
  counter = 1;
  loadedPostIds.clear(); // X√≥a danh s√°ch post_id ƒë√£ load

  try {
    // ƒê·ªçc t·ª´ all_results_summary.json
    const res = await fetch('../backend/data/results/all_results_summary.json');
    if (!res.ok) {
      throw new Error(`HTTP error! status: ${res.status}`);
    }
    const data = await res.json();
    console.log('ƒê√£ load file JSON th√†nh c√¥ng, t·ªïng s·ªë files:', data.total_files);

    // L·∫•y t·∫•t c·∫£ posts t·ª´ results_by_file
    const allPosts = [];
    Object.values(data.results_by_file || {}).forEach(filePosts => {
      if (Array.isArray(filePosts)) {
        allPosts.push(...filePosts);
      }
    });

    console.log(`T·ªïng s·ªë posts c·∫ßn hi·ªÉn th·ªã: ${allPosts.length}`);

    // Chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu sang format c·ªßa b·∫£ng
    let displayedCount = 0;
    allPosts.forEach((post) => {
      const postId = post.post_id || '';
      if (!postId) return; // B·ªè qua n·∫øu kh√¥ng c√≥ post_id

      // Map flag th√†nh type (xanh -> type1, v√†ng -> type2, ƒë·ªè -> type3)
      let type = 'type1'; // m·∫∑c ƒë·ªãnh
      const flag = (post.flag || '').toLowerCase();
      if (flag === 'xanh') {
        type = 'type1';
      } else if (flag === 'v√†ng' || flag === 'vang') {
        type = 'type2';
      } else if (flag === 'ƒë·ªè' || flag === 'do') {
        type = 'type3';
      }

      // Th·ªùi gian m·∫∑c ƒë·ªãnh: comment m·ªõi nh·∫•t c·ªßa b√†i (n·∫øu c√≥)
      let defaultTime = new Date().toLocaleTimeString('vi-VN');
      if (post.comments && post.comments.length > 0) {
        const sortedAllComments = [...post.comments].sort((a, b) => {
          const timeA = new Date(a.created_time_vn || 0);
          const timeB = new Date(b.created_time_vn || 0);
          return timeB - timeA;
        });
        if (sortedAllComments[0] && sortedAllComments[0].created_time_vn) {
          defaultTime = sortedAllComments[0].created_time_vn;
        }
      }

      // Gom reactions theo userId
      const reactionsByUser = new Map();
      if (post.reactions && post.reactions.length > 0) {
        post.reactions.forEach((r) => {
          const uid = r && r.id ? String(r.id) : '';
          if (!uid) return;
          reactionsByUser.set(uid, r);
        });
      }

      // Gom comments theo userId (l·∫•y comment m·ªõi nh·∫•t c·ªßa t·ª´ng user)
      const commentsByUser = new Map();
      if (post.comments && post.comments.length > 0) {
        post.comments.forEach((c) => {
          const uid = c && c.id ? String(c.id) : '';
          if (!uid) return;
          const prev = commentsByUser.get(uid);
          if (!prev) {
            commentsByUser.set(uid, c);
          } else {
            const prevTime = new Date(prev.created_time_vn || 0);
            const curTime = new Date(c.created_time_vn || 0);
            if (curTime > prevTime) {
              commentsByUser.set(uid, c);
            }
          }
        });
      }

      // T·∫≠p t·∫•t c·∫£ user xu·∫•t hi·ªán ·ªü react ho·∫∑c comment
      const allUserIds = new Set([
        ...reactionsByUser.keys(),
        ...commentsByUser.keys(),
      ]);

      allUserIds.forEach((uid) => {
        const reaction = reactionsByUser.get(uid);
        const comment = commentsByUser.get(uid);

        const userId = uid;
        const name =
          (reaction && reaction.name) ||
          (comment && comment.name) ||
          '';

        const hasReact = !!reaction;
        const commentText = comment && comment.text ? comment.text : '';
        const time =
          (comment && comment.created_time_vn) ? comment.created_time_vn : defaultTime;

        const uniqueKey = `${postId}_${userId}`; // T·∫°o key duy nh·∫•t cho m·ªói c·∫∑p post-user
        if (uniqueKey && !loadedPostIds.has(uniqueKey)) {
          appendRow({
            id: postId,
            userId: userId,
            name: name,
            react: hasReact,        // ch·ªâ t√≠ch n·∫øu user c√≥ react
            comment: commentText,   // ch·ªâ c√≥ text n·∫øu user c√≥ comment
            time: time,
            type: type,
          });

          // ƒê√°nh d·∫•u ƒë√£ load
          loadedPostIds.add(uniqueKey);
          displayedCount++;
        }
      });
    });

    console.log(`ƒê√£ hi·ªÉn th·ªã ${displayedCount} d√≤ng d·ªØ li·ªáu`);
    initialLoaded = true;
  } catch (err) {
    console.error('Kh√¥ng t·∫£i ƒë∆∞·ª£c all_results_summary.json', err);
    // Fallback: th·ª≠ load data.json c≈©
    try {
      const res = await fetch('data.json');
      if (res.ok) {
        const rows = await res.json();
        rows.forEach((row) => {
          appendRow(row);
          counter = Math.max(counter, Number(row.id) + 1);
        });
        initialLoaded = true;
      }
    } catch (fallbackErr) {
      console.error('Kh√¥ng t·∫£i ƒë∆∞·ª£c data.json', fallbackErr);
    }
  }

  // Show empty state if no rows
  if (tbody.children.length === 0) {
    emptyState.classList.add('show');
  }
}

// Start qu√©t b√†i vi·∫øt (d√πng chung cho n√∫t "B·∫Øt ƒë·∫ßu qu√©t" v√† n√∫t trong tab Setting profile)
async function startScanFlow(options = {}) {
  // N·∫øu ƒëang qu√©t th√¨ kh√¥ng cho ch·∫°y l·∫°i
  if (isScanning) {
    showToast('ƒêang qu√©t, vui l√≤ng ƒë·ª£i ho·∫∑c b·∫•m d·ª´ng tr∆∞·ªõc', 'warning');
    return;
  }
  
  const {
    runMinutes,
    restMinutes,
    text,
    mode,
  } = options || {};
  
  try {
    // Load v√† hi·ªÉn th·ªã t·∫•t c·∫£ d·ªØ li·ªáu t·ª´ all_results_summary.json ngay l·∫≠p t·ª©c
    // Kh√¥ng c·∫ßn ch·ªù backend, hi·ªÉn th·ªã d·ªØ li·ªáu tr∆∞·ªõc
    await loadInitialData();

    // N·∫øu ƒëang c√≥ interval check data c≈© th√¨ clear tr∆∞·ªõc ƒë·ªÉ tr√°nh setInterval ch·ªìng
    if (dataCheckInterval) {
      clearInterval(dataCheckInterval);
      dataCheckInterval = null;
    }

    // Sau ƒë√≥ m·ªõi ch·∫°y backend (n·∫øu c·∫ßn)
    const ok = await triggerBackendRun({ runMinutes, restMinutes, text, mode });
    if (!ok) {
      setScanning(false);
      return;
    }

    // T·ª± ƒë·ªông ki·ªÉm tra d·ªØ li·ªáu m·ªõi m·ªói 5 gi√¢y ƒë·ªÉ c·∫≠p nh·∫≠t khi c√≥ d·ªØ li·ªáu m·ªõi
    const checkInterval = 5000; // 5 gi√¢y
    dataCheckInterval = setInterval(checkForNewData, checkInterval);

    setScanning(true);
    
    // B·∫Øt ƒë·∫ßu poll s·ªë b√†i ƒë√£ qu√©t ƒë∆∞·ª£c
    if (scanStatsInterval) clearInterval(scanStatsInterval);
    updateScanStats(); // C·∫≠p nh·∫≠t ngay l·∫≠p t·ª©c
    scanStatsInterval = setInterval(updateScanStats, 3000); // Poll m·ªói 3 gi√¢y
    
    // Poll /jobs/status ƒë·ªÉ sync UI n√∫t d·ª´ng/t·∫°m d·ª´ng + t·ª± t·∫Øt khi backend d·ª´ng
    try { startScanBackendPoll({ silent: true }); } catch (_) { }
    try { updateStopPauseButtonsByJobs(); } catch (_) { }
    try { await refreshControlState(); } catch (_) { }
  } catch (err) {
    console.error('L·ªói trong startScanFlow:', err);
    setScanning(false);
    throw err;
  }
}

startBtn.addEventListener(
  'click',
  async () => {
    // N·∫øu ƒëang qu√©t th√¨ kh√¥ng cho b·∫•m l·∫°i
    if (isScanning) {
      showToast('ƒêang qu√©t, vui l√≤ng ƒë·ª£i ho·∫∑c b·∫•m d·ª´ng tr∆∞·ªõc', 'warning');
      return;
    }
    
    // N·∫øu n√∫t ƒëang loading th√¨ kh√¥ng cho b·∫•m l·∫°i
    if (startBtn.classList.contains('btn-loading')) {
      return;
    }
    
    try {
      await startScanFlow();
    } catch (err) {
      console.warn('Kh√¥ng startScanFlow ƒë∆∞·ª£c:', err);
      showToast('Kh√¥ng th·ªÉ kh·ªüi ƒë·ªông qu√©t', 'error');
      setScanning(false);
    }
  }
);

stopBtn.addEventListener('click', async () => {
  // N·∫øu ƒëang d·ª´ng r·ªìi th√¨ kh√¥ng l√†m g√¨
  if (stopBtn.classList.contains('btn-loading')) {
    return;
  }
  
  // Th√™m loading state cho n√∫t d·ª´ng
  setButtonLoading(stopBtn, true, 'ƒêang d·ª´ng...');
  
  try {
    // D·ª´ng t·∫•t c·∫£ intervals v√† timers
    if (timerId) {
      clearInterval(timerId);
      timerId = null;
    }
    // D·ª´ng ki·ªÉm tra d·ªØ li·ªáu m·ªõi
    if (dataCheckInterval) {
      clearInterval(dataCheckInterval);
      dataCheckInterval = null;
    }

    // Reset UI NGAY L·∫¨P T·ª®C ƒë·ªÉ user b·∫•m l·∫°i ƒë∆∞·ª£c (kh√¥ng ch·ªù backend)
    setScanning(false);
    setButtonLoading(scanStartBtn, false);
    setButtonLoading(scanPostsSettingBtn, false);

    // G·ª≠i l·ªánh d·ª´ng backend (c√≥ th·ªÉ ch·∫≠m/timeout, nh∆∞ng UI kh√¥ng b·ªã k·∫πt)
    await sendStopSignal();
    
    showToast('ƒê√£ d·ª´ng qu√©t', 'success');
  } catch (err) {
    console.warn('L·ªói khi d·ª´ng:', err);
    showToast('C√≥ l·ªói khi d·ª´ng qu√©t', 'error');
  } finally {
    // B·ªè loading state c·ªßa n√∫t d·ª´ng
    setButtonLoading(stopBtn, false);
  }
});

// Xu·∫•t file Excel
const exportExcelBtn = document.getElementById('exportExcelBtn');

function exportToExcel() {
  const table = document.getElementById('listTable');
  const rows = table.querySelectorAll('tr');

  if (rows.length <= 1) {
    alert('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t!');
    return;
  }

  // T·∫°o d·ªØ li·ªáu cho Excel
  const data = [];

  // Th√™m header
  const headerRow = [];
  table.querySelectorAll('thead th').forEach(th => {
    headerRow.push(th.textContent);
  });
  data.push(headerRow);

  // Th√™m d·ªØ li·ªáu
  table.querySelectorAll('tbody tr').forEach(tr => {
    const row = [];
    tr.querySelectorAll('td').forEach(td => {
      row.push(td.textContent);
    });
    data.push(row);
  });

  // T·∫°o workbook v√† worksheet
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.aoa_to_sheet(data);

  // ƒê·∫∑t ƒë·ªô r·ªông c·ªôt
  ws['!cols'] = [
    { wch: 18 }, // ID B√†i Post
    { wch: 18 }, // ID User
    { wch: 20 }, // Name
    { wch: 12 }, // React
    { wch: 12 }, // Comment
    { wch: 20 }, // Time
    { wch: 15 }  // Type
  ];

  // Th√™m worksheet v√†o workbook
  XLSX.utils.book_append_sheet(wb, ws, 'Danh s√°ch qu√©t');

  // T·∫°o t√™n file v·ªõi timestamp
  const now = new Date();
  const timestamp = now.toISOString().slice(0, 19).replace(/:/g, '-');
  const filename = `danh_sach_quet_${timestamp}.xlsx`;

  // Xu·∫•t file
  XLSX.writeFile(wb, filename);

  // Hi·ªÉn th·ªã th√¥ng b√°o
  const btnText = exportExcelBtn.querySelector('span:last-child');
  const originalText = btnText.textContent;
  btnText.textContent = 'ƒê√£ xu·∫•t!';
  exportExcelBtn.disabled = true;

  setTimeout(() => {
    btnText.textContent = originalText;
    exportExcelBtn.disabled = false;
  }, 2000);
}

exportExcelBtn.addEventListener('click', exportToExcel);

// ==== FastAPI integration ====

function setBackendStatus(message, isOnline = false) {
  backendStatus.textContent = message;
  statusDot.classList.toggle('online', isOnline);
}

async function callBackend(path, options = {}) {
  const url = `${API_BASE}${path}`;
  const method = (options.method || 'POST').toUpperCase();
  const headers = { ...(options.headers || {}) };
  // Ch·ªâ set Content-Type khi c√≥ body => tr√°nh preflight OPTIONS spam cho GET /status
  if (options.body != null && !headers['Content-Type']) {
    headers['Content-Type'] = 'application/json';
  }

  const res = await fetch(url, {
    method,
    headers,
    ...options,
  });

  let data = {};
  try {
    data = await res.json();
  } catch (e) {
    // ignore parse errors, will throw below if not ok
  }

  if (!res.ok) {
    let detail = data.detail || res.statusText || 'Request failed';
    // N·∫øu backend tr·∫£ detail d·∫°ng object (vd: {message, missing:[...]}) th√¨ format l·∫°i cho d·ªÖ ƒë·ªçc
    try {
      if (detail && typeof detail === 'object') {
        const msg = detail.message ? String(detail.message) : 'Request failed';
        const missing = Array.isArray(detail.missing) ? detail.missing : [];
        if (missing.length > 0) {
          const lines = missing.map((x) => {
            const pid = (x && x.profile_id) ? String(x.profile_id) : '(unknown)';
            const fields = Array.isArray(x && x.missing) ? x.missing.join(', ') : '';
            return `${pid}${fields ? ` thi·∫øu: ${fields}` : ''}`;
          });
          detail = `${msg} ${lines.join(' | ')}`;
        } else {
          detail = msg;
        }
      }
    } catch (_) { }
    throw new Error(String(detail));
  }

  return data;
}

async function callBackendNoAlert(path, options = {}) {
  try {
    return await callBackend(path, options);
  } catch (e) {
    return null;
  }
}

async function triggerBackendRun(options = {}) {
  setBackendStatus('ƒêang g·ª≠i l·ªánh ch·∫°y...', false);
  try {
    // B·∫Øt bu·ªôc ph·∫£i ch·ªçn (tick) profile tr∆∞·ªõc khi ch·∫°y backend
    const selected = Object.keys(profileState.selected || {}).filter((pid) => profileState.selected[pid]);
    if (selected.length === 0) {
      showToast('H√£y tick √≠t nh·∫•t 1 profile ·ªü tab "Setting profile" tr∆∞·ªõc khi ch·∫°y.', 'error');
      try { switchTab('settings'); } catch (_) { }
      return false;
    }

    const runMinutes = (options.runMinutes != null) ? Number(options.runMinutes) : Number(runMinutesInput.value);
    // D√πng lu√¥n "Th·ªùi gian l·∫∑p l·∫°i (ph√∫t)" l√†m th·ªùi gian ngh·ªâ gi·ªØa phi√™n (n·∫øu kh√¥ng truy·ªÅn override)
    const restMinutes = (options.restMinutes != null) ? Number(options.restMinutes) : Number(intervalInput.value);
    const text = (options.text != null) ? String(options.text || '').trim() : '';
    const mode = (options.mode != null) ? String(options.mode || '').trim().toLowerCase() : '';
    const payload = {};
    if (Number.isFinite(runMinutes) && runMinutes > 0) {
      payload.run_minutes = runMinutes;
    }
    if (Number.isFinite(restMinutes) && restMinutes > 0) {
      payload.rest_minutes = restMinutes;
    }
    payload.profile_ids = selected;
    if (text) payload.text = text;
    if (mode) payload.mode = mode;

    const data = await callBackend('/run', {
      body: JSON.stringify(payload),
    });
    const pidText = data.pid ? ` (PID ${data.pid})` : '';

    // X√°c nh·∫≠n backend th·∫≠t s·ª± ƒëang ch·∫°y (tr√°nh UI b√°o "ƒêang qu√©t" nh∆∞ng runner ƒë√£ tho√°t)
    const deadline = Date.now() + 2500;
    let jobs = null;
    while (Date.now() < deadline) {
      jobs = await callBackendNoAlert('/jobs/status', { method: 'GET' });
      if (jobs && jobs.bot_running) break;
      await new Promise((r) => setTimeout(r, 200));
    }
    if (jobs) lastJobsStatus = jobs;
    try { updateStopPauseButtonsByJobs(); } catch (_) { }

    if (!(jobs && jobs.bot_running)) {
      setBackendStatus(`Backend ch∆∞a ch·∫°y bot${pidText}`, false);
      showToast('Backend ch∆∞a ch·∫°y ƒë∆∞·ª£c bot (runner kh√¥ng alive).', 'error', 2200);
      return false;
    }

    setBackendStatus(`Bot ƒëang ch·∫°y${pidText}`, true);
    return true;
  } catch (err) {
    console.error(err);
    alert('Kh√¥ng g·ªçi ƒë∆∞·ª£c backend. H√£y ki·ªÉm tra FastAPI ƒë√£ ch·∫°y ch∆∞a.');
    setBackendStatus('Backend l·ªói ho·∫∑c ch∆∞a kh·ªüi ƒë·ªông', false);
    return false;
  } finally {
  }
}

async function sendStopSignal() {
  try {
    console.log('[UI] STOP triggered');
    // /stop ƒë√£ ƒë∆∞·ª£c backend map sang STOP (GLOBAL_EMERGENCY_STOP + ƒë√≥ng NST best-effort)
    await callBackend('/stop');
    setBackendStatus('ƒê√£ g·ª≠i l·ªánh d·ª´ng backend', false);
  } catch (err) {
    console.warn('Kh√¥ng d·ª´ng ƒë∆∞·ª£c backend:', err);
    setBackendStatus('Backend c√≥ th·ªÉ v·∫´n ƒëang ch·∫°y', false);
  }
}

// Th·ª≠ ki·ªÉm tra tr·∫°ng th√°i backend khi t·∫£i trang
fetch(`${API_BASE}/status`)
  .then((res) => res.json())
  .then((data) => {
    const running = Boolean(data.running);
    setBackendStatus(running ? 'Backend ƒëang ch·∫°y' : 'Backend ch∆∞a ch·∫°y', running);
  })
  .catch(() => {
    setBackendStatus('Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c FastAPI', false);
  });

// ==== Th√™m data nh√≥m - M·ªü file t·ª´ m√°y t√≠nh ====

const addGroupDataBtn = document.getElementById('addGroupDataBtn');

// H√†m x·ª≠ l√Ω n√∫t Th√™m data nh√≥m - ch·ªâ m·ªü dialog ch·ªçn file
function handleAddGroupData() {
  // T·∫°o input file ·∫©n
  const fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.accept = '.json,.xlsx,.xls,.txt,.csv';
  fileInput.style.display = 'none';

  fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      console.log('File ƒë√£ ch·ªçn:', file.name);
      // Ch·ªâ m·ªü file, kh√¥ng x·ª≠ l√Ω g√¨ th√™m
    }
    // X√≥a input ƒë·ªÉ c√≥ th·ªÉ ch·ªçn l·∫°i file c√πng t√™n
    fileInput.value = '';
  });

  // Trigger click ƒë·ªÉ m·ªü dialog ch·ªçn file
  document.body.appendChild(fileInput);
  fileInput.click();
  document.body.removeChild(fileInput);
}



// ==== Help Button v·ªõi Tooltip ====

const helpBtn = document.getElementById('helpBtn');
const helpTooltip = document.getElementById('helpTooltip');
const tooltipClose = document.querySelector('.tooltip-close');

function toggleHelpTooltip() {
  helpTooltip.classList.toggle('show');
}

function closeHelpTooltip() {
  helpTooltip.classList.remove('show');
}

helpBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  toggleHelpTooltip();
});

tooltipClose.addEventListener('click', closeHelpTooltip);

// ƒê√≥ng tooltip khi click ra ngo√†i
document.addEventListener('click', (e) => {
  if (!helpBtn.contains(e.target) && !helpTooltip.contains(e.target)) {
    closeHelpTooltip();
  }
});
// ==== B·ªô l·ªçc m√†u s·∫Øc, React, Comment v√† S·∫Øp x·∫øp ====

const filterButtons = document.querySelectorAll('.filter-btn[data-filter]');
const reactFilterButtons = document.querySelectorAll('.filter-btn[data-filter-react]');
const commentFilterButtons = document.querySelectorAll('.filter-btn[data-filter-comment]');
const timeFilterFrom = document.getElementById('timeFilterFrom');
const timeFilterTo = document.getElementById('timeFilterTo');
const applyTimeFilterBtn = document.getElementById('applyTimeFilterBtn');
const clearTimeFilterBtn = document.getElementById('clearTimeFilterBtn');

// S·ª≠ d·ª•ng Set ƒë·ªÉ l∆∞u c√°c filter ƒë√£ ch·ªçn (cho ph√©p nhi·ªÅu l·ª±a ch·ªçn)
let selectedTypeFilters = new Set(['all']);
let selectedReactFilters = new Set(); // Kh√¥ng c√≥ "all", r·ªóng = hi·ªÉn th·ªã t·∫•t c·∫£
let selectedCommentFilters = new Set(); // Kh√¥ng c√≥ "all", r·ªóng = hi·ªÉn th·ªã t·∫•t c·∫£
let timeFilterFromValue = null; // Th·ªùi gian b·∫Øt ƒë·∫ßu
let timeFilterToValue = null; // Th·ªùi gian k·∫øt th√∫c

function toggleTypeFilter(filterType) {
  if (filterType === 'all') {
    // N·∫øu click "T·∫•t c·∫£", b·ªè ch·ªçn t·∫•t c·∫£ v√† ch·ªâ ch·ªçn "T·∫•t c·∫£"
    selectedTypeFilters.clear();
    selectedTypeFilters.add('all');
  } else {
    // B·ªè "all" n·∫øu ch·ªçn filter c·ª• th·ªÉ
    selectedTypeFilters.delete('all');

    // Toggle filter
    if (selectedTypeFilters.has(filterType)) {
      selectedTypeFilters.delete(filterType);
    } else {
      selectedTypeFilters.add(filterType);
    }

    // N·∫øu kh√¥ng c√≤n filter n√†o ƒë∆∞·ª£c ch·ªçn, t·ª± ƒë·ªông ch·ªçn "all"
    if (selectedTypeFilters.size === 0) {
      selectedTypeFilters.add('all');
    }
  }
  applyAllFilters();
}

function toggleReactFilter(reactFilter) {
  // Toggle filter (kh√¥ng c√≥ "all" n·ªØa)
  if (selectedReactFilters.has(reactFilter)) {
    selectedReactFilters.delete(reactFilter);
  } else {
    selectedReactFilters.add(reactFilter);
  }
  applyAllFilters();
}

function toggleCommentFilter(commentFilter) {
  // Toggle filter (kh√¥ng c√≥ "all" n·ªØa)
  if (selectedCommentFilters.has(commentFilter)) {
    selectedCommentFilters.delete(commentFilter);
  } else {
    selectedCommentFilters.add(commentFilter);
  }
  applyAllFilters();
}

function applyAllFilters() {
  const rows = tbody.querySelectorAll('tr');

  rows.forEach((row) => {
    let shouldShow = true;

    // Filter theo m√†u (Type) - c√≥ th·ªÉ ch·ªçn nhi·ªÅu
    if (!selectedTypeFilters.has('all')) {
      const typeCell = row.querySelector('.type-cell');
      let matchesType = false;

      selectedTypeFilters.forEach(filterType => {
        if (typeCell && typeCell.classList.contains(filterType)) {
          matchesType = true;
        }
      });

      if (!matchesType) {
        shouldShow = false;
      }
    }

    // Filter theo React - n·∫øu Set r·ªóng th√¨ hi·ªÉn th·ªã t·∫•t c·∫£
    if (shouldShow && selectedReactFilters.size > 0) {
      const reactCell = row.querySelector('td:nth-child(4)'); // C·ªôt React
      const hasReact = reactCell && reactCell.textContent.trim() === '‚úì';
      let matchesReact = false;

      selectedReactFilters.forEach(reactFilter => {
        if (reactFilter === 'has' && hasReact) {
          matchesReact = true;
        } else if (reactFilter === 'none' && !hasReact) {
          matchesReact = true;
        }
      });

      if (!matchesReact) {
        shouldShow = false;
      }
    }

    // Filter theo Comment - n·∫øu Set r·ªóng th√¨ hi·ªÉn th·ªã t·∫•t c·∫£
    if (shouldShow && selectedCommentFilters.size > 0) {
      const commentCell = row.querySelector('td:nth-child(5)'); // C·ªôt Comment
      const hasComment = commentCell && commentCell.querySelector('.comment-eye-btn');
      let matchesComment = false;

      selectedCommentFilters.forEach(commentFilter => {
        if (commentFilter === 'has' && hasComment) {
          matchesComment = true;
        } else if (commentFilter === 'none' && !hasComment) {
          matchesComment = true;
        }
      });

      if (!matchesComment) {
        shouldShow = false;
      }
    }

    // Filter theo th·ªùi gian
    if (shouldShow && (timeFilterFromValue || timeFilterToValue)) {
      const timeCell = row.querySelector('td:nth-child(6)'); // C·ªôt Time
      const timeStr = timeCell ? timeCell.textContent.trim() : '';

      if (timeStr) {
        // Parse timestamp t·ª´ row ho·∫∑c t·ª´ text
        let rowTimestamp = row.dataset.timestamp ? parseInt(row.dataset.timestamp) : 0;
        if (!rowTimestamp) {
          rowTimestamp = parseTime(timeStr);
          row.dataset.timestamp = rowTimestamp; // L∆∞u l·∫°i
        }

        // So s√°nh v·ªõi kho·∫£ng th·ªùi gian ƒë√£ ch·ªçn
        if (timeFilterFromValue && rowTimestamp < timeFilterFromValue) {
          shouldShow = false;
        }
        if (timeFilterToValue && rowTimestamp > timeFilterToValue) {
          shouldShow = false;
        }
      } else {
        // N·∫øu kh√¥ng c√≥ th·ªùi gian v√† c√≥ filter th·ªùi gian th√¨ ·∫©n
        shouldShow = false;
      }
    }

    if (shouldShow) {
      row.classList.remove('filtered-out');
    } else {
      row.classList.add('filtered-out');
    }
  });

  // C·∫≠p nh·∫≠t tr·∫°ng th√°i active c·ªßa c√°c n√∫t filter m√†u
  filterButtons.forEach((btn) => {
    const filterType = btn.dataset.filter;
    if (selectedTypeFilters.has(filterType)) {
      btn.classList.add('active');
    } else {
      btn.classList.remove('active');
    }
  });

  // C·∫≠p nh·∫≠t tr·∫°ng th√°i active c·ªßa c√°c n√∫t filter React
  reactFilterButtons.forEach((btn) => {
    const reactFilter = btn.dataset.filterReact;
    if (selectedReactFilters.has(reactFilter)) {
      btn.classList.add('active');
    } else {
      btn.classList.remove('active');
    }
  });

  // C·∫≠p nh·∫≠t tr·∫°ng th√°i active c·ªßa c√°c n√∫t filter Comment
  commentFilterButtons.forEach((btn) => {
    const commentFilter = btn.dataset.filterComment;
    if (selectedCommentFilters.has(commentFilter)) {
      btn.classList.add('active');
    } else {
      btn.classList.remove('active');
    }
  });

  // Ki·ªÉm tra empty state
  const visibleRows = Array.from(rows).filter(row => !row.classList.contains('filtered-out'));
  if (visibleRows.length === 0 && rows.length > 0) {
    emptyState.classList.add('show');
  } else {
    emptyState.classList.remove('show');
  }
}

// √Åp d·ª•ng filter theo th·ªùi gian
function applyTimeFilter() {
  const fromValue = timeFilterFrom ? timeFilterFrom.value : '';
  const toValue = timeFilterTo ? timeFilterTo.value : '';

  // Chuy·ªÉn ƒë·ªïi t·ª´ datetime-local format (YYYY-MM-DDTHH:mm) sang timestamp
  if (fromValue) {
    timeFilterFromValue = new Date(fromValue).getTime();
  } else {
    timeFilterFromValue = null;
  }

  if (toValue) {
    // Th√™m 1 ng√†y v√† tr·ª´ 1ms ƒë·ªÉ bao g·ªìm c·∫£ ng√†y cu·ªëi
    const toDate = new Date(toValue);
    toDate.setHours(23, 59, 59, 999);
    timeFilterToValue = toDate.getTime();
  } else {
    timeFilterToValue = null;
  }

  // √Åp d·ª•ng filter
  applyAllFilters();

  // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t
  if (applyTimeFilterBtn) {
    if (timeFilterFromValue || timeFilterToValue) {
      applyTimeFilterBtn.classList.add('active');
    } else {
      applyTimeFilterBtn.classList.remove('active');
    }
  }
}

// X√≥a filter th·ªùi gian
function clearTimeFilter() {
  if (timeFilterFrom) timeFilterFrom.value = '';
  if (timeFilterTo) timeFilterTo.value = '';
  timeFilterFromValue = null;
  timeFilterToValue = null;

  // √Åp d·ª•ng l·∫°i filter
  applyAllFilters();

  // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t
  if (applyTimeFilterBtn) {
    applyTimeFilterBtn.classList.remove('active');
  }
}

// H√†m parse time t·ª´ string sang Date object
function parseTime(timeStr) {
  if (!timeStr) return 0;

  // Th·ª≠ parse c√°c format th·ªùi gian ph·ªï bi·∫øn
  // Format: "HH:mm:ss" ho·∫∑c "HH:mm" ho·∫∑c "dd/MM/yyyy HH:mm:ss"
  const now = new Date();

  // N·∫øu c√≥ format ƒë·∫ßy ƒë·ªß v·ªõi ng√†y
  if (timeStr.includes('/')) {
    const parts = timeStr.split(' ');
    if (parts.length >= 2) {
      const datePart = parts[0].split('/');
      const timePart = parts[1].split(':');
      if (datePart.length === 3 && timePart.length >= 2) {
        const year = parseInt(datePart[2]);
        const month = parseInt(datePart[1]) - 1;
        const day = parseInt(datePart[0]);
        const hour = parseInt(timePart[0]);
        const minute = parseInt(timePart[1]);
        const second = timePart[2] ? parseInt(timePart[2]) : 0;
        return new Date(year, month, day, hour, minute, second).getTime();
      }
    }
  }

  // N·∫øu ch·ªâ c√≥ gi·ªù:ph√∫t:gi√¢y
  if (timeStr.includes(':')) {
    const parts = timeStr.split(':');
    if (parts.length >= 2) {
      const hour = parseInt(parts[0]) || 0;
      const minute = parseInt(parts[1]) || 0;
      const second = parts[2] ? parseInt(parts[2]) : 0;
      const date = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hour, minute, second);
      return date.getTime();
    }
  }

  // Fallback: th·ª≠ parse tr·ª±c ti·∫øp
  const parsed = Date.parse(timeStr);
  return isNaN(parsed) ? 0 : parsed;
}

// Kh·ªüi t·∫°o: set tr·∫°ng th√°i active cho c√°c n√∫t "T·∫•t c·∫£"
function initializeFilters() {
  applyAllFilters();
}

// Th√™m event listener cho c√°c n√∫t filter m√†u
filterButtons.forEach((btn) => {
  btn.addEventListener('click', () => {
    const filterType = btn.dataset.filter;
    if (filterType) {
      toggleTypeFilter(filterType);
    }
  });
});

// Th√™m event listener cho c√°c n√∫t filter React
reactFilterButtons.forEach((btn) => {
  btn.addEventListener('click', () => {
    const reactFilter = btn.dataset.filterReact;
    if (reactFilter) {
      toggleReactFilter(reactFilter);
    }
  });
});

// Th√™m event listener cho c√°c n√∫t filter Comment
commentFilterButtons.forEach((btn) => {
  btn.addEventListener('click', () => {
    const commentFilter = btn.dataset.filterComment;
    if (commentFilter) {
      toggleCommentFilter(commentFilter);
    }
  });
});

// Th√™m event listener cho filter th·ªùi gian
if (applyTimeFilterBtn) {
  applyTimeFilterBtn.addEventListener('click', () => {
    applyTimeFilter();
  });
}

if (clearTimeFilterBtn) {
  clearTimeFilterBtn.addEventListener('click', () => {
    clearTimeFilter();
  });
}

// Cho ph√©p √°p d·ª•ng filter khi nh·∫•n Enter trong input
if (timeFilterFrom) {
  timeFilterFrom.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      applyTimeFilter();
    }
  });
}

// Flag ƒë·ªÉ track khi ƒëang ch·∫°y info collector
let isInfoCollectorRunning = false;
let scanStatsInterval = null;
let infoProgressInterval = null;

// H√†m ƒë·ªÉ c·∫≠p nh·∫≠t s·ªë b√†i ƒë√£ qu√©t ƒë∆∞·ª£c
async function updateScanStats() {
  try {
    const res = await callBackendNoAlert('/info/scan-stats', { method: 'GET' });
    if (!res || !res.stats) return;
    
    const stats = res.stats;
    const container = document.getElementById('scanStatsContainer');
    const list = document.getElementById('scanStatsList');
    
    if (!container || !list) return;
    
    const selected = getSelectedProfileIds();
    if (selected.length === 0 && Object.keys(stats).length === 0) {
      container.style.display = 'none';
      return;
    }
    
    // Ch·ªâ hi·ªÉn th·ªã c√°c profile ƒë√£ ch·ªçn ho·∫∑c t·∫•t c·∫£ n·∫øu kh√¥ng c√≥ profile n√†o ƒë∆∞·ª£c ch·ªçn
    const profilesToShow = selected.length > 0 ? selected : Object.keys(stats);
    
    let html = '';
    for (const pid of profilesToShow) {
      const count = stats[pid] || 0;
      html += `<div style="margin: 4px 0; padding: 5px; background: white; border-radius: 3px;">
        <strong>${pid}</strong> ƒë√£ qu√©t ƒë∆∞·ª£c <strong>${count}</strong> b√†i
      </div>`;
    }
    
    if (html) {
      list.innerHTML = html;
      container.style.display = 'block';
    } else {
      container.style.display = 'none';
    }
  } catch (e) {
    // Ignore errors
  }
}

// H√†m ƒë·ªÉ c·∫≠p nh·∫≠t ti·∫øn tr√¨nh l·∫•y th√¥ng tin
async function updateInfoProgress() {
  try {
    const res = await callBackendNoAlert('/info/progress', { method: 'GET' });
    if (!res) return;
    
    const container = document.getElementById('infoProgressContainer');
    const text = document.getElementById('infoProgressText');
    
    if (!container || !text) return;
    
    if (res.is_running && res.total > 0) {
      const current = res.current || 0;
      const total = res.total || 0;
      const file = res.current_file || '';
      text.textContent = `ƒê√£ qu√©t ƒë∆∞·ª£c ${current}/${total} b√†i${file ? ` (${file})` : ''}`;
      container.style.display = 'block';
    } else {
      container.style.display = 'none';
    }
  } catch (e) {
    // Ignore errors
  }
}

async function runInfoCollector(mode = 'all') {
  const isSelected = mode === 'selected';
  const btn = isSelected ? runSelectedInfoBtn : runAllInfoBtn;
  const selected = getSelectedProfileIds();

  if (isSelected && selected.length === 0) {
    showToast('Ch·ªçn (tick) √≠t nh·∫•t 1 profile tr∆∞·ªõc.', 'error');
    try { switchTab('settings'); } catch (_) { }
    return;
  }

  // ƒê√°nh d·∫•u ƒëang ch·∫°y v√† enable c√°c n√∫t pause/d·ª´ng
  isInfoCollectorRunning = true;
  [pauseAllBtn, pauseSelectedProfilesBtn, stopAllSettingBtn, stopSelectedProfilesBtn].forEach((b) => {
    if (b) {
      b.disabled = false;
      b.style.opacity = '1';
      b.style.pointerEvents = 'auto';
      b.style.cursor = 'pointer';
    }
  });

  setButtonLoading(btn, true, 'ƒêang l·∫•y th√¥ng tin...');
  
  // B·∫Øt ƒë·∫ßu poll ti·∫øn tr√¨nh
  if (infoProgressInterval) clearInterval(infoProgressInterval);
  updateInfoProgress(); // C·∫≠p nh·∫≠t ngay l·∫≠p t·ª©c
  infoProgressInterval = setInterval(updateInfoProgress, 2000); // Poll m·ªói 2 gi√¢y
  
  try {
    const body = { mode: isSelected ? 'selected' : 'all' };
    if (isSelected) body.profiles = selected;
    const res = await callBackend('/info/run', {
      method: 'POST',
      body: JSON.stringify(body),
    });
    const summary = res && res.summary ? res.summary : null;
    const msgParts = [];
    msgParts.push(isSelected ? `ƒê√£ ch·∫°y cho ${body.profiles.length} profile` : 'ƒê√£ ch·∫°y l·∫•y th√¥ng tin to√†n b·ªô');
    if (summary && typeof summary.total_posts_processed === 'number') {
      msgParts.push(`posts: ${summary.total_posts_processed}`);
    }
    showToast(msgParts.join(' | '), 'success', 2200);
  } catch (e) {
    console.error('Error in runInfoCollector:', e);
    // Ki·ªÉm tra n·∫øu l√† l·ªói "kh√¥ng c√≥ d·ªØ li·ªáu b√†i vi·∫øt"
    const errorMsg = (e?.message || e?.detail || String(e) || '').toLowerCase();
    if (errorMsg.includes('kh√¥ng c√≥ d·ªØ li·ªáu b√†i vi·∫øt') || 
        errorMsg.includes('khong co du lieu bai viet') ||
        errorMsg.includes('no data') ||
        errorMsg.includes('empty')) {
      showToast('Kh√¥ng c√≥ d·ªØ li·ªáu b√†i vi·∫øt ƒë·ªÉ x·ª≠ l√Ω', 'error', 4000);
    } else {
      const displayMsg = e?.message || e?.detail || 'Kh√¥ng ch·∫°y ƒë∆∞·ª£c l·∫•y th√¥ng tin (check backend).';
      showToast(displayMsg, 'error', 3000);
    }
  } finally {
    setButtonLoading(btn, false);
    // D·ª´ng poll ti·∫øn tr√¨nh
    if (infoProgressInterval) {
      clearInterval(infoProgressInterval);
      infoProgressInterval = null;
    }
    // ·∫®n container ti·∫øn tr√¨nh
    const container = document.getElementById('infoProgressContainer');
    if (container) container.style.display = 'none';
    // Gi·ªØ c√°c n√∫t pause/d·ª´ng enabled ƒë·ªÉ user c√≥ th·ªÉ b·∫•m d·ª´ng
    // Ch·ªâ reset flag khi user th·ª±c s·ª± d·ª´ng ho·∫∑c ho√†n th√†nh
    // isInfoCollectorRunning s·∫Ω ƒë∆∞·ª£c reset khi user b·∫•m stop/pause
  }
}

if (runAllInfoBtn) {
  runAllInfoBtn.addEventListener('click', () => runInfoCollector('all'));
}

if (runSelectedInfoBtn) {
  runSelectedInfoBtn.addEventListener('click', () => runInfoCollector('selected'));
}

if (timeFilterTo) {
  timeFilterTo.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      applyTimeFilter();
    }
  });
}

// ==== Tabs: Danh s√°ch qu√©t / Qu·∫£n l√Ω post / Setting profile ====
const tabConfig = {
  scan: { btn: tabScanList, view: scanView },
  post: { btn: tabPostManager, view: postView },
  settings: { btn: tabSettings, view: settingsView },
};

const ACTIVE_TAB_KEY = 'activeTab';

function switchTab(key) {
  Object.entries(tabConfig).forEach(([k, { btn, view }]) => {
    if (!btn || !view) return;
    const isActive = k === key;
    btn.classList.toggle('active', isActive);
    view.style.display = isActive ? 'block' : 'none';
  });

  if (key === 'post') {
    loadPostsForManager();
  }

  // nh·ªõ tab ƒëang m·ªü ƒë·ªÉ kh√¥ng b·ªã nh·∫£y v·ªÅ tab ƒë·∫ßu
  try {
    localStorage.setItem(ACTIVE_TAB_KEY, key);
  } catch (e) {
    // ignore
  }
}

if (tabScanList) tabScanList.addEventListener('click', (e) => {
  // Ch·ªâ chuy·ªÉn tab khi ng∆∞·ªùi d√πng th·∫≠t s·ª± b·∫•m tab; kh√¥ng auto chuy·ªÉn ·ªü n∆°i kh√°c
  e.preventDefault();
  switchTab('scan');
});
if (tabPostManager) tabPostManager.addEventListener('click', () => switchTab('post'));
if (tabSettings) tabSettings.addEventListener('click', () => switchTab('settings'));

// Kh·ªüi t·∫°o: lu√¥n v√†o tab danh s√°ch qu√©t + load state profile
let initialTab = 'scan';
try {
  const saved = localStorage.getItem(ACTIVE_TAB_KEY);
  if (saved && tabConfig[saved]) initialTab = saved;
} catch (e) {
  // ignore
}
switchTab(initialTab);
// Kh·ªüi t·∫°o: load state profile r·ªìi sync UI theo backend (ƒë·ªÉ F5 kh√¥ng b·ªã l·ªách tr·∫°ng th√°i)
(async () => {
  try {
    await loadProfileState();
  } catch (_) { }
  try {
    await resyncUiFromBackendAfterReload();
  } catch (_) { }
})();
// Kh·ªüi t·∫°o filter v·ªõi tr·∫°ng th√°i m·∫∑c ƒë·ªãnh
initializeFilters();

--- END FILE: frontend\script.js ---

--- START FILE: frontend\style.css ---
* {
  box-sizing: border-box;
  margin    : 0;
  padding   : 0;
}

:root {
  --primary       : #6366f1;
  --primary-dark  : #4f46e5;
  --danger        : #ef4444;
  --danger-dark   : #dc2626;
  --success       : #10b981;
  --orange        : #f97316;
  --orange-dark   : #ea580c;
  --pause         : #0ea5a4;
  --pause-dark    : #0f766e;
  --bg-gradient   : linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --card-bg       : #ffffff;
  --text-primary  : #1f2937;
  --text-secondary: #6b7280;
  --border        : #e5e7eb;
  --shadow        : 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --shadow-lg     : 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

body {
  font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  background : var(--bg-gradient);
  height     : 100vh;
  overflow   : hidden;
  padding    : 12px;
  color      : var(--text-primary);
  line-height: 1.6;
}

body.splash-active {
  overflow: hidden;
}

/* Splash Screen */
.splash-screen {
  position       : fixed;
  top            : 0;
  left           : 0;
  width          : 100%;
  height         : 100%;
  background     : linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
  background-size: 400% 400%;
  animation      : gradientShift 15s ease infinite;
  display        : flex;
  align-items    : center;
  justify-content: center;
  z-index        : 10000;
  transition     : opacity 0.6s ease, visibility 0.6s ease;
}

.splash-screen.hidden {
  opacity   : 0;
  visibility: hidden;
}

@keyframes gradientShift {
  0% {
    background-position: 0% 50%;
  }

  50% {
    background-position: 100% 50%;
  }

  100% {
    background-position: 0% 50%;
  }
}

.splash-content {
  text-align: center;
  animation : fadeInUp 0.8s ease-out;
}

.splash-title {
  font-size     : 48px;
  font-weight   : 700;
  color         : white;
  margin        : 0 0 16px 0;
  text-shadow   : 0 4px 20px rgba(0, 0, 0, 0.3);
  letter-spacing: 2px;
  animation     : titleGlow 2s ease-in-out infinite alternate;
}

@keyframes titleGlow {
  from {
    text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), 0 0 30px rgba(255, 255, 255, 0.2);
  }

  to {
    text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), 0 0 40px rgba(255, 255, 255, 0.4);
  }
}

.splash-subtitle {
  font-size  : 18px;
  color      : rgba(255, 255, 255, 0.9);
  margin     : 0 0 40px 0;
  font-weight: 400;
  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

.splash-btn {
  padding        : 16px 48px;
  font-size      : 18px;
  font-weight    : 600;
  color          : white;
  background     : rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
  border         : 2px solid rgba(255, 255, 255, 0.3);
  border-radius  : 50px;
  cursor         : pointer;
  transition     : all 0.3s ease;
  box-shadow     : 0 8px 32px rgba(0, 0, 0, 0.2);
  text-transform : uppercase;
  letter-spacing : 1px;
}

.splash-btn:hover {
  background  : rgba(255, 255, 255, 0.3);
  border-color: rgba(255, 255, 255, 0.5);
  transform   : translateY(-3px) scale(1.05);
  box-shadow  : 0 12px 40px rgba(0, 0, 0, 0.3);
}

.splash-btn:active {
  transform: translateY(-1px) scale(1.02);
}

/* ·∫®n container khi splash ƒëang hi·ªÉn th·ªã */
body.splash-active .container {
  opacity       : 0;
  pointer-events: none;
}

.container {
  width         : 100%;
  max-width     : 100%;
  margin        : 0 auto;
  padding       : 0 12px 12px;
  height        : 100%;
  display       : flex;
  flex-direction: column;
}

/* Header */
.header {
  background     : rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-radius  : 16px;
  padding        : 2px;
  margin-bottom  : 18px;
  box-shadow     : 0 12px 30px rgba(0, 0, 0, 0.08);
  text-align     : center;
  animation      : slideDown 0.5s ease-out;
  position       : relative;
}

.header-content h1 {
  font-size  : 28px;
  font-weight: 700;
  color      : var(--text-primary);

  background             : var(--bg-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip        : text;
}

.subtitle {
  color      : var(--text-secondary);
  font-size  : 14px;
  font-weight: 500;
}

/* Color Legend */
.color-legend {
  display        : flex;
  gap            : 20px;
  align-items    : center;
  flex-wrap      : wrap;
  justify-content: center;
  margin-bottom  : 16px;
  padding        : 10px 16px;
  background     : #f9fafb;
  border-radius  : 8px;
  border         : 1px dashed var(--border);
  font-size      : 12px;
}

.legend-item {
  display    : flex;
  align-items: center;
  gap        : 6px;
  font-size  : 13px;
  font-weight: 500;
}

.legend-dot {
  width        : 12px;
  height       : 12px;
  border-radius: 50%;
  display      : inline-block;
  box-shadow   : 0 2px 4px rgba(0, 0, 0, 0.2);
}

.legend-green {
  background: #10b981;
}

.legend-yellow {
  background: #f59e0b;
}

.legend-red {
  background: #ef4444;
}

.legend-text {
  color      : var(--text-primary);
  white-space: nowrap;
}

/* Layout */
.layout {
  display              : grid;
  grid-template-columns: 320px 1fr;
  gap                  : 16px;
  align-items          : start;
  flex                 : 1;
  min-height           : 0;
  overflow             : hidden;
}

/* Panels */
.left-panel,
.right-panel {
  background   : var(--card-bg);
  border-radius: 16px;
  box-shadow   : var(--shadow-lg);
  overflow     : hidden;
  animation    : fadeInUp 0.6s ease-out;
  transition   : transform 0.3s ease, box-shadow 0.3s ease;
}

.left-panel {
  height    : 100%;
  overflow-y: auto;
}

.right-panel {
  min-height: 0;
  height    : 100%;
  overflow-y: auto;
}

/* Right panel: gi·ªØ tab/header ƒë·ª©ng im, ch·ªâ cu·ªôn ph·∫ßn n·ªôi dung b√™n d∆∞·ªõi */
.right-panel .panel-header {
  position  : sticky;
  top       : 0;
  z-index   : 50;
  box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
}

/* Thu nh·ªè scrollbar cho right-panel cho g·ªçn (gi·ªëng left-panel) */
.right-panel::-webkit-scrollbar {
  width: 8px;
}

.right-panel::-webkit-scrollbar-track {
  background: transparent;
}

.right-panel::-webkit-scrollbar-thumb {
  background   : rgba(99, 102, 241, 0.35);
  border-radius: 999px;
}

.right-panel::-webkit-scrollbar-thumb:hover {
  background: rgba(99, 102, 241, 0.55);
}

/* Thu nh·ªè thanh scroll cho left-panel */
.left-panel::-webkit-scrollbar {
  width: 6px;
}

.left-panel::-webkit-scrollbar-track {
  background: transparent;
}

.left-panel::-webkit-scrollbar-thumb {
  background   : rgba(99, 102, 241, 0.35);
  border-radius: 999px;
}

.left-panel::-webkit-scrollbar-thumb:hover {
  background: rgba(99, 102, 241, 0.55);
}

.panel-header {
  background     : linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding        : 20px 24px;
  display        : flex;
  justify-content: space-between;
  align-items    : center;
}

.panel-header h3 {
  color      : white;
  font-size  : 18px;
  font-weight: 600;
  margin     : 0;
  display    : flex;
  align-items: center;
  gap        : 8px;
}

.badge {
  background     : rgba(255, 255, 255, 0.2);
  color          : white;
  padding        : 4px 12px;
  border-radius  : 12px;
  font-size      : 12px;
  font-weight    : 600;
  backdrop-filter: blur(10px);
}

.panel-body {
  padding: 24px;
}

/* Fields */
.field {
  margin-bottom: 20px;
}

.field:last-child {
  margin-bottom: 0;
}

.field label {
  display      : flex;
  align-items  : center;
  gap          : 8px;
  margin-bottom: 10px;
  font-weight  : 600;
  font-size    : 14px;
  color        : var(--text-primary);
}

.label-icon {
  font-size: 16px;
}

.field input {
  width        : 100%;
  padding      : 12px 16px;
  border       : 2px solid var(--border);
  border-radius: 10px;
  font-size    : 15px;
  transition   : all 0.3s ease;
  background   : #f9fafb;
  color        : var(--text-primary);
}

.field input:focus {
  outline     : none;
  border-color: var(--primary);
  background  : white;
  box-shadow  : 0 0 0 4px rgba(99, 102, 241, 0.1);
  transform   : translateY(-1px);
}

.field input::placeholder {
  color: #9ca3af;
}

/* Buttons */
button {
  width          : 100%;
  padding        : 14px 20px;
  border         : none;
  border-radius  : 12px;
  font-size      : 15px;
  font-weight    : 600;
  cursor         : pointer;
  transition     : all 0.3s ease;
  display        : flex;
  align-items    : center;
  justify-content: center;
  gap            : 8px;
  position       : relative;
  overflow       : hidden;
}

/* Loading state (spinner) */
.btn-loading {
  opacity: 0.9;
  cursor : not-allowed;
}

.btn-loading::after {
  content         : "";
  width           : 14px;
  height          : 14px;
  border-radius   : 50%;
  border          : 2px solid rgba(255, 255, 255, 0.55);
  border-top-color: rgba(255, 255, 255, 1);
  animation       : btnSpin 0.9s linear infinite;
}

@keyframes btnSpin {
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(360deg);
  }
}

button::before {
  content      : '';
  position     : absolute;
  top          : 50%;
  left         : 50%;
  width        : 0;
  height       : 0;
  border-radius: 50%;
  background   : rgba(255, 255, 255, 0.3);
  transform    : translate(-50%, -50%);
  transition   : width 0.6s, height 0.6s;
}

button:hover::before {
  width : 300px;
  height: 300px;
}

button:active {
  transform: scale(0.98);
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color     : white;
  box-shadow: 0 4px 14px 0 rgba(99, 102, 241, 0.4);
}

.btn-primary:hover {
  box-shadow: 0 6px 20px 0 rgba(99, 102, 241, 0.5);
  transform : translateY(-2px);
}

.btn-primary:disabled {
  background: #9ca3af;
  cursor    : not-allowed;
  box-shadow: none;
  transform : none;
}

.btn-danger {
  background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
  color     : white;
  box-shadow: 0 4px 14px 0 rgba(239, 68, 68, 0.4);
}

.btn-danger:hover {
  box-shadow: 0 6px 20px 0 rgba(239, 68, 68, 0.5);
  transform : translateY(-2px);
}

.btn-danger:disabled {
  background: #9ca3af;
  cursor    : not-allowed;
  box-shadow: none;
  transform : none;
}

.btn-success {
  background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
  color     : white;
  box-shadow: 0 4px 14px 0 rgba(16, 185, 129, 0.4);
}

.btn-success:hover {
  box-shadow: 0 6px 20px 0 rgba(16, 185, 129, 0.5);
  transform : translateY(-2px);
}

.btn-success:disabled {
  background: #9ca3af;
  cursor    : not-allowed;
  box-shadow: none;
  transform : none;
}

/* Stop selected (kh√°c m√†u Stop all) */
.btn-orange {
  background: linear-gradient(135deg, var(--orange) 0%, var(--orange-dark) 100%);
  color     : white;
  box-shadow: 0 4px 14px 0 rgba(249, 115, 22, 0.4);
}

.btn-orange:hover {
  box-shadow: 0 6px 20px 0 rgba(249, 115, 22, 0.5);
  transform : translateY(-2px);
}

.btn-orange:disabled {
  background: #9ca3af;
  cursor    : not-allowed;
  box-shadow: none;
  transform : none;
}

.btn-icon {
  font-size: 16px;
}

.status-line {
  display      : flex;
  align-items  : center;
  gap          : 12px;
  margin-top   : 12px;
  padding      : 12px;
  border       : 1px dashed var(--border);
  border-radius: 12px;
  background   : #f9fafb;
}

.status-text-group {
  display       : flex;
  flex-direction: column;
  gap           : 2px;
}

.status-dot {
  width        : 12px;
  height       : 12px;
  border-radius: 50%;
  background   : var(--danger);
  box-shadow   : 0 0 0 4px rgba(239, 68, 68, 0.15);
}

.status-dot.online {
  background: var(--success);
  box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.2);
  animation : pulse 2s infinite;
}

.status-label {
  font-weight: 700;
  color      : var(--text-primary);
  font-size  : 13px;
}

.status-text {
  color    : var(--text-secondary);
  font-size: 13px;
}

/* Filter Container */
.filter-container {
  margin-bottom : 16px;
  padding       : 12px 16px;
  background    : #f9fafb;
  border-radius : 10px;
  border        : 1px solid var(--border);
  display       : flex;
  flex-direction: column;
  gap           : 12px;
}

.filter-group {
  display       : flex;
  flex-direction: column;
  gap           : 8px;
}

.filter-group:not(:last-child) {
  padding-bottom: 12px;
  border-bottom : 1px dashed var(--border);
}

/* Time Filter - Compact Single Row - Beautiful Design */
.time-filter-compact {
  margin-top: 6px;
}

.time-filter-inline {
  display      : inline-flex;
  align-items  : center;
  gap          : 5px;
  background   : linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  border       : 1.5px solid var(--border);
  border-radius: 8px;
  padding      : 5px 7px;
  max-width    : fit-content;
  box-shadow   : 0 2px 6px rgba(0, 0, 0, 0.06), 0 1px 2px rgba(0, 0, 0, 0.04);
  transition   : all 0.3s ease;
}

.time-filter-inline:hover {
  border-color: var(--primary);
  box-shadow  : 0 4px 12px rgba(99, 102, 241, 0.12), 0 2px 4px rgba(0, 0, 0, 0.06);
}

.time-filter-input-compact {
  width        : 135px;
  padding      : 6px 8px;
  border       : 1px solid rgba(99, 102, 241, 0.2);
  border-radius: 6px;
  font-size    : 12px;
  background   : white;
  color        : var(--text-primary);
  transition   : all 0.25s ease;
  font-family  : inherit;
  box-shadow   : 0 1px 2px rgba(0, 0, 0, 0.04);
}

.time-filter-input-compact:hover {
  border-color: var(--primary);
  box-shadow  : 0 2px 4px rgba(99, 102, 241, 0.15);
  transform   : translateY(-1px);
}

.time-filter-input-compact:focus {
  outline     : none;
  border-color: var(--primary);
  background  : white;
  box-shadow  : 0 0 0 3px rgba(99, 102, 241, 0.1), 0 2px 6px rgba(99, 102, 241, 0.2);
  transform   : translateY(-1px);
}

.time-filter-input-compact::placeholder {
  color     : #9ca3af;
  font-size : 11px;
  font-style: italic;
}

.time-filter-separator {
  color      : var(--primary);
  font-size  : 12px;
  font-weight: 700;
  padding    : 0 2px;
  flex-shrink: 0;
  opacity    : 0.6;
  transition : opacity 0.2s ease;
}

.time-filter-inline:hover .time-filter-separator {
  opacity: 1;
}

.time-filter-btn-compact {
  width          : 28px;
  height         : 28px;
  padding        : 0;
  border         : none;
  border-radius  : 6px;
  font-size      : 13px;
  font-weight    : 700;
  cursor         : pointer;
  transition     : all 0.25s ease;
  display        : flex;
  align-items    : center;
  justify-content: center;
  flex-shrink    : 0;
  box-shadow     : 0 2px 4px rgba(0, 0, 0, 0.1);
}

.time-filter-apply-compact {
  background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
  color     : white;
}

.time-filter-apply-compact:hover {
  background: linear-gradient(135deg, #059669 0%, var(--success) 100%);
  transform : translateY(-2px) scale(1.05);
  box-shadow: 0 4px 8px rgba(16, 185, 129, 0.4);
}

.time-filter-apply-compact:active {
  transform: translateY(0) scale(1);
}

.time-filter-apply-compact.active {
  background: linear-gradient(135deg, #047857 0%, #059669 100%);
  box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.3), 0 4px 12px rgba(16, 185, 129, 0.4);
  animation : pulseSuccess 2s ease-in-out infinite;
}

@keyframes pulseSuccess {

  0%,
  100% {
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.3), 0 4px 12px rgba(16, 185, 129, 0.4);
  }

  50% {
    box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.4), 0 6px 16px rgba(16, 185, 129, 0.5);
  }
}

.time-filter-clear-compact {
  background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
  color     : var(--text-secondary);
  border    : 1px solid var(--border);
}

.time-filter-clear-compact:hover {
  background  : linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
  color       : var(--danger);
  border-color: var(--danger);
  transform   : translateY(-2px) scale(1.05);
  box-shadow  : 0 4px 8px rgba(239, 68, 68, 0.2);
}

.time-filter-clear-compact:active {
  transform: translateY(0) scale(1);
}

/* Responsive */
@media (max-width: 768px) {
  .time-filter-inline {
    flex-wrap: wrap;
  }

  .time-filter-input-compact {
    min-width: 120px;
  }
}

.filter-label {
  font-size    : 13px;
  font-weight  : 600;
  color        : var(--text-primary);
  margin-bottom: 0;
}

.filter-buttons {
  display  : flex;
  gap      : 8px;
  flex-wrap: wrap;
}

.filter-btn {
  width        : auto;
  padding      : 8px 16px;
  font-size    : 13px;
  font-weight  : 600;
  border       : 2px solid var(--border);
  background   : white;
  color        : var(--text-primary);
  border-radius: 8px;
  cursor       : pointer;
  transition   : all 0.3s ease;
  display      : flex;
  align-items  : center;
  gap          : 6px;
}

.filter-btn:hover {
  border-color: var(--primary);
  transform   : translateY(-1px);
  box-shadow  : 0 2px 8px rgba(99, 102, 241, 0.2);
}

.filter-btn.active {
  background  : linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color       : white;
  border-color: var(--primary);
  box-shadow  : 0 2px 8px rgba(99, 102, 241, 0.3);
}

.filter-btn.filter-green.active {
  background  : linear-gradient(135deg, #10b981 0%, #059669 100%);
  border-color: #10b981;
  box-shadow  : 0 2px 8px rgba(16, 185, 129, 0.3);
}

.filter-btn.filter-yellow.active {
  background  : linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  border-color: #f59e0b;
  box-shadow  : 0 2px 8px rgba(245, 158, 11, 0.3);
}

.filter-btn.filter-red.active {
  background  : linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  border-color: #ef4444;
  box-shadow  : 0 2px 8px rgba(239, 68, 68, 0.3);
}

.filter-dot {
  width        : 10px;
  height       : 10px;
  border-radius: 50%;
  display      : inline-block;
  box-shadow   : 0 1px 3px rgba(0, 0, 0, 0.2);
}

.filter-dot-green {
  background: #10b981;
}

.filter-dot-yellow {
  background: #f59e0b;
}

.filter-dot-red {
  background: #ef4444;
}

.filter-btn.active .filter-dot {
  background: white;
}

tbody tr.filtered-out {
  display: none;
}

/* Table */
.table-container {
  overflow-x   : auto;
  border-radius: 12px;
  border       : 1px solid var(--border);
  margin       : 0 10px;
}

/* Tabs trong header b√™n ph·∫£i */
.panel-tabs {
  display: flex;
  gap    : 8px;
}

.tab-button {
  width        : auto;
  padding      : 8px 14px;
  border-radius: 999px;
  border       : none;
  background   : rgba(255, 255, 255, 0.15);
  color        : #e5e7eb;
  font-size    : 13px;
  font-weight  : 600;
  cursor       : pointer;
  display      : inline-flex;
  align-items  : center;
  gap          : 6px;
  transition   : background 0.2s ease, color 0.2s ease, transform 0.1s ease;
}

.tab-button:hover {
  background: rgba(255, 255, 255, 0.25);
  transform : translateY(-1px);
}

.tab-button.active {
  background: #ffffff;
  color     : #111827;
}

/* Settings view */
.settings-stack {
  display       : flex;
  flex-direction: column;
  gap           : 14px;
  padding       : 10px;
}

.setting-card {
  background    : #f9fafb;
  border        : 1px solid var(--border);
  border-radius : 12px;
  padding       : 16px;
  display       : flex;
  flex-direction: column;
  gap           : 12px;
}

.feed-panel {
  padding      : 12px;
  border       : 1px dashed var(--border);
  border-radius: 10px;
  background   : #ffffff;
}

.feed-panel-row {
  display      : flex;
  gap          : 10px;
  align-items  : center;
  margin-bottom: 10px;
}

.feed-panel-row:last-child {
  margin-bottom: 0;
}

.feed-radio {
  display    : inline-flex;
  gap        : 6px;
  align-items: center;
  font-size  : 13px;
  font-weight: 600;
  color      : var(--text-primary);
}

.feed-duration {
  margin-left: auto;
  display    : inline-flex;
  gap        : 6px;
  align-items: center;
}

.feed-duration-left {
  margin-left: 0;
}

.feed-label {
  font-size  : 12px;
  color      : var(--text-secondary);
  font-weight: 700;
}

#feedDurationInput {
  width        : 70px;
  height       : 32px;
  padding      : 6px 10px;
  border       : 1px solid var(--border);
  border-radius: 10px;
  font-size    : 13px;
}

#feedTextInput {
  width        : 100%;
  min-height   : 64px;
  resize       : vertical;
  padding      : 10px;
  border       : 1px solid var(--border);
  border-radius: 10px;
  font-size    : 13px;
}

#scanTextInput,
#groupScanUrlInput {
  width        : 100%;
  min-height   : 96px;
  resize       : vertical;
  padding      : 10px;
  border       : 1px solid var(--border);
  border-radius: 10px;
  font-size    : 13px;
  line-height  : 1.35;
}

.feed-panel-actions {
  justify-content: flex-end;
}

.feed-panel-actions button {
  width    : auto;
  min-width: 90px;
  height   : 32px;
  padding  : 6px 12px;
  font-size: 13px;
}

.setting-card-header {
  display        : flex;
  justify-content: space-between;
  align-items    : center;
  gap            : 8px;
}

.setting-card h4 {
  margin   : 0;
  font-size: 16px;
}

.muted {
  color    : var(--text-secondary);
  font-size: 13px;
  margin   : 0;
}

.inline-field {
  display: flex;
  gap    : 10px;
}

.inline-field input {
  flex: 1;
}

/* Settings: l√†m input + button th·∫•p l·∫°i (ch·ªâ trong tab Setting profile) */
#settingsView .inline-field input,
#settingsView .add-profile-form input {
  height       : 34px;
  padding      : 6px 10px;
  font-size    : 13px;
  border-width : 1px;
  border-radius: 10px;
}

#settingsView .profile-id-input {
  height       : 34px;
  padding      : 6px 10px;
  flex         : 1;
  /* ƒÉn to√†n b·ªô ph·∫ßn c√≤n l·∫°i */
  min-width    : 0;
  font-size    : 13px;
  border       : 1px solid var(--border);
  border-radius: 10px;
  background   : #ffffff;
}

#settingsView button {
  width        : auto;
  height       : 34px;
  padding      : 6px 12px;
  font-size    : 13px;
  border-radius: 10px;
}

#settingsView .inline-field button {
  flex     : 0 0 auto;
  min-width: 120px;
}

.setting-card-actions {
  display: flex;
  gap    : 8px;
}

/* Settings: disable state r√µ r√†ng khi ch∆∞a tick profile */
#settingsView .setting-card-actions button:disabled,
#settingsView .feed-panel button:disabled {
  opacity   : 0.55;
  cursor    : not-allowed;
  box-shadow: none !important;
  filter    : saturate(0.75);
}

.profile-list {
  display       : flex;
  flex-direction: column;
  gap           : 10px;
}

/* Settings: danh s√°ch profile cu·ªôn n·ªôi b·ªô (kh√¥ng k√©o d√†i trang) */
#settingsView #profileList.profile-list {
  max-height         : min(55vh, 520px);
  overflow-y         : auto;
  padding-right      : 6px;
  /* ch·ª´a ch·ªó cho scrollbar */
  overscroll-behavior: contain;
  scrollbar-width    : thin;
  /* Firefox */
  scrollbar-color    : rgba(100, 116, 139, 0.55) transparent;
}

#settingsView #profileList.profile-list::-webkit-scrollbar {
  width: 10px;
}

#settingsView #profileList.profile-list::-webkit-scrollbar-track {
  background: transparent;
}

#settingsView #profileList.profile-list::-webkit-scrollbar-thumb {
  background-color: rgba(100, 116, 139, 0.55);
  border-radius   : 999px;
  border          : 3px solid transparent;
  background-clip : content-box;
}

.profile-row-wrap {
  display       : flex;
  flex-direction: column;
  gap           : 8px;
}

.profile-row {
  display      : flex;
  align-items  : center;
  gap          : 8px;
  padding      : 10px 12px;
  background   : #ffffff;
  border       : 1px solid var(--border);
  border-radius: 10px;
}

.profile-select {
  flex           : 0 0 auto;
  display        : flex;
  align-items    : center;
  justify-content: center;
}

.profile-select-cb {
  width : 16px;
  height: 16px;
  cursor: pointer;
}

.group-panel {
  padding      : 10px 12px;
  background   : #f9fafb;
  border       : 1px dashed var(--border);
  border-radius: 10px;
}

.group-panel-header {
  font-size    : 12px;
  font-weight  : 700;
  color        : var(--text-primary);
  margin-bottom: 8px;
}

.group-textarea {
  width        : 100%;
  min-height   : 120px;
  resize       : vertical;
  padding      : 10px;
  border       : 1px solid var(--border);
  border-radius: 10px;
  font-size    : 12px;
  background   : #ffffff;
  color        : var(--text-primary);
  outline      : none;
}

.group-textarea:focus {
  border-color: var(--primary);
  box-shadow  : 0 0 0 4px rgba(99, 102, 241, 0.1);
}

.group-panel-actions {
  display        : flex;
  gap            : 8px;
  justify-content: flex-end;
  margin-top     : 8px;
}


.profile-row .profile-id {
  flex       : 1 1 40%;
  font-weight: 700;
  font-size  : 14px;
  word-break : break-all;
}

.profile-row .profile-actions {
  display        : flex;
  gap            : 8px;
  flex-wrap      : wrap;
  justify-content: flex-end;
}

.profile-state-badge {
  display        : inline-flex;
  align-items    : center;
  justify-content: center;
  padding        : 6px 10px;
  border-radius  : 10px;
  font-weight    : 800;
  font-size      : 12px;
  min-width      : 84px;
  white-space    : nowrap;
  color          : #fff;
  box-shadow     : 0 2px 6px rgba(0, 0, 0, 0.12);
}

.profile-state-badge.state-running { background: #10b981; } /* green */
.profile-state-badge.state-paused  { background: rgb(157, 168, 0); } /* yellow */
.profile-state-badge.state-ready   { background: #64748b; } /* slate */

.profile-row .profile-actions button {
  width    : auto;
  flex     : 0 0 auto;
  min-width: 70px;
  height   : 30px;
  padding  : 4px 10px;
  font-size: 12px;
}

.add-profile-row {
  margin-top: 8px;
}

.add-profile-row button {
  width: 100%;
}

.add-profile-form {
  background  : #f8fafc;
  border-style: dashed;
  gap         : 8px;
}

.add-profile-form input {
  flex         : 1 1 60%;
  padding      : 12px 14px;
  border       : 1px solid var(--border);
  border-radius: 8px;
}

.add-profile-form button {
  min-width: 80px;
  height   : 30px;
  padding  : 4px 10px;
  font-size: 12px;
}

.empty-state-box {
  border       : 1px dashed var(--border);
  border-radius: 10px;
  padding      : 12px;
  text-align   : center;
}

.hint {
  font-size: 12px;
  color    : var(--text-secondary);
}

/* Toast (thay cho alert ƒë·ªÉ kh√¥ng nh√°y UI) */
.toast-container {
  position      : fixed;
  top           : 14px;
  left          : 50%;
  transform     : translateX(-50%);
  display       : flex;
  flex-direction: column;
  gap           : 8px;
  z-index       : 2000;
  pointer-events: none;
}

.toast {
  pointer-events: none;
  min-width     : 260px;
  max-width     : min(520px, calc(100vw - 24px));
  background    : rgba(17, 24, 39, 0.92);
  color         : #fff;
  border-radius : 12px;
  padding       : 10px 12px;
  box-shadow    : 0 10px 30px rgba(0, 0, 0, 0.25);
  font-size     : 13px;
  line-height   : 1.35;
  opacity       : 0;
  transform     : translateY(-6px);
  transition    : opacity 180ms ease, transform 180ms ease;
}

.toast.show {
  opacity  : 1;
  transform: translateY(0);
}

.toast.success {
  background: rgba(16, 185, 129, 0.92);
}

.toast.error {
  background: rgba(239, 68, 68, 0.92);
}

#settingsPreview {
  width        : 100%;
  padding      : 12px;
  border       : 1px solid var(--border);
  border-radius: 10px;
  background   : #0b1021;
  color        : #e5e7eb;
  font-family  : "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
  font-size    : 13px;
  resize       : vertical;
}

table {
  width          : 100%;
  border-collapse: collapse;
  font-size      : 14px;
  background     : white;
}

/* T·ªëi ∆∞u b·∫£ng Qu·∫£n l√Ω post ƒë·ªÉ h·∫°n ch·∫ø scroll ngang */
#postTable {
  table-layout: fixed;
}

#postTable th:nth-child(1) {
  width: 22%;
}

#postTable th:nth-child(2) {
  width: 58%;
}

#postTable th:nth-child(3) {
  width: 20%;
}

#postTable td:nth-child(2) {
  white-space: normal;
  word-break : break-word;
}

/* Ri√™ng ph·∫ßn Qu·∫£n l√Ω post: ·∫©n h·∫≥n thanh scroll ngang cho g·ªçn */
#postView .table-container {
  overflow-x        : auto;
  scrollbar-width   : none;
  /* Firefox */
  -ms-overflow-style: none;
  /* IE/Edge c≈© */
}

#postView .table-container::-webkit-scrollbar {
  display: none;
  /* Chrome/Safari */
}

thead {
  background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
}

th {
  padding       : 16px;
  text-align    : left;
  font-weight   : 700;
  color         : var(--text-primary);
  text-transform: uppercase;
  font-size     : 12px;
  letter-spacing: 0.5px;
  border-bottom : 2px solid var(--border);
}

td {
  padding      : 16px;
  border-bottom: 1px solid var(--border);
  color        : var(--text-primary);
}

/* Link cho ID (ID B√†i Post, ID User) */
.id-link {
  color          : #2563eb;
  text-decoration: none;
  font-weight    : 500;
}

.id-link:hover {
  text-decoration: underline;
}

/* Type column colors */
td.type-cell {
  font-weight: 600;
  text-align : center;
}

td.type-cell.type-green {
  background: #49ee98;
  color     : #065f46;
}

td.type-cell.type-yellow {
  background: #e9d47d;
  color     : #92400e;
}

td.type-cell.type-red {
  background: #ed7b7b;
  color     : #991b1b;
}

tbody tr {
  transition: all 0.2s ease;
}

tbody tr:hover {
  background: #f9fafb;
  transform : scale(1.01);
}

tbody tr:last-child td {
  border-bottom: none;
}

/* Empty State */
.empty {
  text-align: center;
  padding   : 60px 20px;
  color     : var(--text-secondary);
  display   : none;
}

.empty.show {
  display: block;
}

.empty-icon {
  font-size    : 64px;
  margin-bottom: 16px;
  opacity      : 0.5;
}

.empty p {
  font-size    : 16px;
  font-weight  : 600;
  margin-bottom: 8px;
  color        : var(--text-primary);
}

.empty-hint {
  font-size  : 14px;
  color      : var(--text-secondary);
  font-weight: 400;
}

/* Animations */
@keyframes slideDown {
  from {
    opacity  : 0;
    transform: translateY(-20px);
  }

  to {
    opacity  : 1;
    transform: translateY(0);
  }
}

@keyframes fadeInUp {
  from {
    opacity  : 0;
    transform: translateY(20px);
  }

  to {
    opacity  : 1;
    transform: translateY(0);
  }
}

@keyframes pulse {

  0%,
  100% {
    opacity: 1;
  }

  50% {
    opacity: 0.5;
  }
}

/* Modal */
.modal {
  position       : fixed;
  top            : 0;
  left           : 0;
  right          : 0;
  bottom         : 0;
  background     : rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  display        : flex;
  align-items    : center;
  justify-content: center;
  z-index        : 1000;
  opacity        : 0;
  transition     : opacity 0.3s ease;
  pointer-events : none;
}

.modal.show {
  opacity       : 1;
  pointer-events: all;
}

.modal-content {
  background    : var(--card-bg);
  border-radius : 16px;
  box-shadow    : var(--shadow-lg);
  width         : 90%;
  max-width     : 500px;
  max-height    : 90vh;
  overflow      : hidden;
  display       : flex;
  flex-direction: column;
  transform     : scale(0.9) translateY(20px);
  transition    : transform 0.3s ease;
}

.modal.show .modal-content {
  transform: scale(1) translateY(0);
}

.modal-header {
  background     : linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding        : 20px 24px;
  display        : flex;
  justify-content: space-between;
  align-items    : center;
}

.modal-header h3 {
  color      : white;
  font-size  : 18px;
  font-weight: 600;
  margin     : 0;
}

.modal-close {
  background     : rgba(255, 255, 255, 0.2);
  border         : none;
  color          : white;
  font-size      : 24px;
  width          : 32px;
  height         : 32px;
  border-radius  : 50%;
  cursor         : pointer;
  display        : flex;
  align-items    : center;
  justify-content: center;
  transition     : all 0.3s ease;
  padding        : 0;
  line-height    : 1;
}

.modal-close:hover {
  background: rgba(255, 255, 255, 0.3);
  transform : rotate(90deg);
}

.modal-body {
  padding   : 24px;
  overflow-y: auto;
  flex      : 1;
}

.modal-body textarea {
  width        : 100%;
  padding      : 12px 16px;
  border       : 2px solid var(--border);
  border-radius: 10px;
  font-size    : 15px;
  transition   : all 0.3s ease;
  background   : #f9fafb;
  color        : var(--text-primary);
  font-family  : inherit;
  resize       : vertical;
}

.modal-body textarea:focus {
  outline     : none;
  border-color: var(--primary);
  background  : white;
  box-shadow  : 0 0 0 4px rgba(99, 102, 241, 0.1);
}

.modal-footer {
  padding        : 20px 24px;
  border-top     : 1px solid var(--border);
  display        : flex;
  gap            : 12px;
  justify-content: flex-end;
}

.modal-footer button {
  width    : auto;
  min-width: 100px;
  padding  : 10px 20px;
}

.btn-secondary {
  background: rgb(255, 255, 255);
  color     : rgb(0, 0, 0);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.btn-nuoiacc {
  background: rgb(0, 192, 26);
  color     : rgb(255, 255, 255);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.btn-yellow {
  background: rgb(157, 168, 0);
  color     : rgb(255, 255, 255);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.btn-yellow:hover {
  background: #e5e7eb;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

/* Pause selected (kh√°c m√†u Pause all) */
.btn-pause {
  background: rgb(14, 165, 164);
  color     : rgb(255, 255, 255);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.btn-pause:hover {
  background: #e5e7eb;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.btn-nuoiacc:hover {
  background: #e5e7eb;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.btn-secondary:hover {
  background: #e5e7eb;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.btn-secondary:disabled {
  background: #9ca3af;
  cursor    : not-allowed;
  box-shadow: none;
}

/* Help Button */
.help-button {
  position       : fixed;
  top            : 24px;
  right          : 36px;
  width          : 48px;
  height         : 48px;
  border-radius  : 50%;
  background     : linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color          : white;
  border         : none;
  font-size      : 24px;
  font-weight    : 700;
  cursor         : pointer;
  box-shadow     : 0 4px 14px 0 rgba(99, 102, 241, 0.4);
  transition     : all 0.3s ease;
  z-index        : 999;
  display        : flex;
  align-items    : center;
  justify-content: center;
  line-height    : 1;
}

.help-button:hover {
  transform : scale(1.1);
  box-shadow: 0 6px 20px 0 rgba(99, 102, 241, 0.6);
}

.help-button:active {
  transform: scale(0.95);
}

/* Help Tooltip */
.help-tooltip {
  position      : fixed;
  top           : 90px;
  right         : 24px;
  width         : 320px;
  background    : var(--card-bg);
  border-radius : 12px;
  box-shadow    : var(--shadow-lg);
  z-index       : 1000;
  opacity       : 0;
  transform     : translateY(-10px);
  transition    : all 0.3s ease;
  pointer-events: none;
  border        : 1px solid var(--border);
}

.help-tooltip.show {
  opacity       : 1;
  transform     : translateY(0);
  pointer-events: all;
}

.tooltip-header {
  background     : linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding        : 16px 20px;
  border-radius  : 12px 12px 0 0;
  display        : flex;
  justify-content: space-between;
  align-items    : center;
}

.tooltip-header h4 {
  color      : white;
  font-size  : 16px;
  font-weight: 600;
  margin     : 0;
}

.tooltip-close {
  background     : rgba(255, 255, 255, 0.2);
  border         : none;
  color          : white;
  font-size      : 20px;
  width          : 28px;
  height         : 28px;
  border-radius  : 50%;
  cursor         : pointer;
  display        : flex;
  align-items    : center;
  justify-content: center;
  transition     : all 0.3s ease;
  padding        : 0;
  line-height    : 1;
}

.tooltip-close:hover {
  background: rgba(255, 255, 255, 0.3);
  transform : rotate(90deg);
}

.tooltip-body {
  padding: 20px;
}

.tooltip-item {
  display      : flex;
  align-items  : flex-start;
  gap          : 12px;
  margin-bottom: 16px;
}

.tooltip-item:last-child {
  margin-bottom: 0;
}

.tooltip-dot {
  width        : 16px;
  height       : 16px;
  border-radius: 50%;
  display      : inline-block;
  flex-shrink  : 0;
  margin-top   : 2px;
  box-shadow   : 0 2px 4px rgba(0, 0, 0, 0.2);
}

.tooltip-green {
  background: #10b981;
}

.tooltip-yellow {
  background: #f59e0b;
}

.tooltip-red {
  background: #ef4444;
}

.tooltip-item div {
  flex       : 1;
  font-size  : 14px;
  line-height: 1.5;
  color      : var(--text-primary);
}

.tooltip-item strong {
  color      : var(--text-primary);
  font-weight: 600;
}

/* N√∫t xem comment (icon con m·∫Øt) */
.comment-eye-btn {
  background   : transparent;
  border       : none;
  cursor       : pointer;
  font-size    : 20px;
  line-height  : 1;
  padding      : 6px 8px;
  border-radius: 6px;
  transition   : background 0.2s ease, transform 0.1s ease;
}

.comment-eye-btn:hover {
  background: rgba(148, 163, 184, 0.15);
  transform : scale(1.05);
}

/* Text comment c√≥ th·ªÉ click ƒë·ªÉ ·∫©n */
.comment-text {
  cursor       : pointer;
  color        : var(--text-primary);
  padding      : 4px 8px;
  border-radius: 6px;
  transition   : background 0.2s ease;
  display      : inline-block;
  word-break   : break-word;
  max-width    : 100%;
}

.comment-text:hover {
  background: rgba(148, 163, 184, 0.1);
}

td:nth-child(5) {
  text-align: center;
}

/* Floating chat buttons (Messenger & Zalo) */
.chat-floating {
  position      : fixed;
  right         : 24px;
  bottom        : 24px;
  display       : flex;
  flex-direction: column;
  gap           : 10px;
  z-index       : 900;
}

.chat-btn {
  width          : 68px;
  height         : 68px;
  border-radius  : 50%;
  display        : flex;
  align-items    : center;
  justify-content: center;
  color          : #ffffff;
  font-weight    : 700;
  font-size      : 18px;
  text-decoration: none;
  box-shadow     : 0 6px 18px rgba(15, 23, 42, 0.45);
  transition     : transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease;
  opacity        : 0.95;
}

.chat-btn:hover {
  transform : translateY(-2px) scale(1.03);
  box-shadow: 0 10px 25px rgba(15, 23, 42, 0.55);
  opacity   : 1;
}

.chat-mess {
  background: linear-gradient(135deg, #f8f8f8 0%, #ffffff 100%);
}

.chat-zalo {
  background: linear-gradient(135deg, #ffffff 0%, #ffffff 100%);
}

.chat-icon {
  width  : 50px;
  height : 50px;
  display: block;
}

/* Icon Messenger: v√≤ng tr√≤n gradient + tia s√©t */
.chat-icon-mess {
  position     : relative;
  border-radius: 50%;
  background   : radial-gradient(circle at 30% 0, #ffffff 0, #ffffff 8%, transparent 20%),
    radial-gradient(circle at 30% 0, #ff7cf8 0, #ff7cf8 25%, transparent 55%),
    radial-gradient(circle at 70% 100%, #00c6ff 0, #0078ff 40%, #4b00ff 90%);
}

.chat-icon-mess::before {
  content      : '';
  position     : absolute;
  left         : 9px;
  top          : 11px;
  width        : 14px;
  height       : 8px;
  border-radius: 999px;
  border       : 2px solid #ffffff;
  border-top   : none;
  transform    : rotate(10deg);
}

.chat-icon-mess::after {
  content      : '';
  position     : absolute;
  left         : 13px;
  top          : 11px;
  width        : 6px;
  height       : 8px;
  border-right : 2px solid #ffffff;
  border-bottom: 2px solid #ffffff;
  transform    : rotate(25deg);
}

/* Icon Zalo: ch·ªØ Z trong khung bo tr√≤n */
.chat-icon-zalo {
  position       : relative;
  border-radius  : 12px;
  background     : white;
  font-weight    : 700;
  font-size      : 13px;
  color          : #0066ff;
  display        : flex;
  align-items    : center;
  justify-content: center;
  font-family    : system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

.chat-icon-zalo::before {
  content: 'Z';
}

/* ·∫¢nh Zalo th·∫≠t */
.chat-img {
  width        : 50px;
  height       : 50px;
  display      : block;
  border-radius: 12px;
  object-fit   : cover;
}

/* Responsive */
@media (max-width: 1024px) {
  .layout {
    grid-template-columns: 1fr;
  }

  .left-panel {
    order: 2;
  }

  .right-panel {
    order: 1;
  }
}

@media (max-width: 768px) {
  body {
    padding: 12px;
  }

  .header {
    padding: 20px;
  }

  .header-content h1 {
    font-size: 24px;
  }

  .panel-body {
    padding: 20px;
  }

  th,
  td {
    padding  : 12px;
    font-size: 13px;
  }

  .splash-title {
    font-size     : 32px;
    letter-spacing: 1px;
  }

  .splash-subtitle {
    font-size    : 16px;
    margin-bottom: 30px;
  }

  .splash-btn {
    padding  : 14px 36px;
    font-size: 16px;
  }
}


#scanRunMinutesInput {
  border-radius: 5px;
  border       : 1px solid var(--border);
  padding      : 4px;
}

#scanRestMinutesInput {
  border-radius: 5px;
  border       : 1px solid var(--border);
  padding      : 4px;
}

#feedRunMinutesInput {
  border-radius: 5px;
  border       : 1px solid var(--border);
  padding      : 4px;
}

#feedRestMinutesInput {
  border-radius: 5px;
  border       : 1px solid var(--border);
  padding      : 4px;
}

/* groupScanUrlInput ƒë√£ d√πng chung style textarea ·ªü ph√≠a tr√™n */
--- END FILE: frontend\style.css ---

